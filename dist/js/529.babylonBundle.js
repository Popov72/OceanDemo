(self.webpackChunkbabylonjs_ocean_demo=self.webpackChunkbabylonjs_ocean_demo||[]).push([[529,292,955,827,817,59,113],{4292:(e,t,a)=>{"use strict";a.r(t),a.d(t,{Buoyancy:()=>s});var i=a(7976),s=function(){function e(e,t,a){void 0===t&&(t=5),void 0===a&&(a=1),this.enabled=!0,this._size=e,this._displacementMap=null,this._lengthScale=0,this._numSteps=t,this._attenuation=a,this._meshes=[]}return e.prototype.setWaterHeightMap=function(e,t){this._displacementMap=e,this._lengthScale=t},e.prototype.addMesh=function(e,t,a,s){void 0===a&&(a=0),void 0===s&&(s=0),this._meshes.push({mesh:e,frame:t,yOffset:a,spaceCoordinates:s,initQuaternion:e.rotationQuaternion.clone(),curStep:0,curQuaternion:new i.Quaternion,stepQuaternion:new i.Quaternion})},Object.defineProperty(e.prototype,"size",{set:function(e){this._size=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attenuation",{get:function(){return this._attenuation},set:function(e){this._attenuation=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numSteps",{get:function(){return this._numSteps},set:function(e){this._numSteps=e},enumerable:!1,configurable:!0}),e.prototype.update=function(){if(this.enabled)for(var e=0;e<this._meshes.length;++e)this._updateMesh(this._meshes[e])},e.prototype.getWaterHeight=function(e){var t=i.TmpVectors.Vector3[0];return this._getWaterDisplacement(e,t),e.subtractToRef(t,t),this._getWaterDisplacement(e,t),e.subtractToRef(t,t),this._getWaterDisplacement(e,t),e.subtractToRef(t,t),this._getWaterDisplacement(e,t),t.y},e.prototype._updateMesh=function(e){var t=i.TmpVectors.Vector3[5],a=i.TmpVectors.Vector3[6],s=i.TmpVectors.Vector3[7],r=i.TmpVectors.Vector3[8],n=i.TmpVectors.Vector3[9],o=i.TmpVectors.Vector3[10],l=i.TmpVectors.Vector3[11],c=i.TmpVectors.Vector3[12],h=e.mesh,_=e.frame,d=e.yOffset,u=e.spaceCoordinates,p=e.initQuaternion,m=e.curQuaternion,y=e.stepQuaternion,f=e.curStep;i.Vector3.TransformCoordinatesToRef(_.v1,h.getWorldMatrix(),t);var v=this.getWaterHeight(t);if(h.position.y=v+d,_.v2&&_.v3){if(f<this._numSteps)return e.curStep++,m.multiplyToRef(y,m),void p.multiplyToRef(m,h.rotationQuaternion);i.Vector3.TransformCoordinatesToRef(_.v2,h.getWorldMatrix(),a),a.subtractToRef(t,l),l.normalize(),i.Vector3.TransformCoordinatesToRef(_.v3,h.getWorldMatrix(),s),s.subtractToRef(t,c),c.normalize(),t.y=v,r.copyFrom(a),r.y=this.getWaterHeight(a),r.subtractToRef(t,r),r.normalize(),n.copyFrom(s),n.y=this.getWaterHeight(s),n.subtractToRef(t,n),n.normalize(),i.Vector3.CrossToRef(n,r,o),i.Vector3.CrossToRef(r,o,n),n.normalize();var g=Math.acos(i.Scalar.Clamp(i.Vector3.Dot(l,r),0,1))*this._attenuation,b=Math.acos(i.Scalar.Clamp(i.Vector3.Dot(c,n),0,1))*this._attenuation;switch(u){case 0:r.y>l.y&&(g=-g),n.y>c.y&&(b=-b),i.Quaternion.FromEulerAnglesToRef(g/this._numSteps,b/this._numSteps,0,e.stepQuaternion);break;case 1:r.y>l.y&&(g=-g),n.y<c.y&&(b=-b),i.Quaternion.FromEulerAnglesToRef(g/this._numSteps,0,b/this._numSteps,e.stepQuaternion);break;case 2:r.y>l.y&&(g=-g),n.y>c.y&&(b=-b),i.Quaternion.FromEulerAnglesToRef(g/this._numSteps,0,b/this._numSteps,e.stepQuaternion)}e.curStep=0}},e.prototype._getWaterDisplacement=function(e,t){if(this._displacementMap){var a=this._size-1,s=e.x/this._lengthScale*this._size,r=e.z/this._lengthScale*this._size,n=i.TmpVectors.Vector3[1],o=i.TmpVectors.Vector3[2],l=i.TmpVectors.Vector3[3],c=i.TmpVectors.Vector3[4],h=Math.floor(s),_=Math.floor(r),d=s-h,u=r-_;h&=a,_&=a,this._getDisplacement(h,_,n),this._getDisplacement(h+1&a,_,o),o.subtractToRef(n,l).scaleToRef(d,l).addToRef(n,l),this._getDisplacement(h,_+1&a,n),this._getDisplacement(h+1&a,_+1&a,o),o.subtractToRef(n,c).scaleToRef(d,c).addToRef(n,c),c.subtractToRef(l,t).scaleToRef(u,t).addToRef(l,t)}else t.set(e.x,e.y,e.z)},e.prototype._getDisplacement=function(e,t,a){this._displacementMap&&(a.x=i.TextureTools.FromHalfFloat(this._displacementMap[t*this._size*4+4*e+0]),a.y=i.TextureTools.FromHalfFloat(this._displacementMap[t*this._size*4+4*e+1]),a.z=i.TextureTools.FromHalfFloat(this._displacementMap[t*this._size*4+4*e+2]))},e}()},4529:(e,t,a)=>{"use strict";a.r(t),a.d(t,{Ocean:()=>f,default:()=>v});var i=a(7976),s=a(3577),r=a(5811),n=a(6853),o=a(4059),l=a(1817),c=a(4292),h=a(3955),_=a(827),d=a(6113);a(7790);const u=a.p+"cb69d722ba0e1aed94b8f0e32058b799.exr",p=(a.p,a.p,a.p+"643a55451fd81c682e86ba94241de29e.glb");var m=function(e,t,a,i){return new(a||(a=Promise))((function(s,r){function n(e){try{l(i.next(e))}catch(e){r(e)}}function o(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(n,o)}l((i=i.apply(e,t||[])).next())}))},y=function(e,t){var a,i,s,r,n={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;n;)try{if(a=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return n.label++,{value:r[1],done:!1};case 5:n.label++,i=r[1],r=[0];continue;case 7:r=n.ops.pop(),n.trys.pop();continue;default:if(!((s=(s=n.trys).length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){n=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){n.label=r[1];break}if(6===r[0]&&n.label<s[1]){n.label=s[1],s=r;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(r);break}s[2]&&n.ops.pop(),n.trys.pop();continue}r=t.call(e,n)}catch(e){r=[6,e],i=0}finally{a=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}},f=function(){function e(){this._engine=null,this._scene=null,this._camera=null,this._rttDebug=null,this._light=null,this._depthRenderer=null,this._buoyancy=null,this._fxaa=null,this._gui=null,this._skybox=null,this._oceanMaterial=null,this._oceanGeometry=null,this._wavesGenerator=null,this._useZQSD=!1,this._useProceduralSky=!0,this._lightDirection=new i.Vector3(0,-1,-.25),this._shadowGenerator=null,this._lightBuoy=null,this._shadowGeneratorBuoy=null,this._glowLayer=null,this._forceUpdateGlowIntensity=!0,this._size=0,this._wavesSettings=new d.WavesSettings}return e.prototype.createScene=function(e,t){return m(this,void 0,void 0,(function(){var a,s,n=this;return y(this,(function(d){switch(d.label){case 0:return window.convf=function(e){var t=new Uint8Array([255&e,(65280&e)>>8,(16711680&e)>>16,(4278190080&e)>>24]);return new Float32Array(t.buffer)[0]},window.numbg=function(){console.log("NumBindGroupsCreatedTotal=",i.WebGPUCacheBindGroups.NumBindGroupsCreatedTotal," - NumBindGroupsCreatedLastFrame=",i.WebGPUCacheBindGroups.NumBindGroupsCreatedLastFrame)},(a=new i.Scene(e)).useRightHandedSystem=!0,this._engine=e,this._scene=a,this._camera=new i.FreeCamera("mainCamera",new i.Vector3(-17.3,5,-9),a),this._camera.rotation.set(.21402315044176745,1.5974857677541419,0),this._camera.minZ=1,this._camera.maxZ=1e5,this._checkSupport()?(this._setCameraKeys(),[4,_.OceanGUI.LoadDAT()]):[2,a];case 1:return d.sent(),this._rttDebug=new r.RTTDebug(a,e,32),this._rttDebug.show(!1),a.environmentIntensity=1,a.activeCameras=[this._camera,this._rttDebug.camera],this._camera.attachControl(t,!0),s=this._camera.update.bind(this._camera),this._camera.update=function(){s(),this.position.y<1.5&&(this.position.y=1.5)},this._depthRenderer=this._scene.enableDepthRenderer(this._camera,!1),this._depthRenderer.getDepthMap().renderList=[],this._light=new i.DirectionalLight("light",this._lightDirection,a),this._light.intensity=1,this._light.diffuse=new i.Color3(1,1,1),this._light.shadowMinZ=0,this._light.shadowMaxZ=40,this._light.shadowOrthoScale=.5,this._shadowGenerator=new i.ShadowGenerator(4096,this._light),this._shadowGenerator.usePercentageCloserFiltering=!0,this._shadowGenerator.bias=.005,this._skybox=new o.SkyBox(this._useProceduralSky,a),this._buoyancy=new c.Buoyancy(this._size,3,.2),this._oceanMaterial=new l.OceanMaterial(this._depthRenderer,this._scene),this._oceanGeometry=new h.OceanGeometry(this._oceanMaterial,this._camera,this._scene),this._fxaa=new i.FxaaPostProcess("fxaa",1,this._camera),this._fxaa.samples=e.getCaps().maxMSAASamples,[4,this._loadMeshes()];case 2:return d.sent(),[4,this._updateSize(256)];case 3:return d.sent(),this._oceanGeometry.initializeMeshes(),this._gui=new _.OceanGUI(this._useProceduralSky,a,e,this._parameterRead.bind(this),this._parameterChanged.bind(this)),-1!==location.href.indexOf("hidegui")&&(this._gui.visible=!1),this._scene.onKeyboardObservable.add((function(e){switch(e.type){case i.KeyboardEventTypes.KEYDOWN:"Shift"===e.event.key&&(n._camera.speed=10);break;case i.KeyboardEventTypes.KEYUP:"Shift"===e.event.key&&(n._camera.speed=2)}})),a.onBeforeRenderObservable.add((function(){if(n._skybox.update(n._light)||n._forceUpdateGlowIntensity){if(n._glowLayer){var e=n._light.position.clone().normalize(),t=e.clone().normalize();t.y=0;var a=i.Vector3.Dot(e,t),s=i.Scalar.Lerp(.6,3,i.Scalar.Clamp(a,0,1));n._glowLayer.intensity=e.y<0?3:s,n._forceUpdateGlowIntensity=!1}n._light.position=n._light.position.clone().normalize().scaleInPlace(30)}n._oceanGeometry.update(),n._wavesGenerator.update(),n._buoyancy.setWaterHeightMap(n._wavesGenerator.waterHeightMap,n._wavesGenerator.waterHeightMapScale),n._buoyancy.update()})),[2,new Promise((function(e){a.executeWhenReady((function(){return e(a)}))}))]}}))}))},e.prototype._setCameraKeys=function(){var e=this._camera.inputs.attached.keyboard;this._useZQSD?(e.keysDown=[40,83],e.keysLeft=[37,81],e.keysRight=[39,68],e.keysUp=[38,90]):(e.keysDown=[40,83],e.keysLeft=[37,65],e.keysRight=[39,68],e.keysUp=[38,87]),e.keysDownward=[34,32],e.keysUpward=[33,69]},e.prototype._checkSupport=function(){if(this._engine.getCaps().supportComputeShaders)return!0;var e=s.in.CreateFullscreenUI("UI"),t=new s.al;return t.text="**Use WebGPU to watch this demo which requires compute shaders support. To enable WebGPU please use Chrome Canary or Edge canary. Also select the WebGPU engine from the top right drop down menu.**",t.width="100%",t.paddingLeft="5px",t.paddingRight="5px",t.textHorizontalAlignment=s.oT.HORIZONTAL_ALIGNMENT_CENTER,t.textVerticalAlignment=s.oT.VERTICAL_ALIGNMENT_CENTER,t.color="red",t.fontSize="24px",t.fontStyle="bold",t.textWrapping=!0,e.addControl(t),!1},e.prototype._loadMeshes=function(){return m(this,void 0,void 0,(function(){var e,t,a,s,r,n,o,l=this;return y(this,(function(c){switch(c.label){case 0:return[3,2];case 1:c.sent(),(e=this._scene.getMeshByName("pTorus5_lambert1_0")).scaling.setAll(.1),e.position.y=-.3,e.position.z=-15,e.receiveShadows=!0,this._depthRenderer.getDepthMap().renderList.push(e),this._buoyancy.addMesh(e,{v1:new i.Vector3(0,5,-6),v2:new i.Vector3(0,5,6),v3:new i.Vector3(5,5,-6)},-.3,1),this._shadowGenerator.addShadowCaster(e),c.label=2;case 2:return[3,4];case 3:c.sent(),(t=this._scene.getTransformNodeByName("Cube.022")).scaling.setAll(3),t.position.x=-5,t.position.y=1.5,t.position.z=-10,(o=this._depthRenderer.getDepthMap().renderList).push.apply(o,t.getChildMeshes(!1)),this._buoyancy.addMesh(t,{v1:new i.Vector3(0,2,0),v2:new i.Vector3(0,-1.2,0),v3:new i.Vector3(.4,2,0)},1.5,0),t.getChildMeshes(!1).forEach((function(e){e.receiveShadows=!0,l._shadowGenerator.addShadowCaster(e)})),c.label=4;case 4:return[4,i.SceneLoader.AppendAsync("",p,this._scene,void 0,".glb")];case 5:c.sent(),a=[this._scene.getMeshByName("buoyMesh_low")],s=a[0].parent,r=14,s.position.z=-8,s.scaling.setAll(r),a.forEach((function(e){e.material.backFaceCulling=!1,l._shadowGenerator.addShadowCaster(e),e.receiveShadows=!0,l._depthRenderer.getDepthMap().renderList.push(e)})),s.rotationQuaternion=i.Quaternion.FromEulerAngles(0,Math.PI/3,0),this._buoyancy.addMesh(s,{v1:new i.Vector3(.7/r,1/r,-1.5/r),v2:new i.Vector3(.7/r,1/r,1.5/r),v3:new i.Vector3(-1.5/r,1/r,-1.5/r)},0,2),(n=i.MeshBuilder.CreateSphere("slight",{segments:6,diameter:.5/r},this._scene)).position.set(-.6/r,6.58/r,.3/r),n.visibility=0,n.parent=s,this._lightBuoy=new i.PointLight("point",new i.Vector3(0,0,0),this._scene),this._lightBuoy.intensity=30,this._lightBuoy.diffuse=new i.Color3(.96,.7,.15).toLinearSpace(),this._lightBuoy.shadowMinZ=.01,this._lightBuoy.shadowMaxZ=15,this._lightBuoy.parent=n,this._shadowGeneratorBuoy=new i.ShadowGenerator(2048,this._lightBuoy),this._shadowGeneratorBuoy.usePoissonSampling=!0,this._shadowGeneratorBuoy.addShadowCaster(a[0]),this._shadowGeneratorBuoy.bias=.01,c.label=6;case 6:return[2]}}))}))},e.prototype._createGlowLayer=function(){var e=this;this._glowLayer=new i.GlowLayer("glow",this._scene),this._glowLayer.addIncludedOnlyMesh(this._scene.getMeshByName("glassCovers_low")),this._glowLayer.customEmissiveColorSelector=function(t,a,i,s){s.set(e._lightBuoy.diffuse.r,e._lightBuoy.diffuse.g,e._lightBuoy.diffuse.b,1)},this._forceUpdateGlowIntensity=!0},e.prototype._updateSize=function(e){var t;return m(this,void 0,void 0,(function(){var a;return y(this,(function(i){switch(i.label){case 0:return this._size=e,this._buoyancy.size=e,[4,fetch(u)];case 1:return[4,i.sent().arrayBuffer()];case 2:return a=i.sent(),null===(t=this._wavesGenerator)||void 0===t||t.dispose(),this._wavesGenerator=new n.WavesGenerator(this._size,this._wavesSettings,this._scene,this._rttDebug,a),this._oceanMaterial.setWavesGenerator(this._wavesGenerator),[4,this._oceanGeometry.initializeMaterials()];case 3:return i.sent(),[2]}}))}))},e.prototype._readValue=function(e,t){for(var a=t.split("_"),i=0;i<a.length;++i)e=e[a[i]];return e},e.prototype._setValue=function(e,t,a){for(var i=t.split("_"),s=0;s<i.length-1;++s)e=e[i[s]];e[i[i.length-1]]=a},e.prototype._parameterRead=function(e){switch(e){case"size":return this._size;case"showDebugRTT":return this._rttDebug.isVisible;case"envIntensity":return this._scene.environmentIntensity;case"lightIntensity":return this._light.intensity;case"proceduralSky":return this._useProceduralSky;case"enableShadows":return this._light.shadowEnabled;case"enableFXAA":return null!==this._fxaa;case"enableGlow":return null!==this._glowLayer;case"useZQSD":return this._useZQSD;case"buoy_enabled":return this._buoyancy.enabled;case"buoy_attenuation":return this._buoyancy.attenuation;case"buoy_numSteps":return this._buoyancy.numSteps;case"skybox_lightColor":return this._light.diffuse.toHexString();case"skybox_directionX":return this._lightDirection.x;case"skybox_directionY":return this._lightDirection.y;case"skybox_directionZ":return this._lightDirection.z}return e.startsWith("procSky_")?(e=e.substring(8),this._skybox.skyMaterial[e]):e.startsWith("waves_")?(e=e.substring(6),this._readValue(this._wavesSettings,e)):e.startsWith("oceangeom_")?(e=e.substring(10),this._readValue(this._oceanGeometry,e)):e.startsWith("oceanshader_")?(e=e.substring(12),this._oceanMaterial.readMaterialParameter(this._oceanGeometry.getMaterial(0),e)):void 0},e.prototype._parameterChanged=function(e,t){switch(e){case"size":var a=0|t;a!==this._size&&this._updateSize(a);break;case"showDebugRTT":this._rttDebug.show(!!t);break;case"envIntensity":this._scene.environmentIntensity=parseFloat(t);break;case"lightIntensity":this._light.intensity=parseFloat(t);break;case"enableShadows":this._light.shadowEnabled=!!t,this._lightBuoy&&(this._lightBuoy.shadowEnabled=!!t);break;case"enableFXAA":t?this._fxaa||(this._fxaa=new i.FxaaPostProcess("fxaa",1,this._camera),this._fxaa.samples=this._engine.getCaps().maxMSAASamples):this._fxaa&&(this._fxaa.dispose(),this._fxaa=null);break;case"enableGlow":this._glowLayer?(this._glowLayer.dispose(),this._glowLayer=null):this._createGlowLayer();break;case"proceduralSky":t=!!t,this._useProceduralSky!==t&&(this._gui.dispose(),this._skybox.dispose(),this._useProceduralSky=t,this._skybox=new o.SkyBox(this._useProceduralSky,this._scene),this._gui=new _.OceanGUI(this._useProceduralSky,this._scene,this._engine,this._parameterRead.bind(this),this._parameterChanged.bind(this)));break;case"useZQSD":this._useZQSD=!!t,this._setCameraKeys();break;case"buoy_enabled":this._buoyancy.enabled=!!t;break;case"buoy_attenuation":this._buoyancy.attenuation=parseFloat(t);break;case"buoy_numSteps":this._buoyancy.numSteps=0|t;break;case"skybox_lightColor":this._light.diffuse.copyFrom(i.Color3.FromHexString(t));break;case"skybox_directionX":this._lightDirection.x=parseFloat(t),this._light.direction=this._lightDirection.normalizeToNew();break;case"skybox_directionY":this._lightDirection.y=parseFloat(t),this._light.direction=this._lightDirection.normalizeToNew();break;case"skybox_directionZ":this._lightDirection.z=parseFloat(t),this._light.direction=this._lightDirection.normalizeToNew()}e.startsWith("procSky_")&&(e=e.substring(8),this._setValue(this._skybox.skyMaterial,e,!1!==t&&(!0===t||parseFloat(t))),this._skybox.setAsDirty()),e.startsWith("waves_")&&(e=e.substring(6),this._setValue(this._wavesSettings,e,!1!==t&&(!0===t||parseFloat(t))),this._wavesGenerator.initializeCascades()),e.startsWith("oceangeom_")&&(e=e.substring(10),this._setValue(this._oceanGeometry,e,!1!==t&&(!0===t||parseFloat(t))),"oceangeom_noMaterialLod"!==e&&this._oceanGeometry.initializeMeshes()),e.startsWith("oceanshader_")&&(e=e.substring(12),this._oceanMaterial.updateMaterialParameter(this._oceanGeometry.getMaterial(0),e,t),this._oceanMaterial.updateMaterialParameter(this._oceanGeometry.getMaterial(1),e,t),this._oceanMaterial.updateMaterialParameter(this._oceanGeometry.getMaterial(2),e,t))},e}();const v=new f},3955:(e,t,a)=>{"use strict";a.r(t),a.d(t,{OceanGeometry:()=>r});var i,s=a(7976);!function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Top=4]="Top",e[e.Bottom=8]="Bottom",e[e.All=15]="All"}(i||(i={}));var r=function(){function e(e,t,a){this.lengthScale=15,this.vertexDensity=30,this.clipLevels=8,this.skirtSize=10,this.noMaterialLod=!0,this.useSkirt=!0,this._oceanMaterial=e,this._camera=t,this._scene=a,this._materials=[],this._root=new s.TransformNode("Ocean",a),this._center=null,this._skirt=null,this._rings=[],this._trims=[],this._trimRotations=[s.Quaternion.RotationAxis(s.Vector3.UpReadOnly,s.Angle.FromDegrees(180).radians()),s.Quaternion.RotationAxis(s.Vector3.UpReadOnly,s.Angle.FromDegrees(90).radians()),s.Quaternion.RotationAxis(s.Vector3.UpReadOnly,s.Angle.FromDegrees(270).radians()),s.Quaternion.Identity()]}return Object.defineProperty(e.prototype,"wireframe",{get:function(){return this._center.material.wireframe},set:function(e){this._center.material.wireframe=e,this._skirt&&(this._skirt.material.wireframe=e),this._rings.forEach((function(t){return t.material.wireframe=e})),this._trims.forEach((function(t){return t.material.wireframe=e}))},enumerable:!1,configurable:!0}),e.prototype.initializeMaterials=function(){var e,t,a,i,s,r,n;return i=this,s=void 0,n=function(){var i,s;return function(e,t){var a,i,s,r,n={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;n;)try{if(a=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return n.label++,{value:r[1],done:!1};case 5:n.label++,i=r[1],r=[0];continue;case 7:r=n.ops.pop(),n.trys.pop();continue;default:if(!((s=(s=n.trys).length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){n=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){n.label=r[1];break}if(6===r[0]&&n.label<s[1]){n.label=s[1],s=r;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(r);break}s[2]&&n.ops.pop(),n.trys.pop();continue}r=t.call(e,n)}catch(e){r=[6,e],i=0}finally{a=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}}(this,(function(r){switch(r.label){case 0:return null===(e=this._materials[0])||void 0===e||e.dispose(),null===(t=this._materials[1])||void 0===t||t.dispose(),null===(a=this._materials[2])||void 0===a||a.dispose(),i=this,[4,this._oceanMaterial.getMaterial(!0,!0)];case 1:return s=[r.sent()],[4,this._oceanMaterial.getMaterial(!0,!1)];case 2:return s=s.concat([r.sent()]),[4,this._oceanMaterial.getMaterial(!1,!1)];case 3:return i._materials=s.concat([r.sent()]),[2]}}))},new((r=void 0)||(r=Promise))((function(e,t){function a(e){try{l(n.next(e))}catch(e){t(e)}}function o(e){try{l(n.throw(e))}catch(e){t(e)}}function l(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r((function(e){e(i)}))).then(a,o)}l((n=n.apply(i,s||[])).next())}))},e.prototype.initializeMeshes=function(){var e,t,a,i;null===(e=this._center)||void 0===e||e.dispose(),null===(t=this._skirt)||void 0===t||t.dispose(),null===(a=this._rings)||void 0===a||a.forEach((function(e){return e.dispose()})),null===(i=this._trims)||void 0===i||i.forEach((function(e){return e.dispose()})),this._skirt=null,this._rings=[],this._trims=[],this._instantiateMeshes()},e.prototype.update=function(){this._updatePositions(),this._updateMaterials()},e.prototype.getMaterial=function(e){return this._materials[e]},e.prototype._updateMaterials=function(){var e=this._activeLodLevels;this._center.material=this._getMaterial(this.noMaterialLod?0:this.clipLevels-e-1);for(var t=0;t<this._rings.length;t++)this._rings[t].material=this._getMaterial(this.noMaterialLod?0:this.clipLevels-e-t),this._trims[t].material=this._getMaterial(this.noMaterialLod?0:this.clipLevels-e-t);this.useSkirt&&(this._skirt.material=this.noMaterialLod?this._materials[0]:this._materials[2])},e.prototype._updatePositions=function(){var e=this._gridSize,t=this._activeLodLevels,a=s.TmpVectors.Vector3[0],i=s.TmpVectors.Vector3[1],r=s.TmpVectors.Vector3[2],n=s.TmpVectors.Vector3[3],o=this._clipLevelScale(-1,t);a.copyFrom(this._camera.position),this._snap(a,2*o),this._offsetFromCenter(-1,t,i),this._center.position.copyFrom(a).addInPlace(i),this._center.scaling.set(o,1,o);for(var l=0;l<this.clipLevels;l++)if(this._rings[l].setEnabled(l<t),this._trims[l].setEnabled(l<t),!(l>=t)){o=this._clipLevelScale(l,t),r.copyFrom(this._camera.position),this._snap(r,2*o),this._offsetFromCenter(l,t,i),n.copyFrom(r).addInPlace(i).addInPlaceFromFloats(o*(e-1)/2,0,o*(e-1)/2);var c=a.x-r.x<=0?1:0,h=a.z-r.z<=0?1:0;n.x+=c*(e+1)*o,n.z+=h*(e+1)*o,this._trims[l].position.copyFrom(n),this._trims[l].rotationQuaternion.copyFrom(this._trimRotations[c+2*h]),this._trims[l].scaling.set(o,1,o),this._rings[l].position.copyFrom(r).addInPlace(i),this._rings[l].scaling.set(o,1,o),a.copyFrom(r)}this.useSkirt&&(o=2*this.lengthScale*Math.pow(2,this.clipLevels),this._skirt.position.copyFrom(a).addInPlaceFromFloats(-o*(this.skirtSize+.5-.5/e),0,-o*(this.skirtSize+.5-.5/e)),this._skirt.scaling.set(o,1,o))},Object.defineProperty(e.prototype,"_activeLodLevels",{get:function(){return this.clipLevels-s.Scalar.Clamp(Math.floor(Math.log2((1.7*Math.abs(this._camera.position.y)+1)/this.lengthScale)),0,this.clipLevels)},enumerable:!1,configurable:!0}),e.prototype._clipLevelScale=function(e,t){return this.lengthScale/this._gridSize*Math.pow(2,this.clipLevels-t+e+1)},e.prototype._offsetFromCenter=function(t,a,i){var s=this._gridSize,r=((1<<this.clipLevels)+e._GeometricProgressionSum(2,2,this.clipLevels-a+t+1,this.clipLevels-1))*this.lengthScale/s*(s-1)/2;i.copyFromFloats(-r,0,-r)},e._GeometricProgressionSum=function(e,t,a,i){return e/(1-t)*(Math.pow(t,i)-Math.pow(t,a))},e.prototype._snap=function(e,t){e.x>=0?e.x=Math.floor(e.x/t)*t:e.x=Math.ceil((e.x-t+1)/t)*t,e.z<0?e.z=Math.floor(e.z/t)*t:e.z=Math.ceil((e.z-t+1)/t)*t,e.y=0},e.prototype._getMaterial=function(e){return e-2<=0?this._materials[0]:e-2<=2?this._materials[1]:this._materials[2]},Object.defineProperty(e.prototype,"_gridSize",{get:function(){return 4*this.vertexDensity+1},enumerable:!1,configurable:!0}),e.prototype._instantiateMeshes=function(){var e=this._gridSize;this._center=this._instantiateElement("Center",this._createPlaneMesh(2*e,2*e,1,i.All),this._materials[this._materials.length-1]);for(var t=this._createRingMesh(e,1),a=this._createTrimMesh(e,1),s=0;s<this.clipLevels;++s)this._rings.push(this._instantiateElement("Ring "+s,t,this._materials[this._materials.length-1],s>0)),this._trims.push(this._instantiateElement("Trim "+s,a,this._materials[this._materials.length-1],s>0));this.useSkirt&&(this._skirt=this._instantiateElement("Skirt",this._createSkirtMesh(e,this.skirtSize),this._materials[this._materials.length-1]))},e.prototype._instantiateElement=function(e,t,a,i){return void 0===i&&(i=!1),i&&(t=t.clone("")),t.name=e,t.material=a,t.parent=this._root,t.receiveShadows=!0,t},e.prototype._createSkirtMesh=function(e,t){var a=this._createPlaneMesh(1,1,1),i=this._createPlaneMesh(e,1,1),r=this._createPlaneMesh(1,e,1),n=new s.Vector3(t,1,t),o=new s.Vector3(1/e,1,t),l=new s.Vector3(t,1,1/e),c=a.clone();c.scaling.copyFrom(n);var h=i.clone();h.scaling.copyFrom(o),h.position.x=t;var _=a.clone();_.scaling.copyFrom(n),_.position.x=t+1;var d=r.clone();d.scaling.copyFrom(l),d.position.z=t;var u=r.clone();u.scaling.copyFrom(l),u.position.x=t+1,u.position.z=t;var p=a.clone();p.scaling.copyFrom(n),p.position.z=t+1;var m=i.clone();m.scaling.copyFrom(o),m.position.x=t,m.position.z=t+1;var y=a.clone();return y.scaling.copyFrom(n),y.position.x=t+1,y.position.z=t+1,a.dispose(!0,!1),i.dispose(!0,!1),r.dispose(!0,!1),s.Mesh.MergeMeshes([c,h,_,d,u,p,m,y],!0,!0)},e.prototype._createTrimMesh=function(e,t){var a=this._createPlaneMesh(e+1,1,t,i.None,1);a.position.set((-e-1)*t,0,-1*t);var r=this._createPlaneMesh(1,e,t,i.None,1);r.position.set(-1*t,0,(-e-1)*t);var n=s.Mesh.MergeMeshes([a,r],!0,!0);return n.rotationQuaternion=new s.Quaternion,n},e.prototype._createRingMesh=function(e,t){var a=this._createPlaneMesh(2*e,e-1>>1,t,i.Bottom|i.Right|i.Left),r=this._createPlaneMesh(2*e,e-1>>1,t,i.Top|i.Right|i.Left);r.position.set(0,0,(e+1+(e-1>>1))*t);var n=this._createPlaneMesh(e-1>>1,e+1,t,i.Left);n.position.set(0,0,(e-1>>1)*t);var o=this._createPlaneMesh(e-1>>1,e+1,t,i.Right);return o.position.set((e+1+(e-1>>1))*t,0,(e-1>>1)*t),s.Mesh.MergeMeshes([a,r,n,o],!0,!0)},e.prototype._createPlaneMesh=function(e,t,a,r,n){void 0===r&&(r=i.None),void 0===n&&(n=0);var o=[],l=[],c=[],h=new s.VertexData;h.positions=o,h.indices=l,h.normals=c;for(var _=0;_<t+1;++_)for(var d=0;d<e+1;++d){var u=d,p=_;(0===_&&r&i.Bottom||_===t&&r&i.Top)&&(u&=-2),(0===d&&r&i.Left||d===e&&r&i.Right)&&(p&=-2),o[0+3*d+_*(e+1)*3]=u*a,o[1+3*d+_*(e+1)*3]=0*a,o[2+3*d+_*(e+1)*3]=p*a,c[0+3*d+_*(e+1)*3]=0,c[1+3*d+_*(e+1)*3]=1,c[2+3*d+_*(e+1)*3]=0}var m=0;for(_=0;_<t;++_)for(d=0;d<e;++d){var y=d+_*(e+1);(_+d+n)%2==0?(l[m++]=y,l[m++]=y+e+2,l[m++]=y+e+1,l[m++]=y,l[m++]=y+1,l[m++]=y+e+2):(l[m++]=y,l[m++]=y+1,l[m++]=y+e+1,l[m++]=y+1,l[m++]=y+e+2,l[m++]=y+e+1)}var f=new s.Mesh("Clipmap plane",this._scene);return h.applyToMesh(f,!0),f},e}()},827:(e,t,a)=>{"use strict";a.r(t),a.d(t,{OceanGUI:()=>r});var i=a(7976),s=a(2281),r=function(){function e(e,t,a,i,s){this._scene=t,this._visible=!0,this._onKeyObserver=null,this._paramRead=i,this._paramChanged=s;var r=document.getElementById("datGUI");null!==r&&r.remove(),this._gui=new dat.GUI,this._gui.domElement.style.marginTop="60px",this._gui.domElement.id="datGUI",this._setupKeyboard(),this._initialize(e)}return e.LoadDAT=function(){return s.w1.LoadScriptAsync("https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js")},Object.defineProperty(e.prototype,"visible",{set:function(e){e!==this._visible&&(this._visible=e,this._gui.domElement.style.display=e?"":"none")},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){var e=document.getElementById("datGUI");null!==e&&e.remove(),this._scene.onKeyboardObservable.remove(this._onKeyObserver)},e.prototype._setupKeyboard=function(){var e=this;this._onKeyObserver=this._scene.onKeyboardObservable.add((function(t){switch(t.type){case i.KeyboardEventTypes.KEYDOWN:break;case i.KeyboardEventTypes.KEYUP:switch(t.event.key){case"F8":e.visible=!e._visible}}}))},e.prototype._initialize=function(e){this._makeMenuGeneral(),e?this._makeMenuProceduralSky():this._makeMenuSkybox(),this._makeMenuWavesGenerator(),this._makeMenuOceanGeometry(),this._makeMenuOceanShader(),this._makeMenuBuoyancy()},e.prototype._addList=function(e,t,a,i,s){var r=this;e.add(t,a,s).name(i).onChange((function(e){r._paramChanged(a,e)}))},e.prototype._addCheckbox=function(e,t,a,i){var s=this;e.add(t,a).name(i).onChange((function(e){s._paramChanged(a,e)}))},e.prototype._addSlider=function(e,t,a,i,s,r,n){var o=this;e.add(t,a,s,r,n).name(i).onChange((function(e){o._paramChanged(a,e)}))},e.prototype._addColor=function(e,t,a,i){var s=this;e.addColor(t,a).name(i).onChange((function(e){s._paramChanged(a,e)}))},e.prototype._makeMenuGeneral=function(){var e={size:this._paramRead("size"),envIntensity:this._paramRead("envIntensity"),lightIntensity:this._paramRead("lightIntensity"),enableShadows:this._paramRead("enableShadows"),enableGlow:this._paramRead("enableGlow"),useZQSD:this._paramRead("useZQSD"),showDebugRTT:this._paramRead("showDebugRTT")},t=this._gui.addFolder("General");this._addList(t,e,"size","Resolution",[256,128,64,32]),this._addSlider(t,e,"envIntensity","Env intensity",0,4,.05),this._addSlider(t,e,"lightIntensity","Light intensity",0,5,.05),this._addCheckbox(t,e,"enableShadows","Enable shadows"),this._addCheckbox(t,e,"enableGlow","Enable Glow layer"),this._addCheckbox(t,e,"useZQSD","Use ZQSD"),this._addCheckbox(t,e,"showDebugRTT","Show debug RTT"),t.open()},e.prototype._makeMenuProceduralSky=function(){var e={procSky_inclination:this._paramRead("procSky_inclination"),procSky_azimuth:this._paramRead("procSky_azimuth"),procSky_luminance:this._paramRead("procSky_luminance"),procSky_turbidity:this._paramRead("procSky_turbidity"),procSky_rayleigh:this._paramRead("procSky_rayleigh"),procSky_mieCoefficient:this._paramRead("procSky_mieCoefficient"),procSky_mieDirectionalG:this._paramRead("procSky_mieDirectionalG")},t=this._gui.addFolder("Sky");this._addSlider(t,e,"procSky_inclination","Inclination",-.5,.5,.001),this._addSlider(t,e,"procSky_azimuth","Azimuth",0,1,.001),this._addSlider(t,e,"procSky_luminance","Luminance",.001,1,.001),this._addSlider(t,e,"procSky_turbidity","Turbidity",.1,100,.1),this._addSlider(t,e,"procSky_rayleigh","Rayleigh",.1,10,.1),this._addSlider(t,e,"procSky_mieCoefficient","Mie Coefficient",0,.1,1e-4),this._addSlider(t,e,"procSky_mieDirectionalG","Mie DirectionalG",0,1,.01),t.open()},e.prototype._makeMenuSkybox=function(){var e={skybox_lightColor:this._paramRead("skybox_lightColor"),skybox_directionX:this._paramRead("skybox_directionX"),skybox_directionY:this._paramRead("skybox_directionY"),skybox_directionZ:this._paramRead("skybox_directionZ")},t=this._gui.addFolder("Sky");this._addColor(t,e,"skybox_lightColor","Light color"),this._addSlider(t,e,"skybox_directionX","Light dir X",-10,10,.001),this._addSlider(t,e,"skybox_directionY","Light dir Y",-10,-.01,.001),this._addSlider(t,e,"skybox_directionZ","Light dir Z",-10,10,.001)},e.prototype._makeMenuWavesGenerator=function(){var e={waves_g:this._paramRead("waves_g"),waves_depth:this._paramRead("waves_depth"),waves_lambda:this._paramRead("waves_lambda"),waves_local_scale:this._paramRead("waves_local_scale"),waves_local_windSpeed:this._paramRead("waves_local_windSpeed"),waves_local_windDirection:this._paramRead("waves_local_windDirection"),waves_local_fetch:this._paramRead("waves_local_fetch"),waves_local_spreadBlend:this._paramRead("waves_local_spreadBlend"),waves_local_swell:this._paramRead("waves_local_swell"),waves_local_peakEnhancement:this._paramRead("waves_local_peakEnhancement"),waves_local_shortWavesFade:this._paramRead("waves_local_shortWavesFade"),waves_swell_scale:this._paramRead("waves_swell_scale"),waves_swell_windSpeed:this._paramRead("waves_swell_windSpeed"),waves_swell_windDirection:this._paramRead("waves_swell_windDirection"),waves_swell_fetch:this._paramRead("waves_swell_fetch"),waves_swell_spreadBlend:this._paramRead("waves_swell_spreadBlend"),waves_swell_swell:this._paramRead("waves_swell_swell"),waves_swell_peakEnhancement:this._paramRead("waves_swell_peakEnhancement"),waves_swell_shortWavesFade:this._paramRead("waves_swell_shortWavesFade")},t=this._gui.addFolder("Waves Generator");this._addSlider(t,e,"waves_g","Gravity",.01,30,.01),this._addSlider(t,e,"waves_depth","Ocean depth",.001,3,.001),this._addSlider(t,e,"waves_lambda","Lambda",0,1,.001);var a=t.addFolder("Local");this._addSlider(a,e,"waves_local_scale","Scale",0,1,.001),this._addSlider(a,e,"waves_local_windSpeed","Wind speed",.001,100,.001),this._addSlider(a,e,"waves_local_windDirection","Wind direction",-100,100,.1),this._addSlider(a,e,"waves_local_fetch","Fetch",100,1e6,100),this._addSlider(a,e,"waves_local_spreadBlend","Spread blend",0,1,.01),this._addSlider(a,e,"waves_local_swell","Swell",0,1,.01),this._addSlider(a,e,"waves_local_peakEnhancement","Peak enhanc.",.01,100,.01),this._addSlider(a,e,"waves_local_shortWavesFade","Short waves fade",.001,1,.001),a.open();var i=t.addFolder("Swell");this._addSlider(i,e,"waves_swell_scale","Scale",0,1,.001),this._addSlider(i,e,"waves_swell_windSpeed","Wind speed",.001,100,.001),this._addSlider(i,e,"waves_swell_windDirection","Wind direction",-100,100,.1),this._addSlider(i,e,"waves_swell_fetch","Fetch",100,1e6,100),this._addSlider(i,e,"waves_swell_spreadBlend","Spread blend",0,1,.01),this._addSlider(i,e,"waves_swell_swell","Swell",0,1,.01),this._addSlider(i,e,"waves_swell_peakEnhancement","Peak enhanc.",.01,100,.01),this._addSlider(i,e,"waves_swell_shortWavesFade","Short waves fade",.001,1,.001),i.open(),t.open()},e.prototype._makeMenuOceanGeometry=function(){var e={oceangeom_lengthScale:this._paramRead("oceangeom_lengthScale"),oceangeom_vertexDensity:this._paramRead("oceangeom_vertexDensity"),oceangeom_clipLevels:this._paramRead("oceangeom_clipLevels"),oceangeom_skirtSize:this._paramRead("oceangeom_skirtSize"),oceangeom_wireframe:this._paramRead("oceangeom_wireframe"),oceangeom_noMaterialLod:this._paramRead("oceangeom_noMaterialLod")},t=this._gui.addFolder("Ocean Geometry");this._addSlider(t,e,"oceangeom_lengthScale","Length scale",1,100,.1),this._addSlider(t,e,"oceangeom_vertexDensity","Vertex density",1,40,1),this._addSlider(t,e,"oceangeom_clipLevels","Clip levels",1,8,1),this._addSlider(t,e,"oceangeom_skirtSize","Skirt size",0,100,.1),this._addCheckbox(t,e,"oceangeom_wireframe","Wireframe"),this._addCheckbox(t,e,"oceangeom_noMaterialLod","No material LOD")},e.prototype._makeMenuOceanShader=function(){var e={oceanshader__Color:this._paramRead("oceanshader__Color"),oceanshader__MaxGloss:this._paramRead("oceanshader__MaxGloss"),oceanshader__RoughnessScale:this._paramRead("oceanshader__RoughnessScale"),oceanshader__LOD_scale:this._paramRead("oceanshader__LOD_scale"),oceanshader__FoamColor:this._paramRead("oceanshader__FoamColor"),oceanshader__FoamScale:this._paramRead("oceanshader__FoamScale"),oceanshader__ContactFoam:this._paramRead("oceanshader__ContactFoam"),oceanshader__FoamBiasLOD2:this._paramRead("oceanshader__FoamBiasLOD2"),oceanshader__SSSColor:this._paramRead("oceanshader__SSSColor"),oceanshader__SSSStrength:this._paramRead("oceanshader__SSSStrength"),oceanshader__SSSBase:this._paramRead("oceanshader__SSSBase"),oceanshader__SSSScale:this._paramRead("oceanshader__SSSScale")},t=this._gui.addFolder("Ocean Shader");this._addColor(t,e,"oceanshader__Color","Color"),this._addSlider(t,e,"oceanshader__MaxGloss","Max gloss",0,1,.01),this._addSlider(t,e,"oceanshader__RoughnessScale","Roughness scale",0,1,1e-4),this._addSlider(t,e,"oceanshader__LOD_scale","LOD scale",.01,20,.01),this._addColor(t,e,"oceanshader__FoamColor","Foam color"),this._addSlider(t,e,"oceanshader__FoamScale","Foam scale",.001,8,.001),this._addSlider(t,e,"oceanshader__ContactFoam","Foam contact",.001,3,.001),this._addSlider(t,e,"oceanshader__FoamBiasLOD2","Foam bias",.001,4,.001),this._addColor(t,e,"oceanshader__SSSColor","SSS color"),this._addSlider(t,e,"oceanshader__SSSStrength","SSS strength",.001,2,.001),this._addSlider(t,e,"oceanshader__SSSBase","SSS base",-2,1,.001),this._addSlider(t,e,"oceanshader__SSSScale","SSS scale",.001,10,.001)},e.prototype._makeMenuBuoyancy=function(){var e={buoy_enabled:this._paramRead("buoy_enabled"),buoy_attenuation:this._paramRead("buoy_attenuation"),buoy_numSteps:this._paramRead("buoy_numSteps")},t=this._gui.addFolder("Buoyancy");this._addCheckbox(t,e,"buoy_enabled","Enabled"),this._addSlider(t,e,"buoy_attenuation","Damping factor",0,1,.001),this._addSlider(t,e,"buoy_numSteps","Num steps",1,20,1)},e}()},1817:(e,t,a)=>{"use strict";a.r(t),a.d(t,{OceanMaterial:()=>r});var i=a(7976),s=a(9781),r=function(){function e(e,t){var a,s;this._wavesGenerator=null,this._depthRenderer=e,this._scene=t,this._camera=null!==(s=null===(a=t.activeCameras)||void 0===a?void 0:a[0])&&void 0!==s?s:t.activeCamera,this._foamTexture=new i.Texture("https://assets.babylonjs.com/environments/waterFoam_circular_mask.png",this._scene),this._startTime=(new Date).getTime()/1e3}return e.prototype.setWavesGenerator=function(e){this._wavesGenerator=e},e.prototype.readMaterialParameter=function(e,t){var a=new i.Color3;for(var s in e._newUniformInstances){var r=s.split("-"),n=r[0],o=r[1],l=e._newUniformInstances[s];if(o===t)return"vec3"===n&&(l=l,a.copyFromFloats(l.x,l.y,l.z),a.toGammaSpaceToRef(a),l=a.toHexString()),l}return null},e.prototype.updateMaterialParameter=function(e,t,a){var s=new i.Vector3;for(var r in e._newUniformInstances){var n=r.split("-"),o=n[0];if(n[1]===t)return"vec3"===o&&(a=(a=i.Color3.FromHexString(a)).toLinearSpaceToRef(a),s.copyFromFloats(a.r,a.g,a.b),a=s),void(e._newUniformInstances[r]=a)}},e.prototype.getMaterial=function(e,t,a){return void 0===a&&(a=!1),r=this,n=void 0,l=function(){var r,n,o,l=this;return function(e,t){var a,i,s,r,n={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function o(r){return function(o){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;n;)try{if(a=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return n.label++,{value:r[1],done:!1};case 5:n.label++,i=r[1],r=[0];continue;case 7:r=n.ops.pop(),n.trys.pop();continue;default:if(!((s=(s=n.trys).length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){n=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){n.label=r[1];break}if(6===r[0]&&n.label<s[1]){n.label=s[1],s=r;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(r);break}s[2]&&n.ops.pop(),n.trys.pop();continue}r=t.call(e,n)}catch(e){r=[6,e],i=0}finally{a=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}}(this,(function(c){switch(c.label){case 0:return a?[3,1]:((r=new s.B_("oceanMat"+(e?"1":"0")+(t?"1":"0"),this._scene)).metallic=0,r.roughness=.311,r.forceIrradianceInFragment=!0,n=new i.Vector3(.011126082368383245,.05637409755197975,.09868919754109445),r.AddUniform("_Color","vec3",n),r.AddUniform("_MaxGloss","float",.91),r.AddUniform("_RoughnessScale","float",.0044),r.AddUniform("_LOD_scale","float",7.13),r.AddUniform("_FoamColor","vec3",new i.Vector3(1,1,1)),r.AddUniform("_FoamScale","float",2.4),r.AddUniform("_ContactFoam","float",1),r.AddUniform("_FoamBiasLOD0","float",.84),r.AddUniform("_FoamBiasLOD1","float",1.83),r.AddUniform("_FoamBiasLOD2","float",2.72),r.AddUniform("_SSSColor","vec3",new i.Vector3(.1541919,.8857628,.990566)),r.AddUniform("_SSSStrength","float",.15),r.AddUniform("_SSSBase","float",-.261),r.AddUniform("_SSSScale","float",4.7),r.AddUniform("lightDirection","vec3",""),r.AddUniform("_WorldSpaceCameraPos","vec3",""),r.AddUniform("LengthScale0","float",this._wavesGenerator.lengthScale[0]),r.AddUniform("LengthScale1","float",this._wavesGenerator.lengthScale[1]),r.AddUniform("LengthScale2","float",this._wavesGenerator.lengthScale[2]),r.AddUniform("_Displacement_c0","sampler2D",this._wavesGenerator.getCascade(0).displacement),r.AddUniform("_Derivatives_c0","sampler2D",this._wavesGenerator.getCascade(0).derivatives),r.AddUniform("_Turbulence_c0","sampler2D",this._wavesGenerator.getCascade(0).turbulence),r.AddUniform("_Displacement_c1","sampler2D",this._wavesGenerator.getCascade(1).displacement),r.AddUniform("_Derivatives_c1","sampler2D",this._wavesGenerator.getCascade(1).derivatives),r.AddUniform("_Turbulence_c1","sampler2D",this._wavesGenerator.getCascade(1).turbulence),r.AddUniform("_Displacement_c2","sampler2D",this._wavesGenerator.getCascade(2).displacement),r.AddUniform("_Derivatives_c2","sampler2D",this._wavesGenerator.getCascade(2).derivatives),r.AddUniform("_Turbulence_c2","sampler2D",this._wavesGenerator.getCascade(2).turbulence),r.AddUniform("_Time","float",0),r.AddUniform("_CameraDepthTexture","sampler2D",this._depthRenderer.getDepthMap()),r.AddUniform("_CameraData","vec4",new i.Vector4(this._camera.minZ,this._camera.maxZ,this._camera.maxZ-this._camera.minZ,0)),r.AddUniform("_FoamTexture","sampler2D",this._foamTexture),o=[],e&&o.push("#define MID"),t&&o.push("#define CLOSE"),r.Vertex_Definitions("\n                "+o.join("\n")+"\n\n                varying vec2 vWorldUV;\n                varying vec2 vUVCoords_c0;\n                varying vec2 vUVCoords_c1;\n                varying vec2 vUVCoords_c2;\n                varying vec3 vViewVector;\n                varying vec4 vLodScales;\n                varying vec4 vClipCoords;\n                varying float vMetric;\n            "),r.Fragment_Definitions("\n                "+o.join("\n")+"\n\n                varying vec2 vWorldUV;\n                varying vec2 vUVCoords_c0;\n                varying vec2 vUVCoords_c1;\n                varying vec2 vUVCoords_c2;\n                varying vec3 vViewVector;\n                varying vec4 vLodScales;\n                varying vec4 vClipCoords;\n                varying float vMetric;\n            "),r.Vertex_After_WorldPosComputed("\n                vWorldUV = worldPos.xz;\n            \n                vViewVector = _WorldSpaceCameraPos - worldPos.xyz;\n                float viewDist = length(vViewVector);\n            \n                float lod_c0 = min(_LOD_scale * LengthScale0 / viewDist, 1.0);\n                float lod_c1 = min(_LOD_scale * LengthScale1 / viewDist, 1.0);\n                float lod_c2 = min(_LOD_scale * LengthScale2 / viewDist, 1.0);\n                    \n                vec3 displacement = vec3(0.);\n                float largeWavesBias = 0.;\n            \n                vUVCoords_c0 = vWorldUV / LengthScale0;\n                vUVCoords_c1 = vWorldUV / LengthScale1;\n                vUVCoords_c2 = vWorldUV / LengthScale2;\n            \n                displacement += texture2D(_Displacement_c0, vUVCoords_c0).xyz * lod_c0;\n                largeWavesBias = displacement.y;\n            \n                #if defined(MID) || defined(CLOSE)\n                    displacement += texture2D(_Displacement_c1, vUVCoords_c1).xyz * lod_c1;\n                #endif\n                #if defined(CLOSE)\n                    displacement += texture2D(_Displacement_c2, vUVCoords_c2).xyz * lod_c2;\n                #endif\n    \n                worldPos.xyz += displacement;\n\n                vLodScales = vec4(lod_c0, lod_c1, lod_c2, max(displacement.y - largeWavesBias * 0.8 - _SSSBase, 0) / _SSSScale);\n            "),r.Vertex_MainEnd("\n                vClipCoords = gl_Position;\n                vMetric = gl_Position.z;\n            "),r.Fragment_Before_Lights("\n                vec4 derivatives = texture2D(_Derivatives_c0, vUVCoords_c0);\n                #if defined(MID) || defined(CLOSE)\n                    derivatives += texture2D(_Derivatives_c1, vUVCoords_c1) * vLodScales.y;\n                #endif\n                #if defined(CLOSE)\n                    derivatives += texture2D(_Derivatives_c2, vUVCoords_c2) * vLodScales.z;\n                #endif\n\n                vec2 slope = vec2(derivatives.x / (1.0 + derivatives.z), derivatives.y / (1.0 + derivatives.w));\n                normalW = normalize(vec3(-slope.x, 1.0, -slope.y));\n\n                #if defined(CLOSE)\n                    float jacobian = texture2D(_Turbulence_c0, vUVCoords_c0).x + texture2D(_Turbulence_c1, vUVCoords_c1).x + texture2D(_Turbulence_c2, vUVCoords_c2).x;\n                    jacobian = min(1.0, max(0.0, (-jacobian + _FoamBiasLOD2) * _FoamScale));\n                #elif defined(MID)\n                    float jacobian = texture2D(_Turbulence_c0, vUVCoords_c0).x + texture2D(_Turbulence_c1, vUVCoords_c1).x;\n                    jacobian = min(1.0, max(0.0, (-jacobian + _FoamBiasLOD1) * _FoamScale));\n                #else\n                    float jacobian = texture2D(_Turbulence_c0, vUVCoords_c0).x;\n                    jacobian = min(1.0, max(0.0, (-jacobian + _FoamBiasLOD0) * _FoamScale));\n                #endif\n\n                vec2 screenUV = vClipCoords.xy / vClipCoords.w;\n                screenUV = screenUV * 0.5 + 0.5;\n                float backgroundDepth = texture2D(_CameraDepthTexture, screenUV).r * _CameraData.y;\n                float surfaceDepth = vMetric;\n                float depthDifference = max(0.0, (backgroundDepth - surfaceDepth) - 0.5);\n                float foam = texture2D(_FoamTexture, vWorldUV * 0.5 + _Time * 2.).r;\n                jacobian += _ContactFoam * saturate(max(0.0, foam - depthDifference) * 5.0) * 0.9;\n    \n                surfaceAlbedo = mix(vec3(0.0), _FoamColor, jacobian);\n\n                vec3 viewDir = normalize(vViewVector);\n                vec3 H = normalize(-normalW + lightDirection);\n                float ViewDotH = pow5(saturate(dot(viewDir, -H))) * 30.0 * _SSSStrength;\n                vec3 color = mix(_Color, saturate(_Color + _SSSColor.rgb * ViewDotH * vLodScales.w), vLodScales.z);\n    \n                float fresnel = dot(normalW, viewDir);\n                fresnel = saturate(1.0 - fresnel);\n                fresnel = pow5(fresnel);\n            "),r.Fragment_Custom_MetallicRoughness("\n                float distanceGloss = mix(1.0 - metallicRoughness.g, _MaxGloss, 1.0 / (1.0 + length(vViewVector) * _RoughnessScale));\n                metallicRoughness.g = 1.0 - mix(distanceGloss, 0.0, jacobian);\n            "),r.Fragment_Before_FinalColorComposition("\n                finalEmissive = mix(color * (1.0 - fresnel), vec3(0.0), jacobian);\n            "),r.Fragment_Before_FragColor("\n                //finalColor = vec4(toGammaSpace((normalW + vec3(1.)) / vec3(2.)), 1.);\n                //finalColor = vec4(vec3(surfaceDepth), 1.);\n            "),r.onBindObservable.add((function(){var e,t,a,i,s,n,o=((new Date).getTime()/1e3-l._startTime)/10;null===(e=r.getEffect())||void 0===e||e.setVector3("_WorldSpaceCameraPos",l._camera.position),null===(t=r.getEffect())||void 0===t||t.setTexture("_Turbulence_c0",l._wavesGenerator.getCascade(0).turbulence),null===(a=r.getEffect())||void 0===a||a.setTexture("_Turbulence_c1",l._wavesGenerator.getCascade(1).turbulence),null===(i=r.getEffect())||void 0===i||i.setTexture("_Turbulence_c2",l._wavesGenerator.getCascade(2).turbulence),null===(s=r.getEffect())||void 0===s||s.setFloat("_Time",o),null===(n=r.getEffect())||void 0===n||n.setVector3("lightDirection",l._scene.lights[0].direction)})),[2,new Promise((function(e){l._foamTexture.isReady()?e(r):l._foamTexture.onLoadObservable.addOnce((function(){e(r)}))}))]);case 1:return[4,i.NodeMaterial.ParseFromSnippetAsync("R4152I#24",this._scene)];case 2:(r=c.sent()).getInputBlockByPredicate((function(e){return"LOD_scale"===e.name})).value=7.13,r.getInputBlockByPredicate((function(e){return"LengthScale0"===e.name})).value=this._wavesGenerator.lengthScale[0],r.getInputBlockByPredicate((function(e){return"Roughness"===e.name})).value=.311,r.getInputBlockByPredicate((function(e){return"metallic"===e.name})).value=0,r.getBlockByName("Displacement_c0").texture=this._wavesGenerator.getCascade(0).displacement,r.getBlockByName("Derivatives_c0").texture=this._wavesGenerator.getCascade(0).derivatives,r.build(),c.label=3;case 3:return[2,r]}}))},new((o=void 0)||(o=Promise))((function(e,t){function a(e){try{s(l.next(e))}catch(e){t(e)}}function i(e){try{s(l.throw(e))}catch(e){t(e)}}function s(t){var s;t.done?e(t.value):(s=t.value,s instanceof o?s:new o((function(e){e(s)}))).then(a,i)}s((l=l.apply(r,n||[])).next())}));var r,n,o,l},e}()},4059:(e,t,a)=>{"use strict";a.r(t),a.d(t,{SkyBox:()=>n});var i=a(7976),s=a(9781);a(6699);const r=a.p+"0c03bd6e3c9d04da0cf428bbf487bf68.hdr";var n=function(){function e(e,t){var a=this;this._procedural=e,this._scene=t,this._oldSunPosition=new i.Vector3,this._skyMaterial=null,this._probe=null,this._dirty=!1,this._dirtyCount=0,this._needPolynomialsRegen=!1,this._skybox=i.MeshBuilder.CreateBox("skyBox",{size:1e3,sideOrientation:i.Mesh.BACKSIDE},this._scene),t.meshes.splice(t.meshes.indexOf(this._skybox),1),t.meshes.splice(0,0,this._skybox),this._skyboxObserver=t.onBeforeRenderObservable.add((function(){var e,i;a._skybox.position=null!==(i=null===(e=t.activeCameras)||void 0===e?void 0:e[0].position)&&void 0!==i?i:t.activeCamera.position})),e?this._initProceduralSkybox():this._initSkybox(),this.setAsDirty()}return Object.defineProperty(e.prototype,"probe",{get:function(){return this._probe},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skyMaterial",{get:function(){return this._skyMaterial},enumerable:!1,configurable:!0}),e.prototype.setAsDirty=function(){this._dirty=!0,this._dirtyCount=2,this._probe.cubeTexture.refreshRate=1,this._needPolynomialsRegen=!0},e.prototype.update=function(e){if(!this._procedural)return!1;var t=!1,a=this._probe.cubeTexture.getInternalTexture();return this._oldSunPosition.equals(this._skyMaterial.sunPosition)&&!this._dirty||(this._oldSunPosition.copyFrom(this._skyMaterial.sunPosition),e.position=this._skyMaterial.sunPosition.clone(),e.direction=this._skyMaterial.sunPosition.negate().normalize(),e.diffuse=this._skyMaterial.getSunColor().toLinearSpace(),0==this._dirtyCount--&&(this._dirty=!1,this._probe.cubeTexture.refreshRate=0),t=!0),!this._dirty&&this._needPolynomialsRegen&&a._sphericalPolynomialComputed&&(this._probe.cubeTexture.forceSphericalPolynomialsRecompute(),this._needPolynomialsRegen=!1),t},e.prototype.dispose=function(){var e,t;this._scene.onBeforeRenderObservable.remove(this._skyboxObserver),this._scene.customRenderTargets=[],this._procedural?this._probe.dispose():(null===(e=this._scene.environmentTexture)||void 0===e||e.dispose(),null===(t=this._skybox.material.reflectionTexture)||void 0===t||t.dispose()),this._skybox.material.dispose(),this._skybox.dispose(),this._scene.environmentTexture=null},e.prototype._initProceduralSkybox=function(){var e,t,a=this;this._skyMaterial=new s.fE("sky",this._scene),this._skybox.material=this._skyMaterial,this._skybox.material.disableDepthWrite=!0,this._skyMaterial.azimuth=.307,this._skyMaterial.inclination=0,this._probe=new i.ReflectionProbe("skyProbe",128,this._scene,!0,!0,!0),this._probe.renderList.push(this._skybox),this._probe.attachToMesh(this._skybox),this._probe.cubeTexture.activeCamera=null!==(t=null===(e=this._scene.activeCameras)||void 0===e?void 0:e[0])&&void 0!==t?t:this._scene.activeCamera,this._probe.cubeTexture.refreshRate=0,this._probe.cubeTexture.onAfterUnbindObservable.add((function(){a._probe.cubeTexture.getInternalTexture()._sphericalPolynomialComputed?(a._probe.cubeTexture.forceSphericalPolynomialsRecompute(),a._needPolynomialsRegen=!1):a._needPolynomialsRegen=!0})),this._scene.environmentTexture=this._probe.cubeTexture,this._scene.customRenderTargets.push(this._probe.cubeTexture)},e.prototype._initSkybox=function(){var e=new i.HDRCubeTexture(r,this._scene,256,!1,!0,!1,!0),t=new i.StandardMaterial("skyBox",this._scene);t.disableDepthWrite=!0,t.reflectionTexture=e.clone(),t.reflectionTexture.coordinatesMode=i.Texture.SKYBOX_MODE,t.diffuseColor=new i.Color3(0,0,0),t.specularColor=new i.Color3(0,0,0),this._skybox.material=t,this._scene.environmentTexture=e},e}()},6113:(e,t,a)=>{"use strict";a.r(t),a.d(t,{WavesSettings:()=>s});var i=a(7976),s=function(){function e(){this.g=9.81,this.depth=3,this.lambda=1,this.local={scale:.5,windSpeed:1.5,windDirection:-29.81,fetch:1e5,spreadBlend:1,swell:.198,peakEnhancement:3.3,shortWavesFade:.01},this.swell={scale:.5,windSpeed:1.5,windDirection:90,fetch:3e5,spreadBlend:1,swell:1,peakEnhancement:3.3,shortWavesFade:.01},this.spectrums=[{scale:0,angle:0,spreadBlend:0,swell:0,alpha:0,peakOmega:0,gamma:0,shortWavesFade:0},{scale:0,angle:0,spreadBlend:0,swell:0,alpha:0,peakOmega:0,gamma:0,shortWavesFade:0}]}return e.prototype.setParametersToShader=function(e,t){e.updateFloat("GravityAcceleration",this.g),e.updateFloat("Depth",this.depth),this._fillSettingsStruct(this.local,this.spectrums[0]),this._fillSettingsStruct(this.swell,this.spectrums[1]);var a=[];this._linearizeSpectrumSetting(this.spectrums[0],a),this._linearizeSpectrumSetting(this.spectrums[1],a),t.update(a)},e.prototype._linearizeSpectrumSetting=function(e,t){t.push(e.scale,e.angle,e.spreadBlend,e.swell,e.alpha,e.peakOmega,e.gamma,e.shortWavesFade)},e.prototype._fillSettingsStruct=function(e,t){t.scale=e.scale,t.angle=e.windDirection/180*Math.PI,t.spreadBlend=e.spreadBlend,t.swell=i.Scalar.Clamp(e.swell,.01,1),t.alpha=this._JonswapAlpha(this.g,e.fetch,e.windSpeed),t.peakOmega=this._JonswapPeakFrequency(this.g,e.fetch,e.windSpeed),t.gamma=e.peakEnhancement,t.shortWavesFade=e.shortWavesFade},e.prototype._JonswapAlpha=function(e,t,a){return.076*Math.pow(e*t/a/a,-.22)},e.prototype._JonswapPeakFrequency=function(e,t,a){return 22*Math.pow(a*t/e/e,-.33)},e}()}}]);
//# sourceMappingURL=529.babylonBundle.js.map