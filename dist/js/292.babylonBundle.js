(self.webpackChunkbabylonjs_typescript_webpack_simple_scene=self.webpackChunkbabylonjs_typescript_webpack_simple_scene||[]).push([[292],{4292:(t,e,s)=>{"use strict";s.r(e),s.d(e,{Buoyancy:()=>o});var i=s(1465),o=function(){function t(t,e,s){void 0===e&&(e=5),void 0===s&&(s=1),this._size=t,this._displacementMap=null,this._lengthScale=0,this._numSteps=e,this._attenuation=s,this._meshes=[]}return t.prototype.setWaterHeightMap=function(t,e){this._displacementMap=t,this._lengthScale=e},t.prototype.addMesh=function(t,e,s,o){void 0===s&&(s=0),void 0===o&&(o=0),this._meshes.push({mesh:t,frame:e,yOffset:s,spaceCoordinates:o,initQuaternion:t.rotationQuaternion.clone(),curStep:0,curQuaternion:new i._fP,stepQuaternion:new i._fP})},Object.defineProperty(t.prototype,"attenuation",{get:function(){return this._attenuation},set:function(t){this._attenuation=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numSteps",{get:function(){return this._numSteps},set:function(t){this._numSteps=t},enumerable:!1,configurable:!0}),t.prototype.update=function(){for(var t=0;t<this._meshes.length;++t)this._updateMesh(this._meshes[t])},t.prototype.getWaterHeight=function(t){var e=i.jp9.Vector3[0];return this._getWaterDisplacement(t,e),t.subtractToRef(e,e),this._getWaterDisplacement(t,e),t.subtractToRef(e,e),this._getWaterDisplacement(t,e),t.subtractToRef(e,e),this._getWaterDisplacement(t,e),e.y},t.prototype._updateMesh=function(t){var e=i.jp9.Vector3[5],s=i.jp9.Vector3[6],o=i.jp9.Vector3[7],a=i.jp9.Vector3[8],n=i.jp9.Vector3[9],r=i.jp9.Vector3[10],p=i.jp9.Vector3[11],c=i.jp9.Vector3[12],u=t.mesh,h=t.frame,l=t.yOffset,f=t.spaceCoordinates,_=t.initQuaternion,m=t.curQuaternion,y=t.stepQuaternion,d=t.curStep;i.Pa4.TransformCoordinatesToRef(h.v1,u.getWorldMatrix(),e);var g=this.getWaterHeight(e);if(u.position.y=g+l,h.v2&&h.v3){if(d<this._numSteps)return t.curStep++,m.multiplyToRef(y,m),void _.multiplyToRef(m,u.rotationQuaternion);i.Pa4.TransformCoordinatesToRef(h.v2,u.getWorldMatrix(),s),s.subtractToRef(e,p),p.normalize(),i.Pa4.TransformCoordinatesToRef(h.v3,u.getWorldMatrix(),o),o.subtractToRef(e,c),c.normalize(),e.y=g,a.copyFrom(s),a.y=this.getWaterHeight(s),a.subtractToRef(e,a),a.normalize(),n.copyFrom(o),n.y=this.getWaterHeight(o),n.subtractToRef(e,n),n.normalize(),i.Pa4.CrossToRef(n,a,r),i.Pa4.CrossToRef(a,r,n),n.normalize();var T=Math.acos(i.Rus.Clamp(i.Pa4.Dot(p,a),0,1))*this._attenuation,R=Math.acos(i.Rus.Clamp(i.Pa4.Dot(c,n),0,1))*this._attenuation;switch(f){case 0:a.y>p.y&&(T=-T),n.y>c.y&&(R=-R),i._fP.FromEulerAnglesToRef(T/this._numSteps,R/this._numSteps,0,t.stepQuaternion);break;case 1:a.y>p.y&&(T=-T),n.y<c.y&&(R=-R),i._fP.FromEulerAnglesToRef(T/this._numSteps,0,R/this._numSteps,t.stepQuaternion);break;case 2:a.y>p.y&&(T=-T),n.y>c.y&&(R=-R),i._fP.FromEulerAnglesToRef(T/this._numSteps,0,R/this._numSteps,t.stepQuaternion)}t.curStep=0}},t.prototype._getWaterDisplacement=function(t,e){if(this._displacementMap){var s=this._size-1,o=t.x/this._lengthScale*this._size,a=t.z/this._lengthScale*this._size,n=i.jp9.Vector3[1],r=i.jp9.Vector3[2],p=i.jp9.Vector3[3],c=i.jp9.Vector3[4],u=Math.floor(o),h=Math.floor(a),l=o-u,f=a-h;u&=s,h&=s,this._getDisplacement(u,h,n),this._getDisplacement(u+1&s,h,r),r.subtractToRef(n,p).scaleToRef(l,p).addToRef(n,p),this._getDisplacement(u,h+1&s,n),this._getDisplacement(u+1&s,h+1&s,r),r.subtractToRef(n,c).scaleToRef(l,c).addToRef(n,c),c.subtractToRef(p,e).scaleToRef(f,e).addToRef(p,e)}else e.set(t.x,t.y,t.z)},t.prototype._getDisplacement=function(t,e,s){this._displacementMap&&(s.x=i.OiL.FromHalfFloat(this._displacementMap[e*this._size*4+4*t+0]),s.y=i.OiL.FromHalfFloat(this._displacementMap[e*this._size*4+4*t+1]),s.z=i.OiL.FromHalfFloat(this._displacementMap[e*this._size*4+4*t+2]))},t}()}}]);
//# sourceMappingURL=292.babylonBundle.js.map