"use strict";(self.webpackChunkbabylonjs_ocean_demo=self.webpackChunkbabylonjs_ocean_demo||[]).push([[811,183],{5811:(t,e,i)=>{i.r(e),i.d(e,{RTTDebug:()=>r});var a=i(153),s=i(47),n=i(4952),h=i(1183);class r{constructor(t,e,i=5){this._engine=e,this._scene=t,this._debugPlaneList=[],this._guiBackgrounds=[],this._guiTexts=[],this._guiButtons=[],this._exrSerializer=new h.EXRSerializer,this._camera=new a.ArcRotateCamera("debug",-Math.PI/2,Math.PI/2,10,new a.Vector3(0,0,0),this._scene),this._camera.mode=a.Camera.ORTHOGRAPHIC_CAMERA,this._camera.layerMask=268435456,this._gui=s.in.CreateFullscreenUI("debugGUI",!0,t),this._gui.layer.layerMask=268435456,this._makePlanes(i)}get camera(){return this._camera}setTexture(t,e,i,a=1){var s;this._debugPlaneList[t].material.emissiveTexture=i,1!==a&&(null===(s=this._debugPlaneList[t].material)||void 0===s||s.onBindObservable.add((()=>{var e;null===(e=this._debugPlaneList[t].material.getEffect())||void 0===e||e.setFloat("multiplier",a)}))),this._debugPlaneList[t].name=e,this._debugPlaneList[t].material.name="rttDebug_"+e,this._guiTexts[t].text=e}get isVisible(){return this._gui.layer.isEnabled}show(t){for(const e of this._debugPlaneList)e.setEnabled(t);for(const e of this._guiBackgrounds)e.isVisible=t;for(const e of this._guiTexts)e.isVisible=t;for(const e of this._guiButtons)e.isVisible=t;this._gui.layer.isEnabled=t}_makePlanes(t){const e=new s.rj("grid");e.addRowDefinition(1),this._gui.addControl(e);const i=new a.TransformNode("rttDebug",this._scene);for(let h=0;h<t;++h){const t=a.MeshBuilder.CreatePlane("plane"+h,{size:1},this._scene),r=t.getVerticesData("uv");for(let t=0;t<r.length;t+=2)r[t+1]=1-r[t+1];t.setVerticesData("uv",r),t.layerMask=268435456,t.position.x+=.5,t.position.y-=.5,t.bakeCurrentTransformIntoVertices(),t.parent=i,this._debugPlaneList.push(t);const _=new n.tk("planemat"+h,this._scene);t.material=_,_.AddUniform("multiplier","float","1.0"),_.Fragment_Before_FragColor("\n                color.rgba *= vec4(multiplier);\n            "),_.disableLighting=!0,e.addColumnDefinition(1/32);const d=new s.Ae("text"+h);d.background="green",d.color="white",d.thickness=2,d.width=.95,d.horizontalAlignment=s.oT.HORIZONTAL_ALIGNMENT_CENTER,d.verticalAlignment=s.oT.VERTICAL_ALIGNMENT_TOP,this._guiBackgrounds.push(d);const o=new s.al("title"+h,"");o.color="white",o.horizontalAlignment=s.oT.HORIZONTAL_ALIGNMENT_CENTER,o.verticalAlignment=s.oT.VERTICAL_ALIGNMENT_TOP,o.textHorizontalAlignment=s.oT.HORIZONTAL_ALIGNMENT_CENTER,o.textVerticalAlignment=s.oT.VERTICAL_ALIGNMENT_CENTER,this._guiTexts.push(o);const l=s.zx.CreateSimpleButton("button"+h,"Save");l.width=.7,l.color="white",l.cornerRadius=10,l.background="green",l.horizontalAlignment=s.oT.HORIZONTAL_ALIGNMENT_CENTER,l.verticalAlignment=s.oT.VERTICAL_ALIGNMENT_TOP,l.onPointerUpObservable.add((()=>{var t,e;const i=this._debugPlaneList[h].material.emissiveTexture;if(i){const s=null!==(e=null===(t=i.getInternalTexture())||void 0===t?void 0:t.format)&&void 0!==e?e:a.Constants.TEXTUREFORMAT_RGBA;i.readPixels().then((t=>{const e=s===a.Constants.TEXTUREFORMAT_R?["R"]:s===a.Constants.TEXTUREFORMAT_RG?["R","G"]:["R","G","B","A"];this._exrSerializer.serialize(i.getSize().width,i.getSize().height,new Float32Array(t.buffer),e),this._exrSerializer.download(this._debugPlaneList[h].name+".exr")}))}})),this._guiButtons.push(l),e.addControl(d,0,h),e.addControl(o,0,h),e.addControl(l,0,h)}for(let i=t;i<32;++i)e.addColumnDefinition(1/32);this._resize(),this._engine.onResizeObservable.add(this._resize.bind(this))}_resize(){const t=this._engine.getRenderWidth(),e=this._engine.getRenderHeight(),i=t/e;this._camera.orthoLeft=-5*i,this._camera.orthoRight=5*i,this._camera.orthoTop=5,this._camera.orthoBottom=-5,this._camera.getProjectionMatrix(!0);const s=this._camera.getTransformationMatrix().invert(),n=.0595,h=Math.floor(e*n*i/2+5),r=new a.Vector3(-1,1-n*i,.001),_=new a.Vector3(-1,1-n*i,.001);r.x+=.0015,_.x+=.0015,this._guiBackgrounds[0].parent.paddingTop=h+"px";for(let e=0;e<this._debugPlaneList.length;++e){const i=this._debugPlaneList[e];_.x+=n;const h=a.Vector3.TransformCoordinates(r,s),d=a.Vector3.TransformCoordinates(_,s).x-h.x;i.scaling.set(d,d,1),i.position.set(h.x,h.y,h.z),_.x+=.003,r.x=_.x,this._guiBackgrounds[e].height=20*t/1920+"px",this._guiTexts[e].height=20*t/1920+"px",this._guiTexts[e].fontSize=8*t/1920+"px",this._guiButtons[e].top=20*t/1920+2+"px",this._guiButtons[e].height=16*t/1920+"px",this._guiButtons[e].fontSize=8*t/1920+"px"}}}},1183:(t,e,i)=>{i.r(e),i.d(e,{EXRSerializer:()=>r});var a,s,n,h=i(4651);!function(t){t[t.UINT=0]="UINT",t[t.HALF=1]="HALF",t[t.FLOAT=2]="FLOAT"}(a||(a={})),function(t){t[t.NO_COMPRESSION=0]="NO_COMPRESSION",t[t.RLE_COMPRESSION=1]="RLE_COMPRESSION",t[t.ZIPS_COMPRESSION=2]="ZIPS_COMPRESSION",t[t.ZIP_COMPRESSION=3]="ZIP_COMPRESSION",t[t.PIZ_COMPRESSION=4]="PIZ_COMPRESSION",t[t.PXR24_COMPRESSION=5]="PXR24_COMPRESSION",t[t.B44_COMPRESSION=6]="B44_COMPRESSION",t[t.B44A_COMPRESSION=7]="B44A_COMPRESSION"}(s||(s={})),function(t){t[t.INCREASING_Y=0]="INCREASING_Y",t[t.DECREASING_Y=1]="DECREASING_Y",t[t.RANDOM_Y=2]="RANDOM_Y"}(n||(n={}));class r{constructor(){this._buffer=new Uint8Array(0),this._dataLength=0,this._view=new DataView(this._buffer.buffer),this._growSize=2e3}get buffer(){return this._buffer}serialize(t,e,i,h=["R","G","B","A"]){this._dataLength=0;const r=h.length;this._capacity(t*e*r*4);const _=[],d=["A","B","G","R"];let o=0;for(let t=0;t<d.length;++t)h.indexOf(d[t])>=0&&(_.push({name:d[t],pixelType:a.FLOAT}),o|=1<<3-t);this._add([118,47,49,1]),this._addInt32(2),this._addHeaderAttribute_chlist("channels",_),this._addHeaderAttribute_compression("compression",s.NO_COMPRESSION),this._addHeaderAttribute_box2i("dataWindow",0,0,t-1,e-1),this._addHeaderAttribute_box2i("displayWindow",0,0,t-1,e-1),this._addHeaderAttribute_lineOrder("lineOrder",n.INCREASING_Y),this._addHeaderAttribute_float("pixelAspectRatio",1),this._addHeaderAttribute_v2f("screenWindowCenter",0,0),this._addHeaderAttribute_float("screenWindowWidth",t),this._addNull();const l=[],g=8*e,u=t*r*4;let c=this._dataLength+g;for(let t=0;t<e;++t)l.push(BigInt(c)),c+=u+8;this._addUint64(l);for(let a=0;a<e;++a){this._addUint32(a),this._addUint32(u);for(let e=3;e>=0;--e)if(o&1<<e)for(let s=0;s<t;++s){const n=i[a*t*r+s*r+e];this._addFloat(n)}}this._buffer=this._buffer.slice(0,this._dataLength),this._view=new DataView(this._buffer.buffer)}download(t){h.w1.Download(new Blob([this._buffer.buffer],{type:"application/octet-stream"}),t)}_addHeaderAttribute_chlist(t,e){this._addString(t),this._addNull(),this._addString("chlist"),this._addNull();let i=1;for(let t=0;t<e.length;++t)i+=e[t].name.length+1,i+=16;this._addUint32(i);for(let t=0;t<e.length;++t){const i=e[t];this._addString(i.name),this._addNull(),this._addInt32(i.pixelType),this._addUint8(0),this._addNull(3),this._addInt32([1,1])}this._addNull()}_addHeaderAttribute_compression(t,e){this._addString(t),this._addNull(),this._addString("compression"),this._addNull(),this._addUint32(1),this._addUint8(e)}_addHeaderAttribute_box2i(t,e,i,a,s){this._addString(t),this._addNull(),this._addString("box2i"),this._addNull(),this._addUint32(16),this._addInt32([e,i,a,s])}_addHeaderAttribute_lineOrder(t,e){this._addString(t),this._addNull(),this._addString("lineOrder"),this._addNull(),this._addUint32(1),this._addUint8(e)}_addHeaderAttribute_float(t,e){this._addString(t),this._addNull(),this._addString("float"),this._addNull(),this._addUint32(4),this._addFloat(e)}_addHeaderAttribute_v2f(t,e,i){this._addString(t),this._addNull(),this._addString("v2f"),this._addNull(),this._addUint32(8),this._addFloat([e,i])}_addString(t){this._capacity(t.length);for(let e=0;e<t.length;++e)this._view.setUint8(this._dataLength++,t.charCodeAt(e))}_addInt8(t){if(Array.isArray(t)){this._capacity(t.length);for(let e=0;e<t.length;++e)this._view.setInt8(this._dataLength++,t[e])}else this._capacity(1),this._view.setInt8(this._dataLength,t),this._dataLength+=1}_addUint8(t){this._capacity(1),this._view.setUint8(this._dataLength,t),this._dataLength+=1}_addInt16(t){if(Array.isArray(t)){this._capacity(2*t.length);for(let e=0;e<t.length;++e)this._view.setInt16(this._dataLength,t[e],!0),this._dataLength+=2}else this._capacity(2),this._view.setInt16(this._dataLength,t,!0),this._dataLength+=2}_addUint16(t){if(Array.isArray(t)){this._capacity(2*t.length);for(let e=0;e<t.length;++e)this._view.setUint16(this._dataLength,t[e],!0),this._dataLength+=2}else this._view.setUint16(this._dataLength,t,!0),this._dataLength+=2}_addInt32(t){if(Array.isArray(t)){this._capacity(4*t.length);for(let e=0;e<t.length;++e)this._view.setInt32(this._dataLength,t[e],!0),this._dataLength+=4}else this._capacity(4),this._view.setInt32(this._dataLength,t,!0),this._dataLength+=4}_addUint32(t){if(Array.isArray(t)){this._capacity(4*t.length);for(let e=0;e<t.length;++e)this._view.setUint32(this._dataLength,t[e],!0),this._dataLength+=4}else this._capacity(4),this._view.setUint32(this._dataLength,t,!0),this._dataLength+=4}_addUint64(t){if(Array.isArray(t)){this._capacity(8*t.length);for(let e=0;e<t.length;++e)this._view.setBigUint64(this._dataLength,t[e],!0),this._dataLength+=8}else{this._capacity(t.byteLength);for(let e=0;e<t.length;++e)this._view.setBigUint64(this._dataLength,t[e],!0),this._dataLength+=8}}_addFloat(t){if(Array.isArray(t)){this._capacity(4*t.length);for(let e=0;e<t.length;++e)this._view.setFloat32(this._dataLength,t[e],!0),this._dataLength+=4}else t instanceof Float32Array?(this._capacity(t.byteLength),this._buffer.set(t,this._dataLength),this._dataLength+=t.byteLength):(this._capacity(4),this._view.setFloat32(this._dataLength,t,!0),this._dataLength+=4)}_addNull(t=1){for(this._capacity(t);t-- >0;)this._view.setUint8(this._dataLength++,0)}_add(t){Array.isArray(t)&&(t=new Uint8Array(t));const e=t.byteLength;this._capacity(e),this._buffer.set(t,this._dataLength),this._dataLength+=e}_capacity(t){this._dataLength+t<=this._buffer.byteLength||this._growBuffer(Math.max(this._growSize,t))}_growBuffer(t){const e=new Uint8Array(this._buffer.byteLength+t);e.set(this._buffer,0),this._buffer=e,this._view=new DataView(this._buffer.buffer)}}}}]);
//# sourceMappingURL=811.50b49284e0fc1da429c5.js.map