(self.webpackChunkbabylonjs_ocean_demo=self.webpackChunkbabylonjs_ocean_demo||[]).push([[292],{4292:(t,e,o)=>{"use strict";o.r(e),o.d(e,{Buoyancy:()=>r});var s=o(7976),r=function(){function t(t,e,o){void 0===e&&(e=5),void 0===o&&(o=1),this.enabled=!0,this._size=t,this._displacementMap=null,this._lengthScale=0,this._numSteps=e,this._attenuation=o,this._meshes=[]}return t.prototype.setWaterHeightMap=function(t,e){this._displacementMap=t,this._lengthScale=e},t.prototype.addMesh=function(t,e,o,r){void 0===o&&(o=0),void 0===r&&(r=0),this._meshes.push({mesh:t,frame:e,yOffset:o,spaceCoordinates:r,initQuaternion:t.rotationQuaternion.clone(),curStep:0,curQuaternion:new s.Quaternion,stepQuaternion:new s.Quaternion})},Object.defineProperty(t.prototype,"size",{set:function(t){this._size=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attenuation",{get:function(){return this._attenuation},set:function(t){this._attenuation=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numSteps",{get:function(){return this._numSteps},set:function(t){this._numSteps=t},enumerable:!1,configurable:!0}),t.prototype.update=function(){if(this.enabled)for(var t=0;t<this._meshes.length;++t)this._updateMesh(this._meshes[t])},t.prototype.getWaterHeight=function(t){var e=s.TmpVectors.Vector3[0];return this._getWaterDisplacement(t,e),t.subtractToRef(e,e),this._getWaterDisplacement(t,e),t.subtractToRef(e,e),this._getWaterDisplacement(t,e),t.subtractToRef(e,e),this._getWaterDisplacement(t,e),e.y},t.prototype._updateMesh=function(t){var e=s.TmpVectors.Vector3[5],o=s.TmpVectors.Vector3[6],r=s.TmpVectors.Vector3[7],i=s.TmpVectors.Vector3[8],a=s.TmpVectors.Vector3[9],n=s.TmpVectors.Vector3[10],c=s.TmpVectors.Vector3[11],p=s.TmpVectors.Vector3[12],u=t.mesh,h=t.frame,l=t.yOffset,m=t.spaceCoordinates,f=t.initQuaternion,_=t.curQuaternion,T=t.stepQuaternion,y=t.curStep;s.Vector3.TransformCoordinatesToRef(h.v1,u.getWorldMatrix(),e);var d=this.getWaterHeight(e);if(u.position.y=d+l,h.v2&&h.v3){if(y<this._numSteps)return t.curStep++,_.multiplyToRef(T,_),void f.multiplyToRef(_,u.rotationQuaternion);s.Vector3.TransformCoordinatesToRef(h.v2,u.getWorldMatrix(),o),o.subtractToRef(e,c),c.normalize(),s.Vector3.TransformCoordinatesToRef(h.v3,u.getWorldMatrix(),r),r.subtractToRef(e,p),p.normalize(),e.y=d,i.copyFrom(o),i.y=this.getWaterHeight(o),i.subtractToRef(e,i),i.normalize(),a.copyFrom(r),a.y=this.getWaterHeight(r),a.subtractToRef(e,a),a.normalize(),s.Vector3.CrossToRef(a,i,n),s.Vector3.CrossToRef(i,n,a),a.normalize();var g=Math.acos(s.Scalar.Clamp(s.Vector3.Dot(c,i),0,1))*this._attenuation,V=Math.acos(s.Scalar.Clamp(s.Vector3.Dot(p,a),0,1))*this._attenuation;switch(m){case 0:i.y>c.y&&(g=-g),a.y>p.y&&(V=-V),s.Quaternion.FromEulerAnglesToRef(g/this._numSteps,V/this._numSteps,0,t.stepQuaternion);break;case 1:i.y>c.y&&(g=-g),a.y<p.y&&(V=-V),s.Quaternion.FromEulerAnglesToRef(g/this._numSteps,0,V/this._numSteps,t.stepQuaternion);break;case 2:i.y>c.y&&(g=-g),a.y>p.y&&(V=-V),s.Quaternion.FromEulerAnglesToRef(g/this._numSteps,0,V/this._numSteps,t.stepQuaternion)}t.curStep=0}},t.prototype._getWaterDisplacement=function(t,e){if(this._displacementMap){var o=this._size-1,r=t.x/this._lengthScale*this._size,i=t.z/this._lengthScale*this._size,a=s.TmpVectors.Vector3[1],n=s.TmpVectors.Vector3[2],c=s.TmpVectors.Vector3[3],p=s.TmpVectors.Vector3[4],u=Math.floor(r),h=Math.floor(i),l=r-u,m=i-h;u&=o,h&=o,this._getDisplacement(u,h,a),this._getDisplacement(u+1&o,h,n),n.subtractToRef(a,c).scaleToRef(l,c).addToRef(a,c),this._getDisplacement(u,h+1&o,a),this._getDisplacement(u+1&o,h+1&o,n),n.subtractToRef(a,p).scaleToRef(l,p).addToRef(a,p),p.subtractToRef(c,e).scaleToRef(m,e).addToRef(c,e)}else e.set(t.x,t.y,t.z)},t.prototype._getDisplacement=function(t,e,o){this._displacementMap&&(o.x=s.TextureTools.FromHalfFloat(this._displacementMap[e*this._size*4+4*t+0]),o.y=s.TextureTools.FromHalfFloat(this._displacementMap[e*this._size*4+4*t+1]),o.z=s.TextureTools.FromHalfFloat(this._displacementMap[e*this._size*4+4*t+2]))},t}()}}]);
//# sourceMappingURL=292.babylonBundle.js.map