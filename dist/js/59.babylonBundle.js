(self.webpackChunkbabylonjs_ocean_demo=self.webpackChunkbabylonjs_ocean_demo||[]).push([[59],{4059:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SkyBox:()=>n});var s=i(7976),o=i(9781);i(6699);const r=i.p+"0c03bd6e3c9d04da0cf428bbf487bf68.hdr";var n=function(){function e(e,t){var i=this;this._procedural=e,this._scene=t,this._oldSunPosition=new s.Vector3,this._skyMaterial=null,this._probe=null,this._dirty=!1,this._dirtyCount=0,this._needPolynomialsRegen=!1,this._skybox=s.MeshBuilder.CreateBox("skyBox",{size:1e3,sideOrientation:s.Mesh.BACKSIDE},this._scene),t.meshes.splice(t.meshes.indexOf(this._skybox),1),t.meshes.splice(0,0,this._skybox),this._skyboxObserver=t.onBeforeRenderObservable.add((function(){var e,s;i._skybox.position=null!==(s=null===(e=t.activeCameras)||void 0===e?void 0:e[0].position)&&void 0!==s?s:t.activeCamera.position})),e?this._initProceduralSkybox():this._initSkybox(),this.setAsDirty()}return Object.defineProperty(e.prototype,"probe",{get:function(){return this._probe},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skyMaterial",{get:function(){return this._skyMaterial},enumerable:!1,configurable:!0}),e.prototype.setAsDirty=function(){this._dirty=!0,this._dirtyCount=2,this._probe.cubeTexture.refreshRate=1,this._needPolynomialsRegen=!0},e.prototype.update=function(e){if(!this._procedural)return!1;var t=!1,i=this._probe.cubeTexture.getInternalTexture();return this._oldSunPosition.equals(this._skyMaterial.sunPosition)&&!this._dirty||(this._oldSunPosition.copyFrom(this._skyMaterial.sunPosition),e.position=this._skyMaterial.sunPosition.clone(),e.direction=this._skyMaterial.sunPosition.negate().normalize(),e.diffuse=this._skyMaterial.getSunColor().toLinearSpace(),0==this._dirtyCount--&&(this._dirty=!1,this._probe.cubeTexture.refreshRate=0),t=!0),!this._dirty&&this._needPolynomialsRegen&&i._sphericalPolynomialComputed&&(this._probe.cubeTexture.forceSphericalPolynomialsRecompute(),this._needPolynomialsRegen=!1),t},e.prototype.dispose=function(){var e,t;this._scene.onBeforeRenderObservable.remove(this._skyboxObserver),this._scene.customRenderTargets=[],this._procedural?this._probe.dispose():(null===(e=this._scene.environmentTexture)||void 0===e||e.dispose(),null===(t=this._skybox.material.reflectionTexture)||void 0===t||t.dispose()),this._skybox.material.dispose(),this._skybox.dispose(),this._scene.environmentTexture=null},e.prototype._initProceduralSkybox=function(){var e,t,i=this;this._skyMaterial=new o.fE("sky",this._scene),this._skybox.material=this._skyMaterial,this._skybox.material.disableDepthWrite=!0,this._skyMaterial.azimuth=.307,this._skyMaterial.inclination=0,this._probe=new s.ReflectionProbe("skyProbe",128,this._scene,!0,!0,!0),this._probe.renderList.push(this._skybox),this._probe.attachToMesh(this._skybox),this._probe.cubeTexture.activeCamera=null!==(t=null===(e=this._scene.activeCameras)||void 0===e?void 0:e[0])&&void 0!==t?t:this._scene.activeCamera,this._probe.cubeTexture.refreshRate=0,this._probe.cubeTexture.onAfterUnbindObservable.add((function(){i._probe.cubeTexture.getInternalTexture()._sphericalPolynomialComputed?(i._probe.cubeTexture.forceSphericalPolynomialsRecompute(),i._needPolynomialsRegen=!1):i._needPolynomialsRegen=!0})),this._scene.environmentTexture=this._probe.cubeTexture,this._scene.customRenderTargets.push(this._probe.cubeTexture)},e.prototype._initSkybox=function(){var e=new s.HDRCubeTexture(r,this._scene,256,!1,!0,!1,!0),t=new s.StandardMaterial("skyBox",this._scene);t.disableDepthWrite=!0,t.reflectionTexture=e.clone(),t.reflectionTexture.coordinatesMode=s.Texture.SKYBOX_MODE,t.diffuseColor=new s.Color3(0,0,0),t.specularColor=new s.Color3(0,0,0),this._skybox.material=t,this._scene.environmentTexture=e},e}()}}]);
//# sourceMappingURL=59.babylonBundle.js.map