/*! For license information please see babylonBundle.js.LICENSE.txt */
(()=>{var e,t,r,i,n={798:(e,t,r)=>{"use strict";r.d(t,{l:()=>s,o:()=>o});var i=r(3173),n=r(9510),s=function(){function e(e,t,r,n,s,o,a,u){void 0===n&&(n=0),void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===a&&(a=!1),this._isAlreadyOwned=!1,e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=r,this._instanced=o,this._divisor=u||1,t instanceof i.h?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=a?n:n*Float32Array.BYTES_PER_ELEMENT,s||this.create()}return e.prototype.createVertexBuffer=function(e,t,r,i,n,s,a){void 0===s&&(s=!1);var u=s?t:t*Float32Array.BYTES_PER_ELEMENT,h=i?s?i:i*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new o(this._engine,this,e,this._updatable,!0,h,void 0===n?this._instanced:n,u,r,void 0,void 0,!0,this._divisor||a)},e.prototype.isUpdatable=function(){return this._updatable},e.prototype.getData=function(){return this._data},e.prototype.getBuffer=function(){return this._buffer},e.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},e.prototype.create=function(e){void 0===e&&(e=null),!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e))},e.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},e.prototype.update=function(e){this.create(e)},e.prototype.updateDirectly=function(e,t,r,i){void 0===i&&(i=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,i?t:t*Float32Array.BYTES_PER_ELEMENT,r?r*this.byteStride:void 0),this._data=null)},e.prototype._increaseReferences=function(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)},e.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},e}(),o=function(){function e(t,r,i,n,o,a,u,h,c,l,p,f,d,_){if(void 0===p&&(p=!1),void 0===f&&(f=!1),void 0===d&&(d=1),void 0===_&&(_=!1),r instanceof s?(this._buffer=r,this._ownsBuffer=_,_&&this._buffer._increaseReferences()):(this._buffer=new s(t,r,n,a,o,u,f),this._ownsBuffer=!0),this.uniqueId=e._Counter++,this._kind=i,null==l){var g=this.getData();this.type=e.FLOAT,g instanceof Int8Array?this.type=e.BYTE:g instanceof Uint8Array?this.type=e.UNSIGNED_BYTE:g instanceof Int16Array?this.type=e.SHORT:g instanceof Uint16Array?this.type=e.UNSIGNED_SHORT:g instanceof Int32Array?this.type=e.INT:g instanceof Uint32Array&&(this.type=e.UNSIGNED_INT)}else this.type=l;var m=e.GetTypeByteLength(this.type);f?(this._size=c||(a?a/m:e.DeduceStride(i)),this.byteStride=a||this._buffer.byteStride||this._size*m,this.byteOffset=h||0):(this._size=c||a||e.DeduceStride(i),this.byteStride=a?a*m:this._buffer.byteStride||this._size*m,this.byteOffset=(h||0)*m),this.normalized=p,this._instanced=void 0!==u&&u,this._instanceDivisor=u?d:0,this._computeHashCode()}return Object.defineProperty(e.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,this._instanced=0!=e,this._computeHashCode()},enumerable:!1,configurable:!0}),e.prototype._computeHashCode=function(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)},e.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},e.prototype.getKind=function(){return this._kind},e.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},e.prototype.getData=function(){return this._buffer.getData()},e.prototype.getFloatData=function(t,r){var i=this.getData();if(!i)return null;var s=this.getSize()*e.GetTypeByteLength(this.type),o=t*this.getSize();if(this.type!==e.FLOAT||this.byteStride!==s){var a=[];return this.forEach(o,(function(e){return a.push(e)})),a}if(!(i instanceof Array||i instanceof Float32Array)||0!==this.byteOffset||i.length!==o){if(i instanceof Array){var u=this.byteOffset/4;return n.u.Slice(i,u,u+o)}if(i instanceof ArrayBuffer)return new Float32Array(i,this.byteOffset,o);if(u=i.byteOffset+this.byteOffset,r){var h=new Float32Array(o),c=new Float32Array(i.buffer,u,o);return h.set(c),h}var l=u%4;return l&&(u=Math.max(0,u-l)),new Float32Array(i.buffer,u,o)}return r?n.u.Slice(i):i},e.prototype.getBuffer=function(){return this._buffer.getBuffer()},e.prototype.getStrideSize=function(){return this.byteStride/e.GetTypeByteLength(this.type)},e.prototype.getOffset=function(){return this.byteOffset/e.GetTypeByteLength(this.type)},e.prototype.getSize=function(t){return void 0===t&&(t=!1),t?this._size*e.GetTypeByteLength(this.type):this._size},e.prototype.getIsInstanced=function(){return this._instanced},e.prototype.getInstanceDivisor=function(){return this._instanceDivisor},e.prototype.create=function(e){this._buffer.create(e)},e.prototype.update=function(e){this._buffer.update(e)},e.prototype.updateDirectly=function(e,t,r){void 0===r&&(r=!1),this._buffer.updateDirectly(e,t,void 0,r)},e.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},e.prototype.forEach=function(t,r){e.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,r)},e.DeduceStride=function(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}},e.GetTypeByteLength=function(t){switch(t){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.INT:case e.UNSIGNED_INT:case e.FLOAT:return 4;default:throw new Error("Invalid type '"+t+"'")}},e.ForEach=function(t,r,i,n,s,o,a,u){if(t instanceof Array)for(var h=r/4,c=i/4,l=0;l<o;l+=n){for(var p=0;p<n;p++)u(t[h+p],l+p);h+=c}else{var f=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),d=e.GetTypeByteLength(s);for(l=0;l<o;l+=n){var _=r;for(p=0;p<n;p++)u(e._GetFloatValue(f,s,_,a),l+p),_+=d;r+=i}}},e._GetFloatValue=function(t,r,i,n){switch(r){case e.BYTE:var s=t.getInt8(i);return n&&(s=Math.max(s/127,-1)),s;case e.UNSIGNED_BYTE:return s=t.getUint8(i),n&&(s/=255),s;case e.SHORT:return s=t.getInt16(i,!0),n&&(s=Math.max(s/32767,-1)),s;case e.UNSIGNED_SHORT:return s=t.getUint16(i,!0),n&&(s/=65535),s;case e.INT:return t.getInt32(i,!0);case e.UNSIGNED_INT:return t.getUint32(i,!0);case e.FLOAT:return t.getFloat32(i,!0);default:throw new Error("Invalid component type "+r)}},e._Counter=0,e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra",e}()},3173:(e,t,r)=>{"use strict";r.d(t,{h:()=>i});var i=function(){function e(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=e._Counter++}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),e._Counter=0,e}()},3018:(e,t,r)=>{"use strict";var i=r(1910);i.B.prototype.setAlphaConstants=function(e,t,r,i){this._alphaState.setAlphaBlendConstants(e,t,r,i)},i.B.prototype.setAlphaMode=function(e,t){if(void 0===t&&(t=!1),this._alphaMode!==e){switch(e){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0}t||(this.depthCullingState.depthMask=0===e),this._alphaMode=e}},i.B.prototype.getAlphaMode=function(){return this._alphaMode},i.B.prototype.setAlphaEquation=function(e){if(this._alphaEquation!==e){switch(e){case 0:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_ADD,this._gl.FUNC_ADD);break;case 1:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_SUBTRACT,this._gl.FUNC_SUBTRACT);break;case 2:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_REVERSE_SUBTRACT,this._gl.FUNC_REVERSE_SUBTRACT);break;case 3:this._alphaState.setAlphaEquationParameters(this._gl.MAX,this._gl.MAX);break;case 4:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.MIN);break;case 5:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.FUNC_ADD)}this._alphaEquation=e}},i.B.prototype.getAlphaEquation=function(){return this._alphaEquation}},7507:(e,t,r)=>{"use strict";var i=r(1910);i.B.prototype.updateDynamicIndexBuffer=function(e,t,r){var i;void 0===r&&(r=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),i=t instanceof Uint16Array||t instanceof Uint32Array?t:e.is32Bits?new Uint32Array(t):new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},i.B.prototype.updateDynamicVertexBuffer=function(e,t,r,i){this.bindArrayBuffer(e),void 0===r&&(r=0);var n=t.length||t.byteLength;void 0===i||i>=n&&0===r?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(r,r+i)):(t=t instanceof ArrayBuffer?new Uint8Array(t,r,i):new Uint8Array(t.buffer,t.byteOffset+r,i),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()}},1457:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var i=r(1910);function n(e,t,r,i){switch(void 0===r&&(r=!1),e){case 3:var n=(ArrayBuffer,new Int8Array(t));return i&&n.set(new Int8Array(i)),n;case 0:var s=(ArrayBuffer,new Uint8Array(t));return i&&s.set(new Uint8Array(i)),s;case 4:var o=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(r?t/2:t);return i&&o.set(new Int16Array(i)),o;case 5:case 8:case 9:case 10:case 2:var a=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(r?t/2:t);return i&&a.set(new Uint16Array(i)),a;case 6:var u=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(r?t/4:t);return i&&u.set(new Int32Array(i)),u;case 7:case 11:case 12:case 13:case 14:case 15:var h=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(r?t/4:t);return i&&h.set(new Uint32Array(i)),h;case 1:var c=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(r?t/4:t);return i&&c.set(new Float32Array(i)),c}var l=(ArrayBuffer,new Uint8Array(t));return i&&l.set(new Uint8Array(i)),l}i.B.prototype._readTexturePixelsSync=function(e,t,r,i,s,o,a,u){var h,c;void 0===i&&(i=-1),void 0===s&&(s=0),void 0===o&&(o=null),void 0===a&&(a=!0),void 0===u&&(u=!1);var l=this._gl;if(!l)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var p=l.createFramebuffer();if(!p)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=p}l.bindFramebuffer(l.FRAMEBUFFER,this._dummyFramebuffer),i>-1?l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_CUBE_MAP_POSITIVE_X+i,null===(h=e._hardwareTexture)||void 0===h?void 0:h.underlyingResource,s):l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,null===(c=e._hardwareTexture)||void 0===c?void 0:c.underlyingResource,s);var f=void 0!==e.type?this._getWebGLTextureType(e.type):l.UNSIGNED_BYTE;if(u)o||(o=n(e.type,4*t*r));else switch(f){case l.UNSIGNED_BYTE:o||(o=new Uint8Array(4*t*r)),f=l.UNSIGNED_BYTE;break;default:o||(o=new Float32Array(4*t*r)),f=l.FLOAT}return a&&this.flushFramebuffer(),l.readPixels(0,0,t,r,l.RGBA,f,o),l.bindFramebuffer(l.FRAMEBUFFER,this._currentFramebuffer),o},i.B.prototype._readTexturePixels=function(e,t,r,i,n,s,o,a){return void 0===i&&(i=-1),void 0===n&&(n=0),void 0===s&&(s=null),void 0===o&&(o=!0),void 0===a&&(a=!1),Promise.resolve(this._readTexturePixelsSync(e,t,r,i,n,s,o,a))}},346:(e,t,r)=>{"use strict";var i=r(3940),n=r(6599),s=r(4462),o=r(1730),a=r(1910);a.B.prototype.createRenderTargetTexture=function(e,t){var r=new o.L;void 0!==t&&"object"==typeof t?(r.generateMipMaps=t.generateMipMaps,r.generateDepthBuffer=!!t.generateDepthBuffer,r.generateStencilBuffer=!!t.generateStencilBuffer,r.type=void 0===t.type?0:t.type,r.samplingMode=void 0===t.samplingMode?3:t.samplingMode,r.format=void 0===t.format?5:t.format):(r.generateMipMaps=t,r.generateDepthBuffer=!0,r.generateStencilBuffer=!1,r.type=0,r.samplingMode=3,r.format=5),(1!==r.type||this._caps.textureFloatLinearFiltering)&&(2!==r.type||this._caps.textureHalfFloatLinearFiltering)||(r.samplingMode=1),1!==r.type||this._caps.textureFloat||(r.type=0,s.Y.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var i=this._gl,a=new n.l(this,n.S.RenderTarget),u=e.width||e,h=e.height||e,c=e.layers||0,l=this._getSamplingParameters(r.samplingMode,!!r.generateMipMaps),p=0!==c?i.TEXTURE_2D_ARRAY:i.TEXTURE_2D,f=this._getRGBABufferInternalSizedFormat(r.type,r.format),d=this._getInternalFormat(r.format),_=this._getWebGLTextureType(r.type);this._bindTextureDirectly(p,a),0!==c?(a.is2DArray=!0,i.texImage3D(p,0,f,u,h,c,0,d,_,null)):i.texImage2D(p,0,f,u,h,0,d,_,null),i.texParameteri(p,i.TEXTURE_MAG_FILTER,l.mag),i.texParameteri(p,i.TEXTURE_MIN_FILTER,l.min),i.texParameteri(p,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(p,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),r.generateMipMaps&&this._gl.generateMipmap(p),this._bindTextureDirectly(p,null);var g=this._currentFramebuffer,m=i.createFramebuffer();return this._bindUnboundFramebuffer(m),a._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!r.generateStencilBuffer,r.generateDepthBuffer,u,h),a.is2DArray||i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,a._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(g),a._framebuffer=m,a.baseWidth=u,a.baseHeight=h,a.width=u,a.height=h,a.depth=c,a.isReady=!0,a.samples=1,a.generateMipMaps=!!r.generateMipMaps,a.samplingMode=r.samplingMode,a.type=r.type,a.format=r.format,a._generateDepthBuffer=r.generateDepthBuffer,a._generateStencilBuffer=!!r.generateStencilBuffer,this._internalTexturesCache.push(a),a},a.B.prototype.createDepthStencilTexture=function(e,t){if(t.isCube){var r=e.width||e;return this._createDepthStencilCubeTexture(r,t)}return this._createDepthStencilTexture(e,t)},a.B.prototype._createDepthStencilTexture=function(e,t){var r=this._gl,o=e.layers||0,a=0!==o?r.TEXTURE_2D_ARRAY:r.TEXTURE_2D,u=new n.l(this,n.S.Depth);if(!this._caps.depthTextureExtension)return s.Y.Error("Depth texture is not supported by your browser or hardware."),u;var h=(0,i.pi)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t);this._bindTextureDirectly(a,u,!0),this._setupDepthStencilTexture(u,e,h.generateStencil,0!==h.comparisonFunction&&h.bilinearFiltering,h.comparisonFunction);var c=h.generateStencil?r.UNSIGNED_INT_24_8:r.UNSIGNED_INT,l=h.generateStencil?r.DEPTH_STENCIL:r.DEPTH_COMPONENT,p=l;return this.webGLVersion>1&&(p=h.generateStencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24),u.is2DArray?r.texImage3D(a,0,p,u.width,u.height,o,0,l,c,null):r.texImage2D(a,0,p,u.width,u.height,0,l,c,null),this._bindTextureDirectly(a,null),this._internalTexturesCache.push(u),u}},6410:(e,t,r)=>{"use strict";var i=r(3940),n=r(6599),s=r(4462);r(1910).B.prototype.createRenderTargetCubeTexture=function(e,t){var r=(0,i.pi)({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5},t);r.generateStencilBuffer=r.generateDepthBuffer&&r.generateStencilBuffer,(1!==r.type||this._caps.textureFloatLinearFiltering)&&(2!==r.type||this._caps.textureHalfFloatLinearFiltering)||(r.samplingMode=1);var o=this._gl,a=new n.l(this,n.S.RenderTarget);this._bindTextureDirectly(o.TEXTURE_CUBE_MAP,a,!0);var u=this._getSamplingParameters(r.samplingMode,r.generateMipMaps);1!==r.type||this._caps.textureFloat||(r.type=0,s.Y.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,u.mag),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,u.min),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE);for(var h=0;h<6;h++)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,this._getRGBABufferInternalSizedFormat(r.type,r.format),e,e,0,this._getInternalFormat(r.format),this._getWebGLTextureType(r.type),null);var c=o.createFramebuffer();return this._bindUnboundFramebuffer(c),a._depthStencilBuffer=this._setupFramebufferDepthAttachments(r.generateStencilBuffer,r.generateDepthBuffer,e,e),r.generateMipMaps&&o.generateMipmap(o.TEXTURE_CUBE_MAP),this._bindTextureDirectly(o.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),a._framebuffer=c,a.width=e,a.height=e,a.isReady=!0,a.isCube=!0,a.samples=1,a.generateMipMaps=r.generateMipMaps,a.samplingMode=r.samplingMode,a.type=r.type,a.format=r.format,a._generateDepthBuffer=r.generateDepthBuffer,a._generateStencilBuffer=r.generateStencilBuffer,this._internalTexturesCache.push(a),a}},462:(e,t,r)=>{"use strict";var i=r(1910),n=r(809);i.B.prototype.createUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");var r=new n.M(t);return this.bindUniformBuffer(r),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),r.references=1,r},i.B.prototype.createDynamicUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");var r=new n.M(t);return this.bindUniformBuffer(r),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),r.references=1,r},i.B.prototype.updateUniformBuffer=function(e,t,r,i){this.bindUniformBuffer(e),void 0===r&&(r=0),void 0===i?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,r,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,r,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(r,r+i)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(r,r+i)),this.bindUniformBuffer(null)},i.B.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e?e.underlyingResource:null)},i.B.prototype.bindUniformBufferBase=function(e,t,r){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e?e.underlyingResource:null)},i.B.prototype.bindUniformBlock=function(e,t,r){var i=e.program,n=this._gl.getUniformBlockIndex(i,t);this._gl.uniformBlockBinding(i,n,r)}},4549:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var i=function(){function e(e,t){void 0===t&&(t=20),this.debug=!1,this._sourceCode=e,this._numMaxIterations=t,this._functionDescr=[],this.inlineToken="#define inline"}return Object.defineProperty(e.prototype,"code",{get:function(){return this._sourceCode},enumerable:!1,configurable:!0}),e.prototype.processCode=function(){this.debug&&console.log("Start inlining process (code size="+this._sourceCode.length+")..."),this._collectFunctions(),this._processInlining(this._numMaxIterations),this.debug&&console.log("End of inlining process.")},e.prototype._collectFunctions=function(){for(var t=0;t<this._sourceCode.length;){var r=this._sourceCode.indexOf(this.inlineToken,t);if(r<0)break;var i=this._sourceCode.indexOf("(",r+this.inlineToken.length);if(i<0)this.debug&&console.warn("Could not find the opening parenthesis after the token. startIndex="+t),t=r+this.inlineToken.length;else{var n=e._RegexpFindFunctionNameAndType.exec(this._sourceCode.substring(r+this.inlineToken.length,i));if(n){var s=[n[3],n[4]],o=s[0],a=s[1],u=this._extractBetweenMarkers("(",")",this._sourceCode,i);if(u<0)this.debug&&console.warn("Could not extract the parameters the function '"+a+"' (type="+o+"). funcParamsStartIndex="+i),t=r+this.inlineToken.length;else{var h=this._sourceCode.substring(i+1,u),c=this._skipWhitespaces(this._sourceCode,u+1);if(c!==this._sourceCode.length){var l=this._extractBetweenMarkers("{","}",this._sourceCode,c);if(l<0)this.debug&&console.warn("Could not extract the body of the function '"+a+"' (type="+o+"). funcBodyStartIndex="+c),t=r+this.inlineToken.length;else{for(var p=this._sourceCode.substring(c,l+1),f=this._removeComments(h).split(","),d=[],_=0;_<f.length;++_){var g=f[_].trim(),m=g.lastIndexOf(" ");m>=0&&d.push(g.substring(m+1))}"void"!==o&&d.push("return"),this._functionDescr.push({name:a,type:o,parameters:d,body:p,callIndex:0}),t=l+1;var y=r>0?this._sourceCode.substring(0,r):"",v=l+1<this._sourceCode.length-1?this._sourceCode.substring(l+1):"";this._sourceCode=y+v,t-=l+1-r}}else this.debug&&console.warn("Could not extract the body of the function '"+a+"' (type="+o+"). funcParamsEndIndex="+u),t=r+this.inlineToken.length}}else this.debug&&console.warn("Could not extract the name/type of the function from: "+this._sourceCode.substring(r+this.inlineToken.length,i)),t=r+this.inlineToken.length}}this.debug&&console.log("Collect functions: "+this._functionDescr.length+" functions found. functionDescr=",this._functionDescr)},e.prototype._processInlining=function(e){for(void 0===e&&(e=20);e-- >=0&&this._replaceFunctionCallsByCode(););return this.debug&&console.log("numMaxIterations is "+e+" after inlining process"),e>=0},e.prototype._extractBetweenMarkers=function(e,t,r,i){for(var n=i,s=0,o="";n<r.length;){var a=r.charAt(n);if(o)a===o?'"'===o||"'"===o?"\\"!==r.charAt(n-1)&&(o=""):o="":"*/"===o&&"*"===a&&n+1<r.length&&("/"===r.charAt(n+1)&&(o=""),""===o&&n++);else switch(a){case e:s++;break;case t:s--;break;case'"':case"'":case"`":o=a;break;case"/":if(n+1<r.length){var u=r.charAt(n+1);"/"===u?o="\n":"*"===u&&(o="*/")}}if(n++,0===s)break}return 0===s?n-1:-1},e.prototype._skipWhitespaces=function(e,t){for(;t<e.length;){var r=e[t];if(" "!==r&&"\n"!==r&&"\r"!==r&&"\t"!==r&&"\n"!==r&&" "!==r)break;t++}return t},e.prototype._isIdentifierChar=function(e){var t=e.charCodeAt(0);return t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||95==t},e.prototype._removeComments=function(e){for(var t=0,r="",i=!1,n=[];t<e.length;){var s=e.charAt(t);if(r)s===r?'"'===r||"'"===r?("\\"!==e.charAt(t-1)&&(r=""),n.push(s)):(r="",i=!1):"*/"===r&&"*"===s&&t+1<e.length?("/"===e.charAt(t+1)&&(r=""),""===r&&(i=!1,t++)):i||n.push(s);else{switch(s){case'"':case"'":case"`":r=s;break;case"/":if(t+1<e.length){var o=e.charAt(t+1);"/"===o?(r="\n",i=!0):"*"===o&&(r="*/",i=!0)}}i||n.push(s)}t++}return n.join("")},e.prototype._replaceFunctionCallsByCode=function(){for(var e=this,t=!1,r=0,i=this._functionDescr;r<i.length;r++)for(var n=i[r],s=n.name,o=n.type,a=n.parameters,u=n.body,h=0;h<this._sourceCode.length;){var c=this._sourceCode.indexOf(s,h);if(c<0)break;if(0===c||this._isIdentifierChar(this._sourceCode.charAt(c-1)))h=c+s.length;else{var l=this._skipWhitespaces(this._sourceCode,c+s.length);if(l!==this._sourceCode.length&&"("===this._sourceCode.charAt(l)){var p=this._extractBetweenMarkers("(",")",this._sourceCode,l);if(p<0)this.debug&&console.warn("Could not extract the parameters of the function call. Function '"+s+"' (type="+o+"). callParamsStartIndex="+l),h=c+s.length;else{var f=this._sourceCode.substring(l+1,p),d=function(t){for(var r=[],i=0,n=0;i<t.length;){if("("===t.charAt(i)){var s=e._extractBetweenMarkers("(",")",t,i);if(s<0)return null;i=s}else","===t.charAt(i)&&(r.push(t.substring(n,i)),n=i+1);i++}return n<i&&r.push(t.substring(n,i)),r}(this._removeComments(f));if(null!==d){for(var _=[],g=0;g<d.length;++g){var m=d[g].trim();_.push(m)}var y="void"!==o?s+"_"+n.callIndex++:null;if(y&&_.push(y+" ="),_.length===a.length){h=p+1;var v=this._replaceNames(u,a,_),b=c>0?this._sourceCode.substring(0,c):"",x=p+1<this._sourceCode.length-1?this._sourceCode.substring(p+1):"";if(y){var R=this._findBackward(this._sourceCode,c-1,"\n");b=this._sourceCode.substring(0,R+1);var T=this._sourceCode.substring(R+1,c);this._sourceCode=b+o+" "+y+";\n"+v+"\n"+T+y+x,this.debug&&console.log("Replace function call by code. Function '"+s+"' (type="+o+"). injectDeclarationIndex="+R+", call parameters="+_)}else this._sourceCode=b+v+x,h+=v.length-(p+1-c),this.debug&&console.log("Replace function call by code. Function '"+s+"' (type="+o+"). functionCallIndex="+c+", call parameters="+_);t=!0}else this.debug&&console.warn("Invalid function call: not the same number of parameters for the call than the number expected by the function. Function '"+s+"' (type="+o+"). function parameters="+a+", call parameters="+_),h=c+s.length}else this.debug&&console.warn("Invalid function call: can't extract the parameters of the function call. Function '"+s+"' (type="+o+"). callParamsStartIndex="+l+", callParams="+f),h=c+s.length}}else h=c+s.length}}return t},e.prototype._findBackward=function(e,t,r){for(;t>=0&&e.charAt(t)!==r;)t--;return t},e.prototype._escapeRegExp=function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},e.prototype._replaceNames=function(e,t,r){for(var i=this,n=function(n){var o=new RegExp(s._escapeRegExp(t[n]),"g"),a=t[n].length,u=r[n];e=e.replace(o,(function(r){for(var s=[],o=1;o<arguments.length;o++)s[o-1]=arguments[o];var h=s[0];return i._isIdentifierChar(e.charAt(h-1))||i._isIdentifierChar(e.charAt(h+a))?t[n]:u}))},s=this,o=0;o<t.length;++o)n(o);return e},e._RegexpFindFunctionNameAndType=/((\s+?)(\w+)\s+(\w+)\s*?)$/,e}()},5210:(e,t,r)=>{"use strict";r.d(t,{L:()=>m});var i=r(2519),n=function(){function e(){this.children=[]}return e.prototype.isValid=function(e){return!0},e.prototype.process=function(e,t){var r="";if(this.line){var n=this.line,s=t.processor;s&&(s.lineProcessor&&(n=s.lineProcessor(n,t.isFragment,t.processingContext)),s.attributeProcessor&&i.M.StartsWith(this.line,"attribute")?n=s.attributeProcessor(this.line,e,t.processingContext):s.varyingProcessor&&i.M.StartsWith(this.line,"varying")?n=s.varyingProcessor(this.line,t.isFragment,e,t.processingContext):(s.uniformProcessor||s.uniformBufferProcessor)&&i.M.StartsWith(this.line,"uniform")&&!t.lookForClosingBracketForUniformBuffer&&(/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?s.uniformProcessor&&(n=s.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):s.uniformBufferProcessor&&(n=s.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)),t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,s.endOfUniformBufferProcessor&&(n=s.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))),r+=n+"\r\n"}return this.children.forEach((function(i){r+=i.process(e,t)})),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),r},e}(),s=function(){function e(){}return Object.defineProperty(e.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lines",{set:function(e){this._lines=[];for(var t=0,r=e;t<r.length;t++){var i=r[t];if("#"!==i[0])for(var n=i.split(";"),s=0;s<n.length;s++){var o=n[s];(o=o.trim())&&this._lines.push(o+(s!==n.length-1?";":""))}else this._lines.push(i)}},enumerable:!1,configurable:!0}),e}(),o=r(3940),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.prototype.process=function(e,t){for(var r=0;r<this.children.length;r++){var i=this.children[r];if(i.isValid(e))return i.process(e,t)}return""},t}(n),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.prototype.isValid=function(e){return this.testExpression.isTrue(e)},t}(n),h=function(){function e(){}return e.prototype.isTrue=function(e){return!0},e.postfixToInfix=function(t){for(var r=[],i=0,n=t;i<n.length;i++){var s=n[i];if(void 0===e._OperatorPriority[s])r.push(s);else{var o=r[r.length-1],a=r[r.length-2];r.length-=2,r.push("("+a+s+o+")")}}return r[r.length-1]},e.infixToPostfix=function(t){for(var r=[],i=-1,n=function(){""!==(h=h.trim())&&(r.push(h),h="")},s=function(t){i<e._Stack.length-1&&(e._Stack[++i]=t)},o=function(){return e._Stack[i]},a=function(){return-1===i?"!!INVALID EXPRESSION!!":e._Stack[i--]},u=0,h="";u<t.length;){var c=t.charAt(u),l=u<t.length-1?t.substr(u,2):"";if("("===c)h="",s(c);else if(")"===c){for(n();-1!==i&&"("!==o();)r.push(a());a()}else if(e._OperatorPriority[l]>1){for(n();-1!==i&&e._OperatorPriority[o()]>=e._OperatorPriority[l];)r.push(a());s(l),u++}else h+=c;u++}for(n();-1!==i;)"("===o()?a():r.push(a());return r},e._OperatorPriority={")":0,"(":1,"||":2,"&&":3},e._Stack=["","","","","","","","","","","","","","","","","","","",""],e}(),c=function(e){function t(t,r){void 0===r&&(r=!1);var i=e.call(this)||this;return i.define=t,i.not=r,i}return(0,o.ZT)(t,e),t.prototype.isTrue=function(e){var t=void 0!==e[this.define];return this.not&&(t=!t),t},t}(h),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)},t}(h),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,o.ZT)(t,e),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)},t}(h),f=function(e){function t(t,r,i){var n=e.call(this)||this;return n.define=t,n.operand=r,n.testValue=i,n}return(0,o.ZT)(t,e),t.prototype.isTrue=function(e){var t=e[this.define];void 0===t&&(t=this.define);var r=!1,i=parseInt(t),n=parseInt(this.testValue);switch(this.operand){case">":r=i>n;break;case"<":r=i<n;break;case"<=":r=i<=n;break;case">=":r=i>=n;break;case"==":r=i===n}return r},t}(h),d=r(7936),_=/defined\s*?\((.+?)\)/g,g=/defined\s*?\[(.+?)\]/g,m=function(){function e(){}return e.Initialize=function(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)},e.Process=function(e,t,r,i){var n=this;this._ProcessIncludes(e,t,(function(e){var s=n._ProcessShaderConversion(e,t,i);r(s)}))},e.PreProcess=function(e,t,r,i){var n=this;this._ProcessIncludes(e,t,(function(e){var s=n._ApplyPreProcessing(e,t,i);r(s)}))},e.Finalize=function(e,t,r){return r.processor&&r.processor.finalizeShaders?r.processor.finalizeShaders(e,t,r.processingContext):{vertexCode:e,fragmentCode:t}},e._ProcessPrecision=function(e,t){var r=t.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=r?"precision highp float;\n"+e:"precision mediump float;\n"+e:r||(e=e.replace("precision highp float","precision mediump float")),e},e._ExtractOperation=function(e){var t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new c(t[1].trim(),"!"===e[0]);for(var r="",i=0,n=0,s=["==",">=","<=","<",">"];n<s.length&&(r=s[n],!((i=e.indexOf(r))>-1));n++);if(-1===i)return new c(e);var o=e.substring(0,i).trim(),a=e.substring(i+r.length).trim();return new f(o,r,a)},e._BuildSubExpression=function(e){e=e.replace(_,"defined[$1]");for(var t=[],r=0,i=h.infixToPostfix(e);r<i.length;r++){var n=i[r];if("||"!==n&&"&&"!==n)t.push(n);else if(t.length>=2){var s=t[t.length-1],o=t[t.length-2];t.length-=2;var a="&&"==n?new p:new l;"string"==typeof s&&(s=s.replace(g,"defined($1)")),"string"==typeof o&&(o=o.replace(g,"defined($1)")),a.leftOperand="string"==typeof o?this._ExtractOperation(o):o,a.rightOperand="string"==typeof s?this._ExtractOperation(s):s,t.push(a)}}var u=t[t.length-1];return"string"==typeof u&&(u=u.replace(g,"defined($1)")),"string"==typeof u?this._ExtractOperation(u):u},e._BuildExpression=function(e,t){var r=new u,i=e.substring(0,t),n=e.substring(t);return n=n.substring(0,(n.indexOf("//")+1||n.length+1)-1).trim(),r.testExpression="#ifdef"===i?new c(n):"#ifndef"===i?new c(n,!0):this._BuildSubExpression(n),r},e._MoveCursorWithinIf=function(e,t,r){for(var i=e.currentLine;this._MoveCursor(e,r);){var s=(i=e.currentLine).substring(0,5).toLowerCase();if("#else"===s){var o=new n;return t.children.push(o),void this._MoveCursor(e,o)}if("#elif"===s){var a=this._BuildExpression(i,5);t.children.push(a),r=a}}},e._MoveCursor=function(e,t){for(;e.canRead;){e.lineIndex++;var r=e.currentLine,i=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(r);if(i&&i.length)switch(i[0]){case"#ifdef":var s=new a;t.children.push(s);var o=this._BuildExpression(r,6);s.children.push(o),this._MoveCursorWithinIf(e,s,o);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":s=new a,t.children.push(s),o=this._BuildExpression(r,7),s.children.push(o),this._MoveCursorWithinIf(e,s,o);break;case"#if":s=new a,o=this._BuildExpression(r,3),t.children.push(s),s.children.push(o),this._MoveCursorWithinIf(e,s,o)}else{var u=new n;if(u.line=r,t.children.push(u),"#"===r[0]&&"d"===r[1]){var h=r.replace(";","").split(" ");u.additionalDefineKey=h[1],3===h.length&&(u.additionalDefineValue=h[2])}}}return!1},e._EvaluatePreProcessors=function(e,t,r){var i=new n,o=new s;return o.lineIndex=-1,o.lines=e.split("\n"),this._MoveCursor(o,i),i.process(t,r)},e._PreparePreProcessors=function(e,t,r){void 0===r&&(r=!0);for(var i={},n=0,s=e.defines;n<s.length;n++){var o=s[n].replace("#define","").replace(";","").trim().split(" ");i[o[0]]=o.length>1?o[1]:""}return r&&(i.GL_ES="true"),i.__VERSION__=e.version,i[e.platformName]="true",t._getGlobalDefines(i),i},e._ProcessShaderConversion=function(e,t,r){var i=this._ProcessPrecision(e,t);if(!t.processor)return i;if(-1!==i.indexOf("#version 3"))return i.replace("#version 300 es","");var n=t.defines,s=this._PreparePreProcessors(t,r);return t.processor.preProcessor&&(i=t.processor.preProcessor(i,n,t.isFragment,t.processingContext)),i=this._EvaluatePreProcessors(i,s,t),t.processor.postProcessor&&(i=t.processor.postProcessor(i,n,t.isFragment,t.processingContext,r)),r._features.needShaderCodeInlining&&(i=r.inlineShaderCode(i)),i},e._ApplyPreProcessing=function(e,t,r){var i,n,s=e,o=t.defines,a=this._PreparePreProcessors(t,r,!1);return(null===(i=t.processor)||void 0===i?void 0:i.preProcessor)&&(s=t.processor.preProcessor(s,o,t.isFragment,t.processingContext)),s=this._EvaluatePreProcessors(s,a,t),(null===(n=t.processor)||void 0===n?void 0:n.postProcessor)&&(s=t.processor.postProcessor(s,o,t.isFragment,t.processingContext,r)),r._features.needShaderCodeInlining&&(s=r.inlineShaderCode(s)),s},e._ProcessIncludes=function(t,r,i){for(var n=this,s=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,o=s.exec(t),a=new String(t),u=!1;null!=o;){var h=o[1];if(-1!==h.indexOf("__decl__")&&(h=h.replace(/__decl__/,""),r.supportsUniformBuffers&&(h=(h=h.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),h+="Declaration"),!r.includesShadersStore[h]){var c=r.shadersRepository+"ShadersInclude/"+h+".fx";return void e._FileToolsLoadFile(c,(function(e){r.includesShadersStore[h]=e,n._ProcessIncludes(a,r,i)}))}var l=r.includesShadersStore[h];if(o[2])for(var p=o[3].split(","),f=0;f<p.length;f+=2){var d=new RegExp(p[f],"g"),_=p[f+1];l=l.replace(d,_)}if(o[4]){var g=o[5];if(-1!==g.indexOf("..")){var m=g.split(".."),y=parseInt(m[0]),v=parseInt(m[1]),b=l.slice(0);l="",isNaN(v)&&(v=r.indexParameters[m[1]]);for(var x=y;x<v;x++)r.supportsUniformBuffers||(b=b.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),l+=b.replace(/\{X\}/g,x.toString())+"\n"}else r.supportsUniformBuffers||(l=l.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),l=l.replace(/\{X\}/g,g)}a=a.replace(o[0],l),u=u||l.indexOf("#include<")>=0||l.indexOf("#include <")>=0,o=s.exec(t)}u?this._ProcessIncludes(a.toString(),r,i):i(a)},e._FileToolsLoadFile=function(e,t,r,i,n,s){throw d.f.WarnImport("FileTools")},e}()},8370:(e,t,r)=>{"use strict";r.d(t,{C:()=>i});var i=function(){function e(){}return e.prototype.attributeProcessor=function(e){return e.replace("attribute","in")},e.prototype.varyingProcessor=function(e,t){return e.replace("varying",t?"in":"out")},e.prototype.postProcessor=function(e,t,r,i,n){var s=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),r)e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(s?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;return e},e}()},9302:(e,t,r)=>{"use strict";r.d(t,{y:()=>i});var i=function(){function e(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(e.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!1,configurable:!0}),e.prototype._handlesSpectorRebuildCallback=function(e){e&&this.program&&e(this.program)},e.prototype._fillEffectInformation=function(e,t,r,i,n,s,o,a){var u,h=this.engine;if(h.supportsUniformBuffers)for(var c in t)e.bindUniformBlock(c,t[c]);for(this.engine.getUniforms(this,r).forEach((function(e,t){i[r[t]]=e})),this._uniforms=i,u=0;u<n.length;u++)null==e.getUniform(n[u])&&(n.splice(u,1),u--);n.forEach((function(e,t){s[e]=t}));for(var l=0,p=h.getAttributes(this,o);l<p.length;l++){var f=p[l];a.push(f)}},e.prototype.dispose=function(){this._uniforms={}},e.prototype._cacheMatrix=function(e,t){var r=this._valueCache[e],i=t.updateFlag;return(void 0===r||r!==i)&&(this._valueCache[e]=i,!0)},e.prototype._cacheFloat2=function(e,t,r){var i=this._valueCache[e];if(!i||2!==i.length)return i=[t,r],this._valueCache[e]=i,!0;var n=!1;return i[0]!==t&&(i[0]=t,n=!0),i[1]!==r&&(i[1]=r,n=!0),n},e.prototype._cacheFloat3=function(e,t,r,i){var n=this._valueCache[e];if(!n||3!==n.length)return n=[t,r,i],this._valueCache[e]=n,!0;var s=!1;return n[0]!==t&&(n[0]=t,s=!0),n[1]!==r&&(n[1]=r,s=!0),n[2]!==i&&(n[2]=i,s=!0),s},e.prototype._cacheFloat4=function(e,t,r,i,n){var s=this._valueCache[e];if(!s||4!==s.length)return s=[t,r,i,n],this._valueCache[e]=s,!0;var o=!1;return s[0]!==t&&(s[0]=t,o=!0),s[1]!==r&&(s[1]=r,o=!0),s[2]!==i&&(s[2]=i,o=!0),s[3]!==n&&(s[3]=n,o=!0),o},e.prototype.setInt=function(e,t){var r=this._valueCache[e];void 0!==r&&r===t||this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)},e.prototype.setInt2=function(e,t,r){this._cacheFloat2(e,t,r)&&(this.engine.setInt2(this._uniforms[e],t,r)||(this._valueCache[e]=null))},e.prototype.setInt3=function(e,t,r,i){this._cacheFloat3(e,t,r,i)&&(this.engine.setInt3(this._uniforms[e],t,r,i)||(this._valueCache[e]=null))},e.prototype.setInt4=function(e,t,r,i,n){this._cacheFloat4(e,t,r,i,n)&&(this.engine.setInt4(this._uniforms[e],t,r,i,n)||(this._valueCache[e]=null))},e.prototype.setIntArray=function(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)},e.prototype.setIntArray2=function(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)},e.prototype.setIntArray3=function(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)},e.prototype.setIntArray4=function(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)},e.prototype.setArray=function(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)},e.prototype.setArray2=function(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)},e.prototype.setArray3=function(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)},e.prototype.setArray4=function(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)},e.prototype.setMatrices=function(e,t){t&&(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))},e.prototype.setMatrix=function(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.toArray())||(this._valueCache[e]=null))},e.prototype.setMatrix3x3=function(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)},e.prototype.setMatrix2x2=function(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)},e.prototype.setFloat=function(e,t){var r=this._valueCache[e];void 0!==r&&r===t||this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)},e.prototype.setVector2=function(e,t){this._cacheFloat2(e,t.x,t.y)&&(this.engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null))},e.prototype.setFloat2=function(e,t,r){this._cacheFloat2(e,t,r)&&(this.engine.setFloat2(this._uniforms[e],t,r)||(this._valueCache[e]=null))},e.prototype.setVector3=function(e,t){this._cacheFloat3(e,t.x,t.y,t.z)&&(this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null))},e.prototype.setFloat3=function(e,t,r,i){this._cacheFloat3(e,t,r,i)&&(this.engine.setFloat3(this._uniforms[e],t,r,i)||(this._valueCache[e]=null))},e.prototype.setVector4=function(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))},e.prototype.setFloat4=function(e,t,r,i,n){this._cacheFloat4(e,t,r,i,n)&&(this.engine.setFloat4(this._uniforms[e],t,r,i,n)||(this._valueCache[e]=null))},e.prototype.setColor3=function(e,t){this._cacheFloat3(e,t.r,t.g,t.b)&&(this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null))},e.prototype.setColor4=function(e,t,r){this._cacheFloat4(e,t.r,t.g,t.b,r)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,r)||(this._valueCache[e]=null))},e.prototype.setDirectColor4=function(e,t){this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null))},e.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null},e.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null},e}()},4286:(e,t,r)=>{"use strict";r.d(t,{C:()=>s});var i=r(4462),n=function(){this.values={}},s=function(){function e(e,t,r){this.disabled=!1,this._device=e,this._cacheSampler=t,this._engine=r}return e.prototype.endFrame=function(){e.NumBindGroupsCreatedLastFrame=e._NumBindGroupsCreatedCurrentFrame,e._NumBindGroupsCreatedCurrentFrame=0},e.prototype.getBindGroups=function(t,r,s){var o,a,u,h,c=void 0,l=e._Cache;if(!this.disabled){for(var p=0,f=t.shaderProcessingContext.uniformBufferNames;p<f.length;p++){var d=s[f[p]].uniqueId;(m=l.values[d])||(m=new n,l.values[d]=m),l=m}for(var _=0,g=t.shaderProcessingContext.samplerNames;_<g.length;_++){var m,y=g[_],v=null!==(u=null===(a=null===(o=r.textures[y])||void 0===o?void 0:o.texture)||void 0===a?void 0:a.uniqueId)&&void 0!==u?u:0;if(!(m=l.values[v])){m=new n,l.values[v]=m;var b=e._CacheTextures[v];b||(b=e._CacheTextures[v]=[]),b.push(l)}l=m}c=l.bindGroups}if(c)return c;c=[],this.disabled||(l.bindGroups=c),e.NumBindGroupsCreatedTotal++,e._NumBindGroupsCreatedCurrentFrame++;for(var x=t.bindGroupLayouts,R=0;R<t.shaderProcessingContext.orderedUBOsAndSamplers.length;R++){var T=t.shaderProcessingContext.orderedUBOsAndSamplers[R];if(void 0!==T){for(var E=[],S=0;S<T.length;S++){var C=t.shaderProcessingContext.orderedUBOsAndSamplers[R][S];if(void 0!==C)if(C.isSampler)if(F=r.samplers[C.name]){var A=null===(h=r.textures[F.firstTextureName])||void 0===h?void 0:h.texture;if(!A){i.Y.Error('Could not create the gpu sampler "'+C.name+'" because no texture can be looked up for the name "'+F.firstTextureName+'". bindingInfo='+JSON.stringify(F)+", materialContext="+JSON.stringify(r,(function(e,t){return"texture"===e||"_cacheBindGroups"===e?"<no dump>":t})),50);continue}E.push({binding:S,resource:this._cacheSampler.getSampler(A)})}else i.Y.Error('Sampler "'+C.name+'" could not be bound. bindingDefinition='+JSON.stringify(C)+", materialContext="+JSON.stringify(r,(function(e,t){return"texture"===e||"_cacheBindGroups"===e?"<no dump>":t})),50);else if(C.isTexture){var F;if(F=r.textures[C.name]){if(this._engine.dbgSanityChecks&&null===F.texture){i.Y.Error("Trying to bind a null texture! bindingDefinition="+JSON.stringify(C)+", bindingInfo="+JSON.stringify(F,(function(e,t){return"texture"===e?"<no dump>":t})),50);continue}var P=F.texture._hardwareTexture;if(this._engine.dbgSanityChecks&&!P.view){i.Y.Error("Trying to bind a null gpu texture! bindingDefinition="+JSON.stringify(C)+", bindingInfo="+JSON.stringify(F,(function(e,t){return"texture"===e?"<no dump>":t}))+", isReady="+F.texture.isReady,50);continue}E.push({binding:S,resource:P.view})}else i.Y.Error('Texture "'+C.name+'" could not be bound. bindingDefinition='+JSON.stringify(C)+", materialContext="+JSON.stringify(r,(function(e,t){return"texture"===e||"_cacheBindGroups"===e?"<no dump>":t})),50)}else{var w=s[C.name];if(w){var B=w.underlyingResource;E.push({binding:S,resource:{buffer:B,offset:0,size:w.capacity}})}else i.Y.Error("Can't find UBO \""+C.name+'". bindingDefinition='+JSON.stringify(C)+", _uniformsBuffers="+JSON.stringify(s),50)}}E.length>0&&(M=x[R],c[R]=this._device.createBindGroup({layout:M,entries:E}))}else{var M=x[R];c[R]=this._device.createBindGroup({layout:M,entries:[]})}}return c},e.prototype.clearTextureEntries=function(t){var r=e._CacheTextures[t];if(r){for(var i=0;i<r.length;++i){var n=r[i];this._clearTextureNode(n,t.toString()),delete r[i].values[t]}delete e._CacheTextures[t]}},e.prototype._clearTextureNode=function(t,r){for(var i in t.values)if(i!==r){this._clearTextureNode(t.values[i],r);var n=e._CacheTextures[i];if(n)for(var s=0;s<n.length;++s)if(n[s]===t){n.splice(s,1);break}}},e.NumBindGroupsCreatedTotal=0,e.NumBindGroupsCreatedLastFrame=0,e._Cache=new n,e._CacheTextures={},e._NumBindGroupsCreatedCurrentFrame=0,e}()},7213:(e,t,r)=>{"use strict";r.d(t,{O:()=>h});var i,n=r(5573),s=r(798);!function(e){e[e.StencilReadMask=0]="StencilReadMask",e[e.StencilWriteMask=1]="StencilWriteMask",e[e.DepthBiasSlopeScale=2]="DepthBiasSlopeScale",e[e.MRTAttachments1=3]="MRTAttachments1",e[e.MRTAttachments2=4]="MRTAttachments2",e[e.DepthStencilState=5]="DepthStencilState",e[e.RasterizationState=6]="RasterizationState",e[e.ColorStates=7]="ColorStates",e[e.ShaderStage=8]="ShaderStage",e[e.TextureStage=9]="TextureStage",e[e.VertexState=10]="VertexState",e[e.NumStates=11]="NumStates"}(i||(i={}));var o={"":0,r8unorm:1,r8snorm:2,r8uint:3,r8sint:4,r16uint:5,r16sint:6,r16float:7,rg8unorm:8,rg8snorm:9,rg8uint:10,rg8sint:11,r32uint:12,r32sint:13,r32float:14,rg16uint:15,rg16sint:16,rg16float:17,rgba8unorm:18,"rgba8unorm-srgb":19,rgba8snorm:20,rgba8uint:21,rgba8sint:22,bgra8unorm:23,"bgra8unorm-srgb":24,rgb9e5ufloat:25,rgb10a2unorm:26,rg11b10ufloat:27,rg32uint:28,rg32sint:29,rg32float:30,rgba16uint:31,rgba16sint:32,rgba16float:33,rgba32uint:34,rgba32sint:35,rgba32float:36,stencil8:37,depth16unorm:38,depth24plus:39,"depth24plus-stencil8":40,depth32float:41,"bc1-rgba-unorm":42,"bc1-rgba-unorm-srgb":43,"bc2-rgba-unorm":44,"bc2-rgba-unorm-srgb":45,"bc3-rgba-unorm":46,"bc3-rgba-unorm-srgb":47,"bc4-r-unorm":48,"bc4-r-snorm":49,"bc5-rg-unorm":50,"bc5-rg-snorm":51,"bc6h-rgb-ufloat":52,"bc6h-rgb-float":53,"bc7-rgba-unorm":54,"bc7-rgba-unorm-srgb":55,"depth24unorm-stencil8":56,"depth32float-stencil8":57},a={0:1,1:2,768:3,769:4,770:5,771:6,772:7,773:8,774:9,775:10,776:11,32769:12,32770:13,32771:12,32772:13},u={0:0,7680:1,7681:2,7682:3,7683:4,5386:5,34055:6,34056:7},h=function(){function e(e,t,r){this._device=e,this._useTextureStage=r,this._states=new Array(30),this._statesLength=0,this._stateDirtyLowestIndex=0,this._emptyVertexBuffer=t,this._mrtFormats=[],this._parameter={token:void 0,pipeline:null},this.disabled=!1,this.vertexBuffers=[],this._kMaxVertexBufferStride=2048,this.reset()}return e.prototype.reset=function(){this._isDirty=!0,this.vertexBuffers.length=0,this.setAlphaToCoverage(!1),this.resetDepthCullingState(),this.setClampDepth(!1),this._webgpuColorFormat=[n.EV.BGRA8Unorm],this.setColorFormat(n.EV.BGRA8Unorm),this.setMRTAttachments([],[]),this.setAlphaBlendEnabled(!1),this.setAlphaBlendFactors([null,null,null,null],[null,null]),this.setWriteMask(15),this.setDepthStencilFormat(n.EV.Depth24PlusStencil8),this.setStencilEnabled(!1),this.resetStencilState(),this.setBuffers(null,null,null),this._setTextureState(0)},Object.defineProperty(e.prototype,"colorFormats",{get:function(){return this._mrtAttachments1>0?this._mrtFormats:this._webgpuColorFormat},enumerable:!1,configurable:!0}),e.prototype.getRenderPipeline=function(t,r,i,n){if(void 0===n&&(n=0),this.disabled){var s=e._GetTopology(t);return this._setVertexState(r),this._parameter.pipeline=this._createRenderPipeline(r,s,i),e.NumCacheMiss++,e._NumPipelineCreationCurrentFrame++,this._parameter.pipeline}if(this._setShaderStage(r.uniqueId),this._setRasterizationState(t,i),this._setColorStates(),this._setDepthStencilState(),this._setVertexState(r),this._setTextureState(n),this.lastStateDirtyLowestIndex=this._stateDirtyLowestIndex,!this._isDirty&&this._parameter.pipeline)return this._stateDirtyLowestIndex=this._statesLength,e.NumCacheHitWithoutHash++,this._parameter.pipeline;if(this._getRenderPipeline(this._parameter),this._isDirty=!1,this._stateDirtyLowestIndex=this._statesLength,this._parameter.pipeline)return e.NumCacheHitWithHash++,this._parameter.pipeline;var o=e._GetTopology(t);return this._parameter.pipeline=this._createRenderPipeline(r,o,i),this._setRenderPipeline(this._parameter),e.NumCacheMiss++,e._NumPipelineCreationCurrentFrame++,this._parameter.pipeline},e.prototype.endFrame=function(){e.NumPipelineCreationLastFrame=e._NumPipelineCreationCurrentFrame,e._NumPipelineCreationCurrentFrame=0},e.prototype.setAlphaToCoverage=function(e){this._alphaToCoverageEnabled=e},e.prototype.setFrontFace=function(e){this._frontFace=e},e.prototype.setCullEnabled=function(e){this._cullEnabled=e},e.prototype.setCullFace=function(e){this._cullFace=e},e.prototype.setClampDepth=function(e){this._clampDepth=e},e.prototype.resetDepthCullingState=function(){this.setDepthCullingState(!1,2,1,0,!0,!0,519)},e.prototype.setDepthCullingState=function(e,t,r,i,n,s,o){this._depthWriteEnabled=s,this._depthTestEnabled=n,this._depthCompare=(null!=o?o:519)-512,this._cullFace=r,this._cullEnabled=e,this._frontFace=t,this.setDepthBiasSlopeScale(i)},e.prototype.setDepthBiasSlopeScale=function(e){this._depthBiasSlopeScale!==e&&(this._depthBiasSlopeScale=e,this._states[i.DepthBiasSlopeScale]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.DepthBiasSlopeScale))},e.prototype.setColorFormat=function(e){this._webgpuColorFormat[0]=e,this._colorFormat=o[e]},e.prototype.setMRTAttachments=function(e,t){var r;if(e.length>10)throw"Can't handle more than 10 attachments for a MRT in cache render pipeline!";this.mrtAttachments=e,this.mrtTextureArray=t;for(var n=[0,0],s=0,a=0,u=0,h=0;h<e.length;++h){var c=e[h];if(0!==c){var l=t[c-1],p=null==l?void 0:l._hardwareTexture;this._mrtFormats[u]=null!==(r=null==p?void 0:p.format)&&void 0!==r?r:this._webgpuColorFormat[0],n[s]+=o[this._mrtFormats[u]]<<a,u++,(a+=6)>=32&&(a=0,s++)}}this._mrtFormats.length=u,this._mrtAttachments1===n[0]&&this._mrtAttachments2===n[1]||(this._mrtAttachments1=n[0],this._mrtAttachments2=n[1],this._states[i.MRTAttachments1]=n[0],this._states[i.MRTAttachments2]=n[1],this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.MRTAttachments1))},e.prototype.setAlphaBlendEnabled=function(e){this._alphaBlendEnabled=e},e.prototype.setAlphaBlendFactors=function(e,t){this._alphaBlendFuncParams=e,this._alphaBlendEqParams=t},e.prototype.setWriteMask=function(e){this._writeMask=e},e.prototype.setDepthStencilFormat=function(e){this._webgpuDepthStencilFormat=e,this._depthStencilFormat=void 0===e?0:o[e]},e.prototype.setDepthTestEnabled=function(e){this._depthTestEnabled=e},e.prototype.setDepthWriteEnabled=function(e){this._depthWriteEnabled=e},e.prototype.setDepthCompare=function(e){this._depthCompare=(null!=e?e:519)-512},e.prototype.setStencilEnabled=function(e){this._stencilEnabled=e},e.prototype.setStencilCompare=function(e){this._stencilFrontCompare=(null!=e?e:519)-512},e.prototype.setStencilDepthFailOp=function(e){this._stencilFrontDepthFailOp=null===e?1:u[e]},e.prototype.setStencilPassOp=function(e){this._stencilFrontPassOp=null===e?2:u[e]},e.prototype.setStencilFailOp=function(e){this._stencilFrontFailOp=null===e?1:u[e]},e.prototype.setStencilReadMask=function(e){this._stencilReadMask!==e&&(this._stencilReadMask=e,this._states[i.StencilReadMask]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.StencilReadMask))},e.prototype.setStencilWriteMask=function(e){this._stencilWriteMask!==e&&(this._stencilWriteMask=e,this._states[i.StencilWriteMask]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.StencilWriteMask))},e.prototype.resetStencilState=function(){this.setStencilState(!1,519,7680,7681,7680,255,255)},e.prototype.setStencilState=function(e,t,r,i,n,s,o){this._stencilEnabled=e,this._stencilFrontCompare=(null!=t?t:519)-512,this._stencilFrontDepthFailOp=null===r?1:u[r],this._stencilFrontPassOp=null===i?2:u[i],this._stencilFrontFailOp=null===n?1:u[n],this.setStencilReadMask(s),this.setStencilWriteMask(o)},e.prototype.setBuffers=function(e,t,r){this._vertexBuffers=e,this._overrideVertexBuffers=r,this._indexBuffer=t},e._GetTopology=function(e){switch(e){case 0:return n.YV.TriangleList;case 2:return n.YV.PointList;case 1:return n.YV.LineList;case 3:return n.YV.PointList;case 4:return n.YV.LineList;case 5:throw"LineLoop is an unsupported fillmode in WebGPU";case 6:return n.YV.LineStrip;case 7:return n.YV.TriangleStrip;case 8:throw"TriangleFan is an unsupported fillmode in WebGPU";default:return n.YV.TriangleList}},e._GetAphaBlendOperation=function(e){switch(e){case 32774:return n.db.Add;case 32778:return n.db.Subtract;case 32779:return n.db.ReverseSubtract;case 32775:return n.db.Min;case 32776:return n.db.Max;default:return n.db.Add}},e._GetAphaBlendFactor=function(e){switch(e){case 0:return n.zi.Zero;case 1:return n.zi.One;case 768:return n.zi.Src;case 769:return n.zi.OneMinusSrc;case 770:return n.zi.SrcAlpha;case 771:return n.zi.OneMinusSrcAlpha;case 772:return n.zi.DstAlpha;case 773:return n.zi.OneMinusDstAlpha;case 774:return n.zi.Dst;case 775:return n.zi.OneMinusDst;case 776:return n.zi.SrcAlphaSaturated;case 32769:return n.zi.Constant;case 32770:return n.zi.OneMinusConstant;case 32771:return n.zi.Constant;case 32772:return n.zi.OneMinusConstant;default:return n.zi.One}},e._GetCompareFunction=function(e){switch(e){case 0:return n.wb.Never;case 1:return n.wb.Less;case 2:return n.wb.Equal;case 3:return n.wb.LessEqual;case 4:return n.wb.Greater;case 5:return n.wb.NotEqual;case 6:return n.wb.GreaterEqual;case 7:return n.wb.Always}return n.wb.Never},e._GetStencilOpFunction=function(e){switch(e){case 0:return n.xS.Zero;case 1:return n.xS.Keep;case 2:return n.xS.Replace;case 3:return n.xS.IncrementClamp;case 4:return n.xS.DecrementClamp;case 5:return n.xS.Invert;case 6:return n.xS.IncrementWrap;case 7:return n.xS.DecrementWrap}return n.xS.Keep},e._GetVertexInputDescriptorFormat=function(e){var t=e.type,r=e.normalized,i=e.getSize();switch(t){case s.o.BYTE:switch(i){case 1:case 2:return r?n.gB.Snorm8x2:n.gB.Sint8x2;case 3:case 4:return r?n.gB.Snorm8x4:n.gB.Sint8x4}break;case s.o.UNSIGNED_BYTE:switch(i){case 1:case 2:return r?n.gB.Unorm8x2:n.gB.Uint8x2;case 3:case 4:return r?n.gB.Unorm8x4:n.gB.Uint8x4}break;case s.o.SHORT:switch(i){case 1:case 2:return r?n.gB.Snorm16x2:n.gB.Sint16x2;case 3:case 4:return r?n.gB.Snorm16x4:n.gB.Sint16x4}break;case s.o.UNSIGNED_SHORT:switch(i){case 1:case 2:return r?n.gB.Unorm16x2:n.gB.Uint16x2;case 3:case 4:return r?n.gB.Unorm16x4:n.gB.Uint16x4}break;case s.o.INT:switch(i){case 1:return n.gB.Sint32;case 2:return n.gB.Sint32x2;case 3:return n.gB.Sint32x3;case 4:return n.gB.Sint32x4}break;case s.o.UNSIGNED_INT:switch(i){case 1:return n.gB.Uint32;case 2:return n.gB.Uint32x2;case 3:return n.gB.Uint32x3;case 4:return n.gB.Uint32x4}break;case s.o.FLOAT:switch(i){case 1:return n.gB.Float32;case 2:return n.gB.Float32x2;case 3:return n.gB.Float32x3;case 4:return n.gB.Float32x4}}throw new Error("Invalid Format '"+e.getKind()+"' - type="+t+", normalized="+r+", size="+i)},e.prototype._getAphaBlendState=function(){return this._alphaBlendEnabled?{srcFactor:e._GetAphaBlendFactor(this._alphaBlendFuncParams[2]),dstFactor:e._GetAphaBlendFactor(this._alphaBlendFuncParams[3]),operation:e._GetAphaBlendOperation(this._alphaBlendEqParams[1])}:{}},e.prototype._getColorBlendState=function(){return this._alphaBlendEnabled?{srcFactor:e._GetAphaBlendFactor(this._alphaBlendFuncParams[0]),dstFactor:e._GetAphaBlendFactor(this._alphaBlendFuncParams[1]),operation:e._GetAphaBlendOperation(this._alphaBlendEqParams[0])}:{}},e.prototype._setShaderStage=function(e){this._shaderId!==e&&(this._shaderId=e,this._states[i.ShaderStage]=e,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.ShaderStage))},e.prototype._setRasterizationState=function(e,t){var r=this._frontFace-1+((this._cullEnabled?this._cullFace:0)<<1)+((this._clampDepth?1:0)<<3)+((this._alphaToCoverageEnabled?1:0)<<4)+(e<<5)+(t<<8);this._rasterizationState!==r&&(this._rasterizationState=r,this._states[i.RasterizationState]=this._rasterizationState,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.RasterizationState))},e.prototype._setColorStates=function(){var e=((this._writeMask?1:0)<<22)+(this._colorFormat<<23)+((this._depthWriteEnabled?1:0)<<29);this._alphaBlendEnabled&&(e+=((null===this._alphaBlendFuncParams[0]?2:a[this._alphaBlendFuncParams[0]])<<0)+((null===this._alphaBlendFuncParams[1]?2:a[this._alphaBlendFuncParams[1]])<<4)+((null===this._alphaBlendFuncParams[2]?2:a[this._alphaBlendFuncParams[2]])<<8)+((null===this._alphaBlendFuncParams[3]?2:a[this._alphaBlendFuncParams[3]])<<12)+((null===this._alphaBlendEqParams[0]?1:this._alphaBlendEqParams[0]-32773)<<16)+((null===this._alphaBlendEqParams[1]?1:this._alphaBlendEqParams[1]-32773)<<19)),e!==this._colorStates&&(this._colorStates=e,this._states[i.ColorStates]=this._colorStates,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.ColorStates))},e.prototype._setDepthStencilState=function(){var e=this._stencilEnabled?this._stencilFrontCompare+(this._stencilFrontDepthFailOp<<3)+(this._stencilFrontPassOp<<6)+(this._stencilFrontFailOp<<9):591,t=this._depthStencilFormat+((this._depthTestEnabled?this._depthCompare:7)<<6)+(e<<10);this._depthStencilState!==t&&(this._depthStencilState=t,this._states[i.DepthStencilState]=this._depthStencilState,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.DepthStencilState))},e.prototype._setVertexState=function(e){for(var t,r,n,s=this._statesLength,o=i.VertexState,a=e._pipelineContext,u=a.shaderProcessingContext.attributeNamesFromEffect,h=a.shaderProcessingContext.attributeLocationsFromEffect,c=0,l=0;l<u.length;l++){var p=h[l],f=null!==(t=this._overrideVertexBuffers&&this._overrideVertexBuffers[u[l]])&&void 0!==t?t:this._vertexBuffers[u[l]];f||(f=this._emptyVertexBuffer);var d=null===(r=f.getBuffer())||void 0===r?void 0:r.underlyingResource;if(void 0===f._validOffsetRange){var _=f.byteOffset,g=f.getSize(!0),m=f.byteStride;f._validOffsetRange=_<=this._kMaxVertexBufferStride-g&&(0===m||_+g<=m)}n&&n===d&&f._validOffsetRange||(this.vertexBuffers[c++]=f,n=f._validOffsetRange?d:null);var y=f.hashCode+(p<<7);this._isDirty=this._isDirty||this._states[o]!==y,this._states[o++]=y}this.vertexBuffers.length=c,this._statesLength=o,this._isDirty=this._isDirty||o!==s,this._isDirty&&(this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.VertexState))},e.prototype._setTextureState=function(e){this._textureState!==e&&(this._textureState=e,this._states[i.TextureStage]=this._textureState,this._isDirty=!0,this._stateDirtyLowestIndex=Math.min(this._stateDirtyLowestIndex,i.TextureStage))},e.prototype._createPipelineLayout=function(e){if(this._useTextureStage)return this._createPipelineLayoutWithTextureStage(e);for(var t=[],r=0;r<e.shaderProcessingContext.orderedUBOsAndSamplers.length;r++){var i=e.shaderProcessingContext.orderedUBOsAndSamplers[r];if(void 0!==i){for(var s=[],o=0;o<i.length;o++){var a=e.shaderProcessingContext.orderedUBOsAndSamplers[r][o];if(void 0!==a){var u=0;a.usedInVertex&&(u|=n.$X.Vertex),a.usedInFragment&&(u|=n.$X.Fragment);var h={binding:o,visibility:u};s.push(h),a.isSampler?h.sampler={type:a.samplerBindingType}:a.isTexture?h.texture={sampleType:a.sampleType,viewDimension:a.textureDimension,multisampled:!1}:h.buffer={type:n.Rs.Uniform}}}s.length>0&&(t[r]=this._device.createBindGroupLayout({entries:s}))}else{var c=this._device.createBindGroupLayout({entries:[]});t[r]=c}}return e.bindGroupLayouts=t,this._device.createPipelineLayout({bindGroupLayouts:t})},e.prototype._createPipelineLayoutWithTextureStage=function(e){for(var t=[],r=e.shaderProcessingContext,i=1,s=0;s<r.orderedUBOsAndSamplers.length;s++){var o=r.orderedUBOsAndSamplers[s];if(void 0!==o){var a=[];t[s]=a;for(var u=0;u<o.length;u++){var h=r.orderedUBOsAndSamplers[s][u];if(void 0!==h){var c=0;h.usedInVertex&&(c|=n.$X.Vertex),h.usedInFragment&&(c|=n.$X.Fragment);var l={binding:u,visibility:c};if(a.push(l),h.isSampler)l.sampler={type:h.samplerBindingType};else if(h.isTexture){var p=h.sampleType;if(this._textureState&i){var f=r.availableSamplers[h.origName];t[f.sampler.setIndex][f.sampler.bindingIndex].sampler.type=n.dV.NonFiltering,p=n.oD.UnfilterableFloat}l.texture={sampleType:p,viewDimension:h.textureDimension,multisampled:!1},i<<=1}else l.buffer={type:n.Rs.Uniform}}}}else t[s]=[]}var d=[];for(s=0;s<t.length;++s)d[s]=this._device.createBindGroupLayout({entries:t[s]});return e.bindGroupLayouts=d,this._device.createPipelineLayout({bindGroupLayouts:d})},e.prototype._getVertexInputDescriptor=function(t,r){for(var i,s,o,a,u=[],h=t._pipelineContext,c=h.shaderProcessingContext.attributeNamesFromEffect,l=h.shaderProcessingContext.attributeLocationsFromEffect,p=0;p<c.length;p++){var f=l[p],d=null!==(i=this._overrideVertexBuffers&&this._overrideVertexBuffers[c[p]])&&void 0!==i?i:this._vertexBuffers[c[p]];d||(d=this._emptyVertexBuffer);var _=null===(s=d.getBuffer())||void 0===s?void 0:s.underlyingResource,g=d.byteOffset,m=!d._validOffsetRange;if(!o||!a||o!==_||m){var y={arrayStride:d.byteStride,stepMode:d.getIsInstanced()?n.V.Instance:n.V.Vertex,attributes:[]};u.push(y),a=y.attributes,m&&(g=0,_=null)}a.push({shaderLocation:f,offset:g,format:e._GetVertexInputDescriptorFormat(d)}),o=_}return u},e.prototype._createRenderPipeline=function(t,r,i){var s=t._pipelineContext,o=this._getVertexInputDescriptor(t,r),a=this._createPipelineLayout(s),u=[],h=this._getAphaBlendState(),c=this._getColorBlendState();if(this._mrtAttachments1>0)for(var l=0;l<this._mrtFormats.length;++l)u.push({format:this._mrtFormats[l],blend:{alpha:h,color:c},writeMask:this._writeMask});else u.push({format:this._webgpuColorFormat[0],blend:{alpha:h,color:c},writeMask:this._writeMask});var p={compare:e._GetCompareFunction(this._stencilEnabled?this._stencilFrontCompare:7),depthFailOp:e._GetStencilOpFunction(this._stencilEnabled?this._stencilFrontDepthFailOp:1),failOp:e._GetStencilOpFunction(this._stencilEnabled?this._stencilFrontFailOp:1),passOp:e._GetStencilOpFunction(this._stencilEnabled?this._stencilFrontPassOp:1)},f=void 0;return r!==n.YV.LineStrip&&r!==n.YV.TriangleStrip||(f=!this._indexBuffer||this._indexBuffer.is32Bits?n.iD.Uint32:n.iD.Uint16),this._device.createRenderPipeline({layout:a,vertex:{module:s.stages.vertexStage.module,entryPoint:s.stages.vertexStage.entryPoint,buffers:o},primitive:{topology:r,stripIndexFormat:f,frontFace:1===this._frontFace?n.zX.CCW:n.zX.CW,cullMode:this._cullEnabled?2===this._cullFace?n.Wf.Front:n.Wf.Back:n.Wf.None},fragment:s.stages.fragmentStage?{module:s.stages.fragmentStage.module,entryPoint:s.stages.fragmentStage.entryPoint,targets:u}:void 0,multisample:{count:i},depthStencil:void 0===this._webgpuDepthStencilFormat?void 0:{depthWriteEnabled:this._depthWriteEnabled,depthCompare:this._depthTestEnabled?e._GetCompareFunction(this._depthCompare):n.wb.Always,format:this._webgpuDepthStencilFormat,stencilFront:p,stencilBack:p,stencilReadMask:this._stencilReadMask,stencilWriteMask:this._stencilWriteMask,depthBias:this._depthBias,depthBiasClamp:this._depthBiasClamp,depthBiasSlopeScale:this._depthBiasSlopeScale}})},e.NumCacheHitWithoutHash=0,e.NumCacheHitWithHash=0,e.NumCacheMiss=0,e.NumPipelineCreationLastFrame=0,e._NumPipelineCreationCurrentFrame=0,e}()},2496:(e,t,r)=>{"use strict";r.d(t,{H:()=>o});var i=r(3940),n=r(7213),s=function(){function e(){this.values={}}return e.prototype.count=function(){var e=0,t=this.pipeline?1:0;for(var r in this.values){var i=this.values[r].count();e+=i[0],t+=i[1],e++}return[e,t]},e}(),o=function(e){function t(r,i,n){var s=e.call(this,r,i,n)||this;return s._nodeStack=[],s._nodeStack[0]=t._Cache,s}return(0,i.ZT)(t,e),t.GetNodeCounts=function(){var e=t._Cache.count();return{nodeCount:e[0],pipelineCount:e[1]}},t.prototype._getRenderPipeline=function(e){for(var t=this._nodeStack[this._stateDirtyLowestIndex],r=this._stateDirtyLowestIndex;r<this._statesLength;++r){var i=t.values[this._states[r]];i||(i=new s,t.values[this._states[r]]=i),t=i,this._nodeStack[r+1]=t}e.token=t,e.pipeline=t.pipeline},t.prototype._setRenderPipeline=function(e){e.token.pipeline=e.pipeline},t._Cache=new s,t}(n.O)},906:(e,t,r)=>{"use strict";r.d(t,{W:()=>h});var i=r(3940),n=r(5573),s=r(9753),o=[0,0,3,7,0,2,6,2,4,1,5,3,1],a=[0,64,32,96,16,80,48,112,8],u=[0,128,128,0,0,0,0,128,0,0,0,0,128],h=function(){function e(e){this._samplers={},this._device=e,this.disabled=!1}return e._GetSamplerHashCode=function(e){var t,r,i,n;return o[e.samplingMode]+a[(e._comparisonFunction||514)-512+1]+u[e.samplingMode]+((null!==(t=e._cachedWrapU)&&void 0!==t?t:1)<<8)+((null!==(r=e._cachedWrapV)&&void 0!==r?r:1)<<10)+((null!==(i=e._cachedWrapR)&&void 0!==i?i:1)<<12)+((e.generateMipMaps?1:0)<<14)+((null!==(n=e._cachedAnisotropicFilteringLevel)&&void 0!==n?n:1)<<15)},e._GetSamplerFilterDescriptor=function(e,t){var r,i,s,o,a,u=e.generateMipMaps;switch(e.samplingMode){case 11:r=n.X9.Linear,i=n.X9.Linear,s=n.X9.Nearest,u||(o=a=0);break;case 3:case 3:r=n.X9.Linear,i=n.X9.Linear,u?s=n.X9.Linear:(s=n.X9.Nearest,o=a=0);break;case 8:r=n.X9.Nearest,i=n.X9.Nearest,u?s=n.X9.Linear:(s=n.X9.Nearest,o=a=0);break;case 4:r=n.X9.Nearest,i=n.X9.Nearest,s=n.X9.Nearest,u||(o=a=0);break;case 5:r=n.X9.Nearest,i=n.X9.Linear,s=n.X9.Nearest,u||(o=a=0);break;case 6:r=n.X9.Nearest,i=n.X9.Linear,u?s=n.X9.Linear:(s=n.X9.Nearest,o=a=0);break;case 7:r=n.X9.Nearest,i=n.X9.Linear,s=n.X9.Nearest,o=a=0;break;case 1:case 1:r=n.X9.Nearest,i=n.X9.Nearest,s=n.X9.Nearest,o=a=0;break;case 9:r=n.X9.Linear,i=n.X9.Nearest,s=n.X9.Nearest,u||(o=a=0);break;case 10:r=n.X9.Linear,i=n.X9.Nearest,u?s=n.X9.Linear:(s=n.X9.Nearest,o=a=0);break;case 2:case 2:r=n.X9.Linear,i=n.X9.Linear,s=n.X9.Nearest,o=a=0;break;case 12:r=n.X9.Linear,i=n.X9.Nearest,s=n.X9.Nearest,o=a=0;break;default:r=n.X9.Nearest,i=n.X9.Nearest,s=n.X9.Nearest,o=a=0}return t>1&&(0!==o||0!==a)?{magFilter:n.X9.Linear,minFilter:n.X9.Linear,mipmapFilter:n.X9.Linear,anisotropyEnabled:!0}:{magFilter:r,minFilter:i,mipmapFilter:s,lodMinClamp:o,lodMaxClamp:a}},e._GetWrappingMode=function(e){switch(e){case 1:return n.OB.Repeat;case 0:return n.OB.ClampToEdge;case 2:return n.OB.MirrorRepeat}return n.OB.Repeat},e._GetSamplerWrappingDescriptor=function(e){return{addressModeU:this._GetWrappingMode(e._cachedWrapU),addressModeV:this._GetWrappingMode(e._cachedWrapV),addressModeW:this._GetWrappingMode(e._cachedWrapR)}},e._GetSamplerDescriptor=function(e){var t,r=e.generateMipMaps&&null!==(t=e._cachedAnisotropicFilteringLevel)&&void 0!==t?t:1,n=this._GetSamplerFilterDescriptor(e,r);return(0,i.pi)((0,i.pi)((0,i.pi)({},n),this._GetSamplerWrappingDescriptor(e)),{compare:e._comparisonFunction?s.D.GetCompareFunction(e._comparisonFunction):void 0,maxAnisotropy:n.anisotropyEnabled?r:1})},e.prototype.getSampler=function(t,r){if(void 0===r&&(r=!1),this.disabled)return this._device.createSampler(e._GetSamplerDescriptor(t));var i=r?0:e._GetSamplerHashCode(t),n=r?void 0:this._samplers[i];return n||(n=this._device.createSampler(e._GetSamplerDescriptor(t)),r||(this._samplers[i]=n)),n},e}()},5573:(e,t,r)=>{"use strict";var i,n,s,o,a,u,h,c,l,p,f,d,_,g,m,y,v,b,x,R,T,E,S,C,A,F,P,w,B,M,O,I,D,L,U;r.d(t,{eS:()=>n,FB:()=>s,gc:()=>o,kd:()=>a,v2:()=>u,p_:()=>h,H7:()=>c,EV:()=>l,OB:()=>p,X9:()=>f,wb:()=>d,$X:()=>_,Rs:()=>g,dV:()=>m,oD:()=>y,YV:()=>x,zX:()=>R,Wf:()=>T,zi:()=>S,db:()=>C,xS:()=>A,iD:()=>F,gB:()=>P,V:()=>w,Ws:()=>B,EG:()=>M,xL:()=>O,nw:()=>D}),function(e){e.SRGB="srgb"}(i||(i={})),function(e){e.LowPower="low-power",e.HighPerformance="high-performance"}(i||(i={})),function(e){e.DepthClamping="depth-clamping",e.Depth24UnormStencil8="depth24unorm-stencil8",e.Depth32FloatStencil8="depth32float-stencil8",e.PipelineStatisticsQuery="pipeline-statistics-query",e.TextureCompressionBC="texture-compression-bc",e.TimestampQuery="timestamp-query"}(n||(n={})),function(e){e[e.MapRead=1]="MapRead",e[e.MapWrite=2]="MapWrite",e[e.CopySrc=4]="CopySrc",e[e.CopyDst=8]="CopyDst",e[e.Index=16]="Index",e[e.Vertex=32]="Vertex",e[e.Uniform=64]="Uniform",e[e.Storage=128]="Storage",e[e.Indirect=256]="Indirect",e[e.QueryResolve=512]="QueryResolve"}(s||(s={})),function(e){e[e.Read=1]="Read",e[e.Write=2]="Write"}(o||(o={})),function(e){e.E1d="1d",e.E2d="2d",e.E3d="3d"}(a||(a={})),function(e){e[e.CopySrc=1]="CopySrc",e[e.CopyDst=2]="CopyDst",e[e.Sampled=4]="Sampled",e[e.Storage=8]="Storage",e[e.RenderAttachment=16]="RenderAttachment"}(u||(u={})),function(e){e.E1d="1d",e.E2d="2d",e.E2dArray="2d-array",e.Cube="cube",e.CubeArray="cube-array",e.E3d="3d"}(h||(h={})),function(e){e.All="all",e.StencilOnly="stencil-only",e.DepthOnly="depth-only"}(c||(c={})),function(e){e.R8Unorm="r8unorm",e.R8Snorm="r8snorm",e.R8Uint="r8uint",e.R8Sint="r8sint",e.R16Uint="r16uint",e.R16Sint="r16sint",e.R16Float="r16float",e.RG8Unorm="rg8unorm",e.RG8Snorm="rg8snorm",e.RG8Uint="rg8uint",e.RG8Sint="rg8sint",e.R32Uint="r32uint",e.R32Sint="r32sint",e.R32Float="r32float",e.RG16Uint="rg16uint",e.RG16Sint="rg16sint",e.RG16Float="rg16float",e.RGBA8Unorm="rgba8unorm",e.RGBA8UnormSRGB="rgba8unorm-srgb",e.RGBA8Snorm="rgba8snorm",e.RGBA8Uint="rgba8uint",e.RGBA8Sint="rgba8sint",e.BGRA8Unorm="bgra8unorm",e.BGRA8UnormSRGB="bgra8unorm-srgb",e.RGB9E5UFloat="rgb9e5ufloat",e.RGB10A2Unorm="rgb10a2unorm",e.RG11B10UFloat="rg11b10ufloat",e.RG32Uint="rg32uint",e.RG32Sint="rg32sint",e.RG32Float="rg32float",e.RGBA16Uint="rgba16uint",e.RGBA16Sint="rgba16sint",e.RGBA16Float="rgba16float",e.RGBA32Uint="rgba32uint",e.RGBA32Sint="rgba32sint",e.RGBA32Float="rgba32float",e.Stencil8="stencil8",e.Depth16Unorm="depth16unorm",e.Depth24Plus="depth24plus",e.Depth24PlusStencil8="depth24plus-stencil8",e.Depth32Float="depth32float",e.BC1RGBAUnorm="bc1-rgba-unorm",e.BC1RGBAUnormSRGB="bc1-rgba-unorm-srgb",e.BC2RGBAUnorm="bc2-rgba-unorm",e.BC2RGBAUnormSRGB="bc2-rgba-unorm-srgb",e.BC3RGBAUnorm="bc3-rgba-unorm",e.BC3RGBAUnormSRGB="bc3-rgba-unorm-srgb",e.BC4RUnorm="bc4-r-unorm",e.BC4RSnorm="bc4-r-snorm",e.BC5RGUnorm="bc5-rg-unorm",e.BC5RGSnorm="bc5-rg-snorm",e.BC6HRGBUFloat="bc6h-rgb-ufloat",e.BC6HRGBFloat="bc6h-rgb-float",e.BC7RGBAUnorm="bc7-rgba-unorm",e.BC7RGBAUnormSRGB="bc7-rgba-unorm-srgb",e.Depth24UnormStencil8="depth24unorm-stencil8",e.Depth32FloatStencil8="depth32float-stencil8"}(l||(l={})),function(e){e.ClampToEdge="clamp-to-edge",e.Repeat="repeat",e.MirrorRepeat="mirror-repeat"}(p||(p={})),function(e){e.Nearest="nearest",e.Linear="linear"}(f||(f={})),function(e){e.Never="never",e.Less="less",e.Equal="equal",e.LessEqual="less-equal",e.Greater="greater",e.NotEqual="not-equal",e.GreaterEqual="greater-equal",e.Always="always"}(d||(d={})),function(e){e[e.Vertex=1]="Vertex",e[e.Fragment=2]="Fragment",e[e.Compute=4]="Compute"}(_||(_={})),function(e){e.Uniform="uniform",e.Storage="storage",e.ReadOnlyStorage="read-only-storage"}(g||(g={})),function(e){e.Filtering="filtering",e.NonFiltering="non-filtering",e.Comparison="comparison"}(m||(m={})),function(e){e.Float="float",e.UnfilterableFloat="unfilterable-float",e.Depth="depth",e.Sint="sint",e.Uint="uint"}(y||(y={})),function(e){e.ReadOnly="read-only",e.WriteOnly="write-only"}(v||(v={})),function(e){e.Error="error",e.Warning="warning",e.Info="info"}(b||(b={})),function(e){e.PointList="point-list",e.LineList="line-list",e.LineStrip="line-strip",e.TriangleList="triangle-list",e.TriangleStrip="triangle-strip"}(x||(x={})),function(e){e.CCW="ccw",e.CW="cw"}(R||(R={})),function(e){e.None="none",e.Front="front",e.Back="back"}(T||(T={})),function(e){e[e.Red=1]="Red",e[e.Green=2]="Green",e[e.Blue=4]="Blue",e[e.Alpha=8]="Alpha",e[e.All=15]="All"}(E||(E={})),function(e){e.Zero="zero",e.One="one",e.Src="src",e.OneMinusSrc="one-minus-src",e.SrcAlpha="src-alpha",e.OneMinusSrcAlpha="one-minus-src-alpha",e.Dst="dst",e.OneMinusDst="one-minus-dst",e.DstAlpha="dst-alpha",e.OneMinusDstAlpha="one-minus-dst-alpha",e.SrcAlphaSaturated="src-alpha-saturated",e.Constant="constant",e.OneMinusConstant="one-minus-constant"}(S||(S={})),function(e){e.Add="add",e.Subtract="subtract",e.ReverseSubtract="reverse-subtract",e.Min="min",e.Max="max"}(C||(C={})),function(e){e.Keep="keep",e.Zero="zero",e.Replace="replace",e.Invert="invert",e.IncrementClamp="increment-clamp",e.DecrementClamp="decrement-clamp",e.IncrementWrap="increment-wrap",e.DecrementWrap="decrement-wrap"}(A||(A={})),function(e){e.Uint16="uint16",e.Uint32="uint32"}(F||(F={})),function(e){e.Uint8x2="uint8x2",e.Uint8x4="uint8x4",e.Sint8x2="sint8x2",e.Sint8x4="sint8x4",e.Unorm8x2="unorm8x2",e.Unorm8x4="unorm8x4",e.Snorm8x2="snorm8x2",e.Snorm8x4="snorm8x4",e.Uint16x2="uint16x2",e.Uint16x4="uint16x4",e.Sint16x2="sint16x2",e.Sint16x4="sint16x4",e.Unorm16x2="unorm16x2",e.Unorm16x4="unorm16x4",e.Snorm16x2="snorm16x2",e.Snorm16x4="snorm16x4",e.Float16x2="float16x2",e.Float16x4="float16x4",e.Float32="float32",e.Float32x2="float32x2",e.Float32x3="float32x3",e.Float32x4="float32x4",e.Uint32="uint32",e.Uint32x2="uint32x2",e.Uint32x3="uint32x3",e.Uint32x4="uint32x4",e.Sint32="sint32",e.Sint32x2="sint32x2",e.Sint32x3="sint32x3",e.Sint32x4="sint32x4"}(P||(P={})),function(e){e.Vertex="vertex",e.Instance="instance"}(w||(w={})),function(e){e.Load="load"}(B||(B={})),function(e){e.Store="store",e.Clear="clear"}(M||(M={})),function(e){e.Occlusion="occlusion",e.PipelineStatistics="pipeline-statistics",e.Timestamp="timestamp"}(O||(O={})),function(e){e.VertexShaderInvocations="vertex-shader-invocations",e.ClipperInvocations="clipper-invocations",e.ClipperPrimitivesOut="clipper-primitives-out",e.FragmentShaderInvocations="fragment-shader-invocations",e.ComputeShaderInvocations="compute-shader-invocations"}(I||(I={})),function(e){e.Opaque="opaque",e.Premultiplied="premultiplied"}(D||(D={})),function(e){e.Destroyed="destroyed"}(L||(L={})),function(e){e.OutOfMemory="out-of-memory",e.Validation="validation"}(U||(U={}))},1838:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var i=r(6599),n=r(1027),s=r(5573),o=function(){function e(e){void 0===e&&(e=null),this.format=s.EV.RGBA8Unorm,this.textureUsages=0,this.textureAdditionalUsages=0,this._webgpuTexture=e,this._webgpuMSAATexture=null,this.view=null}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return this._webgpuTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"msaaTexture",{get:function(){return this._webgpuMSAATexture},set:function(e){this._webgpuMSAATexture=e},enumerable:!1,configurable:!0}),e.prototype.set=function(e){this._webgpuTexture=e},e.prototype.setMSAATexture=function(e){this._webgpuMSAATexture=e},e.prototype.setUsage=function(e,t,r,o,a){t=e!==i.S.RenderTarget&&t,this.createView({format:this.format,dimension:r?s.p_.Cube:s.p_.E2d,mipLevelCount:t?n.R.ILog2(Math.max(o,a))+1:1,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:r?6:1,aspect:s.H7.All})},e.prototype.createView=function(e){this.view=this._webgpuTexture.createView(e)},e.prototype.reset=function(){this._webgpuTexture=null,this._webgpuMSAATexture=null,this.view=null},e.prototype.release=function(){var e,t;null===(e=this._webgpuTexture)||void 0===e||e.destroy(),null===(t=this._webgpuMSAATexture)||void 0===t||t.destroy(),this.reset()},e}()},9753:(e,t,r)=>{"use strict";r.d(t,{D:()=>c});var i,n=r(5573),s=r(1027),o=r(6599),a=r(1838),u=r(3852);!function(e){e[e.MipMap=0]="MipMap",e[e.InvertYPremultiplyAlpha=1]="InvertYPremultiplyAlpha",e[e.Clear=2]="Clear"}(i||(i={}));var h=[{vertex:"\n    const vec2 pos[4] = vec2[4](vec2(-1.0f, 1.0f), vec2(1.0f, 1.0f), vec2(-1.0f, -1.0f), vec2(1.0f, -1.0f));\n    const vec2 tex[4] = vec2[4](vec2(0.0f, 0.0f), vec2(1.0f, 0.0f), vec2(0.0f, 1.0f), vec2(1.0f, 1.0f));\n\n    layout(location = 0) out vec2 vTex;\n\n    void main() {\n        vTex = tex[gl_VertexIndex];\n        gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);\n    }\n    ",fragment:"\n    layout(set = 0, binding = 0) uniform sampler imgSampler;\n    layout(set = 0, binding = 1) uniform texture2D img;\n\n    layout(location = 0) in vec2 vTex;\n    layout(location = 0) out vec4 outColor;\n\n    void main() {\n        outColor = texture(sampler2D(img, imgSampler), vTex);\n    }\n    "},{vertex:"\n    #extension GL_EXT_samplerless_texture_functions : enable\n\n    const vec2 pos[4] = vec2[4](vec2(-1.0f, 1.0f), vec2(1.0f, 1.0f), vec2(-1.0f, -1.0f), vec2(1.0f, -1.0f));\n    const vec2 tex[4] = vec2[4](vec2(0.0f, 0.0f), vec2(1.0f, 0.0f), vec2(0.0f, 1.0f), vec2(1.0f, 1.0f));\n\n    layout(set = 0, binding = 0) uniform texture2D img;\n\n    #ifdef INVERTY\n        layout(location = 0) out flat ivec2 vTextureSize;\n    #endif\n\n    void main() {\n        #ifdef INVERTY\n            vTextureSize = textureSize(img, 0);\n        #endif\n        gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);\n    }\n    ",fragment:"\n    #extension GL_EXT_samplerless_texture_functions : enable\n\n    layout(set = 0, binding = 0) uniform texture2D img;\n\n    #ifdef INVERTY\n        layout(location = 0) in flat ivec2 vTextureSize;\n    #endif\n    layout(location = 0) out vec4 outColor;\n\n    void main() {\n    #ifdef INVERTY\n        vec4 color = texelFetch(img, ivec2(gl_FragCoord.x, vTextureSize.y - gl_FragCoord.y), 0);\n    #else\n        vec4 color = texelFetch(img, ivec2(gl_FragCoord.xy), 0);\n    #endif\n    #ifdef PREMULTIPLYALPHA\n        color.rgb *= color.a;\n    #endif\n        outColor = color;\n    }\n    "},{vertex:"\n    const vec2 pos[4] = vec2[4](vec2(-1.0f, 1.0f), vec2(1.0f, 1.0f), vec2(-1.0f, -1.0f), vec2(1.0f, -1.0f));\n\n    void main() {\n        gl_Position = vec4(pos[gl_VertexIndex], 0.0, 1.0);\n    }\n    ",fragment:"\n    layout(set = 0, binding = 0) uniform Uniforms {\n        uniform vec4 color;\n    };\n\n    layout(location = 0) out vec4 outColor;\n\n    void main() {\n        outColor = color;\n    }\n    "}],c=function(){function e(e,t,r){this._pipelines={},this._compiledShaders=[],this._deferredReleaseTextures=[],this._device=e,this._glslang=t,this._bufferManager=r,this._mipmapSampler=e.createSampler({minFilter:n.X9.Linear}),this._getPipeline(n.EV.RGBA8Unorm)}return e.ComputeNumMipmapLevels=function(e,t){return s.R.ILog2(Math.max(e,t))+1},e.prototype._getPipeline=function(e,t,r){void 0===t&&(t=i.MipMap);var s=t===i.MipMap?1:t===i.InvertYPremultiplyAlpha?((r.invertY?1:0)<<1)+((r.premultiplyAlpha?1:0)<<2):t===i.Clear?8:0;this._pipelines[e]||(this._pipelines[e]=[]);var o=this._pipelines[e][s];if(!o){var a="#version 450\r\n";t===i.InvertYPremultiplyAlpha&&(r.invertY&&(a+="#define INVERTY\r\n"),r.premultiplyAlpha&&(a+="#define PREMULTIPLYALPHA\r\n"));var u=this._compiledShaders[s];if(!u){var c=this._device.createShaderModule({code:this._glslang.compileGLSL(a+h[t].vertex,"vertex")}),l=this._device.createShaderModule({code:this._glslang.compileGLSL(a+h[t].fragment,"fragment")});u=this._compiledShaders[s]=[c,l]}o=this._pipelines[e][s]=this._device.createRenderPipeline({vertex:{module:u[0],entryPoint:"main"},fragment:{module:u[1],entryPoint:"main",targets:[{format:e}]},primitive:{topology:n.YV.TriangleStrip,stripIndexFormat:n.iD.Uint16}})}return o},e._GetTextureTypeFromFormat=function(e){switch(e){case n.EV.R8Unorm:case n.EV.R8Snorm:case n.EV.R8Uint:case n.EV.R8Sint:case n.EV.RG8Unorm:case n.EV.RG8Snorm:case n.EV.RG8Uint:case n.EV.RG8Sint:case n.EV.RGBA8Unorm:case n.EV.RGBA8UnormSRGB:case n.EV.RGBA8Snorm:case n.EV.RGBA8Uint:case n.EV.RGBA8Sint:case n.EV.BGRA8Unorm:case n.EV.BGRA8UnormSRGB:case n.EV.RGB10A2Unorm:case n.EV.RGB9E5UFloat:case n.EV.RG11B10UFloat:case n.EV.Depth24UnormStencil8:case n.EV.Depth32FloatStencil8:case n.EV.BC7RGBAUnorm:case n.EV.BC7RGBAUnormSRGB:case n.EV.BC6HRGBUFloat:case n.EV.BC6HRGBFloat:case n.EV.BC5RGUnorm:case n.EV.BC5RGSnorm:case n.EV.BC3RGBAUnorm:case n.EV.BC3RGBAUnormSRGB:case n.EV.BC2RGBAUnorm:case n.EV.BC2RGBAUnormSRGB:case n.EV.BC4RUnorm:case n.EV.BC4RSnorm:case n.EV.BC1RGBAUnorm:case n.EV.BC1RGBAUnormSRGB:return 0;case n.EV.R16Uint:case n.EV.R16Sint:case n.EV.RG16Uint:case n.EV.RG16Sint:case n.EV.RGBA16Uint:case n.EV.RGBA16Sint:case n.EV.Depth16Unorm:return 5;case n.EV.R16Float:case n.EV.RG16Float:case n.EV.RGBA16Float:return 2;case n.EV.R32Uint:case n.EV.R32Sint:case n.EV.RG32Uint:case n.EV.RG32Sint:case n.EV.RGBA32Uint:case n.EV.RGBA32Sint:return 7;case n.EV.R32Float:case n.EV.RG32Float:case n.EV.RGBA32Float:case n.EV.Depth32Float:return 1;case n.EV.Stencil8:throw"No fixed size for Stencil8 format!";case n.EV.Depth24Plus:throw"No fixed size for Depth24Plus format!";case n.EV.Depth24PlusStencil8:throw"No fixed size for Depth24PlusStencil8 format!"}return 0},e._GetBlockInformationFromFormat=function(e){switch(e){case n.EV.R8Unorm:case n.EV.R8Snorm:case n.EV.R8Uint:case n.EV.R8Sint:return{width:1,height:1,length:1};case n.EV.R16Uint:case n.EV.R16Sint:case n.EV.R16Float:case n.EV.RG8Unorm:case n.EV.RG8Snorm:case n.EV.RG8Uint:case n.EV.RG8Sint:return{width:1,height:1,length:2};case n.EV.R32Uint:case n.EV.R32Sint:case n.EV.R32Float:case n.EV.RG16Uint:case n.EV.RG16Sint:case n.EV.RG16Float:case n.EV.RGBA8Unorm:case n.EV.RGBA8UnormSRGB:case n.EV.RGBA8Snorm:case n.EV.RGBA8Uint:case n.EV.RGBA8Sint:case n.EV.BGRA8Unorm:case n.EV.BGRA8UnormSRGB:case n.EV.RGB9E5UFloat:case n.EV.RGB10A2Unorm:case n.EV.RG11B10UFloat:return{width:1,height:1,length:4};case n.EV.RG32Uint:case n.EV.RG32Sint:case n.EV.RG32Float:case n.EV.RGBA16Uint:case n.EV.RGBA16Sint:case n.EV.RGBA16Float:return{width:1,height:1,length:8};case n.EV.RGBA32Uint:case n.EV.RGBA32Sint:case n.EV.RGBA32Float:return{width:1,height:1,length:16};case n.EV.Stencil8:throw"No fixed size for Stencil8 format!";case n.EV.Depth16Unorm:return{width:1,height:1,length:2};case n.EV.Depth24Plus:throw"No fixed size for Depth24Plus format!";case n.EV.Depth24PlusStencil8:throw"No fixed size for Depth24PlusStencil8 format!";case n.EV.Depth32Float:case n.EV.Depth24UnormStencil8:return{width:1,height:1,length:4};case n.EV.Depth32FloatStencil8:return{width:1,height:1,length:5};case n.EV.BC7RGBAUnorm:case n.EV.BC7RGBAUnormSRGB:case n.EV.BC6HRGBUFloat:case n.EV.BC6HRGBFloat:case n.EV.BC5RGUnorm:case n.EV.BC5RGSnorm:case n.EV.BC3RGBAUnorm:case n.EV.BC3RGBAUnormSRGB:case n.EV.BC2RGBAUnorm:case n.EV.BC2RGBAUnormSRGB:return{width:4,height:4,length:16};case n.EV.BC4RUnorm:case n.EV.BC4RSnorm:case n.EV.BC1RGBAUnorm:case n.EV.BC1RGBAUnormSRGB:return{width:4,height:4,length:8}}return{width:1,height:1,length:4}},e._IsHardwareTexture=function(e){return!!e.release},e._IsInternalTexture=function(e){return!!e.dispose},e.GetCompareFunction=function(e){switch(e){case 519:return n.wb.Always;case 514:return n.wb.Equal;case 516:return n.wb.Greater;case 518:return n.wb.GreaterEqual;case 513:return n.wb.Less;case 515:return n.wb.LessEqual;case 512:return n.wb.Never;case 517:return n.wb.NotEqual;default:return n.wb.Less}},e.IsImageBitmap=function(e){return void 0!==e.close},e.IsImageBitmapArray=function(e){return Array.isArray(e)&&void 0!==e[0].close},e.prototype.setCommandEncoder=function(e){this._commandEncoderForCreation=e},e.IsCompressedFormat=function(e){switch(e){case n.EV.BC7RGBAUnormSRGB:case n.EV.BC7RGBAUnorm:case n.EV.BC6HRGBFloat:case n.EV.BC6HRGBUFloat:case n.EV.BC5RGSnorm:case n.EV.BC5RGUnorm:case n.EV.BC4RSnorm:case n.EV.BC4RUnorm:case n.EV.BC3RGBAUnormSRGB:case n.EV.BC3RGBAUnorm:case n.EV.BC2RGBAUnormSRGB:case n.EV.BC2RGBAUnorm:case n.EV.BC1RGBAUnormSRGB:case n.EV.BC1RGBAUnorm:return!0}return!1},e.GetWebGPUTextureFormat=function(e,t,r){switch(void 0===r&&(r=!1),t){case 13:return n.EV.Depth24PlusStencil8;case 14:return n.EV.Depth32Float;case 36492:return r?n.EV.BC7RGBAUnormSRGB:n.EV.BC7RGBAUnorm;case 36495:return n.EV.BC6HRGBUFloat;case 36494:return n.EV.BC6HRGBFloat;case 33779:return r?n.EV.BC3RGBAUnormSRGB:n.EV.BC3RGBAUnorm;case 33778:return r?n.EV.BC2RGBAUnormSRGB:n.EV.BC2RGBAUnorm;case 33777:return r?n.EV.BC1RGBAUnormSRGB:n.EV.BC1RGBAUnorm}switch(e){case 3:switch(t){case 6:return n.EV.R8Snorm;case 7:return n.EV.RG8Snorm;case 4:throw"RGB format not supported in WebGPU";case 8:return n.EV.R8Sint;case 9:return n.EV.RG8Sint;case 10:throw"RGB_INTEGER format not supported in WebGPU";case 11:return n.EV.RGBA8Sint;default:return n.EV.RGBA8Snorm}case 0:switch(t){case 6:return n.EV.R8Unorm;case 7:return n.EV.RG8Unorm;case 4:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";case 5:return r?n.EV.RGBA8UnormSRGB:n.EV.RGBA8Unorm;case 12:return r?n.EV.BGRA8UnormSRGB:n.EV.BGRA8Unorm;case 8:return n.EV.R8Uint;case 9:return n.EV.RG8Uint;case 10:throw"RGB_INTEGER format not supported in WebGPU";case 11:return n.EV.RGBA8Uint;case 0:throw"TEXTUREFORMAT_ALPHA format not supported in WebGPU";case 1:throw"TEXTUREFORMAT_LUMINANCE format not supported in WebGPU";case 2:throw"TEXTUREFORMAT_LUMINANCE_ALPHA format not supported in WebGPU";default:return n.EV.RGBA8Unorm}case 4:switch(t){case 8:return n.EV.R16Sint;case 9:return n.EV.RG16Sint;case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";case 11:default:return n.EV.RGBA16Sint}case 5:switch(t){case 8:return n.EV.R16Uint;case 9:return n.EV.RG16Uint;case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";case 11:default:return n.EV.RGBA16Uint}case 6:switch(t){case 8:return n.EV.R32Sint;case 9:return n.EV.RG32Sint;case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";case 11:default:return n.EV.RGBA32Sint}case 7:switch(t){case 8:return n.EV.R32Uint;case 9:return n.EV.RG32Uint;case 10:throw"TEXTUREFORMAT_RGB_INTEGER format not supported in WebGPU";case 11:default:return n.EV.RGBA32Uint}case 1:switch(t){case 6:return n.EV.R32Float;case 7:return n.EV.RG32Float;case 4:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";case 5:default:return n.EV.RGBA32Float}case 2:switch(t){case 6:return n.EV.R16Float;case 7:return n.EV.RG16Float;case 4:throw"TEXTUREFORMAT_RGB format not supported in WebGPU";case 5:default:return n.EV.RGBA16Float}case 10:throw"TEXTURETYPE_UNSIGNED_SHORT_5_6_5 format not supported in WebGPU";case 13:throw"TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV format not supported in WebGPU";case 14:throw"TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV format not supported in WebGPU";case 8:throw"TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4 format not supported in WebGPU";case 9:throw"TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1 format not supported in WebGPU";case 11:switch(t){case 5:return n.EV.RGB10A2Unorm;case 11:throw"TEXTUREFORMAT_RGBA_INTEGER format not supported in WebGPU when type is TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV";default:return n.EV.RGB10A2Unorm}}return r?n.EV.RGBA8UnormSRGB:n.EV.RGBA8Unorm},e.prototype.invertYPreMultiplyAlpha=function(e,t,r,s,o,a,u,h,c,l){var p,f,d,_;void 0===o&&(o=!1),void 0===a&&(a=!1),void 0===u&&(u=0),void 0===h&&(h=0),void 0===c&&(c=1);var g=void 0===l,m=this._getPipeline(s,i.InvertYPremultiplyAlpha,{invertY:o,premultiplyAlpha:a}),y=m.getBindGroupLayout(0);g&&(l=this._device.createCommandEncoder({})),null===(f=(p=l).pushDebugGroup)||void 0===f||f.call(p,"internal process texture - invertY="+o+" premultiplyAlpha="+a);var v=this.createTexture({width:t,height:r,layers:1},!1,!1,!1,!1,!1,s,1,l,n.v2.CopySrc|n.v2.RenderAttachment|n.v2.Sampled),b=l.beginRenderPass({colorAttachments:[{view:v.createView({format:s,dimension:n.p_.E2d,baseMipLevel:0,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:0}),loadValue:n.Ws.Load,storeOp:n.EG.Store}]}),x=this._device.createBindGroup({layout:y,entries:[{binding:0,resource:e.createView({format:s,dimension:n.p_.E2d,baseMipLevel:h,mipLevelCount:1,arrayLayerCount:c,baseArrayLayer:Math.max(u,0)})}]});b.setPipeline(m),b.setBindGroup(0,x),b.draw(4,1,0,0),b.endPass(),l.copyTextureToTexture({texture:v},{texture:e,mipLevel:h,origin:{x:0,y:0,z:Math.max(u,0)}},{width:t,height:r,depthOrArrayLayers:1}),this._deferredReleaseTextures.push([v,null,null]),null===(_=(d=l).popDebugGroup)||void 0===_||_.call(d),g&&(this._device.queue.submit([l.finish()]),l=null)},e.prototype.copyWithInvertY=function(e,t,r,n){var s,o,a,u,h=void 0===n,c=this._getPipeline(t,i.InvertYPremultiplyAlpha,{invertY:!0,premultiplyAlpha:!1}),l=c.getBindGroupLayout(0);h&&(n=this._device.createCommandEncoder({})),null===(o=(s=n).pushDebugGroup)||void 0===o||o.call(s,"internal copy texture with invertY");var p=n.beginRenderPass(r),f=this._device.createBindGroup({layout:l,entries:[{binding:0,resource:e}]});p.setPipeline(c),p.setBindGroup(0,f),p.draw(4,1,0,0),p.endPass(),null===(u=(a=n).popDebugGroup)||void 0===u||u.call(a),h&&(this._device.queue.submit([n.finish()]),n=null)},e.prototype.createTexture=function(t,r,i,s,o,a,u,h,c,l,p){void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===a&&(a=!1),void 0===u&&(u=n.EV.RGBA8Unorm),void 0===h&&(h=1),void 0===l&&(l=-1),void 0===p&&(p=0),h>1&&(h=4);var f=t.layers||1,d={width:t.width,height:t.height,depthOrArrayLayers:f},_=e.IsCompressedFormat(u),g=r?e.ComputeNumMipmapLevels(t.width,t.height):1,m=l>=0?l:n.v2.CopySrc|n.v2.CopyDst|n.v2.Sampled;p|=r&&!_?n.v2.CopySrc|n.v2.RenderAttachment:0,_||(p|=n.v2.RenderAttachment|n.v2.CopyDst);var y=this._device.createTexture({size:d,dimension:a?n.kd.E3d:n.kd.E2d,format:u,usage:m|p,sampleCount:h,mipLevelCount:g});return e.IsImageBitmap(t)&&(this.updateTexture(t,y,t.width,t.height,f,u,0,0,s,o,0,0,c),r&&i&&this.generateMipmaps(y,u,g,0,c)),y},e.prototype.createCubeTexture=function(t,r,i,s,o,a,u,h,c,l){void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===a&&(a=n.EV.RGBA8Unorm),void 0===u&&(u=1),void 0===c&&(c=-1),void 0===l&&(l=0),u>1&&(u=4);var p=e.IsImageBitmapArray(t)?t[0].width:t.width,f=e.IsImageBitmapArray(t)?t[0].height:t.height,d=e.IsCompressedFormat(a),_=r?e.ComputeNumMipmapLevels(p,f):1,g=c>=0?c:n.v2.CopySrc|n.v2.CopyDst|n.v2.Sampled;l|=r&&!d?n.v2.CopySrc|n.v2.RenderAttachment:0,d||(l|=n.v2.RenderAttachment|n.v2.CopyDst);var m=this._device.createTexture({size:{width:p,height:f,depthOrArrayLayers:6},dimension:n.kd.E2d,format:a,usage:g|l,sampleCount:u,mipLevelCount:_});return e.IsImageBitmapArray(t)&&(this.updateCubeTextures(t,m,p,f,a,s,o,0,0,h),r&&i&&this.generateCubeMipmaps(m,a,_,h)),m},e.prototype.generateCubeMipmaps=function(e,t,r,i){var n,s,o,a,u=void 0===i;u&&(i=this._device.createCommandEncoder({})),null===(s=(n=i).pushDebugGroup)||void 0===s||s.call(n,"create cube mipmaps - "+r+" levels");for(var h=0;h<6;++h)this.generateMipmaps(e,t,r,h,i);null===(a=(o=i).popDebugGroup)||void 0===a||a.call(o),u&&(this._device.queue.submit([i.finish()]),i=null)},e.prototype.generateMipmaps=function(e,t,r,i,s){var o,a,u,h;void 0===i&&(i=0);var c=void 0===s,l=this._getPipeline(t),p=l.getBindGroupLayout(0);c&&(s=this._device.createCommandEncoder({})),null===(a=(o=s).pushDebugGroup)||void 0===a||a.call(o,"create mipmaps for face #"+i+" - "+r+" levels");for(var f=1;f<r;++f){var d=s.beginRenderPass({colorAttachments:[{view:e.createView({format:t,dimension:n.p_.E2d,baseMipLevel:f,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:Math.max(i,0)}),loadValue:n.Ws.Load,storeOp:n.EG.Store}]}),_=this._device.createBindGroup({layout:p,entries:[{binding:0,resource:this._mipmapSampler},{binding:1,resource:e.createView({format:t,dimension:n.p_.E2d,baseMipLevel:f-1,mipLevelCount:1,arrayLayerCount:1,baseArrayLayer:Math.max(i,0)})}]});d.setPipeline(l),d.setBindGroup(0,_),d.draw(4,1,0,0),d.endPass()}null===(h=(u=s).popDebugGroup)||void 0===h||h.call(u),c&&(this._device.queue.submit([s.finish()]),s=null)},e.prototype.createGPUTextureForInternalTexture=function(t,r,i,s,u){t._hardwareTexture||(t._hardwareTexture=new a.Z),void 0===r&&(r=t.width),void 0===i&&(i=t.height),void 0===s&&(s=t.depth);var h=t._hardwareTexture;h.format=e.GetWebGPUTextureFormat(t.type,t.format,t._useSRGBBuffer),h.textureUsages=t._source===o.S.RenderTarget||t.source===o.S.MultiRenderTarget?n.v2.Sampled|n.v2.CopySrc|n.v2.RenderAttachment:t._source===o.S.Depth?n.v2.Sampled|n.v2.RenderAttachment:-1,h.textureAdditionalUsages=1&(null!=u?u:0)?n.v2.Storage:0;var c=t.generateMipMaps,l=s||1;if(t.isCube){var p=this.createCubeTexture({width:r,height:i},t.generateMipMaps,t.generateMipMaps,t.invertY,!1,h.format,1,this._commandEncoderForCreation,h.textureUsages,h.textureAdditionalUsages);h.set(p),h.createView({format:h.format,dimension:n.p_.Cube,mipLevelCount:c?e.ComputeNumMipmapLevels(r,i):1,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:6,aspect:n.H7.All})}else p=this.createTexture({width:r,height:i,layers:l},t.generateMipMaps,t.generateMipMaps,t.invertY,!1,t.is3D,h.format,1,this._commandEncoderForCreation,h.textureUsages,h.textureAdditionalUsages),h.set(p),h.createView({format:h.format,dimension:t.is2DArray?n.p_.E2dArray:t.is3D?n.kd.E3d:n.p_.E2d,mipLevelCount:c?e.ComputeNumMipmapLevels(r,i):1,baseArrayLayer:0,baseMipLevel:0,arrayLayerCount:t.is3D?1:l,aspect:n.H7.All});return t.width=t.baseWidth=r,t.height=t.baseHeight=i,t.depth=t.baseDepth=s,this.createMSAATexture(t,t.samples),h},e.prototype.createMSAATexture=function(e,t){var r=e._hardwareTexture;if((null==r?void 0:r.msaaTexture)&&(this.releaseTexture(r.msaaTexture),r.msaaTexture=null),r&&!((null!=t?t:1)<=1)){var i=e.width,n=e.height,s=e.depth||1;if(e.isCube){var o=this.createCubeTexture({width:i,height:n},!1,!1,e.invertY,!1,r.format,t,this._commandEncoderForCreation,r.textureUsages,r.textureAdditionalUsages);r.setMSAATexture(o)}else o=this.createTexture({width:i,height:n,layers:s},!1,!1,e.invertY,!1,e.is3D,r.format,t,this._commandEncoderForCreation,r.textureUsages,r.textureAdditionalUsages),r.setMSAATexture(o)}},e.prototype.updateCubeTextures=function(e,t,r,i,n,s,o,a,u,h){void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===a&&(a=0),void 0===u&&(u=0);for(var c=[0,3,1,4,2,5],l=0;l<c.length;++l){var p=e[c[l]];this.updateTexture(p,t,r,i,1,n,l,0,s,o,a,u,h)}},e.prototype.updateTexture=function(t,r,i,s,o,a,h,c,l,p,f,d,_){var g=this;void 0===h&&(h=0),void 0===c&&(c=0),void 0===l&&(l=!1),void 0===p&&(p=!1),void 0===f&&(f=0),void 0===d&&(d=0);var m=e._IsInternalTexture(r)?r._hardwareTexture.underlyingResource:r,y=e._GetBlockInformationFromFormat(a),v={texture:m,origin:{x:f,y:d,z:Math.max(h,0)},mipLevel:c},b={width:Math.ceil(i/y.width)*y.width,height:Math.ceil(s/y.height)*y.height,depthOrArrayLayers:o||1};if(void 0!==t.byteLength){t=t;var x=Math.ceil(i/y.width)*y.length;if(256*Math.ceil(x/256)===x){var R=void 0===_;R&&(_=this._device.createCommandEncoder({}));var T=this._bufferManager.createRawBuffer(t.byteLength,n.FB.MapWrite|n.FB.CopySrc,!0),E=T.getMappedRange();new Uint8Array(E).set(t),T.unmap(),_.copyBufferToTexture({buffer:T,offset:0,bytesPerRow:x,rowsPerImage:s},v,b),R&&(this._device.queue.submit([_.finish()]),_=null),this._bufferManager.releaseBuffer(T)}else this._device.queue.writeTexture(v,t,{offset:0,bytesPerRow:x,rowsPerImage:s},b);(l||p)&&this.invertYPreMultiplyAlpha(m,i,s,a,l,p,h,c,o||1,_)}else if(t=t,l||p){var S=u.l.LastCreatedEngine;S&&S.createImageBitmap(t,{imageOrientation:l?"flipY":"none",premultiplyAlpha:p?"premultiply":"none"}).then((function(e){g._device.queue.copyImageBitmapToTexture({imageBitmap:e},v,b)}))}else this._device.queue.copyImageBitmapToTexture({imageBitmap:t},v,b)},e.prototype.readPixels=function(t,r,i,s,o,a,u,h,c,l){void 0===u&&(u=0),void 0===h&&(h=0),void 0===c&&(c=null),void 0===l&&(l=!1);var p=e._GetBlockInformationFromFormat(a),f=Math.ceil(s/p.width)*p.length,d=256*Math.ceil(f/256),_=d*o,g=this._bufferManager.createRawBuffer(_,n.FB.MapRead|n.FB.CopyDst),m=this._device.createCommandEncoder({});return m.copyTextureToBuffer({texture:t,mipLevel:h,origin:{x:r,y:i,z:Math.max(u,0)}},{buffer:g,offset:0,bytesPerRow:d},{width:s,height:o,depthOrArrayLayers:1}),this._device.queue.submit([m.finish()]),this._bufferManager.readDataFromBuffer(g,_,s,o,f,d,e._GetTextureTypeFromFormat(a),0,c,!0,l)},e.prototype.releaseTexture=function(t){if(e._IsInternalTexture(t)){var r=t._hardwareTexture,i=t._irradianceTexture,n=t._depthStencilTexture;this._deferredReleaseTextures.push([r,i,n])}else this._deferredReleaseTextures.push([t,null,null])},e.prototype.destroyDeferredTextures=function(){for(var t=0;t<this._deferredReleaseTextures.length;++t){var r=this._deferredReleaseTextures[t],i=r[0],n=r[1],s=r[2];i&&(e._IsHardwareTexture(i)?i.release():i.destroy()),null==n||n.dispose(),null==s||s.dispose()}this._deferredReleaseTextures.length=0},e}()},6940:(e,t,r)=>{"use strict";r.d(t,{D:()=>f});var i=r(3940),n=r(8131),s=r(5511),o=r(3852),a=r(7936),u=r(1910),h=r(8134),c=r(3221),l=r(809),p=r(4462),f=(r(3018),r(1457),r(7507),function(e){function t(r,i,o,a){void 0===a&&(a=!1);var u=e.call(this,r,i,o,a)||this;if(u.enableOfflineSupport=!1,u.disableManifestCheck=!1,u.scenes=new Array,u._virtualScenes=new Array,u.onNewSceneAddedObservable=new n.y$,u.postProcesses=new Array,u.isPointerLock=!1,u.onResizeObservable=new n.y$,u.onCanvasBlurObservable=new n.y$,u.onCanvasFocusObservable=new n.y$,u.onCanvasPointerOutObservable=new n.y$,u.onBeginFrameObservable=new n.y$,u.customAnimationFrameRequester=null,u.onEndFrameObservable=new n.y$,u.onBeforeShaderCompilationObservable=new n.y$,u.onAfterShaderCompilationObservable=new n.y$,u._deterministicLockstep=!1,u._lockstepMaxSteps=4,u._timeStep=1/60,u._fps=60,u._deltaTime=0,u._drawCalls=new c.z,u.canvasTabIndex=1,u.disablePerformanceMonitorInBackground=!1,u._performanceMonitor=new h.A,t.Instances.push(u),!r)return u;if(o=u._creationOptions,r.getContext){var l=r;if(u._sharedInit(l,!!o.doNotHandleTouchAction,o.audioEngine),s.M.IsWindowObjectExist()){var p=document;u._onFullscreenChange=function(){void 0!==p.fullscreen?u.isFullscreen=p.fullscreen:void 0!==p.mozFullScreen?u.isFullscreen=p.mozFullScreen:void 0!==p.webkitIsFullScreen?u.isFullscreen=p.webkitIsFullScreen:void 0!==p.msIsFullScreen&&(u.isFullscreen=p.msIsFullScreen),u.isFullscreen&&u._pointerLockRequested&&l&&t._RequestPointerlock(l)},document.addEventListener("fullscreenchange",u._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",u._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",u._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",u._onFullscreenChange,!1),u._onPointerLockChange=function(){u.isPointerLock=p.mozPointerLockElement===l||p.webkitPointerLockElement===l||p.msPointerLockElement===l||p.pointerLockElement===l},document.addEventListener("pointerlockchange",u._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",u._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",u._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",u._onPointerLockChange,!1),!t.audioEngine&&o.audioEngine&&t.AudioEngineFactory&&(t.audioEngine=t.AudioEngineFactory(u.getRenderingCanvas(),u.getAudioContext(),u.getAudioDestination()))}u._connectVREvents(),u.enableOfflineSupport=void 0!==t.OfflineProviderFactory,u._deterministicLockstep=!!o.deterministicLockstep,u._lockstepMaxSteps=o.lockstepMaxSteps||0,u._timeStep=o.timeStep||1/60}return u._prepareVRComponent(),o.autoEnableWebVR&&u.initWebVR(),u}return(0,i.ZT)(t,e),Object.defineProperty(t,"NpmPackage",{get:function(){return u.B.NpmPackage},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Version",{get:function(){return u.B.Version},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Instances",{get:function(){return o.l.Instances},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LastCreatedEngine",{get:function(){return o.l.LastCreatedEngine},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LastCreatedScene",{get:function(){return o.l.LastCreatedScene},enumerable:!1,configurable:!0}),t.prototype.createImageBitmap=function(e,t){return createImageBitmap(e,t)},t.prototype.resizeImageBitmap=function(e,t,r){var i=this.createCanvas(t,r).getContext("2d");if(!i)throw new Error("Unable to get 2d context for resizeImageBitmap");return i.drawImage(e,0,0),i.getImageData(0,0,t,r).data},t.MarkAllMaterialsAsDirty=function(e,r){for(var i=0;i<t.Instances.length;i++)for(var n=t.Instances[i],s=0;s<n.scenes.length;s++)n.scenes[s].markAllMaterialsAsDirty(e,r)},t.DefaultLoadingScreenFactory=function(e){throw a.f.WarnImport("LoadingScreen")},Object.defineProperty(t.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!t._RescalePostProcessFactory},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!1,configurable:!0}),t.prototype.getInputElement=function(){return this._renderingCanvas},t.prototype._sharedInit=function(r,i,n){var o=this;if(e.prototype._sharedInit.call(this,r,i,n),this._onCanvasFocus=function(){o.onCanvasFocusObservable.notifyObservers(o)},this._onCanvasBlur=function(){o.onCanvasBlurObservable.notifyObservers(o)},r.addEventListener("focus",this._onCanvasFocus),r.addEventListener("blur",this._onCanvasBlur),this._onBlur=function(){o.disablePerformanceMonitorInBackground&&o._performanceMonitor.disable(),o._windowIsBackground=!0},this._onFocus=function(){o.disablePerformanceMonitorInBackground&&o._performanceMonitor.enable(),o._windowIsBackground=!1},this._onCanvasPointerOut=function(e){o.onCanvasPointerOutObservable.notifyObservers(e)},s.M.IsWindowObjectExist()){var a=this.getHostWindow();a&&(a.addEventListener("blur",this._onBlur),a.addEventListener("focus",this._onFocus))}r.addEventListener("pointerout",this._onCanvasPointerOut),i||this._disableTouchAction(),!t.audioEngine&&n&&t.AudioEngineFactory&&(t.audioEngine=t.AudioEngineFactory(this.getRenderingCanvas(),this.getAudioContext(),this.getAudioDestination()))},t.prototype.getAspectRatio=function(e,t){void 0===t&&(t=!1);var r=e.viewport;return this.getRenderWidth(t)*r.width/(this.getRenderHeight(t)*r.height)},t.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},t.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},t.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},t.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},t.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},t.prototype.getTimeStep=function(){return 1e3*this._timeStep},t.prototype.generateMipMapsForCubemap=function(e,t){if(void 0===t&&(t=!0),e.generateMipMaps){var r=this._gl;this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,e,!0),r.generateMipmap(r.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null)}},t.prototype.getDepthBuffer=function(){return this._depthCullingState.depthTest},t.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},t.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},t.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},t.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},t.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},t.prototype.getStencilMask=function(){return this._stencilState.stencilMask},t.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},t.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},t.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},t.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},t.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},t.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},t.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},t.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},t.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},t.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},t.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},t.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},t.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},t.prototype.setDitheringState=function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},t.prototype.setRasterizerState=function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},t.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},t.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},t.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},t.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},t.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},t.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},t.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},t.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},t.prototype.setDirectViewport=function(e,t,r,i){var n=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,r,i),n},t.prototype.scissorClear=function(e,t,r,i,n){this.enableScissor(e,t,r,i),this.clear(n,!0,!0,!0),this.disableScissor()},t.prototype.enableScissor=function(e,t,r,i){var n=this._gl;n.enable(n.SCISSOR_TEST),n.scissor(e,t,r,i)},t.prototype.disableScissor=function(){var e=this._gl;e.disable(e.SCISSOR_TEST)},t.prototype._reportDrawCall=function(e){void 0===e&&(e=1),this._drawCalls.addCount(e,!1)},t.prototype.initWebVR=function(){throw a.f.WarnImport("WebVRCamera")},t.prototype._prepareVRComponent=function(){},t.prototype._connectVREvents=function(e,t){},t.prototype._submitVRFrame=function(){},t.prototype.disableVR=function(){},t.prototype.isVRPresenting=function(){return!1},t.prototype._requestVRFrame=function(){},t.prototype._loadFileAsync=function(e,t,r){var i=this;return new Promise((function(n,s){i._loadFile(e,(function(e){n(e)}),void 0,t,r,(function(e,t){s(t)}))}))},t.prototype.getVertexShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null},t.prototype.getFragmentShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null},t.prototype.setDepthStencilTexture=function(e,t,r,i){void 0!==e&&(t&&(this._boundUniforms[e]=t),r&&r.depthStencilTexture?this._setTexture(e,r,!1,!0,i):this._setTexture(e,null,void 0,void 0,i))},t.prototype.setTextureFromPostProcess=function(e,t,r){var i=null;t&&(t._textures.data[t._currentRenderTextureInd]?i=t._textures.data[t._currentRenderTextureInd]:t._forcedOutputTexture&&(i=t._forcedOutputTexture)),this._bindTexture(e,i,r)},t.prototype.setTextureFromPostProcessOutput=function(e,t,r){this._bindTexture(e,t?t._outputTexture:null,r)},t.prototype._rebuildBuffers=function(){for(var t=0,r=this.scenes;t<r.length;t++)(s=r[t]).resetCachedMaterial(),s._rebuildGeometries(),s._rebuildTextures();for(var i=0,n=this._virtualScenes;i<n.length;i++){var s;(s=n[i]).resetCachedMaterial(),s._rebuildGeometries(),s._rebuildTextures()}e.prototype._rebuildBuffers.call(this)},t.prototype._renderFrame=function(){for(var e=0;e<this._activeRenderLoops.length;e++)(0,this._activeRenderLoops[e])()},t.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},t.prototype._renderViews=function(){return!1},t.prototype.switchFullscreen=function(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)},t.prototype.enterFullscreen=function(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&t._RequestFullscreen(this._renderingCanvas))},t.prototype.exitFullscreen=function(){this.isFullscreen&&t._ExitFullscreen()},t.prototype.enterPointerlock=function(){this._renderingCanvas&&t._RequestPointerlock(this._renderingCanvas)},t.prototype.exitPointerlock=function(){t._ExitPointerlock()},t.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),e.prototype.beginFrame.call(this)},t.prototype.endFrame=function(){e.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},t.prototype.resize=function(t){void 0===t&&(t=!1),this.isVRPresenting()||e.prototype.resize.call(this,t)},t.prototype.setSize=function(t,r,i){if(void 0===i&&(i=!1),!this._renderingCanvas)return!1;if(!e.prototype.setSize.call(this,t,r,i))return!1;if(this.scenes){for(var n=0;n<this.scenes.length;n++)for(var s=this.scenes[n],o=0;o<s.cameras.length;o++)s.cameras[o]._currentRenderId=0;this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0},t.prototype._deletePipelineContext=function(t){var r=t;r&&r.program&&r.transformFeedback&&(this.deleteTransformFeedback(r.transformFeedback),r.transformFeedback=null),e.prototype._deletePipelineContext.call(this,t)},t.prototype.createShaderProgram=function(t,r,i,n,s,o){void 0===o&&(o=null),s=s||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var a=e.prototype.createShaderProgram.call(this,t,r,i,n,s,o);return this.onAfterShaderCompilationObservable.notifyObservers(this),a},t.prototype._createShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null);var s=i.createProgram();if(e.program=s,!s)throw new Error("Unable to create program");if(i.attachShader(s,t),i.attachShader(s,r),this.webGLVersion>1&&n){var o=this.createTransformFeedback();this.bindTransformFeedback(o),this.setTranformFeedbackVaryings(s,n),e.transformFeedback=o}return i.linkProgram(s),this.webGLVersion>1&&n&&this.bindTransformFeedback(null),e.context=i,e.vertexShader=t,e.fragmentShader=r,e.isParallelCompiled||this._finalizePipelineContext(e),s},t.prototype._releaseTexture=function(t){e.prototype._releaseTexture.call(this,t),this.scenes.forEach((function(e){e.postProcesses.forEach((function(e){e._outputTexture==t&&(e._outputTexture=null)})),e.cameras.forEach((function(e){e._postProcesses.forEach((function(e){e&&e._outputTexture==t&&(e._outputTexture=null)}))}))}))},t.prototype._rescaleTexture=function(e,r,i,n,s){var o=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var a=this.createRenderTargetTexture({width:r.width,height:r.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&t._RescalePostProcessFactory&&(this._rescalePostProcess=t._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled((function(){o._rescalePostProcess.onApply=function(t){t._bindTexture("textureSampler",e)};var t=i;t||(t=o.scenes[o.scenes.length-1]),t.postProcessManager.directRender([o._rescalePostProcess],a,!0),o._bindTextureDirectly(o._gl.TEXTURE_2D,r,!0),o._gl.copyTexImage2D(o._gl.TEXTURE_2D,0,n,0,0,r.width,r.height,0),o.unBindFramebuffer(a),o._releaseTexture(a),s&&s()}))},t.prototype.getFps=function(){return this._fps},t.prototype.getDeltaTime=function(){return this._deltaTime},t.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},t.prototype._uploadImageToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=this._gl,s=this._getWebGLTextureType(e.type),o=this._getInternalFormat(e.format),a=this._getRGBABufferInternalSizedFormat(e.type,o),u=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(u,e,!0),this._unpackFlipY(e.invertY);var h=n.TEXTURE_2D;e.isCube&&(h=n.TEXTURE_CUBE_MAP_POSITIVE_X+r),n.texImage2D(h,i,a,o,s,t),this._bindTextureDirectly(u,null,!0)},t.prototype.updateRenderTargetTextureSampleCount=function(e,t){if(this.webGLVersion<2||!e)return 1;if(e.samples===t)return t;var r=this._gl;if(t=Math.min(t,this.getCaps().maxMSAASamples),e._depthStencilBuffer&&(r.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(r.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(r.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null),t>1&&r.renderbufferStorageMultisample){var i=r.createFramebuffer();if(!i)throw new Error("Unable to create multi sampled framebuffer");e._MSAAFramebuffer=i,this._bindUnboundFramebuffer(e._MSAAFramebuffer);var n=r.createRenderbuffer();if(!n)throw new Error("Unable to create multi sampled framebuffer");r.bindRenderbuffer(r.RENDERBUFFER,n),r.renderbufferStorageMultisample(r.RENDERBUFFER,t,this._getRGBAMultiSampleBufferFormat(e.type),e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n),e._MSAARenderBuffer=n}else this._bindUnboundFramebuffer(e._framebuffer);return e.samples=t,e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,t),this._bindUnboundFramebuffer(null),t},t.prototype.updateTextureComparisonFunction=function(e,t){if(1!==this.webGLVersion){var r=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_FUNC,515),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_FUNC,t),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,515),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}else p.Y.Error("WebGL 1 does not support texture comparison.")},t.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");var r=new l.M(t);return r.capacity=e,this.bindArrayBuffer(r),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),r},t.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},t.prototype._clientWaitAsync=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=10);var i=this._gl;return new Promise((function(n,s){var o=function(){var a=i.clientWaitSync(e,t,0);a!=i.WAIT_FAILED?a!=i.TIMEOUT_EXPIRED?n():setTimeout(o,r):s()};o()}))},t.prototype._readPixelsAsync=function(e,t,r,i,n,s,o){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var a=this._gl,u=a.createBuffer();a.bindBuffer(a.PIXEL_PACK_BUFFER,u),a.bufferData(a.PIXEL_PACK_BUFFER,o.byteLength,a.STREAM_READ),a.readPixels(e,t,r,i,n,s,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null);var h=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);return h?(a.flush(),this._clientWaitAsync(h,0,10).then((function(){return a.deleteSync(h),a.bindBuffer(a.PIXEL_PACK_BUFFER,u),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,o),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.deleteBuffer(u),o}))):null},t.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();1===t.Instances.length&&t.audioEngine&&(t.audioEngine.dispose(),t.audioEngine=null),this.disableVR(),this.deviceInputSystem&&this.deviceInputSystem.dispose(),s.M.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut)),s.M.IsDocumentAvailable()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange))),e.prototype.dispose.call(this);var r=t.Instances.indexOf(this);r>=0&&t.Instances.splice(r,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},t.prototype._disableTouchAction=function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},t.prototype.displayLoadingUI=function(){if(s.M.IsWindowObjectExist()){var e=this.loadingScreen;e&&e.displayLoadingUI()}},t.prototype.hideLoadingUI=function(){if(s.M.IsWindowObjectExist()){var e=this._loadingScreen;e&&e.hideLoadingUI()}},Object.defineProperty(t.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=t.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!1,configurable:!0}),t.prototype.createVideoElement=function(e){return document.createElement("video")},t._RequestPointerlock=function(e){e.requestPointerLock=e.requestPointerLock||e.msRequestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock&&e.requestPointerLock()},t._ExitPointerlock=function(){var e=document;document.exitPointerLock=document.exitPointerLock||e.msExitPointerLock||e.mozExitPointerLock||e.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},t._RequestFullscreen=function(e){var t=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;t&&t.call(e)},t._ExitFullscreen=function(){var e=document;document.exitFullscreen?document.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.msCancelFullScreen&&e.msCancelFullScreen()},t.ALPHA_DISABLE=0,t.ALPHA_ADD=1,t.ALPHA_COMBINE=2,t.ALPHA_SUBTRACT=3,t.ALPHA_MULTIPLY=4,t.ALPHA_MAXIMIZED=5,t.ALPHA_ONEONE=6,t.ALPHA_PREMULTIPLIED=7,t.ALPHA_PREMULTIPLIED_PORTERDUFF=8,t.ALPHA_INTERPOLATE=9,t.ALPHA_SCREENMODE=10,t.DELAYLOADSTATE_NONE=0,t.DELAYLOADSTATE_LOADED=1,t.DELAYLOADSTATE_LOADING=2,t.DELAYLOADSTATE_NOTLOADED=4,t.NEVER=512,t.ALWAYS=519,t.LESS=513,t.EQUAL=514,t.LEQUAL=515,t.GREATER=516,t.GEQUAL=518,t.NOTEQUAL=517,t.KEEP=7680,t.REPLACE=7681,t.INCR=7682,t.DECR=7683,t.INVERT=5386,t.INCR_WRAP=34055,t.DECR_WRAP=34056,t.TEXTURE_CLAMP_ADDRESSMODE=0,t.TEXTURE_WRAP_ADDRESSMODE=1,t.TEXTURE_MIRROR_ADDRESSMODE=2,t.TEXTUREFORMAT_ALPHA=0,t.TEXTUREFORMAT_LUMINANCE=1,t.TEXTUREFORMAT_LUMINANCE_ALPHA=2,t.TEXTUREFORMAT_RGB=4,t.TEXTUREFORMAT_RGBA=5,t.TEXTUREFORMAT_RED=6,t.TEXTUREFORMAT_R=6,t.TEXTUREFORMAT_RG=7,t.TEXTUREFORMAT_RED_INTEGER=8,t.TEXTUREFORMAT_R_INTEGER=8,t.TEXTUREFORMAT_RG_INTEGER=9,t.TEXTUREFORMAT_RGB_INTEGER=10,t.TEXTUREFORMAT_RGBA_INTEGER=11,t.TEXTURETYPE_UNSIGNED_BYTE=0,t.TEXTURETYPE_UNSIGNED_INT=0,t.TEXTURETYPE_FLOAT=1,t.TEXTURETYPE_HALF_FLOAT=2,t.TEXTURETYPE_BYTE=3,t.TEXTURETYPE_SHORT=4,t.TEXTURETYPE_UNSIGNED_SHORT=5,t.TEXTURETYPE_INT=6,t.TEXTURETYPE_UNSIGNED_INTEGER=7,t.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,t.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,t.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,t.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,t.TEXTURETYPE_UNSIGNED_INT_24_8=12,t.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,t.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,t.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,t.TEXTURE_NEAREST_SAMPLINGMODE=1,t.TEXTURE_BILINEAR_SAMPLINGMODE=2,t.TEXTURE_TRILINEAR_SAMPLINGMODE=3,t.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,t.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,t.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,t.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,t.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,t.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,t.TEXTURE_NEAREST_LINEAR=7,t.TEXTURE_NEAREST_NEAREST=1,t.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,t.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,t.TEXTURE_LINEAR_LINEAR=2,t.TEXTURE_LINEAR_NEAREST=12,t.TEXTURE_EXPLICIT_MODE=0,t.TEXTURE_SPHERICAL_MODE=1,t.TEXTURE_PLANAR_MODE=2,t.TEXTURE_CUBIC_MODE=3,t.TEXTURE_PROJECTION_MODE=4,t.TEXTURE_SKYBOX_MODE=5,t.TEXTURE_INVCUBIC_MODE=6,t.TEXTURE_EQUIRECTANGULAR_MODE=7,t.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,t.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,t.SCALEMODE_FLOOR=1,t.SCALEMODE_NEAREST=2,t.SCALEMODE_CEILING=3,t._RescalePostProcessFactory=null,t}(u.B))},3852:(e,t,r)=>{"use strict";r.d(t,{l:()=>i});var i=function(){function e(){}return Object.defineProperty(e,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!1,configurable:!0}),e.Instances=new Array,e._LastCreatedScene=null,e.UseFallbackTexture=!0,e.FallbackTexture="",e}()},9810:(e,t,r)=>{"use strict";r.d(t,{Z:()=>i});var i=function(){function e(){}return e.SetMatrixPrecision=function(t){if(e.MatrixTrackPrecisionChange=!1,t&&!e.MatrixUse64Bits&&e.MatrixTrackedMatrices)for(var r=0;r<e.MatrixTrackedMatrices.length;++r){var i=e.MatrixTrackedMatrices[r],n=i._m;i._m=new Array(16);for(var s=0;s<16;++s)i._m[s]=n[s]}e.MatrixUse64Bits=t,e.MatrixCurrentType=e.MatrixUse64Bits?Array:Float32Array,e.MatrixTrackedMatrices=null},e.MatrixUse64Bits=!1,e.MatrixTrackPrecisionChange=!0,e.MatrixCurrentType=Float32Array,e.MatrixTrackedMatrices=[],e}()},2457:(e,t,r)=>{"use strict";r.d(t,{v:()=>i});var i=function(){function e(){}return e.ShadersRepository="src/Shaders/",e.ShadersStore={},e.IncludesShadersStore={},e}()},1910:(e,t,r)=>{"use strict";r.d(t,{B:()=>T});var i=r(3940),n=r(3852),s=r(5589),o=r(7936),a=r(8131),u=r(2936),h=r(4450),c=r(6522),l=r(6599),p=r(4462),f=r(5511),d=function(){function e(){}return e.prototype.postProcessor=function(e,t,r,i,n){return n.getCaps().drawBuffersExtension||(e=e.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,"")),e},e}(),_=r(8370),g=r(809),m=r(9302),y=r(9810),v=function(){function e(e,t){if(void 0===e&&(e=null),this._context=t,!e&&!(e=t.createTexture()))throw new Error("Unable to create webGL texture");this.set(e)}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return this._webGLTexture},enumerable:!1,configurable:!0}),e.prototype.setUsage=function(e,t,r,i,n){},e.prototype.set=function(e){this._webGLTexture=e},e.prototype.reset=function(){this._webGLTexture=null},e.prototype.release=function(){this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()},e}(),b=r(9666),x=r(693),R=function(){},T=function(){function e(t,r,i,n){var s=this;this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=null,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.disableUniformBuffers=!1,this.onDisposeObservable=new a.y$,this._frameId=0,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new a.y$,this.onContextRestoredObservable=new a.y$,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new u.k,this._stencilStateComposer=new x.C,this._stencilState=new h.s,this._alphaState=new c.Q,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new a.y$,this._isWebGPU=!1,this._snapshotRenderingEnabled=!1,this._snapshotRenderingMode=0,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._getDepthStencilBuffer=function(e,t,r,i,n,o){var a=s._gl,u=a.createRenderbuffer();return a.bindRenderbuffer(a.RENDERBUFFER,u),r>1&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(a.RENDERBUFFER,r,n,e,t):a.renderbufferStorage(a.RENDERBUFFER,i,e,t),a.framebufferRenderbuffer(a.FRAMEBUFFER,o,a.RENDERBUFFER,u),a.bindRenderbuffer(a.RENDERBUFFER,null),u},this._boundUniforms={};var o=null;if(i=i||{},this._stencilStateComposer.stencilGlobal=this._stencilState,y.Z.SetMatrixPrecision(!!i.useHighPrecisionMatrix),t){if(n=n||i.adaptToDeviceRatio||!1,t.getContext){if(o=t,this._renderingCanvas=o,void 0!==r&&(i.antialias=r),void 0===i.deterministicLockstep&&(i.deterministicLockstep=!1),void 0===i.lockstepMaxSteps&&(i.lockstepMaxSteps=4),void 0===i.timeStep&&(i.timeStep=1/60),void 0===i.preserveDrawingBuffer&&(i.preserveDrawingBuffer=!1),void 0===i.audioEngine&&(i.audioEngine=!0),void 0!==i.audioEngineOptions&&void 0!==i.audioEngineOptions.audioContext&&(this._audioContext=i.audioEngineOptions.audioContext),void 0!==i.audioEngineOptions&&void 0!==i.audioEngineOptions.audioDestination&&(this._audioDestination=i.audioEngineOptions.audioDestination),void 0===i.stencil&&(i.stencil=!0),!1===i.premultipliedAlpha&&(this.premultipliedAlpha=!1),void 0===i.xrCompatible&&(i.xrCompatible=!0),this._doNotHandleContextLost=!!i.doNotHandleContextLost,navigator&&navigator.userAgent){this._checkForMobile=function(){var e=navigator.userAgent;s.hostInformation.isMobile=-1!==e.indexOf("Mobile")||-1!==e.indexOf("Mac")&&"ontouchend"in document},this._checkForMobile(),window.addEventListener("resize",this._checkForMobile);for(var l=navigator.userAgent,d=0,_=e.ExceptionList;d<_.length;d++){var g=_[d],m=g.key,v=g.targets;if(new RegExp(m).test(l)){if(g.capture&&g.captureConstraint){var b=g.capture,T=g.captureConstraint,E=new RegExp(b).exec(l);if(E&&E.length>0&&parseInt(E[E.length-1])>=T)continue}for(var S=0,C=v;S<C.length;S++)switch(C[S]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),s._contextWasLost=!0,p.Y.Warn("WebGL context lost."),s.onContextLostObservable.notifyObservers(s)},this._onContextRestored=function(){s._restoreEngineAfterContextLost(s._initGLContext.bind(s))},o.addEventListener("webglcontextlost",this._onContextLost,!1),o.addEventListener("webglcontextrestored",this._onContextRestored,!1),i.powerPreference="high-performance"),!i.disableWebGL2Support)try{this._gl=o.getContext("webgl2",i)||o.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(e){}if(!this._gl){if(!o)throw new Error("The provided canvas is null or undefined.");try{this._gl=o.getContext("webgl",i)||o.getContext("experimental-webgl",i)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=t,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";var A=this._gl.getContextAttributes();A&&(i.stencil=A.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==i.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats);var F=f.M.IsWindowObjectExist()&&window.devicePixelRatio||1,P=i.limitDeviceRatio||F;this._hardwareScalingLevel=n?1/Math.min(P,F):1,this.resize(),this._isStencilEnable=!!i.stencil,this._initGLContext(),this._initFeatures();for(var w=0;w<this._caps.maxVertexAttribs;w++)this._currentBufferPointers[w]=new R;this._shaderProcessor=this._getShaderProcessor(),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._creationOptions=i,console.log("Babylon.js v"+e.Version+" - "+this.description)}}return Object.defineProperty(e,"NpmPackage",{get:function(){return"babylonjs@5.0.0-alpha.36"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Version",{get:function(){return"5.0.0-alpha.36"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){var e=this.name+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return"WebGL"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ShadersRepository",{get:function(){return s.Q.ShadersRepository},set:function(e){s.Q.ShadersRepository=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useReverseDepthBuffer",{get:function(){return this._useReverseDepthBuffer},set:function(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,this._depthCullingState.depthFunc=e?518:515)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frameId",{get:function(){return this._frameId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeRenderLoops",{get:function(){return this._activeRenderLoops},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"framebufferDimensionsObject",{set:function(e){this._framebufferDimensionsObject=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isWebGPU",{get:function(){return this._isWebGPU},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shaderPlatformName",{get:function(){return this._shaderPlatformName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"snapshotRendering",{get:function(){return this._snapshotRenderingEnabled},set:function(e){this._snapshotRenderingEnabled=!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"snapshotRenderingMode",{get:function(){return this._snapshotRenderingMode},set:function(e){this._snapshotRenderingMode=e},enumerable:!1,configurable:!0}),e._createCanvas=function(e,t){if("undefined"==typeof document)return new OffscreenCanvas(e,t);var r=document.createElement("canvas");return r.width=e,r.height=t,r},e.prototype.createCanvas=function(t,r){return e._createCanvas(t,r)},e.prototype.createCanvasImage=function(){return document.createElement("img")},e.prototype._restoreEngineAfterContextLost=function(e){var t=this;setTimeout((function(){return(0,i.mG)(t,void 0,void 0,(function(){var t,r,n,s,o;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return this._dummyFramebuffer=null,t=this._depthCullingState.depthTest,r=this._depthCullingState.depthFunc,n=this._depthCullingState.depthMask,s=this._stencilState.stencilTest,[4,e()];case 1:return i.sent(),this._rebuildEffects(),null===(o=this._rebuildComputeEffects)||void 0===o||o.call(this),this._rebuildInternalTextures(),this._rebuildBuffers(),this.wipeCaches(!0),this._depthCullingState.depthTest=t,this._depthCullingState.depthFunc=r,this._depthCullingState.depthMask=n,this._stencilState.stencilTest=s,p.Y.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1,[2]}}))}))}),0)},e.prototype._sharedInit=function(e,t,r){this._renderingCanvas=e},e.prototype._getShaderProcessor=function(){return this.webGLVersion>1?new _.C:new d},e.prototype._getShaderProcessingContext=function(){return null},e.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++)t[e]._rebuild()},e.prototype._rebuildEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e];t._pipelineContext=null,t._wasPreviouslyReady=!1,t._prepareEffect()}s.Q.ResetCache()},e.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects)if(!this._compiledEffects[e].isReady())return!1;return!0},e.prototype._rebuildBuffers=function(){for(var e=0,t=this._uniformBuffers;e<t.length;e++)t[e]._rebuild();for(var r=0,i=this._storageBuffers;r<i.length;r++)i[r]._rebuild()},e.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile"),standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1},this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._gl.getParameter(this._gl.MAX_SAMPLES);else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var r=0;r<16;r++)this._gl["COLOR_ATTACHMENT"+r+"_WEBGL"]=t["COLOR_ATTACHMENT"+r+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var i=this._gl.getExtension("WEBGL_depth_texture");null!=i&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=i.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var n=this._gl.getExtension("OES_vertex_array_object");null!=n&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=n.createVertexArrayOES.bind(n),this._gl.bindVertexArray=n.bindVertexArrayOES.bind(n),this._gl.deleteVertexArray=n.deleteVertexArrayOES.bind(n))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var s=this._gl.getExtension("ANGLE_instanced_arrays");null!=s?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=s.drawArraysInstancedANGLE.bind(s),this._gl.drawElementsInstanced=s.drawElementsInstancedANGLE.bind(s),this._gl.vertexAttribDivisor=s.vertexAttribDivisorANGLE.bind(s)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var o=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),a=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);o&&a&&(this._caps.highPrecisionShaderSupported=0!==o.precision&&0!==a.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var u=this._gl.getExtension("EXT_blend_minmax");null!=u&&(this._caps.blendMinMax=!0,this._gl.MAX=u.MAX_EXT,this._gl.MIN=u.MIN_EXT)}if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0;else{var h=this._gl.getExtension("EXT_sRGB");null!=h&&(this._caps.supportSRGBBuffers=!0,this._gl.SRGB=h.SRGB_EXT,this._gl.SRGB8=h.SRGB_ALPHA_EXT,this._gl.SRGB8_ALPHA8=h.SRGB_ALPHA_EXT)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var c=0;c<this._maxSimultaneousTextures;c++)this._nextFreeTextureSlots.push(c)},e.prototype._initFeatures=function(){this._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,_collectUbosUpdatedInFrame:!1}},Object.defineProperty(e.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(e.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),e.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=this.createCanvas(1,1);var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},e.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)this._boundTexturesCache.hasOwnProperty(e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},e.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},e.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},e.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},e.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},e.prototype.getCaps=function(){return this._caps},e.prototype.stopRenderLoop=function(e){if(e){var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)}else this._activeRenderLoops=[]},e.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++)(0,this._activeRenderLoops[t])();this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},e.prototype.getRenderingCanvas=function(){return this._renderingCanvas},e.prototype.getAudioContext=function(){return this._audioContext},e.prototype.getAudioDestination=function(){return this._audioDestination},e.prototype.getHostWindow=function(){return f.M.IsWindowObjectExist()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},e.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},e.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},e.prototype._queueNewFrame=function(t,r){return e.QueueNewFrame(t,r)},e.prototype.runRenderLoop=function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},e.prototype.clear=function(e,t,r,i){void 0===i&&(i=!1);var n=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=n;var s=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),s|=this._gl.COLOR_BUFFER_BIT),r&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),s|=this._gl.DEPTH_BUFFER_BIT),i&&(this._gl.clearStencil(0),s|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(s)},e.prototype._viewport=function(e,t,r,i){e===this._viewportCached.x&&t===this._viewportCached.y&&r===this._viewportCached.z&&i===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=r,this._viewportCached.w=i,this._gl.viewport(e,t,r,i))},e.prototype.setViewport=function(e,t,r){var i=t||this.getRenderWidth(),n=r||this.getRenderHeight(),s=e.x||0,o=e.y||0;this._cachedViewport=e,this._viewport(s*i,o*n,i*e.width,n*e.height)},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._frameId++},e.prototype.resize=function(e){var t,r;void 0===e&&(e=!1),f.M.IsWindowObjectExist()?(t=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,r=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(t=this._renderingCanvas?this._renderingCanvas.width:100,r=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(t/this._hardwareScalingLevel,r/this._hardwareScalingLevel,e)},e.prototype.setSize=function(e,t,r){return void 0===r&&(r=!1),!(!this._renderingCanvas||(e|=0,t|=0,!r&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t||(this._renderingCanvas.width=e,this._renderingCanvas.height=t,0)))},e.prototype.bindFramebuffer=function(e,t,r,i,n,s,o){var a,u,h,c,l;void 0===t&&(t=0),void 0===s&&(s=0),void 0===o&&(o=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer);var p=this._gl;e.is2DArray?p.framebufferTextureLayer(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,null===(a=e._hardwareTexture)||void 0===a?void 0:a.underlyingResource,s,o):e.isCube&&p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_CUBE_MAP_POSITIVE_X+t,null===(u=e._hardwareTexture)||void 0===u?void 0:u.underlyingResource,s);var f=e._depthStencilTexture;if(f){var d=f._generateStencilBuffer?p.DEPTH_STENCIL_ATTACHMENT:p.DEPTH_ATTACHMENT;e.is2DArray?p.framebufferTextureLayer(p.FRAMEBUFFER,d,null===(h=f._hardwareTexture)||void 0===h?void 0:h.underlyingResource,s,o):e.isCube?p.framebufferTexture2D(p.FRAMEBUFFER,d,p.TEXTURE_CUBE_MAP_POSITIVE_X+t,null===(c=f._hardwareTexture)||void 0===c?void 0:c.underlyingResource,s):p.framebufferTexture2D(p.FRAMEBUFFER,d,p.TEXTURE_2D,null===(l=f._hardwareTexture)||void 0===l?void 0:l.underlyingResource,s)}this._cachedViewport&&!n?this.setViewport(this._cachedViewport,r,i):(r||(r=e.width,s&&(r/=Math.pow(2,s))),i||(i=e.height,s&&(i/=Math.pow(2,s))),this._viewport(0,0,r,i)),this.wipeCaches()},e.prototype.setState=function(e,t,r,i,n,s){var o,a;void 0===t&&(t=0),void 0===i&&(i=!1),(this._depthCullingState.cull!==e||r)&&(this._depthCullingState.cull=e);var u=null===(a=null!==(o=this.cullBackFaces)&&void 0!==o?o:n)||void 0===a||a?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==u||r)&&(this._depthCullingState.cullFace=u),this.setZOffset(t);var h=i?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==h||r)&&(this._depthCullingState.frontFace=h),this._stencilStateComposer.stencilMaterial=s},e.prototype.setZOffset=function(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e},e.prototype.getZOffset=function(){return this._depthCullingState.zOffset},e.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},e.prototype._currentFrameBufferIsDefaultFrameBuffer=function(){return null===this._currentFramebuffer},e.prototype.unBindFramebuffer=function(e,t,r){void 0===t&&(t=!1),this._currentRenderTarget=null;var i=this._gl;if(e._MSAAFramebuffer){if(e._textureArray)return void this.unBindMultiColorAttachmentFramebuffer(e._textureArray,t,r);i.bindFramebuffer(i.READ_FRAMEBUFFER,e._MSAAFramebuffer),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,e._framebuffer),i.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,i.COLOR_BUFFER_BIT,i.NEAREST)}!e.generateMipMaps||t||e.isCube||(this._bindTextureDirectly(i.TEXTURE_2D,e,!0),i.generateMipmap(i.TEXTURE_2D),this._bindTextureDirectly(i.TEXTURE_2D,null)),r&&(e._MSAAFramebuffer&&this._bindUnboundFramebuffer(e._framebuffer),r()),this._bindUnboundFramebuffer(null)},e.prototype.flushFramebuffer=function(){this._gl.flush()},e.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},e.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},e.prototype.createVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)},e.prototype._createVertexBuffer=function(e,t){var r=this._gl.createBuffer();if(!r)throw new Error("Unable to create vertex buffer");var i=new g.M(r);return this.bindArrayBuffer(i),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),i.references=1,i},e.prototype.createDynamicVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)},e.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},e.prototype.createIndexBuffer=function(e,t){var r=this._gl.createBuffer(),i=new g.M(r);if(!r)throw new Error("Unable to create index buffer");this.bindIndexBuffer(i);var n=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),i.references=1,i.is32Bits=4===n.BYTES_PER_ELEMENT,i},e.prototype._normalizeIndexData=function(e){if(e instanceof Uint16Array)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(var t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)},e.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ARRAY_BUFFER)},e.prototype.bindUniformBlock=function(e,t,r){var i=e.program,n=this._gl.getUniformBlockIndex(i,t);this._gl.uniformBlockBinding(i,n,r)},e.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},e.prototype.bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},e.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},e.prototype._vertexAttribPointer=function(e,t,r,i,n,s,o){var a=this._currentBufferPointers[t];if(a){var u=!1;a.active?(a.buffer!==e&&(a.buffer=e,u=!0),a.size!==r&&(a.size=r,u=!0),a.type!==i&&(a.type=i,u=!0),a.normalized!==n&&(a.normalized=n,u=!0),a.stride!==s&&(a.stride=s,u=!0),a.offset!==o&&(a.offset=o,u=!0)):(u=!0,a.active=!0,a.index=t,a.size=r,a.type=i,a.normalized=n,a.stride=s,a.offset=o,a.buffer=e),(u||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,r,i,n,s,o))}},e.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},e.prototype._bindVertexBuffersAttributes=function(e,t,r){var i=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var n=0;n<i.length;n++){var s=t.getAttributeLocation(n);if(s>=0){var o=i[n],a=null;if(r&&(a=r[o]),a||(a=e[o]),!a)continue;this._gl.enableVertexAttribArray(s),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[s]=!0);var u=a.getBuffer();u&&(this._vertexAttribPointer(u,s,a.getSize(),a.type,a.normalized,a.byteStride,a.byteOffset),a.getIsInstanced()&&(this._gl.vertexAttribDivisor(s,a.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(s),this._currentInstanceBuffers.push(u))))}}},e.prototype.recordVertexArrayObject=function(e,t,r,i){var n=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(n),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,r,i),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),n},e.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},e.prototype.bindBuffersDirectly=function(e,t,r,i,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n;var s=n.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var o=0,a=0;a<s;a++)if(a<r.length){var u=n.getAttributeLocation(a);u>=0&&(this._gl.enableVertexAttribArray(u),this._vertexAttribArraysEnabled[u]=!0,this._vertexAttribPointer(e,u,r[a],this._gl.FLOAT,!1,i,o)),o+=4*r[a]}}this._bindIndexBufferWithCache(t)},e.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},e.prototype.bindBuffers=function(e,t,r,i){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===r||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r,this._bindVertexBuffersAttributes(e,r,i)),this._bindIndexBufferWithCache(t)},e.prototype.unbindInstanceAttributes=function(){for(var e,t=0,r=this._currentInstanceLocations.length;t<r;t++){var i=this._currentInstanceBuffers[t];e!=i&&i.references&&(e=i,this.bindArrayBuffer(i));var n=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(n,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},e.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},e.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)},e.prototype._deleteBuffer=function(e){this._gl.deleteBuffer(e.underlyingResource)},e.prototype.updateAndBindInstancesBuffer=function(e,t,r){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==r[0].index)this.bindInstancesBuffer(e,r,!0);else for(var i=0;i<4;i++){var n=r[i];this._vertexAttribArraysEnabled[n]||(this._gl.enableVertexAttribArray(n),this._vertexAttribArraysEnabled[n]=!0),this._vertexAttribPointer(e,n,4,this._gl.FLOAT,!1,64,16*i),this._gl.vertexAttribDivisor(n,1),this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(e)}},e.prototype.bindInstancesBuffer=function(e,t,r){void 0===r&&(r=!0),this.bindArrayBuffer(e);var i=0;if(r)for(var n=0;n<t.length;n++)i+=4*(s=t[n]).attributeSize;for(n=0;n<t.length;n++){var s;void 0===(s=t[n]).index&&(s.index=this._currentEffect.getAttributeLocationByName(s.attributeName)),s.index<0||(this._vertexAttribArraysEnabled[s.index]||(this._gl.enableVertexAttribArray(s.index),this._vertexAttribArraysEnabled[s.index]=!0),this._vertexAttribPointer(e,s.index,s.attributeSize,s.attributeType||this._gl.FLOAT,s.normalized||!1,i,s.offset),this._gl.vertexAttribDivisor(s.index,void 0===s.divisor?1:s.divisor),this._currentInstanceLocations.push(s.index),this._currentInstanceBuffers.push(e))}},e.prototype.disableInstanceAttributeByName=function(e){if(this._currentEffect){var t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}},e.prototype.disableInstanceAttribute=function(e){for(var t,r=!1;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),r=!0,t=this._currentInstanceLocations.indexOf(e);r&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))},e.prototype.disableAttributeByIndex=function(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1},e.prototype.draw=function(e,t,r,i){this.drawElementsType(e?0:1,t,r,i)},e.prototype.drawPointClouds=function(e,t,r){this.drawArraysType(2,e,t,r)},e.prototype.drawUnIndexed=function(e,t,r,i){this.drawArraysType(e?0:1,t,r,i)},e.prototype.drawElementsType=function(e,t,r,i){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e),s=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;i?this._gl.drawElementsInstanced(n,r,s,t*o,i):this._gl.drawElements(n,r,s,t*o)},e.prototype.drawArraysType=function(e,t,r,i){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e);i?this._gl.drawArraysInstanced(n,t,r,i):this._gl.drawArrays(n,t,r)},e.prototype._drawMode=function(e){switch(e){case 0:return this._gl.TRIANGLES;case 2:return this._gl.POINTS;case 1:return this._gl.LINES;case 3:return this._gl.POINTS;case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},e.prototype._reportDrawCall=function(){},e.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deletePipelineContext(e.getPipelineContext()))},e.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(t.program))},e.prototype._getGlobalDefines=function(e){if(e)return this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,void(this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER);var t="";return this.isNDCHalfZRange&&(t+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(t&&(t+="\n"),t+="#define USE_REVERSE_DEPTHBUFFER"),t},e.prototype.createEffect=function(e,t,r,i,n,o,a,u,h){var c,l=e.vertexElement||e.vertex||e.vertexToken||e.vertexSource||e,p=e.fragmentElement||e.fragment||e.fragmentToken||e.fragmentSource||e,f=this._getGlobalDefines(),d=null!==(c=null!=n?n:t.defines)&&void 0!==c?c:"";f&&(d+=f);var _=l+"+"+p+"@"+d;if(this._compiledEffects[_]){var g=this._compiledEffects[_];return a&&g.isReady()&&a(g),g}var m=new s.Q(e,t,r,i,this,n,o,a,u,h,_);return this._compiledEffects[_]=m,m},e._ConcatenateShader=function(e,t,r){return void 0===r&&(r=""),r+(t?t+"\n":"")+e},e.prototype._compileShader=function(t,r,i,n){return this._compileRawShader(e._ConcatenateShader(t,i,n),r)},e.prototype._compileRawShader=function(e,t){for(var r=this._gl;r.getError()!=r.NO_ERROR;);var i=r.createShader("vertex"===t?r.VERTEX_SHADER:r.FRAGMENT_SHADER);if(!i)throw new Error("Something went wrong while creating a gl "+t+" shader object. gl error="+r.getError()+", gl isContextLost="+r.isContextLost()+", _contextWasLost="+this._contextWasLost);return r.shaderSource(i,e),r.compileShader(i),i},e.prototype._getShaderSource=function(e){return this._gl.getShaderSource(e)},e.prototype.createRawShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null),i=i||this._gl;var s=this._compileRawShader(t,"vertex"),o=this._compileRawShader(r,"fragment");return this._createShaderProgram(e,s,o,i,n)},e.prototype.createShaderProgram=function(e,t,r,i,n,s){void 0===s&&(s=null),n=n||this._gl;var o=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",a=this._compileShader(t,"vertex",i,o),u=this._compileShader(r,"fragment",i,o);return this._createShaderProgram(e,a,u,n,s)},e.prototype.inlineShaderCode=function(e){return e},e.prototype.createPipelineContext=function(e){var t=new m.y;return t.engine=this,this._caps.parallelShaderCompile&&(t.isParallelCompiled=!0),t},e.prototype.createMaterialContext=function(){},e.prototype.createDrawContext=function(){},e.prototype._createShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null);var s=i.createProgram();if(e.program=s,!s)throw new Error("Unable to create program");return i.attachShader(s,t),i.attachShader(s,r),i.linkProgram(s),e.context=i,e.vertexShader=t,e.fragmentShader=r,e.isParallelCompiled||this._finalizePipelineContext(e),s},e.prototype._finalizePipelineContext=function(e){var t=e.context,r=e.vertexShader,i=e.fragmentShader,n=e.program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var s,o;if(!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS)&&(s=this._gl.getShaderInfoLog(r)))throw e.vertexCompilationError=s,new Error("VERTEX SHADER "+s);if(!this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS)&&(s=this._gl.getShaderInfoLog(i)))throw e.fragmentCompilationError=s,new Error("FRAGMENT SHADER "+s);if(o=t.getProgramInfoLog(n))throw e.programLinkError=o,new Error(o)}if(this.validateShaderPrograms&&(t.validateProgram(n),!t.getProgramParameter(n,t.VALIDATE_STATUS)&&(o=t.getProgramInfoLog(n))))throw e.programValidationError=o,new Error(o);t.deleteShader(r),t.deleteShader(i),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},e.prototype._preparePipelineContext=function(e,t,r,i,n,s,o,a,u,h){var c=e;c.program=i?this.createRawShaderProgram(c,t,r,void 0,u):this.createShaderProgram(c,t,r,a,void 0,u),c.program.__SPECTOR_rebuildProgram=o},e.prototype._isRenderingStateCompiled=function(e){var t=e;return!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0)},e.prototype._executeWhenRenderingStateIsCompiled=function(e,t){var r=e;if(r.isParallelCompiled){var i=r.onCompiled;r.onCompiled=i?function(){i(),t()}:t}else t()},e.prototype.getUniforms=function(e,t){for(var r=new Array,i=e,n=0;n<t.length;n++)r.push(this._gl.getUniformLocation(i.program,t[n]));return r},e.prototype.getAttributes=function(e,t){for(var r=[],i=e,n=0;n<t.length;n++)try{r.push(this._gl.getAttribLocation(i.program,t[n]))}catch(e){r.push(-1)}return r},e.prototype.enableEffect=function(e){(e=null!==e&&b.q.IsWrapper(e)?e.effect:e)&&e!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,e=e,this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},e.prototype.setInt=function(e,t){return!!e&&(this._gl.uniform1i(e,t),!0)},e.prototype.setInt2=function(e,t,r){return!!e&&(this._gl.uniform2i(e,t,r),!0)},e.prototype.setInt3=function(e,t,r,i){return!!e&&(this._gl.uniform3i(e,t,r,i),!0)},e.prototype.setInt4=function(e,t,r,i,n){return!!e&&(this._gl.uniform4i(e,t,r,i,n),!0)},e.prototype.setIntArray=function(e,t){return!!e&&(this._gl.uniform1iv(e,t),!0)},e.prototype.setIntArray2=function(e,t){return!(!e||t.length%2!=0||(this._gl.uniform2iv(e,t),0))},e.prototype.setIntArray3=function(e,t){return!(!e||t.length%3!=0||(this._gl.uniform3iv(e,t),0))},e.prototype.setIntArray4=function(e,t){return!(!e||t.length%4!=0||(this._gl.uniform4iv(e,t),0))},e.prototype.setArray=function(e,t){return!(!e||t.length<1||(this._gl.uniform1fv(e,t),0))},e.prototype.setArray2=function(e,t){return!(!e||t.length%2!=0||(this._gl.uniform2fv(e,t),0))},e.prototype.setArray3=function(e,t){return!(!e||t.length%3!=0||(this._gl.uniform3fv(e,t),0))},e.prototype.setArray4=function(e,t){return!(!e||t.length%4!=0||(this._gl.uniform4fv(e,t),0))},e.prototype.setMatrices=function(e,t){return!!e&&(this._gl.uniformMatrix4fv(e,!1,t),!0)},e.prototype.setMatrix3x3=function(e,t){return!!e&&(this._gl.uniformMatrix3fv(e,!1,t),!0)},e.prototype.setMatrix2x2=function(e,t){return!!e&&(this._gl.uniformMatrix2fv(e,!1,t),!0)},e.prototype.setFloat=function(e,t){return!!e&&(this._gl.uniform1f(e,t),!0)},e.prototype.setFloat2=function(e,t,r){return!!e&&(this._gl.uniform2f(e,t,r),!0)},e.prototype.setFloat3=function(e,t,r,i){return!!e&&(this._gl.uniform3f(e,t,r,i),!0)},e.prototype.setFloat4=function(e,t,r,i,n){return!!e&&(this._gl.uniform4f(e,t,r,i,n),!0)},e.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var e=this._colorWrite;this._gl.colorMask(e,e,e,e)}},e.prototype.setColorWrite=function(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)},e.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(e.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilStateComposer",{get:function(){return this._stencilStateComposer},enumerable:!1,configurable:!0}),e.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},e.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},e.prototype._getSamplingParameters=function(e,t){var r=this._gl,i=r.NEAREST,n=r.NEAREST;switch(e){case 11:i=r.LINEAR,n=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 3:i=r.LINEAR,n=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 8:i=r.NEAREST,n=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 4:i=r.NEAREST,n=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 5:i=r.NEAREST,n=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 6:i=r.NEAREST,n=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 7:i=r.NEAREST,n=r.LINEAR;break;case 1:i=r.NEAREST,n=r.NEAREST;break;case 9:i=r.LINEAR,n=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 10:i=r.LINEAR,n=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 2:i=r.LINEAR,n=r.LINEAR;break;case 12:i=r.LINEAR,n=r.NEAREST}return{min:n,mag:i}},e.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},e.prototype._createHardwareTexture=function(){return new v(this._createTexture(),this._gl)},e.prototype._createTextureBase=function(t,r,i,s,o,a,u,h,c,f,d,_,g,m,y,v){var b=this;void 0===o&&(o=3),void 0===a&&(a=null),void 0===u&&(u=null),void 0===f&&(f=null),void 0===d&&(d=null),void 0===_&&(_=null),void 0===g&&(g=null);var x="data:"===(t=t||"").substr(0,5),R="blob:"===t.substr(0,5),T=x&&-1!==t.indexOf(";base64,"),E=d||new l.l(this,l.S.Url),S=t;!this._transformTextureUrl||T||d||f||(t=this._transformTextureUrl(t)),S!==t&&(E._originalUrl=S);var C=t.lastIndexOf("."),A=g||(C>-1?t.substring(C).toLowerCase():""),F=null;A.indexOf("?")>-1&&(A=A.split("?")[0]);for(var P=0,w=e._TextureLoaders;P<w.length;P++){var B=w[P];if(B.canLoad(A,m)){F=B;break}}s&&s._addPendingData(E),E.url=t,E.generateMipMaps=!r,E.samplingMode=o,E.invertY=i,E._useSRGBBuffer=!!v&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||r),this._doNotHandleContextLost||(E._buffer=f);var M=null;a&&!d&&(M=E.onLoadedObservable.add(a)),d||this._internalTexturesCache.push(E);var O=function(e,i){s&&s._removePendingData(E),t===S?(M&&E.onLoadedObservable.remove(M),n.l.UseFallbackTexture&&b._createTextureBase(n.l.FallbackTexture,r,E.invertY,s,o,null,u,h,c,f,E),u&&u((e||"Unknown error")+(n.l.UseFallbackTexture?" - Fallback texture was used":""),i)):(p.Y.Warn("Failed to load "+t+", falling back to "+S),b._createTextureBase(S,r,E.invertY,s,o,a,u,h,c,f,E,_,g,m,y,v))};if(F){var I=function(e){F.loadData(e,E,(function(e,t,r,i,n,a){a?O("TextureLoader failed to load data"):h(E,A,s,{width:e,height:t},E.invertY,!r,i,(function(){return n(),!1}),o)}),y)};f?f instanceof ArrayBuffer?I(new Uint8Array(f)):ArrayBuffer.isView(f)?I(f):u&&u("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(t,(function(e){return I(new Uint8Array(e))}),void 0,s?s.offlineProvider:void 0,!0,(function(e,t){O("Unable to load "+(e&&e.responseURL,t))}))}else{var D=function(e){R&&!b._doNotHandleContextLost&&(E._buffer=e),h(E,A,s,e,E.invertY,r,!1,c,o)};!x||T?f&&("string"==typeof f.decoding||f.close)?D(f):e._FileToolsLoadImage(t,D,O,s?s.offlineProvider:null,m):"string"==typeof f||f instanceof ArrayBuffer||ArrayBuffer.isView(f)||f instanceof Blob?e._FileToolsLoadImage(f,D,O,s?s.offlineProvider:null,m):f&&D(f)}return E},e.prototype.createTexture=function(e,t,r,i,n,s,o,a,u,h,c,p,f,d,_){var g=this;return void 0===n&&(n=3),void 0===s&&(s=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===h&&(h=null),void 0===c&&(c=null),this._createTextureBase(e,t,r,i,n,s,o,this._prepareWebGLTexture.bind(this),(function(e,t,r,n,s,o){var a=g._gl,u=r.width===e&&r.height===t,c=h?g._getInternalFormat(h,s._useSRGBBuffer):".jpg"!==n||s._useSRGBBuffer?s._useSRGBBuffer?a.SRGB8_ALPHA8:a.RGBA:a.RGB,p=h?g._getInternalFormat(h):".jpg"!==n||s._useSRGBBuffer?a.RGBA:a.RGB;if(s._useSRGBBuffer&&1===g.webGLVersion&&(p=c),u)return a.texImage2D(a.TEXTURE_2D,0,c,p,a.UNSIGNED_BYTE,r),!1;var f=g._caps.maxTextureSize;if(r.width>f||r.height>f||!g._supportsHardwareTextureRescaling)return g._prepareWorkingCanvas(),!(!g._workingCanvas||!g._workingContext||(g._workingCanvas.width=e,g._workingCanvas.height=t,g._workingContext.drawImage(r,0,0,r.width,r.height,0,0,e,t),a.texImage2D(a.TEXTURE_2D,0,c,p,a.UNSIGNED_BYTE,g._workingCanvas),s.width=e,s.height=t,1));var d=new l.l(g,l.S.Temp);return g._bindTextureDirectly(a.TEXTURE_2D,d,!0),a.texImage2D(a.TEXTURE_2D,0,c,p,a.UNSIGNED_BYTE,r),g._rescaleTexture(d,s,i,c,(function(){g._releaseTexture(d),g._bindTextureDirectly(a.TEXTURE_2D,s,!0),o()})),!0}),a,u,h,c,p,f,_)},e._FileToolsLoadImage=function(e,t,r,i,n){throw o.f.WarnImport("FileTools")},e.prototype._rescaleTexture=function(e,t,r,i,n){},e.prototype.createRawTexture=function(e,t,r,i,n,s,a,u,h){throw void 0===u&&(u=null),void 0===h&&(h=0),o.f.WarnImport("Engine.RawTexture")},e.prototype.createRawCubeTexture=function(e,t,r,i,n,s,a,u){throw void 0===u&&(u=null),o.f.WarnImport("Engine.RawTexture")},e.prototype.createRawTexture3D=function(e,t,r,i,n,s,a,u,h,c){throw void 0===h&&(h=null),void 0===c&&(c=0),o.f.WarnImport("Engine.RawTexture")},e.prototype.createRawTexture2DArray=function(e,t,r,i,n,s,a,u,h,c){throw void 0===h&&(h=null),void 0===c&&(c=0),o.f.WarnImport("Engine.RawTexture")},e.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},e.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},e.prototype._getTextureTarget=function(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},e.prototype.updateTextureSamplingMode=function(e,t,r){void 0===r&&(r=!1);var i=this._getTextureTarget(t),n=this._getSamplingParameters(e,t.generateMipMaps||r);this._setTextureParameterInteger(i,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(i,this._gl.TEXTURE_MIN_FILTER,n.min),r&&(t.generateMipMaps=!0,this._gl.generateMipmap(i)),this._bindTextureDirectly(i,null),t.samplingMode=e},e.prototype.updateTextureDimensions=function(e,t,r,i){void 0===i&&(i=1)},e.prototype.updateTextureWrappingMode=function(e,t,r,i){void 0===r&&(r=null),void 0===i&&(i=null);var n=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==r&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(r),e),e._cachedWrapV=r),(e.is2DArray||e.is3D)&&null!==i&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(i),e),e._cachedWrapR=i),this._bindTextureDirectly(n,null)},e.prototype._setupDepthStencilTexture=function(e,t,r,i,n,s){void 0===s&&(s=1);var o=t.width||t,a=t.height||t,u=t.layers||0;e.baseWidth=o,e.baseHeight=a,e.width=o,e.height=a,e.is2DArray=u>0,e.depth=u,e.isReady=!0,e.samples=s,e.generateMipMaps=!1,e._generateDepthBuffer=!0,e._generateStencilBuffer=r,e.samplingMode=i?2:1,e.type=0,e._comparisonFunction=n;var h=this._gl,c=this._getTextureTarget(e),l=this._getSamplingParameters(e.samplingMode,!1);h.texParameteri(c,h.TEXTURE_MAG_FILTER,l.mag),h.texParameteri(c,h.TEXTURE_MIN_FILTER,l.min),h.texParameteri(c,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(c,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),0===n?(h.texParameteri(c,h.TEXTURE_COMPARE_FUNC,515),h.texParameteri(c,h.TEXTURE_COMPARE_MODE,h.NONE)):(h.texParameteri(c,h.TEXTURE_COMPARE_FUNC,n),h.texParameteri(c,h.TEXTURE_COMPARE_MODE,h.COMPARE_REF_TO_TEXTURE))},e.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,i,n,s,o){void 0===s&&(s=0),void 0===o&&(o=0);var a=this._gl,u=a.TEXTURE_2D;if(e.isCube&&(u=a.TEXTURE_CUBE_MAP_POSITIVE_X+s),e._useSRGBBuffer)switch(t){case 36492:t=a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:t=a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?t=a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?t=a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:e._useSRGBBuffer=!1;break;default:e._useSRGBBuffer=!1}this._gl.compressedTexImage2D(u,o,t,r,i,0,n)},e.prototype._uploadDataToTextureDirectly=function(e,t,r,i,n,s){void 0===r&&(r=0),void 0===i&&(i=0),void 0===s&&(s=!1);var o=this._gl,a=this._getWebGLTextureType(e.type),u=this._getInternalFormat(e.format),h=void 0===n?this._getRGBABufferInternalSizedFormat(e.type,e.format,e._useSRGBBuffer):this._getInternalFormat(n,e._useSRGBBuffer);this._unpackFlipY(e.invertY);var c=o.TEXTURE_2D;e.isCube&&(c=o.TEXTURE_CUBE_MAP_POSITIVE_X+r);var l=Math.round(Math.log(e.width)*Math.LOG2E),p=Math.round(Math.log(e.height)*Math.LOG2E),f=s?e.width:Math.pow(2,Math.max(l-i,0)),d=s?e.height:Math.pow(2,Math.max(p-i,0));o.texImage2D(c,i,h,f,d,0,u,a,t)},e.prototype.updateTextureData=function(e,t,r,i,n,s,o,a){void 0===o&&(o=0),void 0===a&&(a=0);var u=this._gl,h=this._getWebGLTextureType(e.type),c=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);var l=u.TEXTURE_2D;e.isCube&&(l=u.TEXTURE_CUBE_MAP_POSITIVE_X+o),u.texSubImage2D(l,a,r,i,n,s,c,h,t)},e.prototype._uploadArrayBufferViewToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=this._gl,s=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(s,e,!0),this._uploadDataToTextureDirectly(e,t,r,i),this._bindTextureDirectly(s,null,!0)},e.prototype._prepareWebGLTextureContinuation=function(e,t,r,i,n){var s=this._gl;if(s){var o=this._getSamplingParameters(n,!r);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o.min),r||i||s.generateMipmap(s.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},e.prototype._prepareWebGLTexture=function(t,r,i,n,s,o,a,u,h){var c=this;void 0===h&&(h=3);var l=this.getCaps().maxTextureSize,p=Math.min(l,this.needPOTTextures?e.GetExponentOfTwo(n.width,l):n.width),f=Math.min(l,this.needPOTTextures?e.GetExponentOfTwo(n.height,l):n.height),d=this._gl;d&&(t._hardwareTexture?(this._bindTextureDirectly(d.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===s||!!s),t.baseWidth=n.width,t.baseHeight=n.height,t.width=p,t.height=f,t.isReady=!0,u(p,f,n,r,t,(function(){c._prepareWebGLTextureContinuation(t,i,o,a,h)}))||this._prepareWebGLTextureContinuation(t,i,o,a,h)):i&&i._removePendingData(t))},e.prototype._setupFramebufferDepthAttachments=function(e,t,r,i,n){void 0===n&&(n=1);var s=this._gl;if(e&&t)return this._getDepthStencilBuffer(r,i,n,s.DEPTH_STENCIL,s.DEPTH24_STENCIL8,s.DEPTH_STENCIL_ATTACHMENT);if(t){var o=s.DEPTH_COMPONENT16;return this._webGLVersion>1&&(o=s.DEPTH_COMPONENT32F),this._getDepthStencilBuffer(r,i,n,o,o,s.DEPTH_ATTACHMENT)}return e?this._getDepthStencilBuffer(r,i,n,s.STENCIL_INDEX8,s.STENCIL_INDEX8,s.STENCIL_ATTACHMENT):null},e.prototype._releaseFramebufferObjects=function(e){var t=this._gl;e._framebuffer&&(t.deleteFramebuffer(e._framebuffer),e._framebuffer=null),e._depthStencilBuffer&&(t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(t.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(t.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null)},e.prototype._releaseTexture=function(e){var t,r;this._releaseFramebufferObjects(e),this._deleteTexture(null===(t=e._hardwareTexture)||void 0===t?void 0:t.underlyingResource),this.unbindAllTextures();var i=this._internalTexturesCache.indexOf(e);-1!==i&&this._internalTexturesCache.splice(i,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose(),null===(r=e._depthStencilTexture)||void 0===r||r.dispose()},e.prototype._deleteTexture=function(e){e&&this._gl.deleteTexture(e)},e.prototype._setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},e.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this._setProgram(t.program);for(var r=e.getSamplers(),i=0;i<r.length;i++){var n=e.getUniform(r[i]);n&&(this._boundUniforms[i]=n)}this._currentEffect=null},e.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},e.prototype._bindTextureDirectly=function(e,t,r,i){var n,s;void 0===r&&(r=!1),void 0===i&&(i=!1);var o=!1,a=t&&t._associatedChannel>-1;return r&&a&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||i?(this._activateCurrentTexture(),t&&t.isMultiview?this._gl.bindTexture(e,t?t._colorTextureArray:null):this._gl.bindTexture(e,null!==(s=null===(n=null==t?void 0:t._hardwareTexture)||void 0===n?void 0:n.underlyingResource)&&void 0!==s?s:null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)):r&&(o=!0,this._activateCurrentTexture()),a&&!r&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),o},e.prototype._bindTexture=function(e,t,r){if(void 0!==e){t&&(t._associatedChannel=e),this._activeChannel=e;var i=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(i,t)}},e.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},e.prototype.setTexture=function(e,t,r,i){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,r))},e.prototype._bindSamplerUniformToChannel=function(e,t){var r=this._boundUniforms[e];r&&r._currentState!==t&&(this._gl.uniform1i(r,t),r._currentState=t)},e.prototype._getTextureWrapMode=function(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},e.prototype._setTexture=function(e,t,r,i,n){if(void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===n&&(n=""),!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video)this._activeChannel=e,t.update();else if(4===t.delayLoadState)return t.delayLoad(),!1;var s;s=i?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!r&&s&&(s._associatedChannel=e);var o=!0;this._boundTexturesCache[e]===s&&(r||this._bindSamplerUniformToChannel(s._associatedChannel,e),o=!1),this._activeChannel=e;var a=this._getTextureTarget(s);if(o&&this._bindTextureDirectly(a,s,r),s&&!s.isMultiview){if(s.isCube&&s._cachedCoordinatesMode!==t.coordinatesMode){s._cachedCoordinatesMode=t.coordinatesMode;var u=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=u,t.wrapV=u}s._cachedWrapU!==t.wrapU&&(s._cachedWrapU=t.wrapU,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),s)),s._cachedWrapV!==t.wrapV&&(s._cachedWrapV=t.wrapV,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),s)),s.is3D&&s._cachedWrapR!==t.wrapR&&(s._cachedWrapR=t.wrapR,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),s)),this._setAnisotropicLevel(a,s,t.anisotropicFilteringLevel)}return!0},e.prototype.setTextureArray=function(e,t,r,i){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===r.length||(this._textureUnits=new Int32Array(r.length));for(var n=0;n<r.length;n++){var s=r[n].getInternalTexture();s?(this._textureUnits[n]=e+n,s._associatedChannel=e+n):this._textureUnits[n]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var o=0;o<r.length;o++)this._setTexture(this._textureUnits[o],r[o],!0)}},e.prototype._setAnisotropicLevel=function(e,t,r){var i=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(r=1),i&&t._cachedAnisotropicFilteringLevel!==r&&(this._setTextureParameterFloat(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=r)},e.prototype._setTextureParameterFloat=function(e,t,r,i){this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameterf(e,t,r)},e.prototype._setTextureParameterInteger=function(e,t,r,i){i&&this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameteri(e,t,r)},e.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e)}else{e=0;for(var t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)}},e.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},e.prototype.dispose=function(){var e;this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),null===(e=this.releaseComputeEffects)||void 0===e||e.call(this),this.unbindAllAttributes(),this._boundUniforms=[],f.M.IsWindowObjectExist()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),window.removeEventListener("resize",this._checkForMobile)),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,s.Q.ResetCache();for(var t=0,r=this._activeRequests;t<r.length;t++)r[t].abort();this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},e.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},e.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},e.prototype.getError=function(){return this._gl.getError()},e.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)},e.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)},e.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var r=!0,i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);var s=t.checkFramebufferStatus(t.FRAMEBUFFER);if((r=(r=r&&s===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),r=r&&t.getError()===t.NO_ERROR),r){t.bindFramebuffer(t.FRAMEBUFFER,null);var o=t.RGBA,a=t.UNSIGNED_BYTE,u=new Uint8Array(4);t.readPixels(0,0,1,1,o,a,u),r=r&&t.getError()===t.NO_ERROR}for(t.deleteTexture(i),t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null);!r&&t.getError()!==t.NO_ERROR;);return r},e.prototype._getWebGLTextureType=function(e){if(1===this._webGLVersion){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},e.prototype._getInternalFormat=function(e,t){void 0===t&&(t=!1);var r=t?this._gl.SRGB8_ALPHA8:this._gl.RGBA;switch(e){case 0:r=this._gl.ALPHA;break;case 1:r=this._gl.LUMINANCE;break;case 2:r=this._gl.LUMINANCE_ALPHA;break;case 6:r=this._gl.RED;break;case 7:r=this._gl.RG;break;case 4:r=t?this._gl.SRGB:this._gl.RGB;break;case 5:r=t?this._gl.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(e){case 8:r=this._gl.RED_INTEGER;break;case 9:r=this._gl.RG_INTEGER;break;case 10:r=this._gl.RGB_INTEGER;break;case 11:r=this._gl.RGBA_INTEGER}return r},e.prototype._getRGBABufferInternalSizedFormat=function(e,t,r){if(void 0===r&&(r=!1),1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return r?this._gl.SRGB:this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return r?this._gl.SRGB8:this._gl.RGB8;case 5:return r?this._gl.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;case 11:default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;case 11:default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;case 11:default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;case 11:default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;case 5:default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;case 5:default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return r?this._gl.SRGB8_ALPHA8:this._gl.RGBA8},e.prototype._getRGBAMultiSampleBufferFormat=function(e){return 1===e?this._gl.RGBA32F:2===e?this._gl.RGBA16F:this._gl.RGBA8},e.prototype._loadFile=function(t,r,i,n,s,o){var a=this,u=e._FileToolsLoadFile(t,r,i,n,s,o);return this._activeRequests.push(u),u.onCompleteObservable.add((function(e){a._activeRequests.splice(a._activeRequests.indexOf(e),1)})),u},e._FileToolsLoadFile=function(e,t,r,i,n,s){throw o.f.WarnImport("FileTools")},e.prototype.readPixels=function(e,t,r,i,n,s){void 0===n&&(n=!0),void 0===s&&(s=!0);var o=n?4:3,a=n?this._gl.RGBA:this._gl.RGB,u=new Uint8Array(i*r*o);return s&&this.flushFramebuffer(),this._gl.readPixels(e,t,r,i,a,this._gl.UNSIGNED_BYTE,u),Promise.resolve(u)},Object.defineProperty(e,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),e.isSupported=function(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{var e=this._createCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=null!=t&&!!window.WebGLRenderingContext}catch(e){this._IsSupported=!1}return this._IsSupported},Object.defineProperty(e,"HasMajorPerformanceCaveat",{get:function(){if(null===this._HasMajorPerformanceCaveat)try{var e=this._createCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch(e){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),e.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},e.FloorPOT=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)},e.NearestPOT=function(t){var r=e.CeilingPOT(t),i=e.FloorPOT(t);return r-t>t-i?i:r},e.GetExponentOfTwo=function(t,r,i){var n;switch(void 0===i&&(i=2),i){case 1:n=e.FloorPOT(t);break;case 2:n=e.NearestPOT(t);break;case 3:default:n=e.CeilingPOT(t)}return Math.min(n,r)},e.QueueNewFrame=function(e,t){return f.M.IsWindowObjectExist()?(t||(t=window),t.requestPostAnimationFrame?t.requestPostAnimationFrame(e):t.requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16)):"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,16)},e.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:document},e.prototype.getFontOffset=function(e){var t=document.createElement("span");t.innerHTML="Hg",t.setAttribute("style","font: "+e+" !important");var r=document.createElement("div");r.style.display="inline-block",r.style.width="1px",r.style.height="0px",r.style.verticalAlign="bottom";var i=document.createElement("div");i.style.whiteSpace="nowrap",i.appendChild(t),i.appendChild(r),document.body.appendChild(i);var n=0,s=0;try{s=r.getBoundingClientRect().top-t.getBoundingClientRect().top,r.style.verticalAlign="baseline",n=r.getBoundingClientRect().top-t.getBoundingClientRect().top}finally{document.body.removeChild(i)}return{ascent:n,height:s,descent:s-n}},e.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],e._TextureLoaders=[],e.CollisionsEpsilon=.001,e._IsSupported=null,e._HasMajorPerformanceCaveat=null,e}()},8483:(e,t,r)=>{"use strict";r.d(t,{f:()=>te});var i=r(3940),n=r(4462),s=r(5511),o=r(8701),a=r(6940),u=r(6599),h=r(5589),c=r(5573),l=r(798),p=r(9104),f={bool:1,int:1,float:1,vec2:2,ivec2:2,vec3:3,ivec3:3,vec4:4,ivec4:4,mat2:4,mat3:12,mat4:16},d=function(){function e(e,t){this._name="unnamed",this.shaderProcessingContext=e,this.leftOverUniformsByName={},this.engine=t}return Object.defineProperty(e.prototype,"isAsync",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return!!this.stages},enumerable:!1,configurable:!0}),e.prototype._handlesSpectorRebuildCallback=function(e){},e.prototype._fillEffectInformation=function(e,t,r,i,n,s,o,a){var u=this.engine;e._fragmentSourceCode="",e._vertexSourceCode="";var h,c=this.shaderProcessingContext.availableSamplers;for(h=0;h<n.length;h++){var l=n[h],p=c[n[h]];null==p||null==p?(n.splice(h,1),h--):s[l]=h}for(var f=0,d=u.getAttributes(this,o);f<d.length;f++){var _=d[f];a.push(_)}this.buildUniformLayout();var g=[],m=[];for(h=0;h<o.length;h++){var y=a[h];y>=0&&(g.push(o[h]),m.push(y))}this.shaderProcessingContext.attributeNamesFromEffect=g,this.shaderProcessingContext.attributeLocationsFromEffect=m},e.prototype.buildUniformLayout=function(){if(this.shaderProcessingContext.leftOverUniforms.length){this.uniformBuffer=new p.M(this.engine,void 0,void 0,"leftOver-"+this._name);for(var e=0,t=this.shaderProcessingContext.leftOverUniforms;e<t.length;e++){var r=t[e],i=f[r.type];this.uniformBuffer.addUniform(r.name,i,r.length),this.leftOverUniformsByName[r.name]=r.type}this.uniformBuffer.create()}},e.prototype.dispose=function(){this.uniformBuffer&&this.uniformBuffer.dispose()},e.prototype.setInt=function(e,t){this.uniformBuffer&&this.leftOverUniformsByName[e]&&this.uniformBuffer.updateInt(e,t)},e.prototype.setInt2=function(e,t,r){this.uniformBuffer&&this.leftOverUniformsByName[e]&&this.uniformBuffer.updateInt2(e,t,r)},e.prototype.setInt3=function(e,t,r,i){this.uniformBuffer&&this.leftOverUniformsByName[e]&&this.uniformBuffer.updateInt3(e,t,r,i)},e.prototype.setInt4=function(e,t,r,i,n){this.uniformBuffer&&this.leftOverUniformsByName[e]&&this.uniformBuffer.updateInt4(e,t,r,i,n)},e.prototype.setIntArray=function(e,t){this.uniformBuffer&&this.leftOverUniformsByName[e]&&this.uniformBuffer.updateIntArray(e,t)},e.prototype.setIntArray2=function(e,t){this.setIntArray(e,t)},e.prototype.setIntArray3=function(e,t){this.setIntArray(e,t)},e.prototype.setIntArray4=function(e,t){this.setIntArray(e,t)},e.prototype.setArray=function(e,t){this.uniformBuffer&&this.leftOverUniformsByName[e]&&this.uniformBuffer.updateArray(e,t)},e.prototype.setArray2=function(e,t){this.setArray(e,t)},e.prototype.setArray3=function(e,t){this.setArray(e,t)},e.prototype.setArray4=function(e,t){this.setArray(e,t)},e.prototype.setMatrices=function(e,t){this.uniformBuffer&&this.leftOverUniformsByName[e]&&this.uniformBuffer.updateMatrices(e,t)},e.prototype.setMatrix=function(e,t){this.uniformBuffer&&this.leftOverUniformsByName[e]&&this.uniformBuffer.updateMatrix(e,t)},e.prototype.setMatrix3x3=function(e,t){this.uniformBuffer&&this.leftOverUniformsByName[e]&&this.uniformBuffer.updateMatrix3x3(e,t)},e.prototype.setMatrix2x2=function(e,t){this.uniformBuffer&&this.leftOverUniformsByName[e]&&this.uniformBuffer.updateMatrix2x2(e,t)},e.prototype.setFloat=function(e,t){this.uniformBuffer&&this.leftOverUniformsByName[e]&&this.uniformBuffer.updateFloat(e,t)},e.prototype.setVector2=function(e,t){this.setFloat2(e,t.x,t.y)},e.prototype.setFloat2=function(e,t,r){this.uniformBuffer&&this.leftOverUniformsByName[e]&&this.uniformBuffer.updateFloat2(e,t,r)},e.prototype.setVector3=function(e,t){this.setFloat3(e,t.x,t.y,t.z)},e.prototype.setFloat3=function(e,t,r,i){this.uniformBuffer&&this.leftOverUniformsByName[e]&&this.uniformBuffer.updateFloat3(e,t,r,i)},e.prototype.setVector4=function(e,t){this.setFloat4(e,t.x,t.y,t.z,t.w)},e.prototype.setFloat4=function(e,t,r,i,n){this.uniformBuffer&&this.leftOverUniformsByName[e]&&this.uniformBuffer.updateFloat4(e,t,r,i,n)},e.prototype.setColor3=function(e,t){this.setFloat3(e,t.r,t.g,t.b)},e.prototype.setColor4=function(e,t,r){this.setFloat4(e,t.r,t.g,t.b,r)},e.prototype.setDirectColor4=function(e,t){this.setFloat4(e,t.r,t.g,t.b,t.a)},e.prototype._getVertexShaderCode=function(){var e;return null===(e=this.sources)||void 0===e?void 0:e.vertex},e.prototype._getFragmentShaderCode=function(){var e;return null===(e=this.sources)||void 0===e?void 0:e.fragment},e}(),_={Scene:{setIndex:0,bindingIndex:0},Light0:{setIndex:0,bindingIndex:5},Light1:{setIndex:0,bindingIndex:6},Light2:{setIndex:0,bindingIndex:7},Light3:{setIndex:0,bindingIndex:8},Light4:{setIndex:0,bindingIndex:9},Light5:{setIndex:0,bindingIndex:10},Light6:{setIndex:0,bindingIndex:11},Light7:{setIndex:0,bindingIndex:12},Light8:{setIndex:0,bindingIndex:13},Material:{setIndex:1,bindingIndex:0},Mesh:{setIndex:1,bindingIndex:1}},g={environmentBrdfSampler:{sampler:{setIndex:0,bindingIndex:1},isTextureArray:!1,textures:[{setIndex:0,bindingIndex:2}]}},m={sampler2D:"sampler2D",sampler2DArray:"sampler2DArray",sampler2DShadow:"sampler2DShadow",sampler2DArrayShadow:"sampler2DArrayShadow",samplerCube:"samplerCube",sampler3D:"sampler3D"},y={sampler2D:"texture2D",sampler2DArray:"texture2DArray",sampler2DShadow:"texture2D",sampler2DArrayShadow:"texture2DArray",samplerCube:"textureCube",samplerCubeArray:"textureCubeArray",sampler3D:"texture3D"},v={textureCube:c.p_.Cube,textureCubeArray:c.p_.CubeArray,texture2D:c.p_.E2d,texture2DArray:c.p_.E2dArray,texture3D:c.p_.E3d},b={sampler2DShadow:"samplerShadow",sampler2DArrayShadow:"samplerShadow"},x={samplerShadow:!0,samplerArrayShadow:!0,sampler:!1},R=function(){function e(){this._missingVaryings=[],this._textureArrayProcessing=[]}return e.prototype._getArraySize=function(e,t){var r=0,i=e.indexOf("["),n=e.indexOf("]");if(i>0&&n>0){var s=e.substring(i+1,n);r=+s,isNaN(r)&&(r=+t[s.trim()]),e=e.substr(0,i)}return[e,r]},e.prototype.initializeShaders=function(e){this._missingVaryings.length=0,this._textureArrayProcessing.length=0},e.prototype.varyingProcessor=function(e,t,r,i){this._preProcessors=r;var s=i,o=new RegExp(/\s*varying\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm).exec(e);if(null!=o){var a,u=o[1],h=o[2];t?(a=s.availableVaryings[h],this._missingVaryings[a]="",void 0===a&&n.Y.Warn('Invalid fragment shader: The varying named "'+h+'" is not declared in the vertex shader! This declaration will be ignored.')):(a=s.getVaryingNextLocation(u,this._getArraySize(h,r)[1]),s.availableVaryings[h]=a,this._missingVaryings[a]="layout(location = "+a+") in "+u+" "+h+";"),e=e.replace(o[0],void 0===a?"":"layout(location = "+a+") "+(t?"in":"out")+" "+u+" "+h+";")}return e},e.prototype.attributeProcessor=function(e,t,r){this._preProcessors=t;var i=r,n=new RegExp(/\s*attribute\s+(\S+)\s+(\S+)\s*;/gm).exec(e);if(null!=n){var s=n[1],o=n[2],a=i.getAttributeNextLocation(s,this._getArraySize(o,t)[1]);i.availableAttributes[o]=a,i.orderedAttributes[a]=o,e=e.replace(n[0],"layout(location = "+a+") in "+s+" "+o+";")}return e},e.prototype.uniformProcessor=function(e,t,r,i){var n,s,o;this._preProcessors=r;var a=i,u=new RegExp(/\s*uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/gm).exec(e);if(null!=u){var h=u[1],l=u[2];if(0===h.indexOf("sampler")||1===h.indexOf("sampler")){var p=g[l],f=0;if(!p)if(l=(n=this._getArraySize(l,r))[0],f=n[1],p=a.availableSamplers[l])f=p.isTextureArray?p.textures.length:0;else{p={sampler:a.getNextFreeUBOBinding(),isTextureArray:f>0,textures:[]};for(var d=0;d<(f||1);++d)p.textures.push(a.getNextFreeUBOBinding())}var _="u"===h.charAt(0)?"u":"i"===h.charAt(0)?"i":"";_&&(h=h.substr(1));var R=f>0,T=p.sampler.setIndex,E=p.sampler.bindingIndex,S=m[h],C=null!==(o=b[h])&&void 0!==o?o:"sampler",A=y[h],F=v[A],P=!!x[C];if(R){var w=[];for(w.push("layout(set = "+T+", binding = "+E+") uniform "+_+C+" "+l+"Sampler;"),e="\r\n",d=0;d<f;++d){var B=p.textures[d].setIndex,M=p.textures[d].bindingIndex;w.push("layout(set = "+B+", binding = "+M+") uniform "+A+" "+l+"Texture"+d+";"),e+=(d>0?"\r\n":"")+"#define "+l+d+" "+_+S+"("+l+"Texture"+d+", "+l+"Sampler)"}e=w.join("\r\n")+e,this._textureArrayProcessing.push(l)}else f=1,e="layout(set = "+T+", binding = "+E+") uniform "+_+C+" "+l+"Sampler;\n                        layout(set = "+p.textures[0].setIndex+", binding = "+p.textures[0].bindingIndex+") uniform "+A+" "+l+"Texture;\n                        #define "+l+" "+_+S+"("+l+"Texture, "+l+"Sampler)";a.availableSamplers[l]=p;var O=P?c.dV.Comparison:c.dV.Filtering;for(a.orderedUBOsAndSamplers[T]||(a.orderedUBOsAndSamplers[T]=[]),a.orderedUBOsAndSamplers[T][E]||(a.orderedUBOsAndSamplers[T][E]={isSampler:!0,isTexture:!1,samplerBindingType:O,usedInVertex:!1,usedInFragment:!1,name:l}),t?a.orderedUBOsAndSamplers[T][E].usedInFragment=!0:a.orderedUBOsAndSamplers[T][E].usedInVertex=!0,d=0;d<f;++d){if(B=p.textures[d].setIndex,M=p.textures[d].bindingIndex,a.orderedUBOsAndSamplers[B]||(a.orderedUBOsAndSamplers[B]=[]),!a.orderedUBOsAndSamplers[B][M]){var I=P?c.oD.Depth:"u"===_?c.oD.Uint:"i"===_?c.oD.Sint:c.oD.Float;a.orderedUBOsAndSamplers[B][M]={isSampler:!1,isTexture:!0,sampleType:I,textureDimension:F,usedInVertex:!1,usedInFragment:!1,name:R?l+d.toString():l,origName:l}}t?a.orderedUBOsAndSamplers[B][M].usedInFragment=!0:a.orderedUBOsAndSamplers[B][M].usedInVertex=!0}}else{var D;for(l=(s=this._getArraySize(l,r))[0],D=s[1],d=0;d<a.leftOverUniforms.length;d++)if(a.leftOverUniforms[d].name===l)return"";a.leftOverUniforms.push({name:l,type:h,length:D}),e=""}}return e},e.prototype.uniformBufferProcessor=function(e,t,r){var i=r,n=new RegExp(/uniform\s+(\w+)/gm).exec(e);if(null!=n){var s=n[1],o=void 0,a=void 0,u=_[s];if(u)o=u.setIndex,a=u.bindingIndex;else if(t){var h=i.availableUBOs[s];h?(o=h.setIndex,a=h.bindingIndex):(o=(c=i.getNextFreeUBOBinding()).setIndex,a=c.bindingIndex)}else{var c;o=(c=i.getNextFreeUBOBinding()).setIndex,a=c.bindingIndex}i.availableUBOs[s]={setIndex:o,bindingIndex:a},i.orderedUBOsAndSamplers[o]||(i.orderedUBOsAndSamplers[o]=[]),i.orderedUBOsAndSamplers[o][a]||(i.orderedUBOsAndSamplers[o][a]={isSampler:!1,isTexture:!1,name:s,usedInVertex:!1,usedInFragment:!1}),t?i.orderedUBOsAndSamplers[o][a].usedInFragment=!0:i.orderedUBOsAndSamplers[o][a].usedInVertex=!0,e=e.replace("uniform","layout(set = "+o+", binding = "+a+") uniform")}return e},e.prototype.postProcessor=function(e,t,r,i,n){var s=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),r)e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(s?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(");else if(e=(e=e.replace(/gl_InstanceID/g,"gl_InstanceIndex")).replace(/gl_VertexID/g,"gl_VertexIndex"),-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;if(!r){var o=e.lastIndexOf("}");e=e.substring(0,o),e+="gl_Position.y *= -1.;\n",n.isNDCHalfZRange||(e+="gl_Position.z = (gl_Position.z + gl_Position.w) / 2.0;\n"),e+="}"}return e},e.prototype._applyTextureArrayProcessing=function(e,t){for(var r=new RegExp(t+"\\s*\\[(.+)?\\]","gm"),i=r.exec(e);null!=i;){var n=i[1],s=+n;this._preProcessors&&isNaN(s)&&(s=+this._preProcessors[n.trim()]),e=e.replace(i[0],t+s),i=r.exec(e)}return e},e.prototype.finalizeShaders=function(e,t,r){for(var i=r,n=0;n<this._textureArrayProcessing.length;++n){var s=this._textureArrayProcessing[n];e=this._applyTextureArrayProcessing(e,s),t=this._applyTextureArrayProcessing(t,s)}for(n=0;n<this._missingVaryings.length;++n){var o=this._missingVaryings[n];o&&o.length>0&&(t=o+"\n"+t)}if(i.leftOverUniforms.length){var a="LeftOver",u=i.availableUBOs[a];u||(u=i.getNextFreeUBOBinding(),i.availableUBOs[a]=u,i.orderedUBOsAndSamplers[u.setIndex]||(i.orderedUBOsAndSamplers[u.setIndex]=[]),i.orderedUBOsAndSamplers[u.setIndex][u.bindingIndex]={isSampler:!1,isTexture:!1,usedInVertex:!0,usedInFragment:!0,name:a});for(var h="layout(set = "+u.setIndex+", binding = "+u.bindingIndex+") uniform "+a+" {\n    ",c=0,l=i.leftOverUniforms;c<l.length;c++){var p=l[c];p.length>0?h+="    "+p.type+" "+p.name+"["+p.length+"];\n":h+="    "+p.type+" "+p.name+";\n"}e=(h+="};\n\n")+e,t=h+t}for(i.samplerNames=[],n=0;n<i.orderedUBOsAndSamplers.length;n++){var f=i.orderedUBOsAndSamplers[n];if(void 0!==f)for(var d=0;d<f.length;d++){var _=i.orderedUBOsAndSamplers[n][d];_&&(_.isTexture&&i.samplerNames.push(_.name),_.isSampler||_.isTexture||i.uniformBufferNames.push(_.name))}}return this._preProcessors=null,{vertexCode:e,fragmentCode:t}},e}(),T={mat2:2,mat3:3,mat4:4},E=function(){function e(){this._attributeNextLocation=0,this._varyingNextLocation=0,this.freeSetIndex=2,this.freeBindingIndex=0,this.availableVaryings={},this.availableAttributes={},this.availableUBOs={},this.availableSamplers={},this.orderedAttributes=[],this.orderedUBOsAndSamplers=[],this.uniformBufferNames=[],this.leftOverUniforms=[]}return e.prototype.getAttributeNextLocation=function(e,t){var r;void 0===t&&(t=0);var i=this._attributeNextLocation;return this._attributeNextLocation+=(null!==(r=T[e])&&void 0!==r?r:1)*(t||1),i},e.prototype.getVaryingNextLocation=function(e,t){var r;void 0===t&&(t=0);var i=this._varyingNextLocation;return this._varyingNextLocation+=(null!==(r=T[e])&&void 0!==r?r:1)*(t||1),i},e.prototype.getNextFreeUBOBinding=function(){return this._getNextFreeBinding(1)},e.prototype._getNextFreeBinding=function(e){if(this.freeBindingIndex>16-e&&(this.freeSetIndex++,this.freeBindingIndex=0),4===this.freeSetIndex)throw"Too many textures or UBOs have been declared and it is not supported in WebGPU.";var t={setIndex:this.freeSetIndex,bindingIndex:this.freeBindingIndex};return this.freeBindingIndex+=e,t},e}(),S=r(2281),C=r(9753),A=r(9838),F=r(714),P=r(1457),w=function(){function e(e){this._deferredReleaseBuffers=[],this._device=e}return e._IsGPUBuffer=function(e){return void 0===e.underlyingResource},e.prototype.createRawBuffer=function(e,t,r){void 0===r&&(r=!1);var i={mappedAtCreation:r,size:void 0!==e.byteLength?e.byteLength+3&-4:e+3&-4,usage:t};return this._device.createBuffer(i)},e.prototype.createBuffer=function(e,t){var r=void 0!==e.byteLength,i=this.createRawBuffer(e,t),n=new A.C(i);return n.references=1,n.capacity=r?e.byteLength:e,r&&this.setSubData(n,0,e),n},e.prototype.setSubData=function(e,t,r,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var s=e.underlyingResource;n=n||r.byteLength,n=Math.min(n,e.capacity-t);var o=r.byteOffset+i,a=o+n,u=n+3&-4;if(u!==n){var h=new Uint8Array(r.buffer.slice(o,a));(r=new Uint8Array(u)).set(h),i=0,o=0,a=u,n=u}for(var c=15728640,l=0;a-(o+l)>c;)this._device.queue.writeBuffer(s,t+l,r.buffer,o+l,c),l+=c;this._device.queue.writeBuffer(s,t+l,r.buffer,o+l,n-l)},e.prototype._GetHalfFloatAsFloatRGBAArrayBuffer=function(e,t,r){r||(r=new Float32Array(e));for(var i=new Uint16Array(t);e--;)r[e]=F.O.FromHalfFloat(i[e]);return r},e.prototype.readDataFromBuffer=function(e,t,r,i,n,s,o,a,u,h,l){var p=this;void 0===o&&(o=0),void 0===a&&(a=0),void 0===u&&(u=null),void 0===h&&(h=!0),void 0===l&&(l=!1);var f=1===o?2:2===o?1:0;return new Promise((function(r,d){e.mapAsync(c.gc.Read,a,t).then((function(){var c=e.getMappedRange(a,t),d=u;if(l)d=null===d?(0,P.A)(o,t,!0,c):(0,P.A)(o,d.buffer,void 0,c);else if(null===d)switch(f){case 0:(d=new Uint8Array(t)).set(new Uint8Array(c));break;case 1:d=p._GetHalfFloatAsFloatRGBAArrayBuffer(t/2,c);break;case 2:(d=new Float32Array(t/4)).set(new Float32Array(c))}else switch(f){case 0:(d=new Uint8Array(d.buffer)).set(new Uint8Array(c));break;case 1:d=p._GetHalfFloatAsFloatRGBAArrayBuffer(t/2,c,u);break;case 2:(d=new Float32Array(d.buffer)).set(new Float32Array(c))}if(n!==s){1!==f||l||(n*=2,s*=2);for(var _=new Uint8Array(d.buffer),g=n,m=0,y=1;y<i;++y){m=y*s;for(var v=0;v<n;++v)_[g++]=_[m++]}d=0===f||l?new Uint8Array(_.buffer,0,g):new Float32Array(_.buffer,0,g/4)}e.unmap(),h&&p.releaseBuffer(e),r(d)}),(function(e){return d(e)}))}))},e.prototype.releaseBuffer=function(t){return e._IsGPUBuffer(t)?(this._deferredReleaseBuffers.push(t),!0):(t.references--,0===t.references&&(this._deferredReleaseBuffers.push(t.underlyingResource),!0))},e.prototype.destroyDeferredBuffers=function(){for(var e=0;e<this._deferredReleaseBuffers.length;++e)this._deferredReleaseBuffers[e].destroy();this._deferredReleaseBuffers.length=0},e}(),B=r(1838),M=function(){function e(){this.colorAttachmentGPUTextures=[],this.reset()}return e.prototype.reset=function(e){void 0===e&&(e=!1),this.renderPass=null,e&&(this.renderPassDescriptor=null,this.colorAttachmentViewDescriptor=null,this.depthAttachmentViewDescriptor=null,this.colorAttachmentGPUTextures=[],this.depthTextureFormat=void 0)},e}(),O=r(906),I=r(2496),D=function(e){function t(t){var r=e.call(this,!1)||this;return r._cache=t,r.reset(),r}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"func",{get:function(){return this._func},set:function(e){this._func!==e&&(this._func=e,this._cache.setStencilCompare(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"funcMask",{get:function(){return this._funcMask},set:function(e){this._funcMask!==e&&(this._funcMask=e,this._cache.setStencilReadMask(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opStencilFail",{get:function(){return this._opStencilFail},set:function(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._cache.setStencilFailOp(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opDepthFail",{get:function(){return this._opDepthFail},set:function(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._cache.setStencilDepthFailOp(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"opStencilDepthPass",{get:function(){return this._opStencilDepthPass},set:function(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._cache.setStencilPassOp(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask!==e&&(this._mask=e,this._cache.setStencilWriteMask(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._cache.setStencilEnabled(e))},enumerable:!1,configurable:!0}),t.prototype.reset=function(){e.prototype.reset.call(this),this._cache.resetStencilState()},t.prototype.apply=function(e){var t,r=null===(t=this.stencilMaterial)||void 0===t?void 0:t.enabled;this.enabled=r?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.enabled&&(this.func=r?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=r?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=r?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=r?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=r?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=r?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=r?this.stencilMaterial.mask:this.stencilGlobal.mask)},t}(r(693).C),L=function(e){function t(t){var r=e.call(this,!1)||this;return r._cache=t,r.reset(),r}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0,this._cache.setDepthBiasSlopeScale(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0,this._cache.setCullFace(null!=e?e:1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0,this._cache.setCullEnabled(!!e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0,this._cache.setDepthCompare(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0,this._cache.setDepthWriteEnabled(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0,this._cache.setDepthTestEnabled(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0,this._cache.setFrontFace(null!=e?e:2))},enumerable:!1,configurable:!0}),t.prototype.reset=function(){e.prototype.reset.call(this),this._cache.resetDepthCullingState()},t.prototype.apply=function(e){},t}(r(2936).k),U=r(9666),N=function(){function e(t){this._cacheBindGroups=t,this.samplers={},this.textures={},this.uniqueId=e._Counter++}return e.prototype.setTexture=function(e,t){var r=this.textures[e];if(!r)return!1;var i=r.texture;return null===i||i!==t||r.wrapU===t._cachedWrapU&&r.wrapV===t._cachedWrapV&&r.wrapR===t._cachedWrapR&&r.anisotropicFilteringLevel===t._cachedAnisotropicFilteringLevel&&r.samplingMode===t.samplingMode||(r.wrapU=t._cachedWrapU,r.wrapV=t._cachedWrapV,r.wrapR=t._cachedWrapR,r.anisotropicFilteringLevel=t._cachedAnisotropicFilteringLevel,r.samplingMode=t.samplingMode,this._cacheBindGroups.clearTextureEntries(i.uniqueId)),r.texture=t,!0},e._Counter=0,e}(),G=function(){function e(){this.uniqueId=e._Counter++}return e._Counter=0,e}(),V=r(4286),z=function(){function e(e,t,r){this._bindGroups={},this._bundleCache={},this._device=e,this._engine=t,this._cacheRenderPipeline=new I.H(this._device,r,!t._caps.textureFloatLinearFiltering),this._cacheRenderPipeline.setDepthTestEnabled(!1),this._cacheRenderPipeline.setStencilReadMask(255),this._effect=t.createEffect("clearQuad",[],["color","depthValue"])}return e.prototype.setDepthStencilFormat=function(e){this._depthTextureFormat=e,this._cacheRenderPipeline.setDepthStencilFormat(e)},e.prototype.setColorFormat=function(e){this._cacheRenderPipeline.setColorFormat(e)},e.prototype.setMRTAttachments=function(e,t){this._cacheRenderPipeline.setMRTAttachments(e,t)},e.prototype.clear=function(e,t,r,i,n){var s,o,a;void 0===n&&(n=1);var u=null,h=0;if(e)a=e;else{if(h=(t?t.r+256*t.g+256*t.b*256+256*t.a*256*256:0)+(r?Math.pow(2,32):0)+(i?Math.pow(2,33):0)+(this._engine.useReverseDepthBuffer?Math.pow(2,34):0)+n*Math.pow(2,35),u=this._bundleCache[h])return u;a=this._device.createRenderBundleEncoder({colorFormats:this._cacheRenderPipeline.colorFormats,depthStencilFormat:this._depthTextureFormat,sampleCount:n})}this._cacheRenderPipeline.setDepthWriteEnabled(!!r),this._cacheRenderPipeline.setStencilEnabled(!!i),this._cacheRenderPipeline.setStencilWriteMask(i?255:0),this._cacheRenderPipeline.setStencilCompare(i?519:512),this._cacheRenderPipeline.setStencilPassOp(i?7681:7680),this._cacheRenderPipeline.setWriteMask(t?15:0);var c=this._cacheRenderPipeline.getRenderPipeline(7,this._effect,n),l=this._effect._pipelineContext;t&&this._effect.setDirectColor4("color",t),this._effect.setFloat("depthValue",this._engine.useReverseDepthBuffer?this._engine._clearReverseDepthValue:this._engine._clearDepthValue),null===(s=l.uniformBuffer)||void 0===s||s.update();var p=null===(o=l.uniformBuffer)||void 0===o?void 0:o.getBuffer(),f=this._bindGroups[p.uniqueId];if(!f){var d=l.bindGroupLayouts;(f=this._bindGroups[p.uniqueId]=[]).push(this._device.createBindGroup({layout:d[0],entries:[]}),this._device.createBindGroup({layout:d[1],entries:[]}),this._device.createBindGroup({layout:d[2],entries:[{binding:0,resource:{buffer:p.underlyingResource,size:p.capacity}}]}))}a.setPipeline(c);for(var _=0;_<f.length;++_)a.setBindGroup(_,f[_]);return a.draw(4,1,0,0),e||(u=a.finish(),this._bundleCache[h]=u),u},e}(),k=function(){function e(e,t,r,i){this.x=Math.floor(e),this.y=Math.floor(t),this.w=Math.floor(r),this.h=Math.floor(i)}return e.prototype.run=function(e){e.setViewport(this.x,this.y,this.w,this.h,0,1)},e.prototype.clone=function(){return new e(this.x,this.y,this.w,this.h)},e}(),W=function(){function e(e,t,r,i){this.x=e,this.y=t,this.w=r,this.h=i}return e.prototype.run=function(e){e.setScissorRect(this.x,this.y,this.w,this.h)},e.prototype.clone=function(){return new e(this.x,this.y,this.w,this.h)},e}(),j=function(){function e(e){this.ref=e}return e.prototype.run=function(e){e.setStencilReference(this.ref)},e.prototype.clone=function(){return new e(this.ref)},e}(),H=function(){function e(e){this.color=e}return e.prototype.run=function(e){e.setBlendConstant(this.color)},e.prototype.clone=function(){return new e(this.color)},e}(),X=function(){function e(){this.bundles=[]}return e.prototype.run=function(e){e.executeBundles(this.bundles)},e.prototype.clone=function(){var t=new e;return t.bundles=this.bundles,t},e}(),q=function(){function e(e){this.numDrawCalls=0,this._device=e,this._list=new Array(10),this._listLength=0}return e.prototype.addBundle=function(e){if(!this._currentItemIsBundle){var t=new X;this._list[this._listLength++]=t,this._currentBundleList=t.bundles,this._currentItemIsBundle=!0}e&&this._currentBundleList.push(e)},e.prototype._finishBundle=function(){this._currentItemIsBundle&&this._bundleEncoder&&(this._currentBundleList.push(this._bundleEncoder.finish()),this._bundleEncoder=void 0,this._currentItemIsBundle=!1)},e.prototype.addItem=function(e){this._finishBundle(),this._list[this._listLength++]=e,this._currentItemIsBundle=!1},e.prototype.getBundleEncoder=function(e,t,r){return this._currentItemIsBundle||(this.addBundle(),this._bundleEncoder=this._device.createRenderBundleEncoder({colorFormats:e,depthStencilFormat:t,sampleCount:r})),this._bundleEncoder},e.prototype.close=function(){this._finishBundle()},e.prototype.run=function(e){this.close();for(var t=0;t<this._listLength;++t)this._list[t].run(e)},e.prototype.reset=function(){this._listLength=0,this._currentItemIsBundle=!1,this.numDrawCalls=0},e.prototype.clone=function(){this.close();var t=new e(this._device);t._list=new Array(this._listLength),t._listLength=this._listLength,t.numDrawCalls=this.numDrawCalls;for(var r=0;r<this._listLength;++r)t._list[r]=this._list[r].clone();return t},e}(),K=r(3221),Y=function(){function e(e,t,r,i,n){void 0===n&&(n=!0),this._dstBuffers=[],this._device=r,this._bufferManager=i,this._count=e,this._canUseMultipleBuffers=n,this._querySet=r.createQuerySet({type:t,count:e}),this._queryBuffer=i.createRawBuffer(8*e,c.FB.QueryResolve|c.FB.CopySrc),n||this._dstBuffers.push(this._bufferManager.createRawBuffer(8*this._count,c.FB.MapRead|c.FB.CopyDst))}return Object.defineProperty(e.prototype,"querySet",{get:function(){return this._querySet},enumerable:!1,configurable:!0}),e.prototype._getBuffer=function(e,t){if(!this._canUseMultipleBuffers&&0===this._dstBuffers.length)return null;var r,i=this._device.createCommandEncoder();return 0===this._dstBuffers.length?r=this._bufferManager.createRawBuffer(8*this._count,c.FB.MapRead|c.FB.CopyDst):(r=this._dstBuffers[this._dstBuffers.length-1],this._dstBuffers.length--),i.resolveQuerySet(this._querySet,e,t,this._queryBuffer,0),i.copyBufferToBuffer(this._queryBuffer,0,r,0,8*t),this._device.queue.submit([i.finish()]),r},e.prototype.readValues=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=1),(0,i.mG)(this,void 0,void 0,(function(){var r,n;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return null===(r=this._getBuffer(e,t))?[2,null]:[4,r.mapAsync(c.gc.Read)];case 1:return i.sent(),n=new BigUint64Array(r.getMappedRange()).slice(),r.unmap(),this._dstBuffers[this._dstBuffers.length]=r,[2,n]}}))}))},e.prototype.readValue=function(e){return void 0===e&&(e=0),(0,i.mG)(this,void 0,void 0,(function(){var t,r,n;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return null===(t=this._getBuffer(e,1))?[2,null]:[4,t.mapAsync(c.gc.Read)];case 1:return i.sent(),r=new BigUint64Array(t.getMappedRange()),n=Number(r[0]),t.unmap(),this._dstBuffers[this._dstBuffers.length]=t,[2,n]}}))}))},e.prototype.readTwoValuesAndSubtract=function(e){return void 0===e&&(e=0),(0,i.mG)(this,void 0,void 0,(function(){var t,r,n;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return null===(t=this._getBuffer(e,2))?[2,null]:[4,t.mapAsync(c.gc.Read)];case 1:return i.sent(),r=new BigUint64Array(t.getMappedRange()),n=Number(r[1]-r[0]),t.unmap(),this._dstBuffers[this._dstBuffers.length]=t,[2,n]}}))}))},e.prototype.dispose=function(){this._querySet.destroy(),this._bufferManager.releaseBuffer(this._queryBuffer);for(var e=0;e<this._dstBuffers.length;++e)this._bufferManager.releaseBuffer(this._dstBuffers[e])},e}(),Q=function(){function e(e,t){this._enabled=!1,this._gpuFrameTimeCounter=new K.z,this._measureDurationState=0,this._device=e,this._bufferManager=t}return Object.defineProperty(e.prototype,"gpuFrameTimeCounter",{get:function(){return this._gpuFrameTimeCounter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enable",{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._measureDurationState=0,e?this._measureDuration=new Z(this._device,this._bufferManager):this._measureDuration.dispose())},enumerable:!1,configurable:!0}),e.prototype.startFrame=function(e){this._enabled&&0===this._measureDurationState&&(this._measureDuration.start(e),this._measureDurationState=1)},e.prototype.endFrame=function(e){var t=this;1===this._measureDurationState&&(this._measureDurationState=2,this._measureDuration.stop(e).then((function(e){null!==e&&e>=0&&(t._gpuFrameTimeCounter.fetchNewFrame(),t._gpuFrameTimeCounter.addCount(e,!0)),t._measureDurationState=0})))},e}(),Z=function(){function e(e,t){this._querySet=new Y(2,c.xL.Timestamp,e,t)}return e.prototype.start=function(e){e.writeTimestamp(this._querySet.querySet,0)},e.prototype.stop=function(e){return(0,i.mG)(this,void 0,void 0,(function(){return(0,i.Jh)(this,(function(t){return e.writeTimestamp(this._querySet.querySet,1),[2,this._querySet.readTwoValuesAndSubtract(0)]}))}))},e.prototype.dispose=function(){this._querySet.dispose()},e}(),$=function(){function e(e,t,r,i,n){void 0===i&&(i=50),void 0===n&&(n=100),this._availableIndices=[],this._engine=e,this._device=t,this._bufferManager=r,this._frameLastBuffer=-1,this._currentTotalIndices=0,this._countIncrement=n,this._allocateNewIndices(i)}return Object.defineProperty(e.prototype,"querySet",{get:function(){return this._querySet.querySet},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasQueries",{get:function(){return this._currentTotalIndices!==this._availableIndices.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canBeginQuery",{get:function(){switch(this._engine._getCurrentRenderPassIndex()){case 0:return void 0!==this._engine._mainRenderPassWrapper.renderPassDescriptor.occlusionQuerySet;case 1:return void 0!==this._engine._rttRenderPassWrapper.renderPassDescriptor.occlusionQuerySet}return!1},enumerable:!1,configurable:!0}),e.prototype.createQuery=function(){0===this._availableIndices.length&&this._allocateNewIndices();var e=this._availableIndices[this._availableIndices.length-1];return this._availableIndices.length--,e},e.prototype.deleteQuery=function(e){this._availableIndices[this._availableIndices.length-1]=e},e.prototype.isQueryResultAvailable=function(e){return this._retrieveQueryBuffer(),!!this._lastBuffer&&e<this._lastBuffer.length},e.prototype.getQueryResult=function(e){var t,r;return Number(null!==(r=null===(t=this._lastBuffer)||void 0===t?void 0:t[e])&&void 0!==r?r:-1)},e.prototype._retrieveQueryBuffer=function(){var e=this;this._lastBuffer&&this._frameLastBuffer===this._engine.frameId||this._frameLastBuffer!==this._engine.frameId&&(this._frameLastBuffer=this._engine.frameId,this._querySet.readValues(0,this._currentTotalIndices).then((function(t){e._lastBuffer=t})))},e.prototype._allocateNewIndices=function(e){e=null!=e?e:this._countIncrement,this._delayQuerySetDispose();for(var t=0;t<e;++t)this._availableIndices.push(this._currentTotalIndices+t);this._currentTotalIndices+=e,this._querySet=new Y(this._currentTotalIndices,c.xL.Occlusion,this._device,this._bufferManager,!1)},e.prototype._delayQuerySetDispose=function(){var e=this._querySet;e&&setTimeout((function(){return e.dispose}),1e3)},e.prototype.dispose=function(){var e;null===(e=this._querySet)||void 0===e||e.dispose(),this._availableIndices=[]},e}(),J=r(8131),ee=r(4549);h.Q.ShadersStore.clearQuadVertexShader="uniform float depthValue;\nconst vec2 pos[4]={\nvec2(-1.0,1.0),\nvec2(1.0,1.0),\nvec2(-1.0,-1.0),\nvec2(1.0,-1.0)\n};\nvoid main(void) {\ngl_Position=vec4(pos[gl_VertexID],depthValue,1.0);\n}\n";h.Q.ShadersStore.clearQuadPixelShader="uniform vec4 color;\nvoid main() {\ngl_FragColor=color;\n}\n";var te=function(e){function t(t,r){var i,o,u,h;void 0===r&&(r={});var l=e.call(this,null)||this;if(l._uploadEncoderDescriptor={label:"upload"},l._renderEncoderDescriptor={label:"render"},l._renderTargetEncoderDescriptor={label:"renderTarget"},l._clearDepthValue=1,l._clearReverseDepthValue=0,l._clearStencilValue=0,l._defaultSampleCount=4,l._glslang=null,l._compiledComputeEffects={},l._counters={numEnableEffects:0,numEnableDrawWrapper:0},l.countersLastFrame={numEnableEffects:0,numEnableDrawWrapper:0},l.numMaxUncapturedErrors=20,l._commandBuffers=[null,null,null],l._currentRenderPass=null,l._mainRenderPassWrapper=new M,l._mainRenderPassCopyWrapper=new M,l._rttRenderPassWrapper=new M,l._pendingDebugCommands=[],l._onAfterUnbindFrameBufferObservable=new J.y$,l._currentOverrideVertexBuffers=null,l._currentIndexBuffer=null,l.__colorWrite=!0,l._uniformsBuffers={},l._forceEnableEffect=!1,l.dbgShowShaderCode=!1,l.dbgSanityChecks=!0,l.dbgVerboseLogsForFirstFrames=!1,l.dbgVerboseLogsNumFrames=10,l.dbgLogIfNotDrawWrapper=!0,l.dbgShowEmptyEnableEffectCalls=!0,l._snapshotRenderingRecordBundles=!1,l._snapshotRenderingPlayBundles=!1,l._snapshotRenderingMainPassBundleList=[],l.compatibilityMode=!0,l._viewportsCurrent=[{x:0,y:0,w:0,h:0},{x:0,y:0,w:0,h:0}],l._scissorsCurrent=[{x:0,y:0,w:0,h:0},{x:0,y:0,w:0,h:0}],l._scissorCached={x:0,y:0,z:0,w:0},l._stencilRefsCurrent=[-1,-1],l._blendColorsCurrent=[[null,null,null,null],[null,null,null,null]],l.isNDCHalfZRange=!0,r.deviceDescriptor=r.deviceDescriptor||{},r.swapChainFormat=r.swapChainFormat||c.EV.BGRA8Unorm,r.antialiasing=void 0===r.antialiasing||r.antialiasing,r.stencil=null===(i=r.stencil)||void 0===i||i,r.enableGPUDebugMarkers=null!==(o=r.enableGPUDebugMarkers)&&void 0!==o&&o,n.Y.Log("Babylon.js v"+a.D.Version+" - "+l.description+" engine"),!navigator.gpu)return n.Y.Error("WebGPU is not supported by your browser."),l;l._isWebGPU=!0,l._shaderPlatformName="WEBGPU",void 0===r.deterministicLockstep&&(r.deterministicLockstep=!1),void 0===r.lockstepMaxSteps&&(r.lockstepMaxSteps=4),void 0===r.audioEngine&&(r.audioEngine=!0),l._deterministicLockstep=r.deterministicLockstep,l._lockstepMaxSteps=r.lockstepMaxSteps,l._timeStep=r.timeStep||1/60,l._doNotHandleContextLost=!!r.doNotHandleContextLost,l._canvas=t,l._options=r,l.premultipliedAlpha=null===(u=r.premultipliedAlpha)||void 0===u||u;var p=s.M.IsWindowObjectExist()&&window.devicePixelRatio||1,f=r.limitDeviceRatio||p,d=null!==(h=r.adaptToDeviceRatio)&&void 0!==h&&h;return l._hardwareScalingLevel=d?1/Math.min(f,p):1,l._mainPassSampleCount=r.antialiasing?l._defaultSampleCount:1,l._isStencilEnable=r.stencil,l._sharedInit(t,!!r.doNotHandleTouchAction,r.audioEngine),l._shaderProcessor=l._getShaderProcessor(),l._invertYFinalFramebuffer=!(!l._options.forceCopyForInvertYFinalFramebuffer&&l._canvas.style||l._options.disableCopyForInvertYFinalFramebuffer),l._invertYFinalFramebuffer||l._canvas.style&&(l._canvas.style.transform="scaleY(-1)"),l}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"snapshotRenderingMode",{get:function(){return this._snapshotRenderingMode},set:function(e){this._snapshotRenderingRecordBundles?this._snapshotRenderingModeSaved=e:this._snapshotRenderingMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"snapshotRendering",{get:function(){return this._snapshotRenderingEnabled},set:function(e){this._snapshotRenderingMainPassBundleList.length=0,this._snapshotRenderingRecordBundles=this._snapshotRenderingEnabled=e,this._snapshotRenderingPlayBundles=!1,e&&(this._snapshotRenderingModeSaved=this._snapshotRenderingMode,this._snapshotRenderingMode=0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disableCacheSamplers",{get:function(){return!!this._cacheSampler&&this._cacheSampler.disabled},set:function(e){this._cacheSampler&&(this._cacheSampler.disabled=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disableCacheRenderPipelines",{get:function(){return!!this._cacheRenderPipeline&&this._cacheRenderPipeline.disabled},set:function(e){this._cacheRenderPipeline&&(this._cacheRenderPipeline.disabled=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disableCacheBindGroups",{get:function(){return!!this._cacheBindGroups&&this._cacheBindGroups.disabled},set:function(e){this._cacheBindGroups&&(this._cacheBindGroups.disabled=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"IsSupported",{get:function(){return!!navigator.gpu},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"supportsUniformBuffers",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"supportedExtensions",{get:function(){return this._adapterSupportedExtensions},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enabledExtensions",{get:function(){return this._deviceEnabledExtensions},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return"WebGPU"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"description",{get:function(){return this.name+this.version},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"version",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentSampleCount",{get:function(){return this._currentRenderTarget?this._currentRenderTarget.samples:this._mainPassSampleCount},enumerable:!1,configurable:!0}),t.CreateAsync=function(e,r){void 0===r&&(r={});var i=new t(e,r);return new Promise((function(e){i.initAsync(r.glslangOptions).then((function(){return e(i)}))}))},t.prototype.initAsync=function(e){var t,r=this;return this._initGlslang(null!=e?e:null===(t=this._options)||void 0===t?void 0:t.glslangOptions).then((function(e){return r._glslang=e,navigator.gpu.requestAdapter(r._options)}),(function(e){throw n.Y.Error("Can not initialize glslang!"),n.Y.Error(e),Error("WebGPU initializations stopped.")})).then((function(e){var t;r._adapter=e,r._adapterSupportedExtensions=[],null===(t=r._adapter.features)||void 0===t||t.forEach((function(e){return r._adapterSupportedExtensions.push(e)}));var i=r._options.deviceDescriptor;if(null==i?void 0:i.requiredFeatures){for(var n=[],s=0,o=i.requiredFeatures;s<o.length;s++){var a=o[s];-1!==r._adapterSupportedExtensions.indexOf(a)&&n.push(a)}i.requiredFeatures=n}return r._adapter.requestDevice(r._options.deviceDescriptor)})).then((function(e){var t,i;r._device=e,r._deviceEnabledExtensions=[],null===(t=r._device.features)||void 0===t||t.forEach((function(e){return r._deviceEnabledExtensions.push(e)}));var s=-1;r._device.addEventListener("uncapturederror",(function(e){++s<r.numMaxUncapturedErrors?n.Y.Warn("WebGPU uncaptured error ("+(s+1)+"): "+e.error+" - "+e.error.message):s++===r.numMaxUncapturedErrors&&n.Y.Warn("WebGPU uncaptured error: too many warnings ("+r.numMaxUncapturedErrors+"), no more warnings will be reported to the console for this engine.")})),r._doNotHandleContextLost||null===(i=r._device.lost)||void 0===i||i.then((function(e){r._contextWasLost=!0,n.Y.Warn("WebGPU context lost. "+e),r.onContextLostObservable.notifyObservers(r),r._restoreEngineAfterContextLost(r.initAsync.bind(r))}))})).then((function(){r._bufferManager=new w(r._device),r._textureHelper=new C.D(r._device,r._glslang,r._bufferManager),r._cacheSampler=new O.W(r._device),r._cacheBindGroups=new V.C(r._device,r._cacheSampler,r),r._timestampQuery=new Q(r._device,r._bufferManager),r._occlusionQuery=r._device.createQuerySet?new $(r,r._device,r._bufferManager):void 0,r._bundleList=new q(r._device),r.dbgVerboseLogsForFirstFrames&&void 0===r._count&&(r._count=0,console.log("%c frame #"+r._count+" - begin","background: #ffff00")),r._uploadEncoder=r._device.createCommandEncoder(r._uploadEncoderDescriptor),r._renderEncoder=r._device.createCommandEncoder(r._renderEncoderDescriptor),r._renderTargetEncoder=r._device.createCommandEncoder(r._renderTargetEncoderDescriptor),r._emptyVertexBuffer=new l.o(r,[0],"",!1,!1,1,!1,0,1),r._initializeLimits(),r._cacheRenderPipeline=new I.H(r._device,r._emptyVertexBuffer,!r._caps.textureFloatLinearFiltering),r._depthCullingState=new L(r._cacheRenderPipeline),r._stencilStateComposer=new D(r._cacheRenderPipeline),r._stencilStateComposer.stencilGlobal=r._stencilState,r._depthCullingState.depthTest=!0,r._depthCullingState.depthFunc=515,r._depthCullingState.depthMask=!0,r._textureHelper.setCommandEncoder(r._uploadEncoder),r._clearQuad=new z(r._device,r,r._emptyVertexBuffer),r._defaultMaterialContext=r.createMaterialContext(),r._currentMaterialContext=r._defaultMaterialContext,r._initializeContextAndSwapChain(),r._initializeMainAttachments(),r.resize()})).catch((function(e){n.Y.Error("Can not create WebGPU Device and/or context."),n.Y.Error(e),console.trace&&console.trace()}))},t.prototype._initGlslang=function(e){return e=e||{},(e=(0,i.pi)((0,i.pi)({},t._glslangDefaultOptions),e)).glslang?Promise.resolve(e.glslang):self.glslang?self.glslang(e.wasmPath):e.jsPath&&e.wasmPath?s.M.IsWindowObjectExist()?S.w1.LoadScriptAsync(e.jsPath).then((function(){return self.glslang(e.wasmPath)})):(importScripts(e.jsPath),self.glslang(e.wasmPath)):Promise.reject("gslang is not available.")},t.prototype._initializeLimits=function(){this._caps={maxTexturesImageUnits:16,maxVertexTextureImageUnits:16,maxCombinedTexturesImageUnits:32,maxTextureSize:8192,maxCubemapTextureSize:2048,maxRenderTextureSize:8192,maxVertexAttribs:16,maxVaryingVectors:15,maxFragmentUniformVectors:1024,maxVertexUniformVectors:1024,standardDerivatives:!0,astc:null,s3tc:this._deviceEnabledExtensions.indexOf(c.eS.TextureCompressionBC)>=0||void 0,pvrtc:null,etc1:null,etc2:null,bptc:this._deviceEnabledExtensions.indexOf(c.eS.TextureCompressionBC)>=0||void 0,maxAnisotropy:16,uintIndices:!0,fragmentDepthSupported:!0,highPrecisionShaderSupported:!0,colorBufferFloat:!0,textureFloat:!0,textureFloatLinearFiltering:!1,textureFloatRender:!0,textureHalfFloat:!0,textureHalfFloatLinearFiltering:!0,textureHalfFloatRender:!0,textureLOD:!0,drawBuffersExtension:!0,depthTextureExtension:!0,vertexArrayObject:!1,instancedArrays:!0,timerQuery:"undefined"!=typeof BigUint64Array&&-1!==this.enabledExtensions.indexOf(c.eS.TimestampQuery)||void 0,supportOcclusionQuery:"undefined"!=typeof BigUint64Array,canUseTimestampForTimerQuery:!0,multiview:!1,oculusMultiview:!1,parallelShaderCompile:void 0,blendMinMax:!0,maxMSAASamples:4,canUseGLInstanceID:!0,canUseGLVertexID:!0,supportComputeShaders:!0,supportSRGBBuffers:!0},this._caps.parallelShaderCompile=null,this._features={forceBitmapOverHTMLImageElement:!0,supportRenderAndCopyToLodForFloatTextures:!0,supportDepthStencilTexture:!0,supportShadowSamplers:!0,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:!0,trackUbosInFrame:!0,checkUbosContentBeforeUpload:!0,supportCSM:!0,basisNeedsPOT:!1,support3DTextures:!0,needTypeSuffixInShaderConstants:!0,supportMSAA:!0,supportSSAO2:!0,supportExtendedTextureFormats:!0,supportSwitchCaseInShader:!0,supportSyncTextureRead:!1,needsInvertingBitmap:!1,useUBOBindingCache:!1,needShaderCodeInlining:!0,_collectUbosUpdatedInFrame:!1}},t.prototype._initializeContextAndSwapChain=function(){this._context=this._canvas.getContext("webgpu"),this._configureContext(this._canvas.width,this._canvas.height),this._colorFormat=this._options.swapChainFormat,this._mainRenderPassWrapper.colorAttachmentGPUTextures=[new B.Z],this._mainRenderPassWrapper.colorAttachmentGPUTextures[0].format=this._colorFormat,this._invertYFinalFramebuffer&&(this._mainRenderPassCopyWrapper.colorAttachmentGPUTextures=[new B.Z],this._mainRenderPassCopyWrapper.colorAttachmentGPUTextures[0].format=this._colorFormat)},t.prototype._initializeMainAttachments=function(){var e,t,r;if(this._mainTextureExtends={width:this.getRenderWidth(),height:this.getRenderHeight(),depthOrArrayLayers:1},this._options.antialiasing){var i={size:this._mainTextureExtends,mipLevelCount:1,sampleCount:this._mainPassSampleCount,dimension:c.kd.E2d,format:this._options.swapChainFormat,usage:c.v2.RenderAttachment};null===(e=this._mainTexture)||void 0===e||e.destroy(),this._mainTexture=this._device.createTexture(i),r=[{view:this._mainTexture.createView(),loadValue:new o.HE(0,0,0,1),storeOp:c.EG.Store}]}else r=[{view:void 0,loadValue:new o.HE(0,0,0,1),storeOp:c.EG.Store}];if(this._invertYFinalFramebuffer){var n={size:this._mainTextureExtends,mipLevelCount:1,sampleCount:1,dimension:c.kd.E2d,format:this._options.swapChainFormat,usage:c.v2.RenderAttachment|c.v2.Sampled};null===(t=this._mainTextureLastCopy)||void 0===t||t.destroy(),this._mainTextureLastCopy=this._device.createTexture(n),this._options.antialiasing?r[0].resolveTarget=this._mainTextureLastCopy.createView():r[0].view=this._mainTextureLastCopy.createView(),this._mainRenderPassCopyWrapper.renderPassDescriptor={colorAttachments:[{view:void 0,loadValue:new o.HE(0,0,0,1),storeOp:c.EG.Store}]}}this._mainRenderPassWrapper.depthTextureFormat=this.isStencilEnable?c.EV.Depth24PlusStencil8:c.EV.Depth32Float,this._setDepthTextureFormat(this._mainRenderPassWrapper);var s={size:this._mainTextureExtends,mipLevelCount:1,sampleCount:this._mainPassSampleCount,dimension:c.kd.E2d,format:this._mainRenderPassWrapper.depthTextureFormat,usage:c.v2.RenderAttachment};this._depthTexture&&this._depthTexture.destroy(),this._depthTexture=this._device.createTexture(s);var a={view:this._depthTexture.createView(),depthLoadValue:this._clearDepthValue,depthStoreOp:c.EG.Store,stencilLoadValue:this._clearStencilValue,stencilStoreOp:c.EG.Store};this._mainRenderPassWrapper.renderPassDescriptor={colorAttachments:r,depthStencilAttachment:a},null!==this._mainRenderPassWrapper.renderPass&&this._endMainRenderPass()},t.prototype._configureContext=function(e,t){this._context.configure({device:this._device,format:this._options.swapChainFormat,usage:c.v2.RenderAttachment|c.v2.CopySrc,compositingAlphaMode:this.premultipliedAlpha?c.nw.Premultiplied:c.nw.Opaque,size:{width:e,height:t,depthOrArrayLayers:1}})},t.prototype.setSize=function(t,r,i){return void 0===i&&(i=!1),!!e.prototype.setSize.call(this,t,r,i)&&(this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - setSize called -",t,r)),this._configureContext(t,r),this._initializeMainAttachments(),!0)},t.prototype._getShaderProcessor=function(){return new R},t.prototype._getShaderProcessingContext=function(){return new E},t.prototype.applyStates=function(){this._stencilStateComposer.apply()},t.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._forceEnableEffect=!0,this._currentIndexBuffer=null,this._currentOverrideVertexBuffers=null,this._cacheRenderPipeline.setBuffers(null,null,null),e&&(this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=515,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters,this._alphaState._blendEquationParameters),this._cacheRenderPipeline.setAlphaBlendEnabled(!1),this.setColorWrite(!0)),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null)},t.prototype.setColorWrite=function(e){this.__colorWrite=e,this._cacheRenderPipeline.setWriteMask(e?15:0)},t.prototype.getColorWrite=function(){return this.__colorWrite},t.prototype._resetCurrentViewport=function(e){this._viewportsCurrent[e].x=0,this._viewportsCurrent[e].y=0,this._viewportsCurrent[e].w=0,this._viewportsCurrent[e].h=0,1===e&&(this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0)},t.prototype._mustUpdateViewport=function(e){var t=e===this._mainRenderPassWrapper.renderPass?0:1,r=this._viewportCached.x,i=this._viewportCached.y,n=this._viewportCached.z,s=this._viewportCached.w,o=this._viewportsCurrent[t].x!==r||this._viewportsCurrent[t].y!==i||this._viewportsCurrent[t].w!==n||this._viewportsCurrent[t].h!==s;return o&&(this._viewportsCurrent[t].x=this._viewportCached.x,this._viewportsCurrent[t].y=this._viewportCached.y,this._viewportsCurrent[t].w=this._viewportCached.z,this._viewportsCurrent[t].h=this._viewportCached.w),o},t.prototype._applyViewport=function(e){e.setViewport(Math.floor(this._viewportCached.x),Math.floor(this._viewportCached.y),Math.floor(this._viewportCached.z),Math.floor(this._viewportCached.w),0,1),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - viewport applied - (",this._viewportCached.x,this._viewportCached.y,this._viewportCached.z,this._viewportCached.w,") current pass is main pass="+(e===this._mainRenderPassWrapper.renderPass)))},t.prototype._viewport=function(e,t,r,i){this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=r,this._viewportCached.w=i},t.prototype._resetCurrentScissor=function(e){this._scissorsCurrent[e].x=0,this._scissorsCurrent[e].y=0,this._scissorsCurrent[e].w=0,this._scissorsCurrent[e].h=0},t.prototype._mustUpdateScissor=function(e){var t=e===this._mainRenderPassWrapper.renderPass?0:1,r=this._scissorCached.x,i=this._scissorCached.y,n=this._scissorCached.z,s=this._scissorCached.w,o=this._scissorsCurrent[t].x!==r||this._scissorsCurrent[t].y!==i||this._scissorsCurrent[t].w!==n||this._scissorsCurrent[t].h!==s;return o&&(this._scissorsCurrent[t].x=this._scissorCached.x,this._scissorsCurrent[t].y=this._scissorCached.y,this._scissorsCurrent[t].w=this._scissorCached.z,this._scissorsCurrent[t].h=this._scissorCached.w),o},t.prototype._applyScissor=function(e){e.setScissorRect(this._scissorCached.x,this._scissorCached.y,this._scissorCached.z,this._scissorCached.w),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - scissor applied - (",this._scissorCached.x,this._scissorCached.y,this._scissorCached.z,this._scissorCached.w,") current pass is main pass="+(e===this._mainRenderPassWrapper.renderPass)))},t.prototype._scissorIsActive=function(){return 0!==this._scissorCached.x||0!==this._scissorCached.y||0!==this._scissorCached.z||0!==this._scissorCached.w},t.prototype.enableScissor=function(e,t,r,i){this._scissorCached.x=e,this._scissorCached.y=t,this._scissorCached.z=r,this._scissorCached.w=i},t.prototype.disableScissor=function(){this._scissorCached.x=0,this._scissorCached.y=0,this._scissorCached.z=0,this._scissorCached.w=0,this._resetCurrentScissor(0),this._resetCurrentScissor(1)},t.prototype._resetCurrentStencilRef=function(e){this._stencilRefsCurrent[e]=-1},t.prototype._mustUpdateStencilRef=function(e){var t=e===this._mainRenderPassWrapper.renderPass?0:1,r=this._stencilStateComposer.funcRef!==this._stencilRefsCurrent[t];return r&&(this._stencilRefsCurrent[t]=this._stencilStateComposer.funcRef),r},t.prototype._applyStencilRef=function(e){var t;e.setStencilReference(null!==(t=this._stencilStateComposer.funcRef)&&void 0!==t?t:0)},t.prototype._resetCurrentColorBlend=function(e){this._blendColorsCurrent[e][0]=this._blendColorsCurrent[e][1]=this._blendColorsCurrent[e][2]=this._blendColorsCurrent[e][3]=null},t.prototype._mustUpdateBlendColor=function(e){var t=e===this._mainRenderPassWrapper.renderPass?0:1,r=this._alphaState._blendConstants,i=r[0]!==this._blendColorsCurrent[t][0]||r[1]!==this._blendColorsCurrent[t][1]||r[2]!==this._blendColorsCurrent[t][2]||r[3]!==this._blendColorsCurrent[t][3];return i&&(this._blendColorsCurrent[t][0]=r[0],this._blendColorsCurrent[t][1]=r[1],this._blendColorsCurrent[t][2]=r[2],this._blendColorsCurrent[t][3]=r[3]),i},t.prototype._applyBlendColor=function(e){e.setBlendConstant(this._alphaState._blendConstants)},t.prototype.clear=function(e,t,r,i){void 0===i&&(i=!1),e&&void 0===e.a&&(e.a=1);var n=this._scissorIsActive();this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - clear called - backBuffer=",t," depth=",r," stencil=",i," scissor is active=",n)),this._currentRenderTarget?n?(this._rttRenderPassWrapper.renderPass||this._startRenderTargetRenderPass(this._currentRenderTarget,!1,t?e:null,r,i),this.compatibilityMode?this._applyScissor(this._currentRenderPass):this._bundleList.addItem(new W(this._scissorCached.x,this._scissorCached.y,this._scissorCached.z,this._scissorCached.w)),this._clearFullQuad(t?e:null,r,i)):(this._currentRenderPass&&this._endRenderTargetRenderPass(),this._startRenderTargetRenderPass(this._currentRenderTarget,!0,t?e:null,r,i)):(this._mainRenderPassWrapper.renderPass&&n||this._startMainRenderPass(!n,t?e:null,r,i),n&&(this.compatibilityMode?this._applyScissor(this._currentRenderPass):this._bundleList.addItem(new W(this._scissorCached.x,this._scissorCached.y,this._scissorCached.z,this._scissorCached.w)),this._clearFullQuad(t?e:null,r,i)))},t.prototype._clearFullQuad=function(e,t,r){var i,n,s,o=this.compatibilityMode?this._getCurrentRenderPass():null;this._clearQuad.setColorFormat(this._colorFormat),this._clearQuad.setDepthStencilFormat(this._depthTextureFormat),this._clearQuad.setMRTAttachments(null!==(i=this._cacheRenderPipeline.mrtAttachments)&&void 0!==i?i:[],null!==(n=this._cacheRenderPipeline.mrtTextureArray)&&void 0!==n?n:[]),this.compatibilityMode?o.setStencilReference(this._clearStencilValue):this._bundleList.addItem(new j(this._clearStencilValue));var a=this._clearQuad.clear(o,e,t,r,this.currentSampleCount);this.compatibilityMode?this._applyStencilRef(o):(this._bundleList.addBundle(a),this._bundleList.addItem(new j(null!==(s=this._stencilStateComposer.funcRef)&&void 0!==s?s:0)),this._reportDrawCall())},t.prototype.createVertexBuffer=function(e){var t;return t=e instanceof Array?new Float32Array(e):e instanceof ArrayBuffer?new Uint8Array(e):e,this._bufferManager.createBuffer(t,c.FB.Vertex|c.FB.CopyDst)},t.prototype.createDynamicVertexBuffer=function(e){return this.createVertexBuffer(e)},t.prototype.createIndexBuffer=function(e,t){var r,i=!0;e instanceof Uint32Array||e instanceof Int32Array?r=e:e instanceof Uint16Array?(r=e,i=!1):e.length>65535?r=new Uint32Array(e):(r=new Uint16Array(e),i=!1);var n=this._bufferManager.createBuffer(r,c.FB.Index|c.FB.CopyDst);return n.is32Bits=i,n},t.prototype._createBuffer=function(e,t){var r;r=e instanceof Array?new Float32Array(e):e instanceof ArrayBuffer?new Uint8Array(e):e;var i=0;return 1&t&&(i|=c.FB.CopySrc),2&t&&(i|=c.FB.CopyDst),4&t&&(i|=c.FB.Uniform),8&t&&(i|=c.FB.Vertex),16&t&&(i|=c.FB.Index),32&t&&(i|=c.FB.Storage),this._bufferManager.createBuffer(r,i)},t.prototype.bindBuffersDirectly=function(e,t,r,i,n){throw"Not implemented on WebGPU"},t.prototype.updateAndBindInstancesBuffer=function(e,t,r){throw"Not implemented on WebGPU"},t.prototype.bindBuffers=function(e,t,r,i){this._currentIndexBuffer=t,this._currentOverrideVertexBuffers=null!=i?i:null,this._cacheRenderPipeline.setBuffers(e,t,this._currentOverrideVertexBuffers)},t.prototype._releaseBuffer=function(e){return this._bufferManager.releaseBuffer(e)},t.prototype.createEffect=function(e,t,r,i,n,s,o,a,u){var c,l=e.vertexElement||e.vertex||e.vertexToken||e.vertexSource||e,p=e.fragmentElement||e.fragment||e.fragmentToken||e.fragmentSource||e,f=this._getGlobalDefines(),d=null!==(c=null!=n?n:t.defines)&&void 0!==c?c:"";f&&(d+="\n"+f);var _=l+"+"+p+"@"+d;if(this._compiledEffects[_]){var g=this._compiledEffects[_];return o&&g.isReady()&&o(g),g}var m=new h.Q(e,t,r,i,this,n,s,o,a,u,_);return this._compiledEffects[_]=m,m},t.prototype._compileRawShaderToSpirV=function(e,t){return this._glslang.compileGLSL(e,t)},t.prototype._compileShaderToSpirV=function(e,t,r,i){return this._compileRawShaderToSpirV(i+(r?r+"\n":"")+e,t)},t.prototype._createPipelineStageDescriptor=function(e,t){return{vertexStage:{module:this._device.createShaderModule({code:e}),entryPoint:"main"},fragmentStage:{module:this._device.createShaderModule({code:t}),entryPoint:"main"}}},t.prototype._compileRawPipelineStageDescriptor=function(e,t){var r=this._compileRawShaderToSpirV(e,"vertex"),i=this._compileRawShaderToSpirV(t,"fragment");return this._createPipelineStageDescriptor(r,i)},t.prototype._compilePipelineStageDescriptor=function(e,t,r){this.onBeforeShaderCompilationObservable.notifyObservers(this);var i="#version 450\n",n=this._compileShaderToSpirV(e,"vertex",r,i),s=this._compileShaderToSpirV(t,"fragment",r,i),o=this._createPipelineStageDescriptor(n,s);return this.onAfterShaderCompilationObservable.notifyObservers(this),o},t.prototype.createRawShaderProgram=function(e,t,r,i,n){throw void 0===n&&(n=null),"Not available on WebGPU"},t.prototype.createShaderProgram=function(e,t,r,i,n,s){throw void 0===s&&(s=null),"Not available on WebGPU"},t.prototype.inlineShaderCode=function(e){var t=new ee.Z(e);return t.debug=!1,t.processCode(),t.code},t.prototype.createPipelineContext=function(e){return new d(e,this)},t.prototype.createMaterialContext=function(){return new N(this._cacheBindGroups)},t.prototype.createDrawContext=function(){return new G},t.prototype._preparePipelineContext=function(e,t,r,i,n,s,o,a,u,h){var c=e;this.dbgShowShaderCode&&(console.log(a),console.log(t),console.log(r)),c.sources={fragment:r,vertex:t,rawVertex:n,rawFragment:s},c.stages=i?this._compileRawPipelineStageDescriptor(t,r):this._compilePipelineStageDescriptor(t,r,a)},t.prototype.getAttributes=function(e,t){for(var r=new Array(t.length),i=e,n=0;n<t.length;n++){var s=t[n],o=i.shaderProcessingContext.availableAttributes[s];void 0!==o&&(r[n]=o)}return r},t.prototype.enableEffect=function(e){if(e){var t=!0;if(U.q.IsWrapper(e)){if(!e.effect||e.effect===this._currentEffect&&e.materialContext===this._currentMaterialContext&&e.drawContext===this._currentDrawContext&&!this._forceEnableEffect)return void(!e.effect&&this.dbgShowEmptyEnableEffectCalls&&console.warn("Invalid call to enableEffect: the effect property is empty! drawWrapper=",e));if(t=e.effect!==this._currentEffect,this._currentEffect=e.effect,this._currentMaterialContext=e.materialContext,this._currentDrawContext=e.drawContext,this._counters.numEnableDrawWrapper++,!this._currentMaterialContext)throw console.error("drawWrapper=",e),"Invalid call to enableEffect: the materialContext property is empty!"}else t=e!==this._currentEffect,this._currentEffect=e,this._currentMaterialContext=this._defaultMaterialContext,this._currentDrawContext=void 0,this._counters.numEnableEffects++,this.dbgLogIfNotDrawWrapper&&n.Y.Warn("enableEffect has been called with an Effect and not a Wrapper! effect.uniqueId="+e.uniqueId+", effect.name="+e.name+", effect.name.vertex="+e.name.vertex+", effect.name.fragment="+e.name.fragment,10);this._stencilStateComposer.stencilMaterial=void 0,this._forceEnableEffect=!t&&!this._forceEnableEffect&&this._forceEnableEffect,t&&(this._currentEffect.onBind&&this._currentEffect.onBind(this._currentEffect),this._currentEffect._onBindObservable&&this._currentEffect._onBindObservable.notifyObservers(this._currentEffect))}},t.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deletePipelineContext(e.getPipelineContext()))},t.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},t.prototype._deletePipelineContext=function(e){e&&e.dispose()},Object.defineProperty(t.prototype,"needPOTTextures",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype._createHardwareTexture=function(){return new B.Z},t.prototype._releaseTexture=function(e){var t=this._internalTexturesCache.indexOf(e);-1!==t&&this._internalTexturesCache.splice(t,1),this._textureHelper.releaseTexture(e)},t.prototype._getRGBABufferInternalSizedFormat=function(e,t){return 5},t.prototype.updateTextureComparisonFunction=function(e,t){e._comparisonFunction=t},t.prototype.createTexture=function(e,t,r,i,n,s,o,a,u,h,c,l,p,f,d){var _=this;return void 0===n&&(n=3),void 0===s&&(s=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===h&&(h=null),void 0===c&&(c=null),this._createTextureBase(e,t,r,i,n,s,o,(function(e,t,r,i,n,s,o,a,u){var c,l=i;if(e.baseWidth=l.width,e.baseHeight=l.height,e.width=l.width,e.height=l.height,e.format=null!=h?h:-1,a(e.width,e.height,l,t,e,(function(){})),null===(c=e._hardwareTexture)||void 0===c?void 0:c.underlyingResource)s||o||_._generateMipmaps(e,_._uploadEncoder);else{var p=_._textureHelper.createGPUTextureForInternalTexture(e,l.width,l.height,void 0,f);C.D.IsImageBitmap(l)&&(_._textureHelper.updateTexture(l,e,l.width,l.height,e.depth,p.format,0,0,n,!1,0,0,_._uploadEncoder),s||o||_._generateMipmaps(e,_._uploadEncoder))}r&&r._removePendingData(e),e.isReady=!0,e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}),(function(){return!1}),a,u,h,c,l,p,d)},t.prototype.generateMipMapsForCubemap=function(e,t){var r;void 0===t&&(t=!0),e.generateMipMaps&&((null===(r=e._hardwareTexture)||void 0===r?void 0:r.underlyingResource)||this._textureHelper.createGPUTextureForInternalTexture(e),this._generateMipmaps(e,e.source===u.S.RenderTarget||e.source===u.S.MultiRenderTarget?this._renderTargetEncoder:void 0))},t.prototype.updateTextureSamplingMode=function(e,t,r){void 0===r&&(r=!1),r&&(t.generateMipMaps=!0,this._generateMipmaps(t)),t.samplingMode=e},t.prototype.updateTextureWrappingMode=function(e,t,r,i){void 0===r&&(r=null),void 0===i&&(i=null),null!==t&&(e._cachedWrapU=t),null!==r&&(e._cachedWrapV=r),(e.is2DArray||e.is3D)&&null!==i&&(e._cachedWrapR=i)},t.prototype.updateTextureDimensions=function(e,t,r,i){if(void 0===i&&(i=1),e._hardwareTexture&&(e.width!==t||e.height!==r||e.depth!==i)){var n=e._hardwareTexture.textureAdditionalUsages;e._hardwareTexture.release(),this._textureHelper.createGPUTextureForInternalTexture(e,t,r,i,n)}},t.prototype._setInternalTexture=function(e,t,r,i){void 0===i&&(i=0),r=null!=r?r:e,this._currentEffect&&!this._currentMaterialContext.setTexture(e,t)&&this._currentEffect._pipelineContext.shaderProcessingContext.availableSamplers[r]&&(this._currentMaterialContext.samplers[r]={firstTextureName:e},this._currentMaterialContext.textures[e]={texture:t,wrapU:null==t?void 0:t._cachedWrapU,wrapV:null==t?void 0:t._cachedWrapV,wrapR:null==t?void 0:t._cachedWrapR,anisotropicFilteringLevel:null==t?void 0:t._cachedAnisotropicFilteringLevel,samplingMode:null==t?void 0:t.samplingMode})},t.prototype.setTexture=function(e,t,r,i){this._setTexture(e,r,!1,!1,i,i)},t.prototype.setTextureArray=function(e,t,r,i){for(var n=0;n<r.length;n++)this._setTexture(-1,r[n],!0,!1,i+n.toString(),i,n)},t.prototype._setTexture=function(e,t,r,i,n,s,o){if(void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===n&&(n=""),void 0===o&&(o=0),s=null!=s?s:n,this._currentEffect){if(!t)return this._currentMaterialContext.setTexture(n,null),!1;if(t.video)t.update();else if(4===t.delayLoadState)return t.delayLoad(),!1;var a=null;if((a=i?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture)&&!a.isMultiview){if(a.isCube&&a._cachedCoordinatesMode!==t.coordinatesMode){a._cachedCoordinatesMode=t.coordinatesMode;var u=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=u,t.wrapV=u}a._cachedWrapU=t.wrapU,a._cachedWrapV=t.wrapV,a.is3D&&(a._cachedWrapR=t.wrapR),this._setAnisotropicLevel(0,a,t.anisotropicFilteringLevel)}this._setInternalTexture(n,a,s,o)}else this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - _setTexture called with a null _currentEffect! texture=",t));return!0},t.prototype._setAnisotropicLevel=function(e,t,r){t._cachedAnisotropicFilteringLevel!==r&&(t._cachedAnisotropicFilteringLevel=Math.min(r,this._caps.maxAnisotropy))},t.prototype._bindTexture=function(e,t,r){void 0!==e&&this._setInternalTexture(r,t)},t.prototype._generateMipmaps=function(e,t){var r,i=null===(r=e._hardwareTexture)||void 0===r?void 0:r.underlyingResource;if(i){t=null!=t?t:this._currentRenderTarget&&!this._currentRenderPass?this._renderTargetEncoder:this._currentRenderPass?this._uploadEncoder:this._renderEncoder;var n=e._hardwareTexture.format,s=C.D.ComputeNumMipmapLevels(e.width,e.height);this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - generate mipmaps called - width=",e.width,"height=",e.height,"isCube=",e.isCube)),e.isCube?this._textureHelper.generateCubeMipmaps(i,n,s,t):this._textureHelper.generateMipmaps(i,n,s,0,t)}},t.prototype.updateTextureData=function(e,t,r,i,n,s,o,a){var u;void 0===o&&(o=0),void 0===a&&(a=0);var h=e._hardwareTexture;(null===(u=e._hardwareTexture)||void 0===u?void 0:u.underlyingResource)||(h=this._textureHelper.createGPUTextureForInternalTexture(e));var c=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(c,e,n,s,e.depth,h.format,o,a,e.invertY,!1,r,i,this._uploadEncoder)},t.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,i,n,s,o){var a;void 0===s&&(s=0),void 0===o&&(o=0);var u=e._hardwareTexture;(null===(a=e._hardwareTexture)||void 0===a?void 0:a.underlyingResource)||(e.format=t,u=this._textureHelper.createGPUTextureForInternalTexture(e,r,i));var h=new Uint8Array(n.buffer,n.byteOffset,n.byteLength);this._textureHelper.updateTexture(h,e,r,i,e.depth,u.format,s,o,!1,!1,0,0,this._uploadEncoder)},t.prototype._uploadDataToTextureDirectly=function(e,t,r,i,n,s){var o;void 0===r&&(r=0),void 0===i&&(i=0),void 0===s&&(s=!1);var a=Math.round(Math.log(e.width)*Math.LOG2E),u=Math.round(Math.log(e.height)*Math.LOG2E),h=s?e.width:Math.pow(2,Math.max(a-i,0)),c=s?e.height:Math.pow(2,Math.max(u-i,0)),l=e._hardwareTexture;(null===(o=e._hardwareTexture)||void 0===o?void 0:o.underlyingResource)||(l=this._textureHelper.createGPUTextureForInternalTexture(e,h,c));var p=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);this._textureHelper.updateTexture(p,e,h,c,e.depth,l.format,r,i,e.invertY,!1,0,0,this._uploadEncoder)},t.prototype._uploadArrayBufferViewToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0),this._uploadDataToTextureDirectly(e,t,r,i)},t.prototype._uploadImageToTexture=function(e,t,r,i){var n;void 0===r&&(r=0),void 0===i&&(i=0);var s=e._hardwareTexture;(null===(n=e._hardwareTexture)||void 0===n?void 0:n.underlyingResource)||(s=this._textureHelper.createGPUTextureForInternalTexture(e));var o=t,a=Math.ceil(e.width/(1<<i)),u=Math.ceil(e.height/(1<<i));this._textureHelper.updateTexture(o,e,a,u,e.depth,s.format,r,i,e.invertY,!1,0,0,this._uploadEncoder)},t.prototype.readPixels=function(e,t,r,i,n,s){void 0===n&&(n=!0),void 0===s&&(s=!0);var o=this._rttRenderPassWrapper.renderPass?this._rttRenderPassWrapper:this._mainRenderPassWrapper,a=o.colorAttachmentGPUTextures[0].underlyingResource,u=o.colorAttachmentGPUTextures[0].format;return a?(s&&this.flushFramebuffer(),this._textureHelper.readPixels(a,e,t,r,i,u)):Promise.resolve(new Uint8Array(0))},t.prototype.beginFrame=function(){e.prototype.beginFrame.call(this)},t.prototype.endFrame=function(){if(this._snapshotRenderingRecordBundles&&(this._snapshotRenderingMainPassBundleList.push(this._bundleList.clone()),this._snapshotRenderingRecordBundles=!1,this._snapshotRenderingPlayBundles=!0,this._snapshotRenderingMode=this._snapshotRenderingModeSaved),null!==this._mainRenderPassWrapper.renderPass&&this._snapshotRenderingPlayBundles)for(var t=0;t<this._snapshotRenderingMainPassBundleList.length;++t)this._snapshotRenderingMainPassBundleList[t].run(this._mainRenderPassWrapper.renderPass),1===this._snapshotRenderingMode&&this._reportDrawCall(this._snapshotRenderingMainPassBundleList[t].numDrawCalls);if(this._endMainRenderPass(),this._timestampQuery.endFrame(this._renderEncoder),this._invertYFinalFramebuffer&&this._mainRenderPassCopyWrapper.renderPassDescriptor.colorAttachments[0].view&&this._textureHelper.copyWithInvertY(this._mainTextureLastCopy.createView(),this._mainRenderPassWrapper.colorAttachmentGPUTextures[0].format,this._mainRenderPassCopyWrapper.renderPassDescriptor,this._renderEncoder),this.flushFramebuffer(!1),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - counters")),this._textureHelper.destroyDeferredTextures(),this._bufferManager.destroyDeferredBuffers(),this._features._collectUbosUpdatedInFrame){if(this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),!this._count||this._count<this.dbgVerboseLogsNumFrames)){var r=[];for(var i in p.M._updatedUbosInFrame)r.push(i+":"+p.M._updatedUbosInFrame[i]);console.log("frame #"+this._count+" - updated ubos -",r.join(", "))}p.M._updatedUbosInFrame={}}this.countersLastFrame.numEnableEffects=this._counters.numEnableEffects,this.countersLastFrame.numEnableDrawWrapper=this._counters.numEnableDrawWrapper,this._counters.numEnableEffects=0,this._counters.numEnableDrawWrapper=0,this._cacheRenderPipeline.endFrame(),this._cacheBindGroups.endFrame(),this._pendingDebugCommands.length=0,e.prototype.endFrame.call(this),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),this._count<this.dbgVerboseLogsNumFrames&&console.log("%c frame #"+this._count+" - end","background: #ffff00"),this._count<this.dbgVerboseLogsNumFrames&&(this._count++,this._count!==this.dbgVerboseLogsNumFrames&&console.log("%c frame #"+this._count+" - begin","background: #ffff00")))},t.prototype.flushFramebuffer=function(e){void 0===e&&(e=!0);var t=0;this._currentRenderPass&&(this._currentRenderTarget?(t=1,this._endRenderTargetRenderPass()):(t=2,this._endMainRenderPass())),this._commandBuffers[0]=this._uploadEncoder.finish(),this._commandBuffers[1]=this._renderTargetEncoder.finish(),this._commandBuffers[2]=this._renderEncoder.finish(),this._device.queue.submit(this._commandBuffers),this._uploadEncoder=this._device.createCommandEncoder(this._uploadEncoderDescriptor),this._renderEncoder=this._device.createCommandEncoder(this._renderEncoderDescriptor),this._renderTargetEncoder=this._device.createCommandEncoder(this._renderTargetEncoderDescriptor),this._timestampQuery.startFrame(this._uploadEncoder),this._textureHelper.setCommandEncoder(this._uploadEncoder),this._bundleList.reset(),e&&(1===t?this._startRenderTargetRenderPass(this._currentRenderTarget,!1,null,!1,!1):2===t&&this._startMainRenderPass(!1))},t.prototype._currentFrameBufferIsDefaultFrameBuffer=function(){return null===this._currentRenderTarget},t.prototype._startRenderTargetRenderPass=function(e,t,r,n,s){var o,a,u,h=e._hardwareTexture,l=h.underlyingResource,p=e._depthStencilTexture,f=null==p?void 0:p._hardwareTexture,d=null==f?void 0:f.underlyingResource,_=null==f?void 0:f.msaaTexture,g=null==d?void 0:d.createView(this._rttRenderPassWrapper.depthAttachmentViewDescriptor),m=null==_?void 0:_.createView(this._rttRenderPassWrapper.depthAttachmentViewDescriptor),y=[];this.useReverseDepthBuffer&&this.setDepthFunctionToGreaterOrEqual();var v=t&&r||c.Ws.Load,b=t&&n?this.useReverseDepthBuffer?this._clearReverseDepthValue:this._clearDepthValue:c.Ws.Load,x=t&&s?this._clearStencilValue:c.Ws.Load;if(e._attachments&&e._textureArray){this._mrtAttachments&&0!==this._mrtAttachments.length||(this._mrtAttachments=e._attachments);for(var R=0;R<this._mrtAttachments.length;++R){var T=this._mrtAttachments[R];if(0!==T){var E=e._textureArray[T-1],S=null==E?void 0:E._hardwareTexture,C=null==S?void 0:S.underlyingResource;if(S&&C){var A=(0,i.pi)((0,i.pi)({},this._rttRenderPassWrapper.colorAttachmentViewDescriptor),{format:S.format}),F=S.msaaTexture,P=C.createView(A),w=null==F?void 0:F.createView(A);y.push({view:w||P,resolveTarget:F?P:void 0,loadValue:v,storeOp:c.EG.Store})}}}this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments,e._textureArray)}else F=h.msaaTexture,P=l.createView(this._rttRenderPassWrapper.colorAttachmentViewDescriptor),w=null==F?void 0:F.createView(this._rttRenderPassWrapper.colorAttachmentViewDescriptor),y.push({view:w||P,resolveTarget:F?P:void 0,loadValue:v,storeOp:c.EG.Store});null===(o=this._debugPushGroup)||void 0===o||o.call(this,"render target pass",1),this._rttRenderPassWrapper.renderPassDescriptor={colorAttachments:y,depthStencilAttachment:p&&d?{view:m||g,depthLoadValue:p._generateDepthBuffer?b:c.Ws.Load,depthStoreOp:c.EG.Store,stencilLoadValue:p._generateStencilBuffer?x:c.Ws.Load,stencilStoreOp:c.EG.Store}:void 0,occlusionQuerySet:(null===(a=this._occlusionQuery)||void 0===a?void 0:a.hasQueries)?this._occlusionQuery.querySet:void 0},this._rttRenderPassWrapper.renderPass=this._renderTargetEncoder.beginRenderPass(this._rttRenderPassWrapper.renderPassDescriptor),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - render target begin pass - internalTexture.uniqueId=",e.uniqueId,"width=",e.width,"height=",e.height,this._rttRenderPassWrapper.renderPassDescriptor)),this._currentRenderPass=this._rttRenderPassWrapper.renderPass,null===(u=this._debugFlushPendingCommands)||void 0===u||u.call(this),this._resetCurrentViewport(1),this._resetCurrentScissor(1),this._resetCurrentStencilRef(1),this._resetCurrentColorBlend(1)},t.prototype._endRenderTargetRenderPass=function(){var e,t,r,i;if(this._currentRenderPass){var n=this._currentRenderTarget._hardwareTexture;this._snapshotRenderingPlayBundles?(null===(e=n._bundleLists[n._currentLayer])||void 0===e||e.run(this._currentRenderPass),1===this._snapshotRenderingMode&&this._reportDrawCall(null===(t=n._bundleLists[n._currentLayer])||void 0===t?void 0:t.numDrawCalls)):this._snapshotRenderingRecordBundles?(n._bundleLists||(n._bundleLists=[]),n._bundleLists[n._currentLayer]=this._bundleList.clone(),n._bundleLists[n._currentLayer].run(this._currentRenderPass),this._bundleList.reset()):this.compatibilityMode||(this._bundleList.run(this._currentRenderPass),this._bundleList.reset()),this._currentRenderPass.endPass(),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - render target end pass - internalTexture.uniqueId=",null===(r=this._currentRenderTarget)||void 0===r?void 0:r.uniqueId)),null===(i=this._debugPopGroup)||void 0===i||i.call(this,1),this._resetCurrentViewport(1),this._resetCurrentScissor(1),this._resetCurrentStencilRef(1),this._resetCurrentColorBlend(1),this._currentRenderPass=null,this._rttRenderPassWrapper.reset()}},t.prototype._getCurrentRenderPass=function(){return this._currentRenderTarget&&!this._currentRenderPass?this._startRenderTargetRenderPass(this._currentRenderTarget,!1,null,!1,!1):this._currentRenderPass||this._startMainRenderPass(!1),this._currentRenderPass},t.prototype._getCurrentRenderPassIndex=function(){return null===this._currentRenderPass?-1:this._currentRenderPass===this._mainRenderPassWrapper.renderPass?0:1},t.prototype._startMainRenderPass=function(e,t,r,i){var n,s,o;this._mainRenderPassWrapper.renderPass&&this._endMainRenderPass(),this.useReverseDepthBuffer&&this.setDepthFunctionToGreaterOrEqual();var a=e&&t||c.Ws.Load,u=e&&r?this.useReverseDepthBuffer?this._clearReverseDepthValue:this._clearDepthValue:c.Ws.Load,h=e&&i?this._clearStencilValue:c.Ws.Load;this._mainRenderPassWrapper.renderPassDescriptor.colorAttachments[0].loadValue=a,this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.depthLoadValue=u,this._mainRenderPassWrapper.renderPassDescriptor.depthStencilAttachment.stencilLoadValue=h,this._mainRenderPassWrapper.renderPassDescriptor.occlusionQuerySet=(null===(n=this._occlusionQuery)||void 0===n?void 0:n.hasQueries)?this._occlusionQuery.querySet:void 0;var l=this._invertYFinalFramebuffer?this._mainRenderPassCopyWrapper:this._mainRenderPassWrapper;this._swapChainTexture=this._context.getCurrentTexture(),l.colorAttachmentGPUTextures[0].set(this._swapChainTexture),this._options.antialiasing?this._invertYFinalFramebuffer?l.renderPassDescriptor.colorAttachments[0].view=this._swapChainTexture.createView():l.renderPassDescriptor.colorAttachments[0].resolveTarget=this._swapChainTexture.createView():l.renderPassDescriptor.colorAttachments[0].view=this._swapChainTexture.createView(),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - main begin pass - texture width="+this._mainTextureExtends.width," height="+this._mainTextureExtends.height,this._mainRenderPassWrapper.renderPassDescriptor)),null===(s=this._debugPushGroup)||void 0===s||s.call(this,"main pass",0),this._currentRenderPass=this._renderEncoder.beginRenderPass(this._mainRenderPassWrapper.renderPassDescriptor),this._mainRenderPassWrapper.renderPass=this._currentRenderPass,null===(o=this._debugFlushPendingCommands)||void 0===o||o.call(this),this._resetCurrentViewport(0),this._resetCurrentScissor(0),this._resetCurrentStencilRef(0),this._resetCurrentColorBlend(0)},t.prototype._endMainRenderPass=function(){var e;null!==this._mainRenderPassWrapper.renderPass&&(this._snapshotRenderingRecordBundles&&this._snapshotRenderingMainPassBundleList.push(this._bundleList.clone()),this.compatibilityMode||this._snapshotRenderingPlayBundles||(this._bundleList.run(this._mainRenderPassWrapper.renderPass),this._bundleList.reset()),this._mainRenderPassWrapper.renderPass.endPass(),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - main end pass")),null===(e=this._debugPopGroup)||void 0===e||e.call(this,0),this._resetCurrentViewport(0),this._resetCurrentScissor(0),this._resetCurrentStencilRef(0),this._resetCurrentColorBlend(0),this._mainRenderPassWrapper.renderPass===this._currentRenderPass&&(this._currentRenderPass=null),this._mainRenderPassWrapper.reset(!1))},t.prototype.bindFramebuffer=function(e,t,r,i,n,s,o){void 0===t&&(t=0),void 0===s&&(s=0),void 0===o&&(o=0);var a=e._hardwareTexture,u=null==a?void 0:a.underlyingResource;a&&u?(this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,a._currentLayer=e.isCube?6*o+t:o,this._rttRenderPassWrapper.colorAttachmentGPUTextures[0]=a,this._rttRenderPassWrapper.depthTextureFormat=this._currentRenderTarget._depthStencilTexture?C.D.GetWebGPUTextureFormat(-1,this._currentRenderTarget._depthStencilTexture.format):void 0,this._setDepthTextureFormat(this._rttRenderPassWrapper),this._setColorFormat(this._rttRenderPassWrapper),this._rttRenderPassWrapper.colorAttachmentViewDescriptor={format:this._colorFormat,dimension:c.p_.E2d,mipLevelCount:1,baseArrayLayer:e.isCube?6*o+t:o,baseMipLevel:s,arrayLayerCount:1,aspect:c.H7.All},this._rttRenderPassWrapper.depthAttachmentViewDescriptor={format:this._depthTextureFormat,dimension:c.p_.E2d,mipLevelCount:1,baseArrayLayer:e.isCube?6*o+t:o,baseMipLevel:0,arrayLayerCount:1,aspect:c.H7.All},this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - bindFramebuffer called - internalTexture.uniqueId=",e.uniqueId,"face=",t,"lodLevel=",s,"layer=",o,this._rttRenderPassWrapper.colorAttachmentViewDescriptor,this._rttRenderPassWrapper.depthAttachmentViewDescriptor)),this._currentRenderPass=null,this.snapshotRendering&&1===this.snapshotRenderingMode&&this._getCurrentRenderPass(),this._cachedViewport&&!n?this.setViewport(this._cachedViewport,r,i):(r||(r=e.width,s&&(r/=Math.pow(2,s))),i||(i=e.height,s&&(i/=Math.pow(2,s))),this._viewport(0,0,r,i)),this.wipeCaches()):this.dbgSanityChecks&&console.error("bindFramebuffer: Trying to bind a texture that does not have a hardware texture or that has a webgpu texture empty!",e,a,u)},t.prototype.unBindFramebuffer=function(e,t,r){void 0===t&&(t=!1);var i=this._currentRenderTarget;this._currentRenderTarget=null,r&&r(),this._currentRenderTarget=i,this._currentRenderPass&&this._currentRenderPass!==this._mainRenderPassWrapper.renderPass&&this._endRenderTargetRenderPass(),!e.generateMipMaps||t||e.isCube||this._generateMipmaps(e),this._currentRenderTarget=null,this._onAfterUnbindFrameBufferObservable.notifyObservers(this),this.dbgVerboseLogsForFirstFrames&&(void 0===this._count&&(this._count=0),(!this._count||this._count<this.dbgVerboseLogsNumFrames)&&console.log("frame #"+this._count+" - unBindFramebuffer called - internalTexture.uniqueId=",e.uniqueId)),this._mrtAttachments=[],this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments,[]),this._currentRenderPass=this._mainRenderPassWrapper.renderPass,this._setDepthTextureFormat(this._mainRenderPassWrapper),this._setColorFormat(this._mainRenderPassWrapper)},t.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):(this._currentRenderPass=this._mainRenderPassWrapper.renderPass,this._setDepthTextureFormat(this._mainRenderPassWrapper),this._setColorFormat(this._mainRenderPassWrapper)),this._currentRenderPass&&this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},t.prototype._setColorFormat=function(e){var t=e.colorAttachmentGPUTextures[0].format;this._cacheRenderPipeline.setColorFormat(t),this._colorFormat!==t&&(this._colorFormat=t)},t.prototype._setDepthTextureFormat=function(e){this._cacheRenderPipeline.setDepthStencilFormat(e.depthTextureFormat),this._depthTextureFormat!==e.depthTextureFormat&&(this._depthTextureFormat=e.depthTextureFormat)},t.prototype.setDitheringState=function(e){},t.prototype.setRasterizerState=function(e){},t.prototype.setState=function(e,t,r,i,n,s){var o,a;void 0===t&&(t=0),void 0===i&&(i=!1),(this._depthCullingState.cull!==e||r)&&(this._depthCullingState.cull=e);var u=null===(a=null!==(o=this.cullBackFaces)&&void 0!==o?o:n)||void 0===a||a?1:2;(this._depthCullingState.cullFace!==u||r)&&(this._depthCullingState.cullFace=u),this.setZOffset(t);var h=i?1:2;(this._depthCullingState.frontFace!==h||r)&&(this._depthCullingState.frontFace=h),this._stencilStateComposer.stencilMaterial=s},t.prototype._draw=function(e,t,r,i,n){var s,o,a,u=this._getCurrentRenderPass();this.applyStates();var h=this._mustUpdateViewport(u),l=this._mustUpdateScissor(u),p=!!this._stencilStateComposer.enabled&&this._mustUpdateStencilRef(u),f=!!this._alphaState.alphaBlend&&this._mustUpdateBlendColor(u),d=this._currentEffect._pipelineContext;if(d.uniformBuffer&&d.uniformBuffer.update(),this._snapshotRenderingPlayBundles)this._reportDrawCall();else{var _=u;if(!this.compatibilityMode&&(null===(s=this._currentDrawContext)||void 0===s?void 0:s.fastBundle)||this._snapshotRenderingRecordBundles){if(h&&this._bundleList.addItem(new k(this._viewportCached.x,this._viewportCached.y,this._viewportCached.z,this._viewportCached.w)),l&&this._bundleList.addItem(new W(this._scissorCached.x,this._scissorCached.y,this._scissorCached.z,this._scissorCached.w)),p&&this._bundleList.addItem(new j(null!==(o=this._stencilStateComposer.funcRef)&&void 0!==o?o:0)),f&&this._bundleList.addItem(new H(this._alphaState._blendConstants.slice())),!this._snapshotRenderingRecordBundles)return this._bundleList.addBundle(this._currentDrawContext.fastBundle),void this._reportDrawCall();_=this._bundleList.getBundleEncoder(this._cacheRenderPipeline.colorFormats,this._depthTextureFormat,this.currentSampleCount),this._bundleList.numDrawCalls++}d.uniformBuffer&&this.bindUniformBufferBase(d.uniformBuffer.getBuffer(),0,"LeftOver");var g=0;if(!this._caps.textureFloatLinearFiltering)for(var m=1,y=0;y<d.shaderProcessingContext.samplerNames.length;++y){var v=d.shaderProcessingContext.samplerNames[y],b=null===(a=this._currentMaterialContext.textures[v])||void 0===a?void 0:a.texture;1===(null==b?void 0:b.type)&&(g|=m),m<<=1}var x=this._cacheRenderPipeline.getRenderPipeline(t,this._currentEffect,this.currentSampleCount,g),R=this._cacheBindGroups.getBindGroups(d,this._currentMaterialContext,this._uniformsBuffers);this._snapshotRenderingRecordBundles||(h&&this._applyViewport(u),l&&this._applyScissor(u),p&&this._applyStencilRef(u),f&&this._applyBlendColor(u),this.compatibilityMode||(_=this._device.createRenderBundleEncoder({colorFormats:this._cacheRenderPipeline.colorFormats,depthStencilFormat:this._depthTextureFormat,sampleCount:this.currentSampleCount}))),_.setPipeline(x),this._currentIndexBuffer&&_.setIndexBuffer(this._currentIndexBuffer.underlyingResource,this._currentIndexBuffer.is32Bits?c.iD.Uint32:c.iD.Uint16,0);for(var T=this._cacheRenderPipeline.vertexBuffers,E=0;E<T.length;E++){var S=T[E],C=S.getBuffer();C&&_.setVertexBuffer(E,C.underlyingResource,S._validOffsetRange?0:S.byteOffset)}for(y=0;y<R.length;y++)_.setBindGroup(y,R[y]);0===e?_.drawIndexed(i,n||1,r,0,0):_.draw(i,n||1,r,0),this.compatibilityMode||!this._currentDrawContext||this._snapshotRenderingRecordBundles||(this._currentDrawContext.fastBundle=_.finish(),this._bundleList.addBundle(this._currentDrawContext.fastBundle)),this._reportDrawCall()}},t.prototype.drawElementsType=function(e,t,r,i){void 0===i&&(i=1),this._draw(0,e,t,r,i)},t.prototype.drawArraysType=function(e,t,r,i){void 0===i&&(i=1),this._currentIndexBuffer=null,this._draw(1,e,t,r,i)},t.prototype.dispose=function(){var t,r,i;null===(t=this._mainTexture)||void 0===t||t.destroy(),null===(r=this._mainTextureLastCopy)||void 0===r||r.destroy(),null===(i=this._depthTexture)||void 0===i||i.destroy(),e.prototype.dispose.call(this)},t.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._canvas.width},t.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._canvas.height},t.prototype.getRenderingCanvas=function(){return this._canvas},t.prototype.getError=function(){return 0},t.prototype.bindSamplers=function(e){},t.prototype._bindTextureDirectly=function(e,t,r,i){return void 0===r&&(r=!1),void 0===i&&(i=!1),!1},t.prototype._releaseFramebufferObjects=function(e){},t.prototype.areAllEffectsReady=function(){return!0},t.prototype._executeWhenRenderingStateIsCompiled=function(e,t){t()},t.prototype._isRenderingStateCompiled=function(e){return!0},t.prototype._getUnpackAlignement=function(){return 1},t.prototype._unpackFlipY=function(e){},t.prototype._getSamplingParameters=function(e,t){throw"_getSamplingParameters is not available in WebGPU"},t.prototype.getUniforms=function(e,t){return[]},t.prototype.setIntArray=function(e,t){return!1},t.prototype.setIntArray2=function(e,t){return!1},t.prototype.setIntArray3=function(e,t){return!1},t.prototype.setIntArray4=function(e,t){return!1},t.prototype.setArray=function(e,t){return!1},t.prototype.setArray2=function(e,t){return!1},t.prototype.setArray3=function(e,t){return!1},t.prototype.setArray4=function(e,t){return!1},t.prototype.setMatrices=function(e,t){return!1},t.prototype.setMatrix3x3=function(e,t){return!1},t.prototype.setMatrix2x2=function(e,t){return!1},t.prototype.setFloat=function(e,t){return!1},t.prototype.setFloat2=function(e,t,r){return!1},t.prototype.setFloat3=function(e,t,r,i){return!1},t.prototype.setFloat4=function(e,t,r,i,n){return!1},t._glslangDefaultOptions={jsPath:"https://preview.babylonjs.com/glslang/glslang.js",wasmPath:"https://preview.babylonjs.com/glslang/glslang.wasm"},t}(a.D)},3990:(e,t,r)=>{"use strict";r.d(t,{V:()=>h});var i=r(3940),n=r(3536),s=r(8131),o=r(4471),a=r(3852),u=r(1018),h=(r(5873),function(e){function t(r){var i=e.call(this,null)||this;return i.metadata=null,i.reservedDataStore=null,i._hasAlpha=!1,i.getAlphaFromRGB=!1,i.level=1,i.coordinatesIndex=0,i._coordinatesMode=0,i.wrapR=1,i.anisotropicFilteringLevel=t.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,i._isCube=!1,i._gammaSpace=!0,i.invertZ=!1,i.lodLevelInAlpha=!1,i.isRenderTarget=!1,i._prefiltered=!1,i.animations=new Array,i.onDisposeObservable=new s.y$,i._onDisposeObserver=null,i._scene=null,i._texture=null,i._uid=null,i._parentContainer=null,r?t._isScene(r)?i._scene=r:i._engine=r:i._scene=a.l.LastCreatedScene,i._scene&&(i.uniqueId=i._scene.getUniqueId(),i._scene.addTexture(i),i._engine=i._scene.getEngine()),i._uid=null,i}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(17))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapU",{get:function(){return this._wrapU},set:function(e){this._wrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapV",{get:function(){return this._wrapV},set:function(e){this._wrapV=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCube",{get:function(){return this._texture?this._texture.isCube:this._isCube},set:function(e){this._texture?this._texture.isCube=e:this._isCube=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(e){this._texture&&(this._texture.is2DArray=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gammaSpace",{get:function(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace},set:function(e){if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRGBD",{get:function(){return null!=this._texture&&this._texture._isRGBD},set:function(e){this._texture&&(this._texture._isRGBD=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"noMipmap",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(e){this._texture&&(this._texture._lodGenerationOffset=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(e){this._texture&&(this._texture._lodGenerationScale=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"linearSpecularLOD",{get:function(){return!!this._texture&&this._texture._linearSpecularLOD},set:function(e){this._texture&&(this._texture._linearSpecularLOD=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(e){this._texture&&(this._texture._irradianceTexture=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid||(this._uid=u.x.RandomId()),this._uid},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return this.name},t.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype.getScene=function(){return this._scene},t.prototype._getEngine=function(){return this._engine},t.prototype.checkTransformsAreIdentical=function(e){return null!==e},t.prototype.getTextureMatrix=function(){return o.y3.IdentityReadOnly},t.prototype.getReflectionTextureMatrix=function(){return o.y3.IdentityReadOnly},t.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},t.prototype.scale=function(e){},Object.defineProperty(t.prototype,"canRescale",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype._getFromCache=function(e,t,r,i,n){var s=this._getEngine();if(!s)return null;for(var o=!!n&&s._caps.supportSRGBBuffers&&(s.webGLVersion>1||s.isWebGPU||t),a=s.getLoadedTexturesCache(),u=0;u<a.length;u++){var h=a[u];if((void 0===n||o===h._useSRGBBuffer)&&!(void 0!==i&&i!==h.invertY||h.url!==e||h.generateMipMaps!==!t||r&&r!==h.samplingMode))return h.incrementReferences(),h}return null},t.prototype._rebuild=function(){},t.prototype.clone=function(){return null},Object.defineProperty(t.prototype,"textureType",{get:function(){return this._texture&&void 0!==this._texture.type?this._texture.type:0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textureFormat",{get:function(){return this._texture&&void 0!==this._texture.format?this._texture.format:5},enumerable:!1,configurable:!0}),t.prototype._markAllSubMeshesAsTexturesDirty=function(){var e=this.getScene();e&&e.markAllMaterialsAsDirty(1)},t.prototype.readPixels=function(e,t,r,i,n){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=null),void 0===i&&(i=!0),void 0===n&&(n=!1),!this._texture)return null;var s=this.getSize(),o=s.width,a=s.height,u=this._getEngine();if(!u)return null;0!=t&&(o/=Math.pow(2,t),a/=Math.pow(2,t),o=Math.round(o),a=Math.round(a));try{return this._texture.isCube?u._readTexturePixels(this._texture,o,a,e,t,r,i,n):u._readTexturePixels(this._texture,o,a,-1,t,r,i,n)}catch(e){return null}},t.prototype._readPixelsSync=function(e,t,r,i,n){if(void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=null),void 0===i&&(i=!0),void 0===n&&(n=!1),!this._texture)return null;var s=this.getSize(),o=s.width,a=s.height,u=this._getEngine();if(!u)return null;0!=t&&(o/=Math.pow(2,t),a/=Math.pow(2,t),o=Math.round(o),a=Math.round(a));try{return this._texture.isCube?u._readTexturePixelsSync(this._texture,o,a,e,t,r,i,n):u._readTexturePixelsSync(this._texture,o,a,-1,t,r,i,n)}catch(e){return null}},Object.defineProperty(t.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var t=this._scene.textures.indexOf(this);if(t>=0&&this._scene.textures.splice(t,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){var r=this._parentContainer.textures.indexOf(this);r>-1&&this._parentContainer.textures.splice(r,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,e.prototype.dispose.call(this)},t.prototype.serialize=function(){if(!this.name)return null;var e=n.p4.Serialize(this);return n.p4.AppendSerializedAnimations(this,e),e},t.WhenAllReady=function(e,t){var r=e.length;if(0!==r)for(var i=0;i<e.length;i++){var n=e[i];if(n.isReady())0==--r&&t();else{var s=n.onLoadObservable;s&&s.addOnce((function(){0==--r&&t()}))}}else t()},t._isScene=function(e){return"Scene"===e.getClassName()},t.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,i.gn)([(0,n.qC)()],t.prototype,"uniqueId",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"name",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"metadata",void 0),(0,i.gn)([(0,n.qC)("hasAlpha")],t.prototype,"_hasAlpha",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"getAlphaFromRGB",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"level",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"coordinatesIndex",void 0),(0,i.gn)([(0,n.qC)("coordinatesMode")],t.prototype,"_coordinatesMode",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"wrapU",null),(0,i.gn)([(0,n.qC)()],t.prototype,"wrapV",null),(0,i.gn)([(0,n.qC)()],t.prototype,"wrapR",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"anisotropicFilteringLevel",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"isCube",null),(0,i.gn)([(0,n.qC)()],t.prototype,"is3D",null),(0,i.gn)([(0,n.qC)()],t.prototype,"is2DArray",null),(0,i.gn)([(0,n.qC)()],t.prototype,"gammaSpace",null),(0,i.gn)([(0,n.qC)()],t.prototype,"invertZ",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"lodLevelInAlpha",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"lodGenerationOffset",null),(0,i.gn)([(0,n.qC)()],t.prototype,"lodGenerationScale",null),(0,i.gn)([(0,n.qC)()],t.prototype,"linearSpecularLOD",null),(0,i.gn)([(0,n.oU)()],t.prototype,"irradianceTexture",null),(0,i.gn)([(0,n.qC)()],t.prototype,"isRenderTarget",void 0),t}(r(1688).g))},6599:(e,t,r)=>{"use strict";r.d(t,{S:()=>i,l:()=>a});var i,n=r(8131),s=r(1730),o=r(7936);!function(e){e[e.Unknown=0]="Unknown",e[e.Url=1]="Url",e[e.Temp=2]="Temp",e[e.Raw=3]="Raw",e[e.Dynamic=4]="Dynamic",e[e.RenderTarget=5]="RenderTarget",e[e.MultiRenderTarget=6]="MultiRenderTarget",e[e.Cube=7]="Cube",e[e.CubeRaw=8]="CubeRaw",e[e.CubePrefiltered=9]="CubePrefiltered",e[e.Raw3D=10]="Raw3D",e[e.Raw2DArray=11]="Raw2DArray",e[e.Depth=12]="Depth",e[e.CubeRawRGBD=13]="CubeRawRGBD"}(i||(i={}));var a=function(){function e(t,r,s){void 0===s&&(s=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new n.y$,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=i.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._textureArray=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._references=1,this._gammaSpace=null,this._engine=t,this._source=r,this._uniqueId=e._Counter++,s||(this._hardwareTexture=t._createHardwareTexture())}return Object.defineProperty(e.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),e.prototype.getEngine=function(){return this._engine},Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),e.prototype.incrementReferences=function(){this._references++},e.prototype.updateSize=function(e,t,r){void 0===r&&(r=1),this._engine.updateTextureDimensions(this,e,t,r),this.width=e,this.height=t,this.depth=r,this.baseWidth=e,this.baseHeight=t,this.baseDepth=r,this._size=e*t*r},e.prototype._rebuild=function(){var t,r,n=this;this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null;var o=function(){var e=n.samples;e>1&&(n.samples=1,n._MSAAFramebuffer=null,n._MSAARenderBuffer=null,n._engine.updateRenderTargetTextureSampleCount(n,e))};switch(this.source){case i.Temp:break;case i.Url:return void(r=this._engine.createTexture(null!==(t=this._originalUrl)&&void 0!==t?t:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(function(){r._swapAndDie(n,!1),o(),n.isReady=!0}),null,this._buffer,void 0,this.format,void 0,void 0,void 0,void 0,this._useSRGBBuffer));case i.Raw:(r=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case i.Raw3D:(r=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case i.Raw2DArray:(r=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case i.Dynamic:(r=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this,!1),this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);break;case i.RenderTarget:var a=new s.L;if(a.generateDepthBuffer=this._generateDepthBuffer,a.generateMipMaps=this.generateMipMaps,a.generateStencilBuffer=this._generateStencilBuffer,a.samplingMode=this.samplingMode,a.type=this.type,this.isCube)r=this._engine.createRenderTargetCubeTexture(this.width,a);else{var u={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};r=this._engine.createRenderTargetTexture(u,a)}r._swapAndDie(this,!1),this.isReady=!0;break;case i.MultiRenderTarget:if(this._textureArray&&this===this._textureArray[0]){var h=!1,c=this._textureArray.length;null===this._textureArray[this._textureArray.length-1]._textureArray&&(h=!0,c--);for(var l=[],p=[],f=0;f<c;++f){var d=this._textureArray[f];l.push(d.samplingMode),p.push(d.type)}var _={samplingModes:l,generateMipMaps:this.generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:h,types:p,textureCount:c},g={width:this.width,height:this.height},m=this._engine.createMultipleRenderTarget(g,_);for(f=0;f<this._textureArray.length;++f)m[f]._swapAndDie(this._textureArray[f],!1)}this.isReady=!0;break;case i.Depth:var y={bilinearFiltering:2===this.samplingMode||3===this.samplingMode||11===this.samplingMode,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube,samples:this.samples},v={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};(r=this._engine.createDepthStencilTexture(v,y))._swapAndDie(this,!1),this.isReady=!0;break;case i.Cube:return void(r=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(function(){r._swapAndDie(n,!1),o(),n.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer));case i.CubeRaw:(r=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this,!1),this.isReady=!0;break;case i.CubeRawRGBD:return r=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void e._UpdateRGBDAsync(r,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then((function(){r._swapAndDie(n,!1),o(),n.isReady=!0}));case i.CubePrefiltered:return void((r=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(function(e){e&&e._swapAndDie(n,!1),o(),n.isReady=!0}),null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial);case i.Unknown:if(this._colorTextureArray&&this._depthStencilTextureArray&&this.isMultiview)(r=this._engine.createMultiviewRenderTargetTexture(this.width,this.height))._swapAndDie(this,!1),this.isReady=!0;else if(this.isCube){var b={bilinearFiltering:2!==this.samplingMode,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube,samples:this.samples};(r=this._engine._createDepthStencilCubeTexture(this.width,b))._swapAndDie(this,!1),this.isReady=!0}}o()},e.prototype._swapAndDie=function(e,t){var r;void 0===t&&(t=!0),null===(r=this._hardwareTexture)||void 0===r||r.setUsage(e._source,this.generateMipMaps,this.isCube,this.width,this.height),e._hardwareTexture=this._hardwareTexture,t&&(e._isRGBD=this._isRGBD),this._framebuffer&&(e._framebuffer=this._framebuffer),this._depthStencilBuffer&&(e._depthStencilBuffer=this._depthStencilBuffer),t&&(e._depthStencilTexture=this._depthStencilTexture),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);var i,n=this._engine.getLoadedTexturesCache();-1!==(i=n.indexOf(this))&&n.splice(i,1),-1===(i=n.indexOf(e))&&n.push(e)},e.prototype.dispose=function(){this._references--,0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null)},e._UpdateRGBDAsync=function(e,t,r,i,n){throw o.f.WarnImport("environmentTextureTools")},e._Counter=0,e}()},1730:(e,t,r)=>{"use strict";r.d(t,{L:()=>i});var i=function(){}},5808:(e,t,r)=>{"use strict";r.d(t,{_:()=>l});var i=r(3940),n=r(8131),s=r(2281),o=r(4471),a=r(1263),u=r(6758),h=r(3009),c=(r(346),r(6410),r(6940)),l=function(e){function t(t,r,i,s,u,c,l,p,f,d,_,g,m,y,v){var b;void 0===u&&(u=!0),void 0===c&&(c=0),void 0===l&&(l=!1),void 0===p&&(p=a.x.TRILINEAR_SAMPLINGMODE),void 0===f&&(f=!0),void 0===d&&(d=!1),void 0===_&&(_=!1),void 0===g&&(g=5),void 0===m&&(m=!1);var x=e.call(this,null,i,!s,void 0,p,void 0,void 0,void 0,void 0,g)||this;return x.renderParticles=!0,x.renderSprites=!1,x.ignoreCameraViewport=!1,x.onBeforeBindObservable=new n.y$,x.onAfterUnbindObservable=new n.y$,x.onBeforeRenderObservable=new n.y$,x.onAfterRenderObservable=new n.y$,x.onClearObservable=new n.y$,x.onResizeObservable=new n.y$,x._cleared=!1,x._currentRefreshId=-1,x._refreshRate=1,x._samples=1,x._canRescale=!0,x.boundingBoxPosition=o.P.Zero(),(i=x.getScene())?(x._coordinatesMode=a.x.PROJECTION_MODE,x.renderList=new Array,x.name=t,x.isRenderTarget=!0,x._initialSizeParameter=r,x._processSizeParameter(r),x._resizeObserver=x.getScene().getEngine().onResizeObservable.add((function(){})),x._generateMipMaps=!!s,x._doNotChangeAspectRatio=u,x._renderingManager=new h.$(i),x._renderingManager._useSceneAutoClearSetup=!0,_||(x._renderTargetOptions={generateMipMaps:s,type:c,format:null!==(b=x._format)&&void 0!==b?b:void 0,samplingMode:x.samplingMode,generateDepthBuffer:f,generateStencilBuffer:d,samples:y,creationFlags:v},x.samplingMode===a.x.NEAREST_SAMPLINGMODE&&(x.wrapU=a.x.CLAMP_ADDRESSMODE,x.wrapV=a.x.CLAMP_ADDRESSMODE),m||(l?(x._texture=i.getEngine().createRenderTargetCubeTexture(x.getRenderSize(),x._renderTargetOptions),x.coordinatesMode=a.x.INVCUBIC_MODE,x._textureMatrix=o.y3.Identity()):x._texture=i.getEngine().createRenderTargetTexture(x._size,x._renderTargetOptions),void 0!==y&&(x.samples=y))),x):x}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"renderList",{get:function(){return this._renderList},set:function(e){this._renderList=e,this._renderList&&this._hookArray(this._renderList)},enumerable:!1,configurable:!0}),t.prototype._hookArray=function(e){var t=this,r=e.push;e.push=function(){for(var i,n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];var o=0===e.length,a=r.apply(e,n);return o&&(null===(i=t.getScene())||void 0===i||i.meshes.forEach((function(e){e._markSubMeshesAsLightDirty()}))),a};var i=e.splice;e.splice=function(r,n){var s,o=i.apply(e,[r,n]);return 0===e.length&&(null===(s=t.getScene())||void 0===s||s.meshes.forEach((function(e){e._markSubMeshesAsLightDirty()}))),o}},Object.defineProperty(t.prototype,"postProcesses",{get:function(){return this._postProcesses},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_prePassEnabled",{get:function(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onAfterUnbind",{set:function(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onClear",{set:function(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!1,configurable:!0}),t.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(t.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(e){if(!this._boundingBoxSize||!this._boundingBoxSize.equals(e)){this._boundingBoxSize=e;var t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"depthStencilTexture",{get:function(){var e;return(null===(e=this.getInternalTexture())||void 0===e?void 0:e._depthStencilTexture)||null},enumerable:!1,configurable:!0}),t.prototype.createDepthStencilTexture=function(e,t,r,i){var n;void 0===e&&(e=0),void 0===t&&(t=!0),void 0===r&&(r=!1),void 0===i&&(i=1);var s=this.getInternalTexture();if(this.getScene()&&s){null===(n=s._depthStencilTexture)||void 0===n||n.dispose();var o=this.getScene().getEngine();s._depthStencilTexture=o.createDepthStencilTexture(this._size,{bilinearFiltering:t,comparisonFunction:e,generateStencil:r,isCube:this.isCube,samples:i})}},t.prototype._processSizeParameter=function(e){if(e.ratio){this._sizeRatio=e.ratio;var t=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(t.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(t.getRenderHeight(),this._sizeRatio)}}else this._size=e},Object.defineProperty(t.prototype,"samples",{get:function(){return this._samples},set:function(e){if(this._samples!==e){var t=this.getScene();t&&(this._samples=t.getEngine().updateRenderTargetTextureSampleCount(this._texture,e))}},enumerable:!1,configurable:!0}),t.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(t.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(e){this._refreshRate=e,this.resetRefreshCounter()},enumerable:!1,configurable:!0}),t.prototype.addPostProcess=function(e){if(!this._postProcessManager){var t=this.getScene();if(!t)return;this._postProcessManager=new u.O(t),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1},t.prototype.clearPostProcesses=function(e){if(void 0===e&&(e=!1),this._postProcesses){if(e)for(var t=0,r=this._postProcesses;t<r.length;t++)r[t].dispose();this._postProcesses=[]}},t.prototype.removePostProcess=function(e){if(this._postProcesses){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},t.prototype._shouldRender=function(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},t.prototype.getRenderSize=function(){return this.getRenderWidth()},t.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},t.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},t.prototype.getRenderLayers=function(){return this._size.layers||0},t.prototype.disableRescaling=function(){this._canRescale=!1},Object.defineProperty(t.prototype,"canRescale",{get:function(){return this._canRescale},enumerable:!1,configurable:!0}),t.prototype.scale=function(e){var t=Math.max(1,this.getRenderSize()*e);this.resize(t)},t.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:e.prototype.getReflectionTextureMatrix.call(this)},t.prototype.resize=function(e){var t=this.isCube;this.releaseInternalTexture();var r=this.getScene();r&&(this._processSizeParameter(e),this._texture=t?r.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):r.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))},t.prototype.render=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),a=this.getScene()){var r,i=a.getEngine();if(void 0!==this.useCameraPostProcesses&&(e=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var n=0;n<this._waitingRenderList.length;n++){var s=this._waitingRenderList[n],o=a.getMeshById(s);o&&this.renderList.push(o)}this._waitingRenderList=void 0}if(this.renderListPredicate){var a;if(this.renderList?this.renderList.length=0:this.renderList=[],!(a=this.getScene()))return;var u=a.meshes;for(n=0;n<u.length;n++){var h=u[n];this.renderListPredicate(h)&&this.renderList.push(h)}}if(this.onBeforeBindObservable.notifyObservers(this),this.activeCamera?(r=this.activeCamera,i.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==a.activeCamera&&a.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(r=a.activeCamera)&&i.setViewport(r.viewport,this.getRenderWidth(),this.getRenderHeight()),this._defaultRenderListPrepared=!1,this.is2DArray)for(var c=0;c<this.getRenderLayers();c++)this.renderToTarget(0,e,t,c,r),a.incrementRenderId(),a.resetCachedMaterial();else if(this.isCube)for(var l=0;l<6;l++)this.renderToTarget(l,e,t,void 0,r),a.incrementRenderId(),a.resetCachedMaterial();else this.renderToTarget(0,e,t,void 0,r);this.onAfterUnbindObservable.notifyObservers(this),a.activeCamera&&((a.getEngine().scenes.length>1||this.activeCamera&&this.activeCamera!==a.activeCamera)&&a.setTransformMatrix(a.activeCamera.getViewMatrix(),a.activeCamera.getProjectionMatrix(!0)),i.setViewport(a.activeCamera.viewport)),a.resetCachedMaterial()}},t.prototype._bestReflectionRenderTargetDimension=function(e,t){var r=e*t,i=c.D.NearestPOT(r+16384/(128+r));return Math.min(c.D.FloorPOT(e),i)},t.prototype._prepareRenderingManager=function(e,t,r,i){var n=this.getScene();if(n){this._renderingManager.reset();for(var s=n.getRenderId(),o=0;o<t;o++){var a=e[o];if(a&&!a.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(a,this.refreshRate)){this.resetRefreshCounter();continue}}else if(!a.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!a._internalAbstractMeshDataInfo._currentLODIsUpToDate&&n.activeCamera&&(a._internalAbstractMeshDataInfo._currentLOD=n.customLODSelector?n.customLODSelector(a,n.activeCamera):a.getLOD(n.activeCamera),a._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!a._internalAbstractMeshDataInfo._currentLOD)continue;var u=a._internalAbstractMeshDataInfo._currentLOD;u._preActivateForIntermediateRendering(s);var h;if(h=!(!i||!r)&&0==(a.layerMask&r.layerMask),a.isEnabled()&&a.isVisible&&a.subMeshes&&!h&&(u!==a&&u._activate(s,!0),a._activate(s,!0)&&a.subMeshes.length)){a.isAnInstance?a._internalAbstractMeshDataInfo._actAsRegularMesh&&(u=a):u._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,u._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var c=0;c<u.subMeshes.length;c++){var l=u.subMeshes[c];this._renderingManager.dispatch(l,u)}}}}for(var p=0;p<n.particleSystems.length;p++){var f=n.particleSystems[p],d=f.emitter;f.isStarted()&&d&&d.position&&d.isEnabled()&&e.indexOf(d)>=0&&this._renderingManager.dispatchParticles(f)}}},t.prototype._bindFrameBuffer=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0);var r=this.getScene();if(r){var i=r.getEngine();this._texture&&i.bindFramebuffer(this._texture,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,t)}},t.prototype.unbindFrameBuffer=function(e,t){var r=this;this._texture&&e.unBindFramebuffer(this._texture,this.isCube,(function(){r.onAfterRenderObservable.notifyObservers(t)}))},t.prototype._prepareFrame=function(e,t,r,i){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):i&&e.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(t,r)},t.prototype.renderToTarget=function(e,t,r,i,n){var o,a;void 0===i&&(i=0),void 0===n&&(n=null);var u=this.getScene();if(u){var h=u.getEngine();if(this._texture){if(null===(o=h._debugPushGroup)||void 0===o||o.call(h,"render to face #"+e+" layer #"+i,1),this._prepareFrame(u,e,i,t),this.is2DArray?this.onBeforeRenderObservable.notifyObservers(i):this.onBeforeRenderObservable.notifyObservers(e),!h.snapshotRendering||1!==h.snapshotRenderingMode){var c=null,l=this.renderList?this.renderList:u.getActiveMeshes().data,p=this.renderList?this.renderList.length:u.getActiveMeshes().length;this.getCustomRenderList&&(c=this.getCustomRenderList(this.is2DArray?i:e,l,p)),c?this._prepareRenderingManager(c,c.length,n,!1):(this._defaultRenderListPrepared||(this._prepareRenderingManager(l,p,n,!this.renderList),this._defaultRenderListPrepared=!0),c=l);for(var f=0,d=u._beforeRenderTargetClearStage;f<d.length;f++)d[f].action(this,e,i);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(h):h.clear(this.clearColor||u.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||u.updateTransformMatrix(!0);for(var _=0,g=u._beforeRenderTargetDrawStage;_<g.length;_++)g[_].action(this,e,i);this._renderingManager.render(this.customRenderFunction,c,this.renderParticles,this.renderSprites);for(var m=0,y=u._afterRenderTargetDrawStage;m<y.length;m++)y[m].action(this,e,i);var v=this._texture.generateMipMaps;this._texture.generateMipMaps=!1,this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,e,this._postProcesses,this.ignoreCameraViewport):t&&u.postProcessManager._finalizeFrame(!1,this._texture,e),this._texture.generateMipMaps=v,this._doNotChangeAspectRatio||u.updateTransformMatrix(!0),r&&s.w1.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),h)}this.unbindFrameBuffer(h,e),this.isCube&&5===e&&h.generateMipMapsForCubemap(this._texture),null===(a=h._debugPopGroup)||void 0===a||a.call(h,1)}}},t.prototype.setRenderingOrder=function(e,t,r,i){void 0===t&&(t=null),void 0===r&&(r=null),void 0===i&&(i=null),this._renderingManager.setRenderingOrder(e,t,r,i)},t.prototype.setRenderingAutoClearDepthStencil=function(e,t){this._renderingManager.setRenderingAutoClearDepthStencil(e,t),this._renderingManager._useSceneAutoClearSetup=!1},t.prototype.clone=function(){var e=this.getSize(),r=new t(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.coordinatesMode=this.coordinatesMode,this.renderList&&(r.renderList=this.renderList.slice(0)),r},t.prototype.serialize=function(){if(!this.name)return null;var t=e.prototype.serialize.call(this);if(t.renderTargetSize=this.getRenderSize(),t.renderList=[],this.renderList)for(var r=0;r<this.renderList.length;r++)t.renderList.push(this.renderList[r].id);return t},t.prototype.disposeFramebufferObjects=function(){var e=this.getInternalTexture(),t=this.getScene();e&&t&&t.getEngine()._releaseFramebufferObjects(e)},t.prototype.dispose=function(){this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var t=this.getScene();if(t){var r=t.customRenderTargets.indexOf(this);r>=0&&t.customRenderTargets.splice(r,1);for(var i=0,n=t.cameras;i<n.length;i++){var s=n[i];(r=s.customRenderTargets.indexOf(this))>=0&&s.customRenderTargets.splice(r,1)}this.depthStencilTexture&&this.getScene().getEngine()._releaseTexture(this.depthStencilTexture),e.prototype.dispose.call(this)}},t.prototype._rebuild=function(){this.refreshRate===t.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=t.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},t.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},t.prototype.getViewCount=function(){return 1},t.REFRESHRATE_RENDER_ONCE=0,t.REFRESHRATE_RENDER_ONEVERYFRAME=1,t.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,t}(a.x);a.x._CreateRenderTargetTexture=function(e,t,r,i,n){return new l(e,t,r,i)}},1263:(e,t,r)=>{"use strict";r.d(t,{x:()=>_});var i=r(3940),n=r(3536),s=r(8131),o=r(4471),a=r(3990),u=r(2997),h=r(7936),c=r(6684),l=r(5472),p=r(3303),f=r(2519),d=r(5192),_=function(e){function t(r,i,n,o,a,u,h,l,p,f,d,_,g){var m,y,v,b,x,R,T,E;void 0===o&&(o=!0),void 0===a&&(a=t.TRILINEAR_SAMPLINGMODE),void 0===u&&(u=null),void 0===h&&(h=null),void 0===l&&(l=null),void 0===p&&(p=!1);var S,C=e.call(this,i)||this;C.url=null,C.uOffset=0,C.vOffset=0,C.uScale=1,C.vScale=1,C.uAng=0,C.vAng=0,C.wAng=0,C.uRotationCenter=.5,C.vRotationCenter=.5,C.wRotationCenter=.5,C.homogeneousRotationInUVTransform=!1,C.inspectableCustomProperties=null,C._noMipmap=!1,C._invertY=!1,C._rowGenerationMatrix=null,C._cachedTextureMatrix=null,C._projectionModeMatrix=null,C._t0=null,C._t1=null,C._t2=null,C._cachedUOffset=-1,C._cachedVOffset=-1,C._cachedUScale=0,C._cachedVScale=0,C._cachedUAng=-1,C._cachedVAng=-1,C._cachedWAng=-1,C._cachedProjectionMatrixId=-1,C._cachedURotationCenter=-1,C._cachedVRotationCenter=-1,C._cachedWRotationCenter=-1,C._cachedHomogeneousRotationInUVTransform=!1,C._cachedCoordinatesMode=-1,C._buffer=null,C._deleteBuffer=!1,C._format=null,C._delayedOnLoad=null,C._delayedOnError=null,C.onLoadObservable=new s.y$,C._isBlocking=!0,C.name=r||"",C.url=r;var A=!1;"object"==typeof n&&null!==n?(S=null!==(m=n.noMipmap)&&void 0!==m&&m,o=null===(y=n.invertY)||void 0===y||y,a=null!==(v=n.samplingMode)&&void 0!==v?v:t.TRILINEAR_SAMPLINGMODE,u=null!==(b=n.onLoad)&&void 0!==b?b:null,h=null!==(x=n.onError)&&void 0!==x?x:null,l=null!==(R=n.buffer)&&void 0!==R?R:null,p=null!==(T=n.deleteBuffer)&&void 0!==T&&T,f=n.format,d=n.mimeType,_=n.loaderOptions,g=n.creationFlags,A=null!==(E=n.useSRGBBuffer)&&void 0!==E&&E):S=!!n,C._noMipmap=S,C._invertY=o,C._initialSamplingMode=a,C._buffer=l,C._deleteBuffer=p,C._mimeType=d,C._loaderOptions=_,C._creationFlags=g,C._useSRGBBuffer=A,f&&(C._format=f);var F=C.getScene(),P=C._getEngine();if(!P)return C;P.onBeforeTextureInitObservable.notifyObservers(C);var w=function(){C._texture&&(C._texture._invertVScale&&(C.vScale*=-1,C.vOffset+=1),null!==C._texture._cachedWrapU&&(C.wrapU=C._texture._cachedWrapU,C._texture._cachedWrapU=null),null!==C._texture._cachedWrapV&&(C.wrapV=C._texture._cachedWrapV,C._texture._cachedWrapV=null),null!==C._texture._cachedWrapR&&(C.wrapR=C._texture._cachedWrapR,C._texture._cachedWrapR=null)),C.onLoadObservable.hasObservers()&&C.onLoadObservable.notifyObservers(C),u&&u(),!C.isBlocking&&F&&F.resetCachedMaterial()};if(!C.url)return C._delayedOnLoad=w,C._delayedOnError=h,C;if(C._texture=C._getFromCache(C.url,S,a,o,A),C._texture)C._texture.isReady?c.Q.SetImmediate((function(){return w()})):C._texture.onLoadedObservable.add(w);else if(F&&F.useDelayedTextureLoading)C.delayLoadState=4,C._delayedOnLoad=w,C._delayedOnError=h;else{try{C._texture=P.createTexture(C.url,S,o,F,a,w,h,C._buffer,void 0,C._format,null,d,_,g,A)}catch(e){throw h&&h(e.message,e),e}p&&(C._buffer=null)}return C}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mimeType",{get:function(){return this._mimeType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(e){this._isBlocking=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"invertY",{get:function(){return this._invertY},enumerable:!1,configurable:!0}),t.prototype.updateURL=function(e,t,r){void 0===t&&(t=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1)),this.name&&!f.M.StartsWith(this.name,"data:")||(this.name=e),this.url=e,this._buffer=t,this.delayLoadState=4,r&&(this._delayedOnLoad=r),this.delayLoad()},t.prototype.delayLoad=function(){if(4===this.delayLoadState){var e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer),this._texture?this._delayedOnLoad&&(this._texture.isReady?c.Q.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,null,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}},t.prototype._prepareRowForTextureGeneration=function(e,t,r,i){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,r-=this.wRotationCenter,o.P.TransformCoordinatesFromFloatsToRef(e,t,r,this._rowGenerationMatrix,i),i.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,i.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,i.z+=this.wRotationCenter},t.prototype.checkTransformsAreIdentical=function(e){return null!==e&&this.uOffset===e.uOffset&&this.vOffset===e.vOffset&&this.uScale===e.uScale&&this.vScale===e.vScale&&this.uAng===e.uAng&&this.vAng===e.vAng&&this.wAng===e.wAng},t.prototype.getTextureMatrix=function(e){var t=this;if(void 0===e&&(e=1),this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=o.y3.Zero(),this._rowGenerationMatrix=new o.y3,this._t0=o.P.Zero(),this._t1=o.P.Zero(),this._t2=o.P.Zero()),o.y3.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(o.y3.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,o.jp.Matrix[0]),o.y3.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,o.jp.Matrix[1]),o.y3.ScalingToRef(this._cachedUScale,this._cachedVScale,0,o.jp.Matrix[2]),o.y3.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,o.jp.Matrix[3]),o.jp.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(o.jp.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(o.jp.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(o.jp.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),o.y3.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));var r=this.getScene();return r?(r.markAllMaterialsAsDirty(1,(function(e){return e.hasTexture(t)})),this._cachedTextureMatrix):this._cachedTextureMatrix},t.prototype.getReflectionTextureMatrix=function(){var e=this,r=this.getScene();if(!r)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode){if(this.coordinatesMode!==t.PROJECTION_MODE)return this._cachedTextureMatrix;if(this._cachedProjectionMatrixId===r.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=o.y3.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=o.y3.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case t.PLANAR_MODE:o.y3.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case t.PROJECTION_MODE:o.y3.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var i=r.getProjectionMatrix();this._cachedProjectionMatrixId=i.updateFlag,i.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:o.y3.IdentityToRef(this._cachedTextureMatrix)}return r.markAllMaterialsAsDirty(1,(function(t){return-1!==t.getActiveTextures().indexOf(e)})),this._cachedTextureMatrix},t.prototype.clone=function(){var e=this;return n.p4.Clone((function(){return new t(e._texture?e._texture.url:null,e.getScene(),e._noMipmap,e._invertY,e.samplingMode,void 0,void 0,e._texture?e._texture._buffer:void 0)}),this)},t.prototype.serialize=function(){var r=this.name;t.SerializeBuffers||f.M.StartsWith(this.name,"data:")&&(this.name=""),f.M.StartsWith(this.name,"data:")&&this.url===this.name&&(this.url="");var i=e.prototype.serialize.call(this);return i?((t.SerializeBuffers||t.ForceSerializeBuffers)&&("string"==typeof this._buffer&&"data:"===this._buffer.substr(0,5)?(i.base64String=this._buffer,i.name=i.name.replace("data:","")):this.url&&f.M.StartsWith(this.url,"data:")&&this._buffer instanceof Uint8Array?i.base64String="data:image/png;base64,"+f.M.EncodeArrayBufferToBase64(this._buffer):t.ForceSerializeBuffers&&(i.base64String=!this._engine||this._engine._features.supportSyncTextureRead?d.r.GenerateBase64StringFromTexture(this):d.r.GenerateBase64StringFromTextureAsync(this))),i.invertY=this._invertY,i.samplingMode=this.samplingMode,i._creationFlags=this._creationFlags,i._useSRGBBuffer=this._useSRGBBuffer,this.name=r,i):null},t.prototype.getClassName=function(){return"Texture"},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},t.Parse=function(e,r,i){if(e.customType){var s=l.K.Instantiate(e.customType).Parse(e,r,i);return e.samplingMode&&s.updateSamplingMode&&s._samplingMode&&s._samplingMode!==e.samplingMode&&s.updateSamplingMode(e.samplingMode),s}if(e.isCube&&!e.isRenderTarget)return t._CubeTextureParser(e,r,i);if(!e.name&&!e.isRenderTarget)return null;var o=function(){if(a&&a._texture&&(a._texture._cachedWrapU=null,a._texture._cachedWrapV=null,a._texture._cachedWrapR=null),e.samplingMode){var t=e.samplingMode;a&&a.samplingMode!==t&&a.updateSamplingMode(t)}if(a&&e.animations)for(var r=0;r<e.animations.length;r++){var i=e.animations[r],n=u.Q.GetClass("BABYLON.Animation");n&&a.animations.push(n.Parse(i))}},a=n.p4.Parse((function(){var n,s,a,u,h=!0;if(e.noMipmap&&(h=!1),e.mirrorPlane){var c=t._CreateMirror(e.name,e.renderTargetSize,r,h);return c._waitingRenderList=e.renderList,c.mirrorPlane=p.J.FromArray(e.mirrorPlane),o(),c}if(e.isRenderTarget){var l=null;if(e.isCube){if(r.reflectionProbes)for(var d=0;d<r.reflectionProbes.length;d++){var _=r.reflectionProbes[d];if(_.name===e.name)return _.cubeTexture}}else(l=t._CreateRenderTargetTexture(e.name,e.renderTargetSize,r,h,null!==(n=e._creationFlags)&&void 0!==n?n:0))._waitingRenderList=e.renderList;return o(),l}if(e.base64String)u=t.CreateFromBase64String(e.base64String,e.name,r,!h,e.invertY,e.samplingMode,o,null!==(s=e._creationFlags)&&void 0!==s?s:0,null!==(a=e._useSRGBBuffer)&&void 0!==a&&a);else{var g=void 0;g=e.name&&e.name.indexOf("://")>0?e.name:i+e.name,(f.M.StartsWith(e.url,"data:")||t.UseSerializedUrlIfAny&&e.url)&&(g=e.url),u=new t(g,r,!h,e.invertY,e.samplingMode,o)}return u}),e,r);return a},t.CreateFromBase64String=function(e,r,i,n,s,o,a,u,h,c){return void 0===o&&(o=t.TRILINEAR_SAMPLINGMODE),void 0===a&&(a=null),void 0===u&&(u=null),void 0===h&&(h=5),new t("data:"+r,i,n,s,o,a,u,e,!1,h,void 0,void 0,c)},t.LoadFromDataString=function(e,r,i,n,s,o,a,u,h,c,l){return void 0===n&&(n=!1),void 0===o&&(o=!0),void 0===a&&(a=t.TRILINEAR_SAMPLINGMODE),void 0===u&&(u=null),void 0===h&&(h=null),void 0===c&&(c=5),"data:"!==e.substr(0,5)&&(e="data:"+e),new t(e,i,s,o,a,u,h,r,n,c,void 0,void 0,l)},t.SerializeBuffers=!0,t.ForceSerializeBuffers=!1,t._CubeTextureParser=function(e,t,r){throw h.f.WarnImport("CubeTexture")},t._CreateMirror=function(e,t,r,i){throw h.f.WarnImport("MirrorTexture")},t._CreateRenderTargetTexture=function(e,t,r,i,n){throw h.f.WarnImport("RenderTargetTexture")},t.NEAREST_SAMPLINGMODE=1,t.NEAREST_NEAREST_MIPLINEAR=8,t.BILINEAR_SAMPLINGMODE=2,t.LINEAR_LINEAR_MIPNEAREST=11,t.TRILINEAR_SAMPLINGMODE=3,t.LINEAR_LINEAR_MIPLINEAR=3,t.NEAREST_NEAREST_MIPNEAREST=4,t.NEAREST_LINEAR_MIPNEAREST=5,t.NEAREST_LINEAR_MIPLINEAR=6,t.NEAREST_LINEAR=7,t.NEAREST_NEAREST=1,t.LINEAR_NEAREST_MIPNEAREST=9,t.LINEAR_NEAREST_MIPLINEAR=10,t.LINEAR_LINEAR=2,t.LINEAR_NEAREST=12,t.EXPLICIT_MODE=0,t.SPHERICAL_MODE=1,t.PLANAR_MODE=2,t.CUBIC_MODE=3,t.PROJECTION_MODE=4,t.SKYBOX_MODE=5,t.INVCUBIC_MODE=6,t.EQUIRECTANGULAR_MODE=7,t.FIXED_EQUIRECTANGULAR_MODE=8,t.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,t.CLAMP_ADDRESSMODE=0,t.WRAP_ADDRESSMODE=1,t.MIRROR_ADDRESSMODE=2,t.UseSerializedUrlIfAny=!1,(0,i.gn)([(0,n.qC)()],t.prototype,"url",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"uOffset",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"vOffset",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"uScale",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"vScale",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"uAng",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"vAng",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"wAng",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"uRotationCenter",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"vRotationCenter",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"wRotationCenter",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"homogeneousRotationInUVTransform",void 0),(0,i.gn)([(0,n.qC)()],t.prototype,"isBlocking",null),t}(a.V);u.Q.RegisteredTypes["BABYLON.Texture"]=_,n.p4._TextureParser=_.Parse},1688:(e,t,r)=>{"use strict";r.d(t,{g:()=>n});var i=r(8878),n=function(){function e(e){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=i.$.Zero(),this._cachedBaseSize=i.$.Zero(),this._initialSamplingMode=2,this._texture=e,this._texture&&(this._engine=this._texture.getEngine())}return Object.defineProperty(e.prototype,"wrapU",{get:function(){return this._wrapU},set:function(e){this._wrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapV",{get:function(){return this._wrapV},set:function(e){this._wrapV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coordinatesMode",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCube",{get:function(){return!!this._texture&&this._texture.isCube},set:function(e){this._texture&&(this._texture.isCube=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"is3D",{get:function(){return!!this._texture&&this._texture.is3D},set:function(e){this._texture&&(this._texture.is3D=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"is2DArray",{get:function(){return!!this._texture&&this._texture.is2DArray},set:function(e){this._texture&&(this._texture.is2DArray=e)},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"ThinTexture"},e.prototype.isReady=function(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady},e.prototype.delayLoad=function(){},e.prototype.getInternalTexture=function(){return this._texture},e.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},e.prototype.getBaseSize=function(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)},Object.defineProperty(e.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!1,configurable:!0}),e.prototype.updateSamplingMode=function(e){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture)},e.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},e.prototype.dispose=function(){this._texture&&(this.releaseInternalTexture(),this._engine=null)},e}()},9666:(e,t,r)=>{"use strict";r.d(t,{q:()=>i});var i=function(){function e(e,t){void 0===t&&(t=!0),this.effect=null,this.defines=null,this.drawContext=e.createDrawContext(),t&&(this.materialContext=e.createMaterialContext())}return e.IsWrapper=function(e){return void 0===e.getPipelineContext},e.GetEffect=function(e){return void 0===e.getPipelineContext?e.effect:e},e.prototype.setEffect=function(e,t){this.effect=e,void 0!==t&&(this.defines=t)},e}()},5589:(e,t,r)=>{"use strict";r.d(t,{Q:()=>u});var i=r(8131),n=r(5511),s=r(4462),o=r(5210),a=r(2457),u=function(){function e(t,r,s,a,u,h,c,l,p,f,d){var _,g=this;void 0===a&&(a=null),void 0===h&&(h=null),void 0===c&&(c=null),void 0===l&&(l=null),void 0===p&&(p=null),void 0===d&&(d=""),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new i.y$,this.onErrorObservable=new i.y$,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this.name=t,this._key=d;var m,y,v=null;if(r.attributes){var b=r;if(this._engine=s,this._attributesNames=b.attributes,this._uniformsNames=b.uniformsNames.concat(b.samplers),this._samplerList=b.samplers.slice(),this.defines=b.defines,this.onError=b.onError,this.onCompiled=b.onCompiled,this._fallbacks=b.fallbacks,this._indexParameters=b.indexParameters,this._transformFeedbackVaryings=b.transformFeedbackVaryings||null,this._multiTarget=!!b.multiTarget,b.uniformBuffersNames){this._uniformBuffersNamesList=b.uniformBuffersNames.slice();for(var x=0;x<b.uniformBuffersNames.length;x++)this._uniformBuffersNames[b.uniformBuffersNames[x]]=x}v=null!==(_=b.processFinalCode)&&void 0!==_?_:null}else this._engine=u,this.defines=null==h?"":h,this._uniformsNames=s.concat(a),this._samplerList=a?a.slice():[],this._attributesNames=r,this._uniformBuffersNamesList=[],this.onError=p,this.onCompiled=l,this._indexParameters=f,this._fallbacks=c;this._attributeLocationByName={},this.uniqueId=e._uniqueIdSeed++;var R=n.M.IsWindowObjectExist()?this._engine.getHostDocument():null;t.vertexSource?m="source:"+t.vertexSource:t.vertexElement?(m=R?R.getElementById(t.vertexElement):null)||(m=t.vertexElement):m=t.vertex||t,t.fragmentSource?y="source:"+t.fragmentSource:t.fragmentElement?(y=R?R.getElementById(t.fragmentElement):null)||(y=t.fragmentElement):y=t.fragment||t,this._processingContext=this._engine._getShaderProcessingContext();var T={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._shaderProcessor,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:e.ShadersRepository,includesShadersStore:e.IncludesShadersStore,version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer},E=[void 0,void 0],S=function(){if(E[0]&&E[1]){T.isFragment=!0;var e=E[0],r=E[1];o.L.Process(r,T,(function(r){v&&(r=v("fragment",r));var i=o.L.Finalize(e,r,T);g._useFinalCode(i.vertexCode,i.fragmentCode,t)}),g._engine)}};this._loadShader(m,"Vertex","",(function(e){o.L.Initialize(T),o.L.Process(e,T,(function(t){g._rawVertexSourceCode=e,v&&(t=v("vertex",t)),E[0]=t,S()}),g._engine)})),this._loadShader(y,"Fragment","Pixel",(function(e){g._rawFragmentSourceCode=e,E[1]=e,S()}))}return Object.defineProperty(e,"ShadersRepository",{get:function(){return a.v.ShadersRepository},set:function(e){a.v.ShadersRepository=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new i.y$),this._onBindObservable},enumerable:!1,configurable:!0}),e.prototype._useFinalCode=function(e,t,r){if(r){var i=r.vertexElement||r.vertex||r.spectorName||r,n=r.fragmentElement||r.fragment||r.spectorName||r;this._vertexSourceCode="#define SHADER_NAME vertex:"+i+"\n"+e,this._fragmentSourceCode="#define SHADER_NAME fragment:"+n+"\n"+t}else this._vertexSourceCode=e,this._fragmentSourceCode=t;this._prepareEffect()},Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),e.prototype.isReady=function(){try{return this._isReadyInternal()}catch(e){return!1}},e.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},e.prototype.getEngine=function(){return this._engine},e.prototype.getPipelineContext=function(){return this._pipelineContext},e.prototype.getAttributesNames=function(){return this._attributesNames},e.prototype.getAttributeLocation=function(e){return this._attributes[e]},e.prototype.getAttributeLocationByName=function(e){return this._attributeLocationByName[e]},e.prototype.getAttributesCount=function(){return this._attributes.length},e.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},e.prototype.getUniform=function(e){return this._uniforms[e]},e.prototype.getSamplers=function(){return this._samplerList},e.prototype.getUniformNames=function(){return this._uniformsNames},e.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},e.prototype.getIndexParameters=function(){return this._indexParameters},e.prototype.getCompilationError=function(){return this._compilationError},e.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},e.prototype.executeWhenCompiled=function(e){var t=this;this.isReady()?e(this):(this.onCompileObservable.add((function(t){e(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((function(){t._checkIsReady(null)}),16))},e.prototype._checkIsReady=function(e){var t=this;try{if(this._isReadyInternal())return}catch(t){return void this._processCompilationErrors(t,e)}setTimeout((function(){t._checkIsReady(e)}),16)},e.prototype._loadShader=function(t,r,i,s){var o;"undefined"!=typeof HTMLElement&&t instanceof HTMLElement?s(n.M.GetDOMTextContent(t)):"source:"!==t.substr(0,7)?"base64:"!==t.substr(0,7)?e.ShadersStore[t+r+"Shader"]?s(e.ShadersStore[t+r+"Shader"]):i&&e.ShadersStore[t+i+"Shader"]?s(e.ShadersStore[t+i+"Shader"]):(o="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:e.ShadersRepository+t,this._engine._loadFile(o+"."+r.toLowerCase()+".fx",s)):s(window.atob(t.substr(7))):s(t.substr(7))},Object.defineProperty(e.prototype,"vertexSourceCode",{get:function(){var e,t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:null!==(t=null===(e=this._pipelineContext)||void 0===e?void 0:e._getVertexShaderCode())&&void 0!==t?t:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fragmentSourceCode",{get:function(){var e,t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:null!==(t=null===(e=this._pipelineContext)||void 0===e?void 0:e._getFragmentShaderCode())&&void 0!==t?t:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),e.prototype._rebuildProgram=function(e,t,r,i){var n=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){i&&i(t)},this.onCompiled=function(){var e=n.getEngine().scenes;if(e)for(var t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(63);n._pipelineContext._handlesSpectorRebuildCallback(r)},this._fallbacks=null,this._prepareEffect()},e.prototype._prepareEffect=function(){var e=this,t=this._attributesNames,r=this.defines,i=this._pipelineContext;this._isReady=!1;try{var n=this._engine;this._pipelineContext=n.createPipelineContext(this._processingContext),this._pipelineContext._name=this._key;var s=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?n._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,this._rawVertexSourceCode,this._rawFragmentSourceCode,s,null,this._transformFeedbackVaryings,this._key):n._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,this._rawVertexSourceCode,this._rawFragmentSourceCode,s,r,this._transformFeedbackVaryings,this._key),n._executeWhenRenderingStateIsCompiled(this._pipelineContext,(function(){if(e._attributes=[],e._pipelineContext._fillEffectInformation(e,e._uniformBuffersNames,e._uniformsNames,e._uniforms,e._samplerList,e._samplers,t,e._attributes),t)for(var r=0;r<t.length;r++){var s=t[r];e._attributeLocationByName[s]=e._attributes[r]}n.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),i&&e.getEngine()._deletePipelineContext(i)})),this._pipelineContext.isAsync&&this._checkIsReady(i)}catch(e){this._processCompilationErrors(e,i)}},e.prototype._getShaderCodeAndErrorLine=function(e,t,r){var i=r?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,n=null;if(t&&e){var s=t.match(i);if(s&&2===s.length){var o=parseInt(s[1]),a=e.split("\n",-1);a.length>=o&&(n="Offending line ["+o+"] in "+(r?"fragment":"vertex")+" code: "+a[o-1])}}return[e,n]},e.prototype._processCompilationErrors=function(t,r){var i,n,o,a,u;void 0===r&&(r=null),this._compilationError=t.message;var h=this._attributesNames,c=this._fallbacks;if(s.Y.Error("Unable to compile effect:"),s.Y.Error("Uniforms: "+this._uniformsNames.map((function(e){return" "+e}))),s.Y.Error("Attributes: "+h.map((function(e){return" "+e}))),s.Y.Error("Defines:\r\n"+this.defines),e.LogShaderCodeOnCompilationError){var l=null,p=null,f=null;(null===(o=this._pipelineContext)||void 0===o?void 0:o._getVertexShaderCode())&&(f=(i=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1))[0],l=i[1],f&&(s.Y.Error("Vertex code:"),s.Y.Error(f))),(null===(a=this._pipelineContext)||void 0===a?void 0:a._getFragmentShaderCode())&&(f=(n=this._getShaderCodeAndErrorLine(null===(u=this._pipelineContext)||void 0===u?void 0:u._getFragmentShaderCode(),this._compilationError,!0))[0],p=n[1],f&&(s.Y.Error("Fragment code:"),s.Y.Error(f))),l&&s.Y.Error(l),p&&s.Y.Error(p)}s.Y.Error("Error: "+this._compilationError),r&&(this._pipelineContext=r,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),c?(this._pipelineContext=null,c.hasMoreFallbacks?(this._allFallbacksProcessed=!1,s.Y.Error("Trying next fallback."),this.defines=c.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(e.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!1,configurable:!0}),e.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t,e)},e.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)},e.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)},e.prototype.setTextureArray=function(e,t){var r=e+"Ex";if(-1===this._samplerList.indexOf(r+"0")){for(var i=this._samplerList.indexOf(e),n=1;n<t.length;n++){var s=r+(n-1).toString();this._samplerList.splice(i+n,0,s)}for(var o=0,a=0,u=this._samplerList;a<u.length;a++){var h=u[a];this._samplers[h]=o,o+=1}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)},e.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t,e)},e.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t,e)},e.prototype.bindUniformBuffer=function(t,r){var i=this._uniformBuffersNames[r];void 0===i||e._baseCache[i]===t&&this._engine._features.useUBOBindingCache||(e._baseCache[i]=t,this._engine.bindUniformBufferBase(t,i,r))},e.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},e.prototype.setInt=function(e,t){return this._pipelineContext.setInt(e,t),this},e.prototype.setInt2=function(e,t,r){return this._pipelineContext.setInt2(e,t,r),this},e.prototype.setInt3=function(e,t,r,i){return this._pipelineContext.setInt3(e,t,r,i),this},e.prototype.setInt4=function(e,t,r,i,n){return this._pipelineContext.setInt4(e,t,r,i,n),this},e.prototype.setIntArray=function(e,t){return this._pipelineContext.setIntArray(e,t),this},e.prototype.setIntArray2=function(e,t){return this._pipelineContext.setIntArray2(e,t),this},e.prototype.setIntArray3=function(e,t){return this._pipelineContext.setIntArray3(e,t),this},e.prototype.setIntArray4=function(e,t){return this._pipelineContext.setIntArray4(e,t),this},e.prototype.setFloatArray=function(e,t){return this._pipelineContext.setArray(e,t),this},e.prototype.setFloatArray2=function(e,t){return this._pipelineContext.setArray2(e,t),this},e.prototype.setFloatArray3=function(e,t){return this._pipelineContext.setArray3(e,t),this},e.prototype.setFloatArray4=function(e,t){return this._pipelineContext.setArray4(e,t),this},e.prototype.setArray=function(e,t){return this._pipelineContext.setArray(e,t),this},e.prototype.setArray2=function(e,t){return this._pipelineContext.setArray2(e,t),this},e.prototype.setArray3=function(e,t){return this._pipelineContext.setArray3(e,t),this},e.prototype.setArray4=function(e,t){return this._pipelineContext.setArray4(e,t),this},e.prototype.setMatrices=function(e,t){return this._pipelineContext.setMatrices(e,t),this},e.prototype.setMatrix=function(e,t){return this._pipelineContext.setMatrix(e,t),this},e.prototype.setMatrix3x3=function(e,t){return this._pipelineContext.setMatrix3x3(e,t),this},e.prototype.setMatrix2x2=function(e,t){return this._pipelineContext.setMatrix2x2(e,t),this},e.prototype.setFloat=function(e,t){return this._pipelineContext.setFloat(e,t),this},e.prototype.setBool=function(e,t){return this._pipelineContext.setInt(e,t?1:0),this},e.prototype.setVector2=function(e,t){return this._pipelineContext.setVector2(e,t),this},e.prototype.setFloat2=function(e,t,r){return this._pipelineContext.setFloat2(e,t,r),this},e.prototype.setVector3=function(e,t){return this._pipelineContext.setVector3(e,t),this},e.prototype.setFloat3=function(e,t,r,i){return this._pipelineContext.setFloat3(e,t,r,i),this},e.prototype.setVector4=function(e,t){return this._pipelineContext.setVector4(e,t),this},e.prototype.setFloat4=function(e,t,r,i,n){return this._pipelineContext.setFloat4(e,t,r,i,n),this},e.prototype.setColor3=function(e,t){return this._pipelineContext.setColor3(e,t),this},e.prototype.setColor4=function(e,t,r){return this._pipelineContext.setColor4(e,t,r),this},e.prototype.setDirectColor4=function(e,t){return this._pipelineContext.setDirectColor4(e,t),this},e.prototype.dispose=function(){this._pipelineContext&&this._pipelineContext.dispose(),this._engine._releaseEffect(this)},e.RegisterShader=function(t,r,i){r&&(e.ShadersStore[t+"PixelShader"]=r),i&&(e.ShadersStore[t+"VertexShader"]=i)},e.ResetCache=function(){e._baseCache={}},e.LogShaderCodeOnCompilationError=!0,e._uniqueIdSeed=0,e._baseCache={},e.ShadersStore=a.v.ShadersStore,e.IncludesShadersStore=a.v.IncludesShadersStore,e}()},9104:(e,t,r)=>{"use strict";r.d(t,{M:()=>s});var i=r(4462),n=r(2281),s=(r(462),function(){function e(e,t,r,i){this._valueCache={},this._engine=e,this._noUBO=!e.supportsUniformBuffers,this._dynamic=r,this._name=null!=i?i:"no-name",this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform)}return Object.defineProperty(e.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!1,configurable:!0}),e.prototype.isDynamic=function(){return void 0!==this._dynamic},e.prototype.getData=function(){return this._bufferData},e.prototype.getBuffer=function(){return this._buffer},e.prototype._fillAlignment=function(e){var t;if(t=e<=2?e:4,this._uniformLocationPointer%t!=0){var r=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;for(var i=this._uniformLocationPointer-r,n=0;n<i;n++)this._data.push(0)}},e.prototype.addUniform=function(e,t,r){if(void 0===r&&(r=0),!this._noUBO&&void 0===this._uniformLocations[e]){var i;if(r>0){if(t instanceof Array)throw"addUniform should not be use with Array in UBO: "+e;this._fillAlignment(4),this._uniformArraySizes[e]={strideSize:t,arraySize:r},16==t?t*=r:t=t*r+(4-t)*r,i=[];for(var n=0;n<t;n++)i.push(0)}else{if(t instanceof Array)t=(i=t).length;else for(t=t,i=[],n=0;n<t;n++)i.push(0);this._fillAlignment(t)}for(this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t,n=0;n<t;n++)this._data.push(i[n]);this._needSync=!0}},e.prototype.addMatrix=function(e,t){this.addUniform(e,Array.prototype.slice.call(t.toArray()))},e.prototype.addFloat2=function(e,t,r){var i=[t,r];this.addUniform(e,i)},e.prototype.addFloat3=function(e,t,r,i){var n=[t,r,i];this.addUniform(e,n)},e.prototype.addColor3=function(e,t){var r=[t.r,t.g,t.b];this.addUniform(e,r)},e.prototype.addColor4=function(e,t,r){var i=[t.r,t.g,t.b,r];this.addUniform(e,i)},e.prototype.addVector3=function(e,t){var r=[t.x,t.y,t.z];this.addUniform(e,r)},e.prototype.addMatrix3x3=function(e){this.addUniform(e,12)},e.prototype.addMatrix2x2=function(e){this.addUniform(e,8)},e.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},e.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))},Object.defineProperty(e.prototype,"_numBuffers",{get:function(){return this._buffers.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_indexBuffer",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),e.prototype._buffersEqual=function(e,t){for(var r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0},e.prototype._copyBuffer=function(e,t){for(var r=0;r<e.length;++r)t[r]=e[r]},e.prototype.update=function(){var t;if(this._buffer)if(this._dynamic||this._needSync){if(null===(t=this._buffers)||void 0===t?void 0:t[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(e._updatedUbosInFrame[this._name]||(e._updatedUbosInFrame[this._name]=0),e._updatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()},e.prototype._createNewBuffer=function(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild(),this._currentEffect&&this._buffer&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)},e.prototype._checkNewFrame=function(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1,this._currentEffect&&this._buffer&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName))},e.prototype.updateUniform=function(e,t,r){this._checkNewFrame();var s=this._uniformLocations[e];if(void 0===s){if(this._buffer)return void i.Y.Error("Cannot add an uniform after UBO has been created.");this.addUniform(e,r),s=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(a=0;a<r;a++)this._bufferData[s+a]=t[a];else{for(var o=!1,a=0;a<r;a++)(16===r&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[s+a]!==n.w1.FloatRound(t[a]))&&(o=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[s+a]=t[a]);this._needSync=this._needSync||o}},e.prototype.updateUniformArray=function(e,t,r){this._checkNewFrame();var s=this._uniformLocations[e];if(void 0!==s){this._buffer||this.create();var o=this._uniformArraySizes[e];if(this._dynamic)for(c=0;c<r;c++)this._bufferData[s+c]=t[c];else{for(var a=!1,u=0,h=0,c=0;c<r;c++)if(this._bufferData[s+4*h+u]!==n.w1.FloatRound(t[c])&&(a=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[s+4*h+u]=t[c]),++u===o.strideSize){for(;u<4;u++)this._bufferData[s+4*h+u]=0;u=0,h++}this._needSync=this._needSync||a}}else i.Y.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform.")},e.prototype._cacheMatrix=function(e,t){this._checkNewFrame();var r=this._valueCache[e],i=t.updateFlag;return(void 0===r||r!==i)&&(this._valueCache[e]=i,!0)},e.prototype._updateMatrix3x3ForUniform=function(t,r){for(var i=0;i<3;i++)e._tempBuffer[4*i]=r[3*i],e._tempBuffer[4*i+1]=r[3*i+1],e._tempBuffer[4*i+2]=r[3*i+2],e._tempBuffer[4*i+3]=0;this.updateUniform(t,e._tempBuffer,12)},e.prototype._updateMatrix3x3ForEffect=function(e,t){this._currentEffect.setMatrix3x3(e,t)},e.prototype._updateMatrix2x2ForEffect=function(e,t){this._currentEffect.setMatrix2x2(e,t)},e.prototype._updateMatrix2x2ForUniform=function(t,r){for(var i=0;i<2;i++)e._tempBuffer[4*i]=r[2*i],e._tempBuffer[4*i+1]=r[2*i+1],e._tempBuffer[4*i+2]=0,e._tempBuffer[4*i+3]=0;this.updateUniform(t,e._tempBuffer,8)},e.prototype._updateFloatForEffect=function(e,t){this._currentEffect.setFloat(e,t)},e.prototype._updateFloatForUniform=function(t,r){e._tempBuffer[0]=r,this.updateUniform(t,e._tempBuffer,1)},e.prototype._updateFloat2ForEffect=function(e,t,r,i){void 0===i&&(i=""),this._currentEffect.setFloat2(e+i,t,r)},e.prototype._updateFloat2ForUniform=function(t,r,i){e._tempBuffer[0]=r,e._tempBuffer[1]=i,this.updateUniform(t,e._tempBuffer,2)},e.prototype._updateFloat3ForEffect=function(e,t,r,i,n){void 0===n&&(n=""),this._currentEffect.setFloat3(e+n,t,r,i)},e.prototype._updateFloat3ForUniform=function(t,r,i,n){e._tempBuffer[0]=r,e._tempBuffer[1]=i,e._tempBuffer[2]=n,this.updateUniform(t,e._tempBuffer,3)},e.prototype._updateFloat4ForEffect=function(e,t,r,i,n,s){void 0===s&&(s=""),this._currentEffect.setFloat4(e+s,t,r,i,n)},e.prototype._updateFloat4ForUniform=function(t,r,i,n,s){e._tempBuffer[0]=r,e._tempBuffer[1]=i,e._tempBuffer[2]=n,e._tempBuffer[3]=s,this.updateUniform(t,e._tempBuffer,4)},e.prototype._updateFloatArrayForEffect=function(e,t){this._currentEffect.setFloatArray(e,t)},e.prototype._updateFloatArrayForUniform=function(e,t){this.updateUniformArray(e,t,t.length)},e.prototype._updateArrayForEffect=function(e,t){this._currentEffect.setArray(e,t)},e.prototype._updateArrayForUniform=function(e,t){this.updateUniformArray(e,t,t.length)},e.prototype._updateIntArrayForEffect=function(e,t){this._currentEffect.setIntArray(e,t)},e.prototype._updateIntArrayForUniform=function(t,r){e._tempBufferInt32View.set(r),this.updateUniformArray(t,e._tempBuffer,r.length)},e.prototype._updateMatrixForEffect=function(e,t){this._currentEffect.setMatrix(e,t)},e.prototype._updateMatrixForUniform=function(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.toArray(),16)},e.prototype._updateMatricesForEffect=function(e,t){this._currentEffect.setMatrices(e,t)},e.prototype._updateMatricesForUniform=function(e,t){this.updateUniform(e,t,t.length)},e.prototype._updateVector3ForEffect=function(e,t){this._currentEffect.setVector3(e,t)},e.prototype._updateVector3ForUniform=function(t,r){e._tempBuffer[0]=r.x,e._tempBuffer[1]=r.y,e._tempBuffer[2]=r.z,this.updateUniform(t,e._tempBuffer,3)},e.prototype._updateVector4ForEffect=function(e,t){this._currentEffect.setVector4(e,t)},e.prototype._updateVector4ForUniform=function(t,r){e._tempBuffer[0]=r.x,e._tempBuffer[1]=r.y,e._tempBuffer[2]=r.z,e._tempBuffer[3]=r.w,this.updateUniform(t,e._tempBuffer,4)},e.prototype._updateColor3ForEffect=function(e,t,r){void 0===r&&(r=""),this._currentEffect.setColor3(e+r,t)},e.prototype._updateColor3ForUniform=function(t,r){e._tempBuffer[0]=r.r,e._tempBuffer[1]=r.g,e._tempBuffer[2]=r.b,this.updateUniform(t,e._tempBuffer,3)},e.prototype._updateColor4ForEffect=function(e,t,r,i){void 0===i&&(i=""),this._currentEffect.setColor4(e+i,t,r)},e.prototype._updateDirectColor4ForEffect=function(e,t,r){void 0===r&&(r=""),this._currentEffect.setDirectColor4(e+r,t)},e.prototype._updateColor4ForUniform=function(t,r,i){e._tempBuffer[0]=r.r,e._tempBuffer[1]=r.g,e._tempBuffer[2]=r.b,e._tempBuffer[3]=i,this.updateUniform(t,e._tempBuffer,4)},e.prototype._updateDirectColor4ForUniform=function(t,r){e._tempBuffer[0]=r.r,e._tempBuffer[1]=r.g,e._tempBuffer[2]=r.b,e._tempBuffer[3]=r.a,this.updateUniform(t,e._tempBuffer,4)},e.prototype._updateIntForEffect=function(e,t,r){void 0===r&&(r=""),this._currentEffect.setInt(e+r,t)},e.prototype._updateIntForUniform=function(t,r){e._tempBufferInt32View[0]=r,this.updateUniform(t,e._tempBuffer,1)},e.prototype._updateInt2ForEffect=function(e,t,r,i){void 0===i&&(i=""),this._currentEffect.setInt2(e+i,t,r)},e.prototype._updateInt2ForUniform=function(t,r,i){e._tempBufferInt32View[0]=r,e._tempBufferInt32View[1]=i,this.updateUniform(t,e._tempBuffer,2)},e.prototype._updateInt3ForEffect=function(e,t,r,i,n){void 0===n&&(n=""),this._currentEffect.setInt3(e+n,t,r,i)},e.prototype._updateInt3ForUniform=function(t,r,i,n){e._tempBufferInt32View[0]=r,e._tempBufferInt32View[1]=i,e._tempBufferInt32View[2]=n,this.updateUniform(t,e._tempBuffer,3)},e.prototype._updateInt4ForEffect=function(e,t,r,i,n,s){void 0===s&&(s=""),this._currentEffect.setInt4(e+s,t,r,i,n)},e.prototype._updateInt4ForUniform=function(t,r,i,n,s){e._tempBufferInt32View[0]=r,e._tempBufferInt32View[1]=i,e._tempBufferInt32View[2]=n,e._tempBufferInt32View[3]=s,this.updateUniform(t,e._tempBuffer,4)},e.prototype.setTexture=function(e,t){this._currentEffect.setTexture(e,t)},e.prototype.updateUniformDirectly=function(e,t){this.updateUniform(e,t,t.length),this.update()},e.prototype.bindToEffect=function(e,t){this._currentEffect=e,this._currentEffectName=t,!this._noUBO&&this._buffer&&e.bindUniformBuffer(this._buffer,t)},e.prototype.dispose=function(){if(!this._noUBO){var e=this._engine._uniformBuffers,t=e.indexOf(this);if(-1!==t&&(e[t]=e[e.length-1],e.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(var r=0;r<this._buffers.length;++r){var i=this._buffers[r][0];this._engine._releaseBuffer(i)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},e._updatedUbosInFrame={},e._MAX_UNIFORM_SIZE=256,e._tempBuffer=new Float32Array(e._MAX_UNIFORM_SIZE),e._tempBufferInt32View=new Uint32Array(e._tempBuffer.buffer),e}())},1088:(e,t,r)=>{"use strict";r.d(t,{T:()=>i,RD:()=>o,c7:()=>s});var i,n=r(4471);!function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD",e[e.BONE=2]="BONE"}(i||(i={}));var s,o=function(){function e(){}return e.X=new n.P(1,0,0),e.Y=new n.P(0,1,0),e.Z=new n.P(0,0,1),e}();!function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(s||(s={}))},2172:(e,t,r)=>{"use strict";r.d(t,{Wo:()=>a,HE:()=>u,zZ:()=>h});var i=r(1027),n=r(6588),s=r(56),o=r(2997),a=function(){function e(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),this.r=e,this.g=t,this.b=r}return e.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},e.prototype.getClassName=function(){return"Color3"},e.prototype.getHashCode=function(){var e=255*this.r|0;return 397*(e=397*e^(255*this.g|0))^(255*this.b|0)},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this},e.prototype.fromArray=function(t,r){return void 0===r&&(r=0),e.FromArrayToRef(t,r,this),this},e.prototype.toColor4=function(e){return void 0===e&&(e=1),new u(this.r,this.g,this.b,e)},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},e.prototype.multiply=function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b)},e.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this},e.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b},e.prototype.equalsFloats=function(e,t,r){return this.r===e&&this.g===t&&this.b===r},e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t)},e.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,this},e.prototype.clampToRef=function(e,t,r){return void 0===e&&(e=0),void 0===t&&(t=1),r.r=i.R.Clamp(this.r,e,t),r.g=i.R.Clamp(this.g,e,t),r.b=i.R.Clamp(this.b,e,t),this},e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b)},e.prototype.addToRef=function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this},e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b)},e.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this},e.prototype.clone=function(){return new e(this.r,this.g,this.b)},e.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},e.prototype.copyFromFloats=function(e,t,r){return this.r=e,this.g=t,this.b=r,this},e.prototype.set=function(e,t,r){return this.copyFromFloats(e,t,r)},e.prototype.toHexString=function(){var e=Math.round(255*this.r),t=Math.round(255*this.g),r=Math.round(255*this.b);return"#"+i.R.ToHex(e)+i.R.ToHex(t)+i.R.ToHex(r)},e.prototype.toLinearSpace=function(){var t=new e;return this.toLinearSpaceToRef(t),t},e.prototype.toHSV=function(){var t=new e;return this.toHSVToRef(t),t},e.prototype.toHSVToRef=function(e){var t=this.r,r=this.g,i=this.b,n=Math.max(t,r,i),s=Math.min(t,r,i),o=0,a=0,u=n,h=n-s;0!==n&&(a=h/n),n!=s&&(n==t?(o=(r-i)/h,r<i&&(o+=6)):n==r?o=(i-t)/h+2:n==i&&(o=(t-r)/h+4),o*=60),e.r=o,e.g=a,e.b=u},e.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,n.Nn),e.g=Math.pow(this.g,n.Nn),e.b=Math.pow(this.b,n.Nn),this},e.prototype.toGammaSpace=function(){var t=new e;return this.toGammaSpaceToRef(t),t},e.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,n.zp),e.g=Math.pow(this.g,n.zp),e.b=Math.pow(this.b,n.zp),this},e.HSVtoRGBToRef=function(e,t,r,i){var n=r*t,s=e/60,o=n*(1-Math.abs(s%2-1)),a=0,u=0,h=0;s>=0&&s<=1?(a=n,u=o):s>=1&&s<=2?(a=o,u=n):s>=2&&s<=3?(u=n,h=o):s>=3&&s<=4?(u=o,h=n):s>=4&&s<=5?(a=o,h=n):s>=5&&s<=6&&(a=n,h=o);var c=r-n;i.set(a+c,u+c,h+c)},e.FromHexString=function(t){if("#"!==t.substring(0,1)||7!==t.length)return new e(0,0,0);var r=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),n=parseInt(t.substring(5,7),16);return e.FromInts(r,i,n)},e.FromArray=function(t,r){return void 0===r&&(r=0),new e(t[r],t[r+1],t[r+2])},e.FromArrayToRef=function(e,t,r){void 0===t&&(t=0),r.r=e[t],r.g=e[t+1],r.b=e[t+2]},e.FromInts=function(t,r,i){return new e(t/255,r/255,i/255)},e.Lerp=function(t,r,i){var n=new e(0,0,0);return e.LerpToRef(t,r,i,n),n},e.LerpToRef=function(e,t,r,i){i.r=e.r+(t.r-e.r)*r,i.g=e.g+(t.g-e.g)*r,i.b=e.b+(t.b-e.b)*r},e.Hermite1stDerivative=function(t,r,i,n,s){var o=e.Black();return this.Hermite1stDerivativeToRef(t,r,i,n,s,o),o},e.Hermite1stDerivativeToRef=function(e,t,r,i,n,s){var o=n*n;s.r=6*(o-n)*e.r+(3*o-4*n+1)*t.r+6*(-o+n)*r.r+(3*o-2*n)*i.r,s.g=6*(o-n)*e.g+(3*o-4*n+1)*t.g+6*(-o+n)*r.g+(3*o-2*n)*i.g,s.b=6*(o-n)*e.b+(3*o-4*n+1)*t.b+6*(-o+n)*r.b+(3*o-2*n)*i.b},e.Red=function(){return new e(1,0,0)},e.Green=function(){return new e(0,1,0)},e.Blue=function(){return new e(0,0,1)},e.Black=function(){return new e(0,0,0)},Object.defineProperty(e,"BlackReadOnly",{get:function(){return e._BlackReadOnly},enumerable:!1,configurable:!0}),e.White=function(){return new e(1,1,1)},e.Purple=function(){return new e(.5,0,.5)},e.Magenta=function(){return new e(1,0,1)},e.Yellow=function(){return new e(1,1,0)},e.Gray=function(){return new e(.5,.5,.5)},e.Teal=function(){return new e(0,1,1)},e.Random=function(){return new e(Math.random(),Math.random(),Math.random())},e._BlackReadOnly=e.Black(),e}(),u=function(){function e(e,t,r,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=1),this.r=e,this.g=t,this.b=r,this.a=i}return e.prototype.addInPlace=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this},e.prototype.fromArray=function(t,r){return void 0===r&&(r=0),e.FromArrayToRef(t,r,this),this},e.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a},e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)},e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)},e.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this},e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t,this.a*t)},e.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,this},e.prototype.clampToRef=function(e,t,r){return void 0===e&&(e=0),void 0===t&&(t=1),r.r=i.R.Clamp(this.r,e,t),r.g=i.R.Clamp(this.g,e,t),r.b=i.R.Clamp(this.b,e,t),r.a=i.R.Clamp(this.a,e,t),this},e.prototype.multiply=function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)},e.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t},e.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},e.prototype.getClassName=function(){return"Color4"},e.prototype.getHashCode=function(){var e=255*this.r|0;return 397*(e=397*(e=397*e^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)},e.prototype.clone=function(){return new e(this.r,this.g,this.b,this.a)},e.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},e.prototype.copyFromFloats=function(e,t,r,i){return this.r=e,this.g=t,this.b=r,this.a=i,this},e.prototype.set=function(e,t,r,i){return this.copyFromFloats(e,t,r,i)},e.prototype.toHexString=function(e){void 0===e&&(e=!1);var t=Math.round(255*this.r),r=Math.round(255*this.g),n=Math.round(255*this.b);if(e)return"#"+i.R.ToHex(t)+i.R.ToHex(r)+i.R.ToHex(n);var s=Math.round(255*this.a);return"#"+i.R.ToHex(t)+i.R.ToHex(r)+i.R.ToHex(n)+i.R.ToHex(s)},e.prototype.toLinearSpace=function(){var t=new e;return this.toLinearSpaceToRef(t),t},e.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,n.Nn),e.g=Math.pow(this.g,n.Nn),e.b=Math.pow(this.b,n.Nn),e.a=this.a,this},e.prototype.toGammaSpace=function(){var t=new e;return this.toGammaSpaceToRef(t),t},e.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,n.zp),e.g=Math.pow(this.g,n.zp),e.b=Math.pow(this.b,n.zp),e.a=this.a,this},e.FromHexString=function(t){if("#"!==t.substring(0,1)||9!==t.length)return new e(0,0,0,0);var r=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),n=parseInt(t.substring(5,7),16),s=parseInt(t.substring(7,9),16);return e.FromInts(r,i,n,s)},e.Lerp=function(t,r,i){var n=new e(0,0,0,0);return e.LerpToRef(t,r,i,n),n},e.LerpToRef=function(e,t,r,i){i.r=e.r+(t.r-e.r)*r,i.g=e.g+(t.g-e.g)*r,i.b=e.b+(t.b-e.b)*r,i.a=e.a+(t.a-e.a)*r},e.Hermite1stDerivative=function(t,r,i,n,s){var o=new e;return this.Hermite1stDerivativeToRef(t,r,i,n,s,o),o},e.Hermite1stDerivativeToRef=function(e,t,r,i,n,s){var o=n*n;s.r=6*(o-n)*e.r+(3*o-4*n+1)*t.r+6*(-o+n)*r.r+(3*o-2*n)*i.r,s.g=6*(o-n)*e.g+(3*o-4*n+1)*t.g+6*(-o+n)*r.g+(3*o-2*n)*i.g,s.b=6*(o-n)*e.b+(3*o-4*n+1)*t.b+6*(-o+n)*r.b+(3*o-2*n)*i.b,s.a=6*(o-n)*e.a+(3*o-4*n+1)*t.a+6*(-o+n)*r.a+(3*o-2*n)*i.a},e.FromColor3=function(t,r){return void 0===r&&(r=1),new e(t.r,t.g,t.b,r)},e.FromArray=function(t,r){return void 0===r&&(r=0),new e(t[r],t[r+1],t[r+2],t[r+3])},e.FromArrayToRef=function(e,t,r){void 0===t&&(t=0),r.r=e[t],r.g=e[t+1],r.b=e[t+2],r.a=e[t+3]},e.FromInts=function(t,r,i,n){return new e(t/255,r/255,i/255,n/255)},e.CheckColors4=function(e,t){if(e.length===3*t){for(var r=[],i=0;i<e.length;i+=3){var n=i/3*4;r[n]=e[i],r[n+1]=e[i+1],r[n+2]=e[i+2],r[n+3]=1}return r}return e},e}(),h=function(){function e(){}return e.Color3=s.B.BuildArray(3,a.Black),e.Color4=s.B.BuildArray(3,(function(){return new u(0,0,0,0)})),e}();o.Q.RegisteredTypes["BABYLON.Color3"]=a,o.Q.RegisteredTypes["BABYLON.Color4"]=u},6588:(e,t,r)=>{"use strict";r.d(t,{zp:()=>i,Nn:()=>n,kn:()=>s});var i=1/2.2,n=2.2,s=.001},7358:(e,t,r)=>{"use strict";r.d(t,{i:()=>n});var i=r(3303),n=function(){function e(){}return e.GetPlanes=function(t){for(var r=[],n=0;n<6;n++)r.push(new i.J(0,0,0,0));return e.GetPlanesToRef(t,r),r},e.GetNearPlaneToRef=function(e,t){var r=e.m;t.normal.x=r[3]+r[2],t.normal.y=r[7]+r[6],t.normal.z=r[11]+r[10],t.d=r[15]+r[14],t.normalize()},e.GetFarPlaneToRef=function(e,t){var r=e.m;t.normal.x=r[3]-r[2],t.normal.y=r[7]-r[6],t.normal.z=r[11]-r[10],t.d=r[15]-r[14],t.normalize()},e.GetLeftPlaneToRef=function(e,t){var r=e.m;t.normal.x=r[3]+r[0],t.normal.y=r[7]+r[4],t.normal.z=r[11]+r[8],t.d=r[15]+r[12],t.normalize()},e.GetRightPlaneToRef=function(e,t){var r=e.m;t.normal.x=r[3]-r[0],t.normal.y=r[7]-r[4],t.normal.z=r[11]-r[8],t.d=r[15]-r[12],t.normalize()},e.GetTopPlaneToRef=function(e,t){var r=e.m;t.normal.x=r[3]-r[1],t.normal.y=r[7]-r[5],t.normal.z=r[11]-r[9],t.d=r[15]-r[13],t.normalize()},e.GetBottomPlaneToRef=function(e,t){var r=e.m;t.normal.x=r[3]+r[1],t.normal.y=r[7]+r[5],t.normal.z=r[11]+r[9],t.d=r[15]+r[13],t.normalize()},e.GetPlanesToRef=function(t,r){e.GetNearPlaneToRef(t,r[0]),e.GetFarPlaneToRef(t,r[1]),e.GetLeftPlaneToRef(t,r[2]),e.GetRightPlaneToRef(t,r[3]),e.GetTopPlaneToRef(t,r[4]),e.GetBottomPlaneToRef(t,r[5])},e}()},8701:(e,t,r)=>{"use strict";r.d(t,{RD:()=>i.RD,Wo:()=>n.Wo,HE:()=>n.HE,zZ:()=>n.zZ,kn:()=>s.kn,y3:()=>o.y3,_f:()=>o._f,jp:()=>o.jp,FM:()=>o.FM,P:()=>o.P,Lt:()=>o.Lt});var i=r(1088),n=r(2172),s=r(6588),o=(r(7358),r(4774),r(3303),r(8878),r(4471));r(745),r(2013)},4774:(e,t,r)=>{"use strict";r.d(t,{hr:()=>a,ZZ:()=>c,$B:()=>l,j_:()=>p});var i,n=r(1027),s=r(4471),o=r(6588);!function(e){e[e.CW=0]="CW",e[e.CCW=1]="CCW"}(i||(i={}));var a=function(){function e(){}return e.Interpolate=function(e,t,r,i,n){for(var s=1-3*i+3*t,o=3*i-6*t,a=3*t,u=e,h=0;h<5;h++){var c=u*u;u-=1/(3*s*c+2*o*u+a)*(s*(c*u)+o*c+a*u-e),u=Math.min(1,Math.max(0,u))}return 3*Math.pow(1-u,2)*u*r+3*(1-u)*Math.pow(u,2)*n+Math.pow(u,3)},e}(),u=function(){function e(e){this._radians=e,this._radians<0&&(this._radians+=2*Math.PI)}return e.prototype.degrees=function(){return 180*this._radians/Math.PI},e.prototype.radians=function(){return this._radians},e.BetweenTwoPoints=function(t,r){var i=r.subtract(t);return new e(Math.atan2(i.y,i.x))},e.FromRadians=function(t){return new e(t)},e.FromDegrees=function(t){return new e(t*Math.PI/180)},e}(),h=function(e,t,r){this.startPoint=e,this.midPoint=t,this.endPoint=r;var n=Math.pow(t.x,2)+Math.pow(t.y,2),o=(Math.pow(e.x,2)+Math.pow(e.y,2)-n)/2,a=(n-Math.pow(r.x,2)-Math.pow(r.y,2))/2,h=(e.x-t.x)*(t.y-r.y)-(t.x-r.x)*(e.y-t.y);this.centerPoint=new s.FM((o*(t.y-r.y)-a*(e.y-t.y))/h,((e.x-t.x)*a-(t.x-r.x)*o)/h),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=u.BetweenTwoPoints(this.centerPoint,this.startPoint);var c=this.startAngle.degrees(),l=u.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),p=u.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();l-c>180&&(l-=360),l-c<-180&&(l+=360),p-l>180&&(p-=360),p-l<-180&&(p+=360),this.orientation=l-c<0?i.CW:i.CCW,this.angle=u.FromDegrees(this.orientation===i.CW?c-p:p-c)},c=function(){function e(e,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new s.FM(e,t))}return e.prototype.addLineTo=function(e,t){if(this.closed)return this;var r=new s.FM(e,t),i=this._points[this._points.length-1];return this._points.push(r),this._length+=r.subtract(i).length(),this},e.prototype.addArcTo=function(e,t,r,n,o){if(void 0===o&&(o=36),this.closed)return this;var a=this._points[this._points.length-1],u=new s.FM(e,t),c=new s.FM(r,n),l=new h(a,u,c),p=l.angle.radians()/o;l.orientation===i.CW&&(p*=-1);for(var f=l.startAngle.radians()+p,d=0;d<o;d++){var _=Math.cos(f)*l.radius+l.centerPoint.x,g=Math.sin(f)*l.radius+l.centerPoint.y;this.addLineTo(_,g),f+=p}return this},e.prototype.close=function(){return this.closed=!0,this},e.prototype.length=function(){var e=this._length;if(this.closed){var t=this._points[this._points.length-1];e+=this._points[0].subtract(t).length()}return e},e.prototype.getPoints=function(){return this._points},e.prototype.getPointAtLengthPosition=function(e){if(e<0||e>1)return s.FM.Zero();for(var t=e*this.length(),r=0,i=0;i<this._points.length;i++){var n=(i+1)%this._points.length,o=this._points[i],a=this._points[n].subtract(o),u=a.length()+r;if(t>=r&&t<=u){var h=a.normalize(),c=t-r;return new s.FM(o.x+h.x*c,o.y+h.y*c)}r=u}return s.FM.Zero()},e.StartingAt=function(t,r){return new e(t,r)},e}(),l=function(){function e(e,t,r,i){void 0===t&&(t=null),void 0===i&&(i=!1),this.path=e,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:s.P.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:s.y3.Identity()};for(var n=0;n<e.length;n++)this._curve[n]=e[n].clone();this._raw=r||!1,this._alignTangentsWithPath=i,this._compute(t,i)}return e.prototype.getCurve=function(){return this._curve},e.prototype.getPoints=function(){return this._curve},e.prototype.length=function(){return this._distances[this._distances.length-1]},e.prototype.getTangents=function(){return this._tangents},e.prototype.getNormals=function(){return this._normals},e.prototype.getBinormals=function(){return this._binormals},e.prototype.getDistances=function(){return this._distances},e.prototype.getPointAt=function(e){return this._updatePointAtData(e).point},e.prototype.getTangentAt=function(e,t){return void 0===t&&(t=!1),this._updatePointAtData(e,t),t?s.P.TransformCoordinates(s.P.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]},e.prototype.getNormalAt=function(e,t){return void 0===t&&(t=!1),this._updatePointAtData(e,t),t?s.P.TransformCoordinates(s.P.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]},e.prototype.getBinormalAt=function(e,t){return void 0===t&&(t=!1),this._updatePointAtData(e,t),t?s.P.TransformCoordinates(s.P.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]},e.prototype.getDistanceAt=function(e){return this.length()*e},e.prototype.getPreviousPointIndexAt=function(e){return this._updatePointAtData(e),this._pointAtData.previousPointArrayIndex},e.prototype.getSubPositionAt=function(e){return this._updatePointAtData(e),this._pointAtData.subPosition},e.prototype.getClosestPositionTo=function(e){for(var t=Number.MAX_VALUE,r=0,i=0;i<this._curve.length-1;i++){var n=this._curve[i+0],o=this._curve[i+1].subtract(n).normalize(),a=this._distances[i+1]-this._distances[i+0],u=Math.min(Math.max(s.P.Dot(o,e.subtract(n).normalize()),0)*s.P.Distance(n,e)/a,1),h=s.P.Distance(n.add(o.scale(u*a)),e);h<t&&(t=h,r=(this._distances[i+0]+a*u)/this.length())}return r},e.prototype.slice=function(t,r){if(void 0===t&&(t=0),void 0===r&&(r=1),t<0&&(t=1- -1*t%1),r<0&&(r=1- -1*r%1),t>r){var i=t;t=r,r=i}var n=this.getCurve(),s=this.getPointAt(t),o=this.getPreviousPointIndexAt(t),a=this.getPointAt(r),u=this.getPreviousPointIndexAt(r)+1,h=[];return 0!==t&&(o++,h.push(s)),h.push.apply(h,n.slice(o,u)),1===r&&1!==t||h.push(a),new e(h,this.getNormalAt(t),this._raw,this._alignTangentsWithPath)},e.prototype.update=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1);for(var i=0;i<e.length;i++)this._curve[i].x=e[i].x,this._curve[i].y=e[i].y,this._curve[i].z=e[i].z;return this._compute(t,r),this},e.prototype._compute=function(e,t){void 0===t&&(t=!1);var r=this._curve.length;if(!(r<2)){this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[r-1]=this._curve[r-1].subtract(this._curve[r-2]),this._raw||this._tangents[r-1].normalize();var i,n,o,a,u,h=this._tangents[0],c=this._normalVector(h,e);this._normals[0]=c,this._raw||this._normals[0].normalize(),this._binormals[0]=s.P.Cross(h,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var l=1;l<r;l++)i=this._getLastNonNullVector(l),l<r-1&&(n=this._getFirstNonNullVector(l),this._tangents[l]=t?n:i.add(n),this._tangents[l].normalize()),this._distances[l]=this._distances[l-1]+this._curve[l].subtract(this._curve[l-1]).length(),o=this._tangents[l],u=this._binormals[l-1],this._normals[l]=s.P.Cross(u,o),this._raw||(0===this._normals[l].length()?(a=this._normals[l-1],this._normals[l]=a.clone()):this._normals[l].normalize()),this._binormals[l]=s.P.Cross(o,this._normals[l]),this._raw||this._binormals[l].normalize();this._pointAtData.id=NaN}},e.prototype._getFirstNonNullVector=function(e){for(var t=1,r=this._curve[e+t].subtract(this._curve[e]);0===r.length()&&e+t+1<this._curve.length;)t++,r=this._curve[e+t].subtract(this._curve[e]);return r},e.prototype._getLastNonNullVector=function(e){for(var t=1,r=this._curve[e].subtract(this._curve[e-t]);0===r.length()&&e>t+1;)t++,r=this._curve[e].subtract(this._curve[e-t]);return r},e.prototype._normalVector=function(e,t){var r,i,a=e.length();return 0===a&&(a=1),null==t?(i=n.R.WithinEpsilon(Math.abs(e.y)/a,1,o.kn)?n.R.WithinEpsilon(Math.abs(e.x)/a,1,o.kn)?n.R.WithinEpsilon(Math.abs(e.z)/a,1,o.kn)?s.P.Zero():new s.P(0,0,1):new s.P(1,0,0):new s.P(0,-1,0),r=s.P.Cross(e,i)):(r=s.P.Cross(e,t),s.P.CrossToRef(r,e,r)),r.normalize(),r},e.prototype._updatePointAtData=function(e,t){if(void 0===t&&(t=!1),this._pointAtData.id===e)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=e;var r=this.getPoints();if(e<=0)return this._setPointAtData(0,0,r[0],0,t);if(e>=1)return this._setPointAtData(1,1,r[r.length-1],r.length-1,t);for(var i,n=r[0],o=0,a=e*this.length(),u=1;u<r.length;u++){i=r[u];var h=s.P.Distance(n,i);if((o+=h)===a)return this._setPointAtData(e,1,i,u,t);if(o>a){var c=(o-a)/h,l=n.subtract(i),p=i.add(l.scaleInPlace(c));return this._setPointAtData(e,1-c,p,u-1,t)}n=i}return this._pointAtData},e.prototype._setPointAtData=function(e,t,r,i,n){return this._pointAtData.point=r,this._pointAtData.position=e,this._pointAtData.subPosition=t,this._pointAtData.previousPointArrayIndex=i,this._pointAtData.interpolateReady=n,n&&this._updateInterpolationMatrix(),this._pointAtData},e.prototype._updateInterpolationMatrix=function(){this._pointAtData.interpolationMatrix=s.y3.Identity();var e=this._pointAtData.previousPointArrayIndex;if(e!==this._tangents.length-1){var t=e+1,r=this._tangents[e].clone(),i=this._normals[e].clone(),n=this._binormals[e].clone(),o=this._tangents[t].clone(),a=this._normals[t].clone(),u=this._binormals[t].clone(),h=s._f.RotationQuaternionFromAxis(i,n,r),c=s._f.RotationQuaternionFromAxis(a,u,o);s._f.Slerp(h,c,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}},e}(),p=function(){function e(e){this._length=0,this._points=e,this._length=this._computeLength(e)}return e.CreateQuadraticBezier=function(t,r,i,n){n=n>2?n:3;for(var o=new Array,a=function(e,t,r,i){return(1-e)*(1-e)*t+2*e*(1-e)*r+e*e*i},u=0;u<=n;u++)o.push(new s.P(a(u/n,t.x,r.x,i.x),a(u/n,t.y,r.y,i.y),a(u/n,t.z,r.z,i.z)));return new e(o)},e.CreateCubicBezier=function(t,r,i,n,o){o=o>3?o:4;for(var a=new Array,u=function(e,t,r,i,n){return(1-e)*(1-e)*(1-e)*t+3*e*(1-e)*(1-e)*r+3*e*e*(1-e)*i+e*e*e*n},h=0;h<=o;h++)a.push(new s.P(u(h/o,t.x,r.x,i.x,n.x),u(h/o,t.y,r.y,i.y,n.y),u(h/o,t.z,r.z,i.z,n.z)));return new e(a)},e.CreateHermiteSpline=function(t,r,i,n,o){for(var a=new Array,u=1/o,h=0;h<=o;h++)a.push(s.P.Hermite(t,r,i,n,h*u));return new e(a)},e.CreateCatmullRomSpline=function(t,r,i){var n=new Array,o=1/r,a=0;if(i){for(var u=t.length,h=0;h<u;h++){a=0;for(var c=0;c<r;c++)n.push(s.P.CatmullRom(t[h%u],t[(h+1)%u],t[(h+2)%u],t[(h+3)%u],a)),a+=o}n.push(n[0])}else{var l=new Array;for(l.push(t[0].clone()),Array.prototype.push.apply(l,t),l.push(t[t.length-1].clone()),h=0;h<l.length-3;h++)for(a=0,c=0;c<r;c++)n.push(s.P.CatmullRom(l[h],l[h+1],l[h+2],l[h+3],a)),a+=o;h--,n.push(s.P.CatmullRom(l[h],l[h+1],l[h+2],l[h+3],a))}return new e(n)},e.prototype.getPoints=function(){return this._points},e.prototype.length=function(){return this._length},e.prototype.continue=function(t){for(var r=this._points[this._points.length-1],i=this._points.slice(),n=t.getPoints(),s=1;s<n.length;s++)i.push(n[s].subtract(n[0]).add(r));return new e(i)},e.prototype._computeLength=function(e){for(var t=0,r=1;r<e.length;r++)t+=e[r].subtract(e[r-1]).length();return t},e}()},3303:(e,t,r)=>{"use strict";r.d(t,{J:()=>n});var i=r(4471),n=function(){function e(e,t,r,n){this.normal=new i.P(e,t,r),this.d=n}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.getClassName=function(){return"Plane"},e.prototype.getHashCode=function(){var e=this.normal.getHashCode();return 397*e^(0|this.d)},e.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},e.prototype.transform=function(t){var r=e._TmpMatrix;t.invertToRef(r);var i=r.m,n=this.normal.x,s=this.normal.y,o=this.normal.z,a=this.d;return new e(n*i[0]+s*i[1]+o*i[2]+a*i[3],n*i[4]+s*i[5]+o*i[6]+a*i[7],n*i[8]+s*i[9]+o*i[10]+a*i[11],n*i[12]+s*i[13]+o*i[14]+a*i[15])},e.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},e.prototype.copyFromPoints=function(e,t,r){var i,n=t.x-e.x,s=t.y-e.y,o=t.z-e.z,a=r.x-e.x,u=r.y-e.y,h=r.z-e.z,c=s*h-o*u,l=o*a-n*h,p=n*u-s*a,f=Math.sqrt(c*c+l*l+p*p);return i=0!==f?1/f:0,this.normal.x=c*i,this.normal.y=l*i,this.normal.z=p*i,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},e.prototype.isFrontFacingTo=function(e,t){return i.P.Dot(this.normal,e)<=t},e.prototype.signedDistanceTo=function(e){return i.P.Dot(e,this.normal)+this.d},e.FromArray=function(t){return new e(t[0],t[1],t[2],t[3])},e.FromPoints=function(t,r,i){var n=new e(0,0,0,0);return n.copyFromPoints(t,r,i),n},e.FromPositionAndNormal=function(t,r){var i=new e(0,0,0,0);return r.normalize(),i.normal=r,i.d=-(r.x*t.x+r.y*t.y+r.z*t.z),i},e.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,r){var n=-(t.x*e.x+t.y*e.y+t.z*e.z);return i.P.Dot(r,t)+n},e._TmpMatrix=i.y3.Identity(),e}()},1027:(e,t,r)=>{"use strict";r.d(t,{R:()=>i});var i=function(){function e(){}return e.WithinEpsilon=function(e,t,r){return void 0===r&&(r=1401298e-51),Math.abs(e-t)<=r},e.ToHex=function(e){var t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()},e.Sign=function(e){return 0==(e=+e)||isNaN(e)?e:e>0?1:-1},e.Clamp=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=1),Math.min(r,Math.max(t,e))},e.Log2=function(e){return Math.log(e)*Math.LOG2E},e.ILog2=function(e){if(Math.log2)return Math.floor(Math.log2(e));if(e<0)return NaN;if(0===e)return-1/0;var t=0;if(e<1){for(;e<1;)t++,e*=2;t=-t}else if(e>1)for(;e>1;)t++,e=Math.floor(e/2);return t},e.Repeat=function(e,t){return e-Math.floor(e/t)*t},e.Normalize=function(e,t,r){return(e-t)/(r-t)},e.Denormalize=function(e,t,r){return e*(r-t)+t},e.DeltaAngle=function(t,r){var i=e.Repeat(r-t,360);return i>180&&(i-=360),i},e.PingPong=function(t,r){var i=e.Repeat(t,2*r);return r-Math.abs(i-r)},e.SmoothStep=function(t,r,i){var n=e.Clamp(i);return r*(n=-2*n*n*n+3*n*n)+t*(1-n)},e.MoveTowards=function(t,r,i){return Math.abs(r-t)<=i?r:t+e.Sign(r-t)*i},e.MoveTowardsAngle=function(t,r,i){var n=e.DeltaAngle(t,r),s=0;return-i<n&&n<i?s=r:(r=t+n,s=e.MoveTowards(t,r,i)),s},e.Lerp=function(e,t,r){return e+(t-e)*r},e.LerpAngle=function(t,r,i){var n=e.Repeat(r-t,360);return n>180&&(n-=360),t+n*e.Clamp(i)},e.InverseLerp=function(t,r,i){return t!=r?e.Clamp((i-t)/(r-t)):0},e.Hermite=function(e,t,r,i,n){var s=n*n,o=n*s;return e*(2*o-3*s+1)+r*(-2*o+3*s)+t*(o-2*s+n)+i*(o-s)},e.Hermite1stDerivative=function(e,t,r,i,n){var s=n*n;return 6*(s-n)*e+(3*s-4*n+1)*t+6*(-s+n)*r+(3*s-2*n)*i},e.RandomRange=function(e,t){return e===t?e:Math.random()*(t-e)+e},e.RangeToPercent=function(e,t,r){return(e-t)/(r-t)},e.PercentToRange=function(e,t,r){return(r-t)*e+t},e.NormalizeRadians=function(t){return t-e.TwoPi*Math.floor((t+Math.PI)/e.TwoPi)},e.TwoPi=2*Math.PI,e}()},8878:(e,t,r)=>{"use strict";r.d(t,{$:()=>i});var i=function(){function e(e,t){this.width=e,this.height=t}return e.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},e.prototype.getClassName=function(){return"Size"},e.prototype.getHashCode=function(){var e=0|this.width;return 397*e^(0|this.height)},e.prototype.copyFrom=function(e){this.width=e.width,this.height=e.height},e.prototype.copyFromFloats=function(e,t){return this.width=e,this.height=t,this},e.prototype.set=function(e,t){return this.copyFromFloats(e,t)},e.prototype.multiplyByFloats=function(t,r){return new e(this.width*t,this.height*r)},e.prototype.clone=function(){return new e(this.width,this.height)},e.prototype.equals=function(e){return!!e&&this.width===e.width&&this.height===e.height},Object.defineProperty(e.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),e.Zero=function(){return new e(0,0)},e.prototype.add=function(t){return new e(this.width+t.width,this.height+t.height)},e.prototype.subtract=function(t){return new e(this.width-t.width,this.height-t.height)},e.Lerp=function(t,r,i){return new e(t.width+(r.width-t.width)*i,t.height+(r.height-t.height)*i)},e}()},4471:(e,t,r)=>{"use strict";r.d(t,{FM:()=>u,P:()=>h,Lt:()=>c,_f:()=>l,y3:()=>p,jp:()=>d});var i=r(1027),n=r(6588),s=r(56),o=r(2997),a=r(9810),u=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t}return e.prototype.toString=function(){return"{X: "+this.x+" Y: "+this.y+"}"},e.prototype.getClassName=function(){return"Vector2"},e.prototype.getHashCode=function(){var e=0|this.x;return 397*e^(0|this.y)},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,this},e.prototype.fromArray=function(t,r){return void 0===r&&(r=0),e.FromArrayToRef(t,r,this),this},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},e.prototype.copyFromFloats=function(e,t){return this.x=e,this.y=t,this},e.prototype.set=function(e,t){return this.copyFromFloats(e,t)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,this},e.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.addVector3=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,this},e.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this},e.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this},e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,this},e.prototype.multiplyByFloats=function(t,r){return new e(this.x*t,this.y*r)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,this},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.negate=function(){return new e(-this.x,-this.y)},e.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},e.prototype.negateToRef=function(e){return e.copyFromFloats(-1*this.x,-1*this.y)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this},e.prototype.scale=function(t){var r=new e(0,0);return this.scaleToRef(t,r),r},e.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,this},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=n.kn),e&&i.R.WithinEpsilon(this.x,e.x,t)&&i.R.WithinEpsilon(this.y,e.y,t)},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},e.prototype.rotateToRef=function(e,t){var r=Math.cos(e),i=Math.sin(e);return t.x=r*this.x-i*this.y,t.y=i*this.x+r*this.y,this},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},e.prototype.normalize=function(){return e.NormalizeToRef(this,this),this},e.prototype.clone=function(){return new e(this.x,this.y)},e.Zero=function(){return new e(0,0)},e.One=function(){return new e(1,1)},e.FromArray=function(t,r){return void 0===r&&(r=0),new e(t[r],t[r+1])},e.FromArrayToRef=function(e,t,r){r.x=e[t],r.y=e[t+1]},e.CatmullRom=function(t,r,i,n,s){var o=s*s,a=s*o;return new e(.5*(2*r.x+(-t.x+i.x)*s+(2*t.x-5*r.x+4*i.x-n.x)*o+(-t.x+3*r.x-3*i.x+n.x)*a),.5*(2*r.y+(-t.y+i.y)*s+(2*t.y-5*r.y+4*i.y-n.y)*o+(-t.y+3*r.y-3*i.y+n.y)*a))},e.Clamp=function(t,r,i){var n=t.x;n=(n=n>i.x?i.x:n)<r.x?r.x:n;var s=t.y;return new e(n,s=(s=s>i.y?i.y:s)<r.y?r.y:s)},e.Hermite=function(t,r,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,c=a-2*o+s,l=a-o;return new e(t.x*u+i.x*h+r.x*c+n.x*l,t.y*u+i.y*h+r.y*c+n.y*l)},e.Hermite1stDerivative=function(t,r,i,n,s){var o=e.Zero();return this.Hermite1stDerivativeToRef(t,r,i,n,s,o),o},e.Hermite1stDerivativeToRef=function(e,t,r,i,n,s){var o=n*n;s.x=6*(o-n)*e.x+(3*o-4*n+1)*t.x+6*(-o+n)*r.x+(3*o-2*n)*i.x,s.y=6*(o-n)*e.y+(3*o-4*n+1)*t.y+6*(-o+n)*r.y+(3*o-2*n)*i.y},e.Lerp=function(t,r,i){return new e(t.x+(r.x-t.x)*i,t.y+(r.y-t.y)*i)},e.Dot=function(e,t){return e.x*t.x+e.y*t.y},e.Normalize=function(t){var r=e.Zero();return this.NormalizeToRef(t,r),r},e.NormalizeToRef=function(e,t){var r=e.length();0!==r&&(t.x=e.x/r,t.y=e.y/r)},e.Minimize=function(t,r){return new e(t.x<r.x?t.x:r.x,t.y<r.y?t.y:r.y)},e.Maximize=function(t,r){return new e(t.x>r.x?t.x:r.x,t.y>r.y?t.y:r.y)},e.Transform=function(t,r){var i=e.Zero();return e.TransformToRef(t,r,i),i},e.TransformToRef=function(e,t,r){var i=t.m,n=e.x*i[0]+e.y*i[4]+i[12],s=e.x*i[1]+e.y*i[5]+i[13];r.x=n,r.y=s},e.PointInTriangle=function(e,t,r,i){var n=.5*(-r.y*i.x+t.y*(-r.x+i.x)+t.x*(r.y-i.y)+r.x*i.y),s=n<0?-1:1,o=(t.y*i.x-t.x*i.y+(i.y-t.y)*e.x+(t.x-i.x)*e.y)*s,a=(t.x*r.y-t.y*r.x+(t.y-r.y)*e.x+(r.x-t.x)*e.y)*s;return o>0&&a>0&&o+a<2*n*s},e.Distance=function(t,r){return Math.sqrt(e.DistanceSquared(t,r))},e.DistanceSquared=function(e,t){var r=e.x-t.x,i=e.y-t.y;return r*r+i*i},e.Center=function(t,r){return e.CenterToRef(t,r,e.Zero())},e.CenterToRef=function(e,t,r){return r.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2)},e.DistanceOfPointFromSegment=function(t,r,i){var n=e.DistanceSquared(r,i);if(0===n)return e.Distance(t,r);var s=i.subtract(r),o=Math.max(0,Math.min(1,e.Dot(t.subtract(r),s)/n)),a=r.add(s.multiplyByFloats(o,o));return e.Distance(t,a)},e}(),h=function(){function e(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),this._isDirty=!0,this._x=e,this._y=t,this._z=r}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e,this._isDirty=!0},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"{X: "+this._x+" Y: "+this._y+" Z: "+this._z+"}"},e.prototype.getClassName=function(){return"Vector3"},e.prototype.getHashCode=function(){var e=0|this._x;return 397*(e=397*e^(0|this._y))^(0|this._z)},e.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,this},e.prototype.fromArray=function(t,r){return void 0===r&&(r=0),e.FromArrayToRef(t,r,this),this},e.prototype.toQuaternion=function(){return l.RotationYawPitchRoll(this._y,this._x,this._z)},e.prototype.addInPlace=function(e){return this.addInPlaceFromFloats(e._x,e._y,e._z)},e.prototype.addInPlaceFromFloats=function(e,t,r){return this.x+=e,this.y+=t,this.z+=r,this},e.prototype.add=function(t){return new e(this._x+t._x,this._y+t._y,this._z+t._z)},e.prototype.addToRef=function(e,t){return t.copyFromFloats(this._x+e._x,this._y+e._y,this._z+e._z)},e.prototype.subtractInPlace=function(e){return this.x-=e._x,this.y-=e._y,this.z-=e._z,this},e.prototype.subtract=function(t){return new e(this._x-t._x,this._y-t._y,this._z-t._z)},e.prototype.subtractToRef=function(e,t){return this.subtractFromFloatsToRef(e._x,e._y,e._z,t)},e.prototype.subtractFromFloats=function(t,r,i){return new e(this._x-t,this._y-r,this._z-i)},e.prototype.subtractFromFloatsToRef=function(e,t,r,i){return i.copyFromFloats(this._x-e,this._y-t,this._z-r)},e.prototype.negate=function(){return new e(-this._x,-this._y,-this._z)},e.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},e.prototype.negateToRef=function(e){return e.copyFromFloats(-1*this._x,-1*this._y,-1*this._z)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.prototype.scale=function(t){return new e(this._x*t,this._y*t,this._z*t)},e.prototype.scaleToRef=function(e,t){return t.copyFromFloats(this._x*e,this._y*e,this._z*e)},e.prototype.scaleAndAddToRef=function(e,t){return t.addInPlaceFromFloats(this._x*e,this._y*e,this._z*e)},e.prototype.projectOnPlane=function(t,r){var i=e.Zero();return this.projectOnPlaneToRef(t,r,i),i},e.prototype.projectOnPlaneToRef=function(t,r,i){var n=t.normal,s=t.d,o=f.Vector3[0];this.subtractToRef(r,o),o.normalize();var a=e.Dot(o,n),u=-(e.Dot(r,n)+s)/a,h=o.scaleInPlace(u);r.addToRef(h,i)},e.prototype.equals=function(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=n.kn),e&&i.R.WithinEpsilon(this._x,e._x,t)&&i.R.WithinEpsilon(this._y,e._y,t)&&i.R.WithinEpsilon(this._z,e._z,t)},e.prototype.equalsToFloats=function(e,t,r){return this._x===e&&this._y===t&&this._z===r},e.prototype.multiplyInPlace=function(e){return this.x*=e._x,this.y*=e._y,this.z*=e._z,this},e.prototype.multiply=function(e){return this.multiplyByFloats(e._x,e._y,e._z)},e.prototype.multiplyToRef=function(e,t){return t.copyFromFloats(this._x*e._x,this._y*e._y,this._z*e._z)},e.prototype.multiplyByFloats=function(t,r,i){return new e(this._x*t,this._y*r,this._z*i)},e.prototype.divide=function(t){return new e(this._x/t._x,this._y/t._y,this._z/t._z)},e.prototype.divideToRef=function(e,t){return t.copyFromFloats(this._x/e._x,this._y/e._y,this._z/e._z)},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.minimizeInPlace=function(e){return this.minimizeInPlaceFromFloats(e._x,e._y,e._z)},e.prototype.maximizeInPlace=function(e){return this.maximizeInPlaceFromFloats(e._x,e._y,e._z)},e.prototype.minimizeInPlaceFromFloats=function(e,t,r){return e<this._x&&(this.x=e),t<this._y&&(this.y=t),r<this._z&&(this.z=r),this},e.prototype.maximizeInPlaceFromFloats=function(e,t,r){return e>this._x&&(this.x=e),t>this._y&&(this.y=t),r>this._z&&(this.z=r),this},e.prototype.isNonUniformWithinEpsilon=function(e){var t=Math.abs(this._x),r=Math.abs(this._y);if(!i.R.WithinEpsilon(t,r,e))return!0;var n=Math.abs(this._z);return!i.R.WithinEpsilon(t,n,e)||!i.R.WithinEpsilon(r,n,e)},Object.defineProperty(e.prototype,"isNonUniform",{get:function(){var e=Math.abs(this._x);return e!==Math.abs(this._y)||e!==Math.abs(this._z)},enumerable:!1,configurable:!0}),e.prototype.floor=function(){return new e(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))},e.prototype.fract=function(){return new e(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))},e.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},e.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z},e.prototype.normalize=function(){return this.normalizeFromLength(this.length())},e.prototype.reorderInPlace=function(e){var t=this;return"xyz"===(e=e.toLowerCase())||(f.Vector3[0].copyFrom(this),["x","y","z"].forEach((function(r,i){t[r]=f.Vector3[0][e[i]]}))),this},e.prototype.rotateByQuaternionToRef=function(t,r){return t.toRotationMatrix(f.Matrix[0]),e.TransformCoordinatesToRef(this,f.Matrix[0],r),r},e.prototype.rotateByQuaternionAroundPointToRef=function(e,t,r){return this.subtractToRef(t,f.Vector3[0]),f.Vector3[0].rotateByQuaternionToRef(e,f.Vector3[0]),t.addToRef(f.Vector3[0],r),r},e.prototype.cross=function(t){return e.Cross(this,t)},e.prototype.normalizeFromLength=function(e){return 0===e||1===e?this:this.scaleInPlace(1/e)},e.prototype.normalizeToNew=function(){var t=new e(0,0,0);return this.normalizeToRef(t),t},e.prototype.normalizeToRef=function(e){var t=this.length();return 0===t||1===t?e.copyFromFloats(this._x,this._y,this._z):this.scaleToRef(1/t,e)},e.prototype.clone=function(){return new e(this._x,this._y,this._z)},e.prototype.copyFrom=function(e){return this.copyFromFloats(e._x,e._y,e._z)},e.prototype.copyFromFloats=function(e,t,r){return this.x=e,this.y=t,this.z=r,this},e.prototype.set=function(e,t,r){return this.copyFromFloats(e,t,r)},e.prototype.setAll=function(e){return this.x=this.y=this.z=e,this},e.GetClipFactor=function(t,r,i,n){var s=e.Dot(t,i)-n;return s/(s-(e.Dot(r,i)-n))},e.GetAngleBetweenVectors=function(t,r,i){var n=t.normalizeToRef(f.Vector3[1]),s=r.normalizeToRef(f.Vector3[2]),o=e.Dot(n,s),a=Math.acos(o),u=f.Vector3[3];return e.CrossToRef(n,s,u),e.Dot(u,i)>0?isNaN(a)?0:a:isNaN(a)?-Math.PI:-Math.acos(o)},e.GetAngleBetweenVectorsOnPlane=function(t,r,n){f.Vector3[0].copyFrom(t);var s=f.Vector3[0];f.Vector3[1].copyFrom(r);var o=f.Vector3[1];f.Vector3[2].copyFrom(n);var a=f.Vector3[2],u=f.Vector3[3],h=f.Vector3[4];s.normalize(),o.normalize(),a.normalize(),e.CrossToRef(a,s,u),e.CrossToRef(u,a,h);var c=Math.atan2(e.Dot(o,u),e.Dot(o,h));return i.R.NormalizeRadians(c)},e.SlerpToRef=function(t,r,s,o){s=i.R.Clamp(s,0,1);var a,u,h=f.Vector3[0],c=f.Vector3[1];h.copyFrom(t),a=h.length(),h.normalizeFromLength(a),c.copyFrom(r),u=c.length(),c.normalizeFromLength(u);var l,p,d=e.Dot(h,c);if(d<1-n.kn){var _=Math.acos(d),g=1/Math.sin(_);l=Math.sin((1-s)*_)*g,p=Math.sin(s*_)*g}else l=1-s,p=s;h.scaleInPlace(l),c.scaleInPlace(p),o.copyFrom(h).addInPlace(c),o.scaleInPlace(i.R.Lerp(a,u,s))},e.SmoothToRef=function(t,r,i,n,s){e.SlerpToRef(t,r,0===n?1:i/n,s)},e.FromArray=function(t,r){return void 0===r&&(r=0),new e(t[r],t[r+1],t[r+2])},e.FromFloatArray=function(t,r){return e.FromArray(t,r)},e.FromArrayToRef=function(e,t,r){r.x=e[t],r.y=e[t+1],r.z=e[t+2]},e.FromFloatArrayToRef=function(t,r,i){return e.FromArrayToRef(t,r,i)},e.FromFloatsToRef=function(e,t,r,i){i.copyFromFloats(e,t,r)},e.Zero=function(){return new e(0,0,0)},e.One=function(){return new e(1,1,1)},e.Up=function(){return new e(0,1,0)},Object.defineProperty(e,"UpReadOnly",{get:function(){return e._UpReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(e,"RightReadOnly",{get:function(){return e._RightReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LeftHandedForwardReadOnly",{get:function(){return e._LeftHandedForwardReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(e,"RightHandedForwardReadOnly",{get:function(){return e._RightHandedForwardReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ZeroReadOnly",{get:function(){return e._ZeroReadOnly},enumerable:!1,configurable:!0}),e.Down=function(){return new e(0,-1,0)},e.Forward=function(t){return void 0===t&&(t=!1),new e(0,0,t?-1:1)},e.Backward=function(t){return void 0===t&&(t=!1),new e(0,0,t?1:-1)},e.Right=function(){return new e(1,0,0)},e.Left=function(){return new e(-1,0,0)},e.TransformCoordinates=function(t,r){var i=e.Zero();return e.TransformCoordinatesToRef(t,r,i),i},e.TransformCoordinatesToRef=function(t,r,i){e.TransformCoordinatesFromFloatsToRef(t._x,t._y,t._z,r,i)},e.TransformCoordinatesFromFloatsToRef=function(e,t,r,i,n){var s=i.m,o=e*s[0]+t*s[4]+r*s[8]+s[12],a=e*s[1]+t*s[5]+r*s[9]+s[13],u=e*s[2]+t*s[6]+r*s[10]+s[14],h=1/(e*s[3]+t*s[7]+r*s[11]+s[15]);n.x=o*h,n.y=a*h,n.z=u*h},e.TransformNormal=function(t,r){var i=e.Zero();return e.TransformNormalToRef(t,r,i),i},e.TransformNormalToRef=function(e,t,r){this.TransformNormalFromFloatsToRef(e._x,e._y,e._z,t,r)},e.TransformNormalFromFloatsToRef=function(e,t,r,i,n){var s=i.m;n.x=e*s[0]+t*s[4]+r*s[8],n.y=e*s[1]+t*s[5]+r*s[9],n.z=e*s[2]+t*s[6]+r*s[10]},e.CatmullRom=function(t,r,i,n,s){var o=s*s,a=s*o;return new e(.5*(2*r._x+(-t._x+i._x)*s+(2*t._x-5*r._x+4*i._x-n._x)*o+(-t._x+3*r._x-3*i._x+n._x)*a),.5*(2*r._y+(-t._y+i._y)*s+(2*t._y-5*r._y+4*i._y-n._y)*o+(-t._y+3*r._y-3*i._y+n._y)*a),.5*(2*r._z+(-t._z+i._z)*s+(2*t._z-5*r._z+4*i._z-n._z)*o+(-t._z+3*r._z-3*i._z+n._z)*a))},e.Clamp=function(t,r,i){var n=new e;return e.ClampToRef(t,r,i,n),n},e.ClampToRef=function(e,t,r,i){var n=e._x;n=(n=n>r._x?r._x:n)<t._x?t._x:n;var s=e._y;s=(s=s>r._y?r._y:s)<t._y?t._y:s;var o=e._z;o=(o=o>r._z?r._z:o)<t._z?t._z:o,i.copyFromFloats(n,s,o)},e.CheckExtends=function(e,t,r){t.minimizeInPlace(e),r.maximizeInPlace(e)},e.Hermite=function(t,r,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,c=a-2*o+s,l=a-o;return new e(t._x*u+i._x*h+r._x*c+n._x*l,t._y*u+i._y*h+r._y*c+n._y*l,t._z*u+i._z*h+r._z*c+n._z*l)},e.Hermite1stDerivative=function(t,r,i,n,s){var o=e.Zero();return this.Hermite1stDerivativeToRef(t,r,i,n,s,o),o},e.Hermite1stDerivativeToRef=function(e,t,r,i,n,s){var o=n*n;s.x=6*(o-n)*e.x+(3*o-4*n+1)*t.x+6*(-o+n)*r.x+(3*o-2*n)*i.x,s.y=6*(o-n)*e.y+(3*o-4*n+1)*t.y+6*(-o+n)*r.y+(3*o-2*n)*i.y,s.z=6*(o-n)*e.z+(3*o-4*n+1)*t.z+6*(-o+n)*r.z+(3*o-2*n)*i.z},e.Lerp=function(t,r,i){var n=new e(0,0,0);return e.LerpToRef(t,r,i,n),n},e.LerpToRef=function(e,t,r,i){i.x=e._x+(t._x-e._x)*r,i.y=e._y+(t._y-e._y)*r,i.z=e._z+(t._z-e._z)*r},e.Dot=function(e,t){return e._x*t._x+e._y*t._y+e._z*t._z},e.Cross=function(t,r){var i=e.Zero();return e.CrossToRef(t,r,i),i},e.CrossToRef=function(e,t,r){var i=e._y*t._z-e._z*t._y,n=e._z*t._x-e._x*t._z,s=e._x*t._y-e._y*t._x;r.copyFromFloats(i,n,s)},e.Normalize=function(t){var r=e.Zero();return e.NormalizeToRef(t,r),r},e.NormalizeToRef=function(e,t){e.normalizeToRef(t)},e.Project=function(t,r,i,n){var s=new e;return e.ProjectToRef(t,r,i,n,s),s},e.ProjectToRef=function(t,r,i,n,s){var o=n.width,a=n.height,u=n.x,h=n.y,c=f.Matrix[1];p.FromValuesToRef(o/2,0,0,0,0,-a/2,0,0,0,0,.5,0,u+o/2,a/2+h,.5,1,c);var l=f.Matrix[0];return r.multiplyToRef(i,l),l.multiplyToRef(c,l),e.TransformCoordinatesToRef(t,l,s),s},e._UnprojectFromInvertedMatrixToRef=function(t,r,n){e.TransformCoordinatesToRef(t,r,n);var s=r.m,o=t._x*s[3]+t._y*s[7]+t._z*s[11]+s[15];i.R.WithinEpsilon(o,1)&&n.scaleInPlace(1/o)},e.UnprojectFromTransform=function(t,r,i,n,s){var o=f.Matrix[0];n.multiplyToRef(s,o),o.invert(),t.x=t._x/r*2-1,t.y=-(t._y/i*2-1);var a=new e;return e._UnprojectFromInvertedMatrixToRef(t,o,a),a},e.Unproject=function(t,r,i,n,s,o){var a=e.Zero();return e.UnprojectToRef(t,r,i,n,s,o,a),a},e.UnprojectToRef=function(t,r,i,n,s,o,a){e.UnprojectFloatsToRef(t._x,t._y,t._z,r,i,n,s,o,a)},e.UnprojectFloatsToRef=function(t,r,i,n,s,o,a,u,h){var c=f.Matrix[0];o.multiplyToRef(a,c),c.multiplyToRef(u,c),c.invert();var l=f.Vector3[0];l.x=t/n*2-1,l.y=-(r/s*2-1),l.z=2*i-1,e._UnprojectFromInvertedMatrixToRef(l,c,h)},e.Minimize=function(e,t){var r=e.clone();return r.minimizeInPlace(t),r},e.Maximize=function(e,t){var r=e.clone();return r.maximizeInPlace(t),r},e.Distance=function(t,r){return Math.sqrt(e.DistanceSquared(t,r))},e.DistanceSquared=function(e,t){var r=e._x-t._x,i=e._y-t._y,n=e._z-t._z;return r*r+i*i+n*n},e.ProjectOnTriangleToRef=function(t,r,s,o,a){var u=f.Vector3[0],h=f.Vector3[1],c=f.Vector3[2],l=f.Vector3[3],p=f.Vector3[4];s.subtractToRef(r,u),o.subtractToRef(r,h),o.subtractToRef(s,c);var d=u.length(),_=h.length(),g=c.length();if(d<n.kn||_<n.kn||g<n.kn)return a.copyFrom(r),e.Distance(t,r);t.subtractToRef(r,p),e.CrossToRef(u,h,l);var m=l.length();if(m<n.kn)return a.copyFrom(r),e.Distance(t,r);l.normalizeFromLength(m);var y=p.length();if(y<n.kn)return a.copyFrom(r),0;p.normalizeFromLength(y);var v=e.Dot(l,p),b=f.Vector3[5],x=f.Vector3[6];b.copyFrom(l).scaleInPlace(-y*v),x.copyFrom(t).addInPlace(b);var R=f.Vector3[4],T=f.Vector3[5],E=f.Vector3[7],S=f.Vector3[8];R.copyFrom(u).scaleInPlace(1/d),S.copyFrom(h).scaleInPlace(1/_),R.addInPlace(S).scaleInPlace(-1),T.copyFrom(u).scaleInPlace(-1/d),S.copyFrom(c).scaleInPlace(1/g),T.addInPlace(S).scaleInPlace(-1),E.copyFrom(c).scaleInPlace(-1/g),S.copyFrom(h).scaleInPlace(-1/_),E.addInPlace(S).scaleInPlace(-1);var C,A,F,P=f.Vector3[9];P.copyFrom(x).subtractInPlace(r),e.CrossToRef(R,P,S),C=e.Dot(S,l),P.copyFrom(x).subtractInPlace(s),e.CrossToRef(T,P,S),A=e.Dot(S,l),P.copyFrom(x).subtractInPlace(o),e.CrossToRef(E,P,S),F=e.Dot(S,l);var w,B,M=f.Vector3[10];C>0&&A<0?(M.copyFrom(u),w=r,B=s):A>0&&F<0?(M.copyFrom(c),w=s,B=o):(M.copyFrom(h).scaleInPlace(-1),w=o,B=r);var O=f.Vector3[9],I=f.Vector3[4];if(w.subtractToRef(x,S),B.subtractToRef(x,O),e.CrossToRef(S,O,I),!(e.Dot(I,l)<0))return a.copyFrom(x),Math.abs(y*v);var D=f.Vector3[5];e.CrossToRef(M,I,D),D.normalize();var L=f.Vector3[9];L.copyFrom(w).subtractInPlace(x);var U=L.length();if(U<n.kn)return a.copyFrom(w),e.Distance(t,w);L.normalizeFromLength(U);var N=e.Dot(D,L),G=f.Vector3[7];G.copyFrom(x).addInPlace(D.scaleInPlace(U*N)),S.copyFrom(G).subtractInPlace(w),y=M.length(),M.normalizeFromLength(y);var V=e.Dot(S,M)/Math.max(y,n.kn);return V=i.R.Clamp(V,0,1),G.copyFrom(w).addInPlace(M.scaleInPlace(V*y)),a.copyFrom(G),e.Distance(t,G)},e.Center=function(t,r){return e.CenterToRef(t,r,e.Zero())},e.CenterToRef=function(e,t,r){return r.copyFromFloats((e._x+t._x)/2,(e._y+t._y)/2,(e._z+t._z)/2)},e.RotationFromAxis=function(t,r,i){var n=e.Zero();return e.RotationFromAxisToRef(t,r,i,n),n},e.RotationFromAxisToRef=function(e,t,r,i){var n=f.Quaternion[0];l.RotationQuaternionFromAxisToRef(e,t,r,n),n.toEulerAnglesToRef(i)},e._UpReadOnly=e.Up(),e._LeftHandedForwardReadOnly=e.Forward(!1),e._RightHandedForwardReadOnly=e.Forward(!0),e._RightReadOnly=e.Right(),e._ZeroReadOnly=e.Zero(),e}(),c=function(){function e(e,t,r,i){this.x=e,this.y=t,this.z=r,this.w=i}return e.prototype.toString=function(){return"{X: "+this.x+" Y: "+this.y+" Z: "+this.z+" W: "+this.w+"}"},e.prototype.getClassName=function(){return"Vector4"},e.prototype.getHashCode=function(){var e=0|this.x;return 397*(e=397*(e=397*e^(0|this.y))^(0|this.z))^(0|this.w)},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this},e.prototype.fromArray=function(t,r){return void 0===r&&(r=0),e.FromArrayToRef(t,r,this),this},e.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},e.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,this},e.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},e.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,this},e.prototype.subtractFromFloats=function(t,r,i,n){return new e(this.x-t,this.y-r,this.z-i,this.w-n)},e.prototype.subtractFromFloatsToRef=function(e,t,r,i,n){return n.x=this.x-e,n.y=this.y-t,n.z=this.z-r,n.w=this.w-i,this},e.prototype.negate=function(){return new e(-this.x,-this.y,-this.z,-this.w)},e.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},e.prototype.negateToRef=function(e){return e.copyFromFloats(-1*this.x,-1*this.y,-1*this.z,-1*this.w)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)},e.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=n.kn),e&&i.R.WithinEpsilon(this.x,e.x,t)&&i.R.WithinEpsilon(this.y,e.y,t)&&i.R.WithinEpsilon(this.z,e.z,t)&&i.R.WithinEpsilon(this.w,e.w,t)},e.prototype.equalsToFloats=function(e,t,r,i){return this.x===e&&this.y===t&&this.z===r&&this.w===i},e.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},e.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,this},e.prototype.multiplyByFloats=function(t,r,i,n){return new e(this.x*t,this.y*r,this.z*i,this.w*n)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},e.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,this},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.minimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this},e.prototype.maximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.prototype.normalize=function(){var e=this.length();return 0===e?this:this.scaleInPlace(1/e)},e.prototype.toVector3=function(){return new h(this.x,this.y,this.z)},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e.prototype.copyFromFloats=function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},e.prototype.set=function(e,t,r,i){return this.copyFromFloats(e,t,r,i)},e.prototype.setAll=function(e){return this.x=this.y=this.z=this.w=e,this},e.FromArray=function(t,r){return r||(r=0),new e(t[r],t[r+1],t[r+2],t[r+3])},e.FromArrayToRef=function(e,t,r){r.x=e[t],r.y=e[t+1],r.z=e[t+2],r.w=e[t+3]},e.FromFloatArrayToRef=function(t,r,i){e.FromArrayToRef(t,r,i)},e.FromFloatsToRef=function(e,t,r,i,n){n.x=e,n.y=t,n.z=r,n.w=i},e.Zero=function(){return new e(0,0,0,0)},e.One=function(){return new e(1,1,1,1)},e.Normalize=function(t){var r=e.Zero();return e.NormalizeToRef(t,r),r},e.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},e.Minimize=function(e,t){var r=e.clone();return r.minimizeInPlace(t),r},e.Maximize=function(e,t){var r=e.clone();return r.maximizeInPlace(t),r},e.Distance=function(t,r){return Math.sqrt(e.DistanceSquared(t,r))},e.DistanceSquared=function(e,t){var r=e.x-t.x,i=e.y-t.y,n=e.z-t.z,s=e.w-t.w;return r*r+i*i+n*n+s*s},e.Center=function(t,r){return e.CenterToRef(t,r,e.Zero())},e.CenterToRef=function(e,t,r){return r.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2,(e.w+t.w)/2)},e.TransformCoordinates=function(t,r){var i=e.Zero();return e.TransformCoordinatesToRef(t,r,i),i},e.TransformCoordinatesToRef=function(t,r,i){e.TransformCoordinatesFromFloatsToRef(t._x,t._y,t._z,r,i)},e.TransformCoordinatesFromFloatsToRef=function(e,t,r,i,n){var s=i.m,o=e*s[0]+t*s[4]+r*s[8]+s[12],a=e*s[1]+t*s[5]+r*s[9]+s[13],u=e*s[2]+t*s[6]+r*s[10]+s[14],h=e*s[3]+t*s[7]+r*s[11]+s[15];n.x=o,n.y=a,n.z=u,n.w=h},e.TransformNormal=function(t,r){var i=e.Zero();return e.TransformNormalToRef(t,r,i),i},e.TransformNormalToRef=function(e,t,r){var i=t.m,n=e.x*i[0]+e.y*i[4]+e.z*i[8],s=e.x*i[1]+e.y*i[5]+e.z*i[9],o=e.x*i[2]+e.y*i[6]+e.z*i[10];r.x=n,r.y=s,r.z=o,r.w=e.w},e.TransformNormalFromFloatsToRef=function(e,t,r,i,n,s){var o=n.m;s.x=e*o[0]+t*o[4]+r*o[8],s.y=e*o[1]+t*o[5]+r*o[9],s.z=e*o[2]+t*o[6]+r*o[10],s.w=i},e.FromVector3=function(t,r){return void 0===r&&(r=0),new e(t._x,t._y,t._z,r)},e}(),l=function(){function e(e,t,r,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=1),this._isDirty=!0,this._x=e,this._y=t,this._z=r,this._w=i}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"w",{get:function(){return this._w},set:function(e){this._w=e,this._isDirty=!0},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"{X: "+this._x+" Y: "+this._y+" Z: "+this._z+" W: "+this._w+"}"},e.prototype.getClassName=function(){return"Quaternion"},e.prototype.getHashCode=function(){var e=0|this._x;return 397*(e=397*(e=397*e^(0|this._y))^(0|this._z))^(0|this._w)},e.prototype.asArray=function(){return[this._x,this._y,this._z,this._w]},e.prototype.equals=function(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z&&this._w===e._w},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=n.kn),e&&i.R.WithinEpsilon(this._x,e._x,t)&&i.R.WithinEpsilon(this._y,e._y,t)&&i.R.WithinEpsilon(this._z,e._z,t)&&i.R.WithinEpsilon(this._w,e._w,t)},e.prototype.clone=function(){return new e(this._x,this._y,this._z,this._w)},e.prototype.copyFrom=function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this.w=e._w,this},e.prototype.copyFromFloats=function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},e.prototype.set=function(e,t,r,i){return this.copyFromFloats(e,t,r,i)},e.prototype.add=function(t){return new e(this._x+t._x,this._y+t._y,this._z+t._z,this._w+t._w)},e.prototype.addInPlace=function(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._w+=e._w,this},e.prototype.subtract=function(t){return new e(this._x-t._x,this._y-t._y,this._z-t._z,this._w-t._w)},e.prototype.scale=function(t){return new e(this._x*t,this._y*t,this._z*t,this._w*t)},e.prototype.scaleToRef=function(e,t){return t.x=this._x*e,t.y=this._y*e,t.z=this._z*e,t.w=this._w*e,this},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this._x*e,t.y+=this._y*e,t.z+=this._z*e,t.w+=this._w*e,this},e.prototype.multiply=function(t){var r=new e(0,0,0,1);return this.multiplyToRef(t,r),r},e.prototype.multiplyToRef=function(e,t){var r=this._x*e._w+this._y*e._z-this._z*e._y+this._w*e._x,i=-this._x*e._z+this._y*e._w+this._z*e._x+this._w*e._y,n=this._x*e._y-this._y*e._x+this._z*e._w+this._w*e._z,s=-this._x*e._x-this._y*e._y-this._z*e._z+this._w*e._w;return t.copyFromFloats(r,i,n,s),this},e.prototype.multiplyInPlace=function(e){return this.multiplyToRef(e,this),this},e.prototype.conjugateToRef=function(e){return e.copyFromFloats(-this._x,-this._y,-this._z,this._w),this},e.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},e.prototype.conjugate=function(){return new e(-this._x,-this._y,-this._z,this._w)},e.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},e.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.prototype.toEulerAngles=function(){var e=h.Zero();return this.toEulerAnglesToRef(e),e},e.prototype.toEulerAnglesToRef=function(e){var t=this._z,r=this._x,i=this._y,n=this._w,s=n*n,o=t*t,a=r*r,u=i*i,h=i*t-r*n,c=.4999999;return h<-c?(e.y=2*Math.atan2(i,n),e.x=Math.PI/2,e.z=0):h>c?(e.y=2*Math.atan2(i,n),e.x=-Math.PI/2,e.z=0):(e.z=Math.atan2(2*(r*i+t*n),-o-a+u+s),e.x=Math.asin(-2*(t*i-r*n)),e.y=Math.atan2(2*(t*r+i*n),o-a-u+s)),this},e.prototype.toRotationMatrix=function(e){return p.FromQuaternionToRef(this,e),this},e.prototype.fromRotationMatrix=function(t){return e.FromRotationMatrixToRef(t,this),this},e.FromRotationMatrix=function(t){var r=new e;return e.FromRotationMatrixToRef(t,r),r},e.FromRotationMatrixToRef=function(e,t){var r,i=e.m,n=i[0],s=i[4],o=i[8],a=i[1],u=i[5],h=i[9],c=i[2],l=i[6],p=i[10],f=n+u+p;f>0?(r=.5/Math.sqrt(f+1),t.w=.25/r,t.x=(l-h)*r,t.y=(o-c)*r,t.z=(a-s)*r):n>u&&n>p?(r=2*Math.sqrt(1+n-u-p),t.w=(l-h)/r,t.x=.25*r,t.y=(s+a)/r,t.z=(o+c)/r):u>p?(r=2*Math.sqrt(1+u-n-p),t.w=(o-c)/r,t.x=(s+a)/r,t.y=.25*r,t.z=(h+l)/r):(r=2*Math.sqrt(1+p-n-u),t.w=(a-s)/r,t.x=(o+c)/r,t.y=(h+l)/r,t.z=.25*r)},e.Dot=function(e,t){return e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w},e.AreClose=function(t,r){return e.Dot(t,r)>=0},e.SmoothToRef=function(t,r,n,s,o){var a=0===s?1:n/s;a=i.R.Clamp(a,0,1),e.SlerpToRef(t,r,a,o)},e.Zero=function(){return new e(0,0,0,0)},e.Inverse=function(t){return new e(-t._x,-t._y,-t._z,t._w)},e.InverseToRef=function(e,t){return t.set(-e._x,-e._y,-e._z,e._w),t},e.Identity=function(){return new e(0,0,0,1)},e.IsIdentity=function(e){return e&&0===e._x&&0===e._y&&0===e._z&&1===e._w},e.RotationAxis=function(t,r){return e.RotationAxisToRef(t,r,new e)},e.RotationAxisToRef=function(e,t,r){var i=Math.sin(t/2);return e.normalize(),r.w=Math.cos(t/2),r.x=e._x*i,r.y=e._y*i,r.z=e._z*i,r},e.FromArray=function(t,r){return r||(r=0),new e(t[r],t[r+1],t[r+2],t[r+3])},e.FromArrayToRef=function(e,t,r){r.x=e[t],r.y=e[t+1],r.z=e[t+2],r.w=e[t+3]},e.FromEulerAngles=function(t,r,i){var n=new e;return e.RotationYawPitchRollToRef(r,t,i,n),n},e.FromEulerAnglesToRef=function(t,r,i,n){return e.RotationYawPitchRollToRef(r,t,i,n),n},e.FromEulerVector=function(t){var r=new e;return e.RotationYawPitchRollToRef(t._y,t._x,t._z,r),r},e.FromEulerVectorToRef=function(t,r){return e.RotationYawPitchRollToRef(t._y,t._x,t._z,r),r},e.FromUnitVectorsToRef=function(e,t,r){var i=h.Dot(e,t)+1;return i<n.kn?Math.abs(e.x)>Math.abs(e.z)?r.set(-e.y,e.x,0,0):r.set(0,-e.z,e.y,0):(h.CrossToRef(e,t,d.Vector3[0]),r.set(d.Vector3[0].x,d.Vector3[0].y,d.Vector3[0].z,i)),r.normalize()},e.RotationYawPitchRoll=function(t,r,i){var n=new e;return e.RotationYawPitchRollToRef(t,r,i,n),n},e.RotationYawPitchRollToRef=function(e,t,r,i){var n=.5*r,s=.5*t,o=.5*e,a=Math.sin(n),u=Math.cos(n),h=Math.sin(s),c=Math.cos(s),l=Math.sin(o),p=Math.cos(o);i.x=p*h*u+l*c*a,i.y=l*c*u-p*h*a,i.z=p*c*a-l*h*u,i.w=p*c*u+l*h*a},e.RotationAlphaBetaGamma=function(t,r,i){var n=new e;return e.RotationAlphaBetaGammaToRef(t,r,i,n),n},e.RotationAlphaBetaGammaToRef=function(e,t,r,i){var n=.5*(r+e),s=.5*(r-e),o=.5*t;i.x=Math.cos(s)*Math.sin(o),i.y=Math.sin(s)*Math.sin(o),i.z=Math.sin(n)*Math.cos(o),i.w=Math.cos(n)*Math.cos(o)},e.RotationQuaternionFromAxis=function(t,r,i){var n=new e(0,0,0,0);return e.RotationQuaternionFromAxisToRef(t,r,i,n),n},e.RotationQuaternionFromAxisToRef=function(t,r,i,n){var s=f.Matrix[0];p.FromXYZAxesToRef(t.normalize(),r.normalize(),i.normalize(),s),e.FromRotationMatrixToRef(s,n)},e.FromLookDirectionLH=function(t,r){var i=new e;return e.FromLookDirectionLHToRef(t,r,i),i},e.FromLookDirectionLHToRef=function(t,r,i){var n=f.Matrix[0];p.LookDirectionLHToRef(t,r,n),e.FromRotationMatrixToRef(n,i)},e.FromLookDirectionRH=function(t,r){var i=new e;return e.FromLookDirectionRHToRef(t,r,i),i},e.FromLookDirectionRHToRef=function(t,r,i){var n=f.Matrix[0];return p.LookDirectionRHToRef(t,r,n),e.FromRotationMatrixToRef(n,i)},e.Slerp=function(t,r,i){var n=e.Identity();return e.SlerpToRef(t,r,i,n),n},e.SlerpToRef=function(e,t,r,i){var n,s,o=e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w,a=!1;if(o<0&&(a=!0,o=-o),o>.999999)s=1-r,n=a?-r:r;else{var u=Math.acos(o),h=1/Math.sin(u);s=Math.sin((1-r)*u)*h,n=a?-Math.sin(r*u)*h:Math.sin(r*u)*h}i.x=s*e._x+n*t._x,i.y=s*e._y+n*t._y,i.z=s*e._z+n*t._z,i.w=s*e._w+n*t._w},e.Hermite=function(t,r,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,c=a-2*o+s,l=a-o;return new e(t._x*u+i._x*h+r._x*c+n._x*l,t._y*u+i._y*h+r._y*c+n._y*l,t._z*u+i._z*h+r._z*c+n._z*l,t._w*u+i._w*h+r._w*c+n._w*l)},e.Hermite1stDerivative=function(t,r,i,n,s){var o=e.Zero();return this.Hermite1stDerivativeToRef(t,r,i,n,s,o),o},e.Hermite1stDerivativeToRef=function(e,t,r,i,n,s){var o=n*n;s.x=6*(o-n)*e.x+(3*o-4*n+1)*t.x+6*(-o+n)*r.x+(3*o-2*n)*i.x,s.y=6*(o-n)*e.y+(3*o-4*n+1)*t.y+6*(-o+n)*r.y+(3*o-2*n)*i.y,s.z=6*(o-n)*e.z+(3*o-4*n+1)*t.z+6*(-o+n)*r.z+(3*o-2*n)*i.z,s.w=6*(o-n)*e.w+(3*o-4*n+1)*t.w+6*(-o+n)*r.w+(3*o-2*n)*i.w},e}(),p=function(){function e(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,a.Z.MatrixTrackPrecisionChange&&a.Z.MatrixTrackedMatrices.push(this),this._m=new a.Z.MatrixCurrentType(16),this._updateIdentityStatus(!1)}return Object.defineProperty(e,"Use64Bits",{get:function(){return a.Z.MatrixUse64Bits},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),e.prototype._markAsUpdated=function(){this.updateFlag=e._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},e.prototype._updateIdentityStatus=function(t,r,i,n){void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===n&&(n=!0),this.updateFlag=e._updateFlagSeed++,this._isIdentity=t,this._isIdentity3x2=t||i,this._isIdentityDirty=!this._isIdentity&&r,this._isIdentity3x2Dirty=!this._isIdentity3x2&&n},e.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var e=this._m;this._isIdentity=1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]}return this._isIdentity},e.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},e.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var e=this._m,t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],u=e[7],h=e[8],c=e[9],l=e[10],p=e[11],f=e[12],d=e[13],_=e[14],g=e[15],m=l*g-_*p,y=c*g-d*p,v=c*_-d*l,b=h*g-f*p,x=h*_-l*f,R=h*d-f*c;return t*+(o*m-a*y+u*v)+r*-(s*m-a*b+u*x)+i*+(s*y-o*b+u*R)+n*-(s*v-o*x+a*R)},e.prototype.toArray=function(){return this._m},e.prototype.asArray=function(){return this._m},e.prototype.invert=function(){return this.invertToRef(this),this},e.prototype.reset=function(){return e.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},e.prototype.add=function(t){var r=new e;return this.addToRef(t,r),r},e.prototype.addToRef=function(e,t){for(var r=this._m,i=t._m,n=e.m,s=0;s<16;s++)i[s]=r[s]+n[s];return t._markAsUpdated(),this},e.prototype.addToSelf=function(e){for(var t=this._m,r=e.m,i=0;i<16;i++)t[i]+=r[i];return this._markAsUpdated(),this},e.prototype.invertToRef=function(t){if(!0===this._isIdentity)return e.IdentityToRef(t),this;var r=this._m,i=r[0],n=r[1],s=r[2],o=r[3],a=r[4],u=r[5],h=r[6],c=r[7],l=r[8],p=r[9],f=r[10],d=r[11],_=r[12],g=r[13],m=r[14],y=r[15],v=f*y-m*d,b=p*y-g*d,x=p*m-g*f,R=l*y-_*d,T=l*m-f*_,E=l*g-_*p,S=+(u*v-h*b+c*x),C=-(a*v-h*R+c*T),A=+(a*b-u*R+c*E),F=-(a*x-u*T+h*E),P=i*S+n*C+s*A+o*F;if(0===P)return t.copyFrom(this),this;var w=1/P,B=h*y-m*c,M=u*y-g*c,O=u*m-g*h,I=a*y-_*c,D=a*m-_*h,L=a*g-_*u,U=h*d-f*c,N=u*d-p*c,G=u*f-p*h,V=a*d-l*c,z=a*f-l*h,k=a*p-l*u,W=-(n*v-s*b+o*x),j=+(i*v-s*R+o*T),H=-(i*b-n*R+o*E),X=+(i*x-n*T+s*E),q=+(n*B-s*M+o*O),K=-(i*B-s*I+o*D),Y=+(i*M-n*I+o*L),Q=-(i*O-n*D+s*L),Z=-(n*U-s*N+o*G),$=+(i*U-s*V+o*z),J=-(i*N-n*V+o*k),ee=+(i*G-n*z+s*k);return e.FromValuesToRef(S*w,W*w,q*w,Z*w,C*w,j*w,K*w,$*w,A*w,H*w,Y*w,J*w,F*w,X*w,Q*w,ee*w,t),this},e.prototype.addAtIndex=function(e,t){return this._m[e]+=t,this._markAsUpdated(),this},e.prototype.multiplyAtIndex=function(e,t){return this._m[e]*=t,this._markAsUpdated(),this},e.prototype.setTranslationFromFloats=function(e,t,r){return this._m[12]=e,this._m[13]=t,this._m[14]=r,this._markAsUpdated(),this},e.prototype.addTranslationFromFloats=function(e,t,r){return this._m[12]+=e,this._m[13]+=t,this._m[14]+=r,this._markAsUpdated(),this},e.prototype.setTranslation=function(e){return this.setTranslationFromFloats(e._x,e._y,e._z)},e.prototype.getTranslation=function(){return new h(this._m[12],this._m[13],this._m[14])},e.prototype.getTranslationToRef=function(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],this},e.prototype.removeRotationAndScaling=function(){var t=this.m;return e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t[12],t[13],t[14],t[15],this),this._updateIdentityStatus(0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]),this},e.prototype.multiply=function(t){var r=new e;return this.multiplyToRef(t,r),r},e.prototype.copyFrom=function(e){e.copyToArray(this._m);var t=e;return this._updateIdentityStatus(t._isIdentity,t._isIdentityDirty,t._isIdentity3x2,t._isIdentity3x2Dirty),this},e.prototype.copyToArray=function(e,t){void 0===t&&(t=0);var r=this._m;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],this},e.prototype.multiplyToRef=function(e,t){return this._isIdentity?(t.copyFrom(e),this):e._isIdentity?(t.copyFrom(this),this):(this.multiplyToArray(e,t._m,0),t._markAsUpdated(),this)},e.prototype.multiplyToArray=function(e,t,r){var i=this._m,n=e.m,s=i[0],o=i[1],a=i[2],u=i[3],h=i[4],c=i[5],l=i[6],p=i[7],f=i[8],d=i[9],_=i[10],g=i[11],m=i[12],y=i[13],v=i[14],b=i[15],x=n[0],R=n[1],T=n[2],E=n[3],S=n[4],C=n[5],A=n[6],F=n[7],P=n[8],w=n[9],B=n[10],M=n[11],O=n[12],I=n[13],D=n[14],L=n[15];return t[r]=s*x+o*S+a*P+u*O,t[r+1]=s*R+o*C+a*w+u*I,t[r+2]=s*T+o*A+a*B+u*D,t[r+3]=s*E+o*F+a*M+u*L,t[r+4]=h*x+c*S+l*P+p*O,t[r+5]=h*R+c*C+l*w+p*I,t[r+6]=h*T+c*A+l*B+p*D,t[r+7]=h*E+c*F+l*M+p*L,t[r+8]=f*x+d*S+_*P+g*O,t[r+9]=f*R+d*C+_*w+g*I,t[r+10]=f*T+d*A+_*B+g*D,t[r+11]=f*E+d*F+_*M+g*L,t[r+12]=m*x+y*S+v*P+b*O,t[r+13]=m*R+y*C+v*w+b*I,t[r+14]=m*T+y*A+v*B+b*D,t[r+15]=m*E+y*F+v*M+b*L,this},e.prototype.equals=function(e){var t=e;if(!t)return!1;if((this._isIdentity||t._isIdentity)&&!this._isIdentityDirty&&!t._isIdentityDirty)return this._isIdentity&&t._isIdentity;var r=this.m,i=t.m;return r[0]===i[0]&&r[1]===i[1]&&r[2]===i[2]&&r[3]===i[3]&&r[4]===i[4]&&r[5]===i[5]&&r[6]===i[6]&&r[7]===i[7]&&r[8]===i[8]&&r[9]===i[9]&&r[10]===i[10]&&r[11]===i[11]&&r[12]===i[12]&&r[13]===i[13]&&r[14]===i[14]&&r[15]===i[15]},e.prototype.clone=function(){var t=new e;return t.copyFrom(this),t},e.prototype.getClassName=function(){return"Matrix"},e.prototype.getHashCode=function(){for(var e=0|this._m[0],t=1;t<16;t++)e=397*e^(0|this._m[t]);return e},e.prototype.decomposeToTransformNode=function(e){return e.rotationQuaternion=e.rotationQuaternion||new l,this.decompose(e.scaling,e.rotationQuaternion,e.position)},e.prototype.decompose=function(t,r,i){if(this._isIdentity)return i&&i.setAll(0),t&&t.setAll(1),r&&r.copyFromFloats(0,0,0,1),!0;var n=this._m;if(i&&i.copyFromFloats(n[12],n[13],n[14]),(t=t||f.Vector3[0]).x=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),t.y=Math.sqrt(n[4]*n[4]+n[5]*n[5]+n[6]*n[6]),t.z=Math.sqrt(n[8]*n[8]+n[9]*n[9]+n[10]*n[10]),this.determinant()<=0&&(t.y*=-1),0===t._x||0===t._y||0===t._z)return r&&r.copyFromFloats(0,0,0,1),!1;if(r){var s=1/t._x,o=1/t._y,a=1/t._z;e.FromValuesToRef(n[0]*s,n[1]*s,n[2]*s,0,n[4]*o,n[5]*o,n[6]*o,0,n[8]*a,n[9]*a,n[10]*a,0,0,0,0,1,f.Matrix[0]),l.FromRotationMatrixToRef(f.Matrix[0],r)}return!0},e.prototype.getRow=function(e){if(e<0||e>3)return null;var t=4*e;return new c(this._m[t+0],this._m[t+1],this._m[t+2],this._m[t+3])},e.prototype.setRow=function(e,t){return this.setRowFromFloats(e,t.x,t.y,t.z,t.w)},e.prototype.transpose=function(){return e.Transpose(this)},e.prototype.transposeToRef=function(t){return e.TransposeToRef(this,t),this},e.prototype.setRowFromFloats=function(e,t,r,i,n){if(e<0||e>3)return this;var s=4*e;return this._m[s+0]=t,this._m[s+1]=r,this._m[s+2]=i,this._m[s+3]=n,this._markAsUpdated(),this},e.prototype.scale=function(t){var r=new e;return this.scaleToRef(t,r),r},e.prototype.scaleToRef=function(e,t){for(var r=0;r<16;r++)t._m[r]=this._m[r]*e;return t._markAsUpdated(),this},e.prototype.scaleAndAddToRef=function(e,t){for(var r=0;r<16;r++)t._m[r]+=this._m[r]*e;return t._markAsUpdated(),this},e.prototype.toNormalMatrix=function(t){var r=f.Matrix[0];this.invertToRef(r),r.transposeToRef(t);var i=t._m;e.FromValuesToRef(i[0],i[1],i[2],0,i[4],i[5],i[6],0,i[8],i[9],i[10],0,0,0,0,1,t)},e.prototype.getRotationMatrix=function(){var t=new e;return this.getRotationMatrixToRef(t),t},e.prototype.getRotationMatrixToRef=function(t){var r=f.Vector3[0];if(!this.decompose(r))return e.IdentityToRef(t),this;var i=this._m,n=1/r._x,s=1/r._y,o=1/r._z;return e.FromValuesToRef(i[0]*n,i[1]*n,i[2]*n,0,i[4]*s,i[5]*s,i[6]*s,0,i[8]*o,i[9]*o,i[10]*o,0,0,0,0,1,t),this},e.prototype.toggleModelMatrixHandInPlace=function(){var e=this._m;e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this._markAsUpdated()},e.prototype.toggleProjectionMatrixHandInPlace=function(){var e=this._m;e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this._markAsUpdated()},e.FromArray=function(t,r){void 0===r&&(r=0);var i=new e;return e.FromArrayToRef(t,r,i),i},e.FromArrayToRef=function(e,t,r){for(var i=0;i<16;i++)r._m[i]=e[i+t];r._markAsUpdated()},e.FromFloat32ArrayToRefScaled=function(e,t,r,i){for(var n=0;n<16;n++)i._m[n]=e[n+t]*r;i._markAsUpdated()},Object.defineProperty(e,"IdentityReadOnly",{get:function(){return e._identityReadOnly},enumerable:!1,configurable:!0}),e.FromValuesToRef=function(e,t,r,i,n,s,o,a,u,h,c,l,p,f,d,_,g){var m=g._m;m[0]=e,m[1]=t,m[2]=r,m[3]=i,m[4]=n,m[5]=s,m[6]=o,m[7]=a,m[8]=u,m[9]=h,m[10]=c,m[11]=l,m[12]=p,m[13]=f,m[14]=d,m[15]=_,g._markAsUpdated()},e.FromValues=function(t,r,i,n,s,o,a,u,h,c,l,p,f,d,_,g){var m=new e,y=m._m;return y[0]=t,y[1]=r,y[2]=i,y[3]=n,y[4]=s,y[5]=o,y[6]=a,y[7]=u,y[8]=h,y[9]=c,y[10]=l,y[11]=p,y[12]=f,y[13]=d,y[14]=_,y[15]=g,m._markAsUpdated(),m},e.Compose=function(t,r,i){var n=new e;return e.ComposeToRef(t,r,i,n),n},e.ComposeToRef=function(e,t,r,i){var n=i._m,s=t._x,o=t._y,a=t._z,u=t._w,h=s+s,c=o+o,l=a+a,p=s*h,f=s*c,d=s*l,_=o*c,g=o*l,m=a*l,y=u*h,v=u*c,b=u*l,x=e._x,R=e._y,T=e._z;n[0]=(1-(_+m))*x,n[1]=(f+b)*x,n[2]=(d-v)*x,n[3]=0,n[4]=(f-b)*R,n[5]=(1-(p+m))*R,n[6]=(g+y)*R,n[7]=0,n[8]=(d+v)*T,n[9]=(g-y)*T,n[10]=(1-(p+_))*T,n[11]=0,n[12]=r._x,n[13]=r._y,n[14]=r._z,n[15]=1,i._markAsUpdated()},e.Identity=function(){var t=e.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return t._updateIdentityStatus(!0),t},e.IdentityToRef=function(t){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(!0)},e.Zero=function(){var t=e.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return t._updateIdentityStatus(!1),t},e.RotationX=function(t){var r=new e;return e.RotationXToRef(t,r),r},e.Invert=function(t){var r=new e;return t.invertToRef(r),r},e.RotationXToRef=function(t,r){var i=Math.sin(t),n=Math.cos(t);e.FromValuesToRef(1,0,0,0,0,n,i,0,0,-i,n,0,0,0,0,1,r),r._updateIdentityStatus(1===n&&0===i)},e.RotationY=function(t){var r=new e;return e.RotationYToRef(t,r),r},e.RotationYToRef=function(t,r){var i=Math.sin(t),n=Math.cos(t);e.FromValuesToRef(n,0,-i,0,0,1,0,0,i,0,n,0,0,0,0,1,r),r._updateIdentityStatus(1===n&&0===i)},e.RotationZ=function(t){var r=new e;return e.RotationZToRef(t,r),r},e.RotationZToRef=function(t,r){var i=Math.sin(t),n=Math.cos(t);e.FromValuesToRef(n,i,0,0,-i,n,0,0,0,0,1,0,0,0,0,1,r),r._updateIdentityStatus(1===n&&0===i)},e.RotationAxis=function(t,r){var i=new e;return e.RotationAxisToRef(t,r,i),i},e.RotationAxisToRef=function(e,t,r){var i=Math.sin(-t),n=Math.cos(-t),s=1-n;e.normalize();var o=r._m;o[0]=e._x*e._x*s+n,o[1]=e._x*e._y*s-e._z*i,o[2]=e._x*e._z*s+e._y*i,o[3]=0,o[4]=e._y*e._x*s+e._z*i,o[5]=e._y*e._y*s+n,o[6]=e._y*e._z*s-e._x*i,o[7]=0,o[8]=e._z*e._x*s-e._y*i,o[9]=e._z*e._y*s+e._x*i,o[10]=e._z*e._z*s+n,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,r._markAsUpdated()},e.RotationAlignToRef=function(e,t,r){var i=h.Dot(t,e),s=r._m;if(i<-1+n.kn)s[0]=-1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0;else{var o=h.Cross(t,e),a=1/(1+i);s[0]=o._x*o._x*a+i,s[1]=o._y*o._x*a-o._z,s[2]=o._z*o._x*a+o._y,s[3]=0,s[4]=o._x*o._y*a+o._z,s[5]=o._y*o._y*a+i,s[6]=o._z*o._y*a-o._x,s[7]=0,s[8]=o._x*o._z*a-o._y,s[9]=o._y*o._z*a+o._x,s[10]=o._z*o._z*a+i,s[11]=0}s[12]=0,s[13]=0,s[14]=0,s[15]=1,r._markAsUpdated()},e.RotationYawPitchRoll=function(t,r,i){var n=new e;return e.RotationYawPitchRollToRef(t,r,i,n),n},e.RotationYawPitchRollToRef=function(e,t,r,i){l.RotationYawPitchRollToRef(e,t,r,f.Quaternion[0]),f.Quaternion[0].toRotationMatrix(i)},e.Scaling=function(t,r,i){var n=new e;return e.ScalingToRef(t,r,i,n),n},e.ScalingToRef=function(t,r,i,n){e.FromValuesToRef(t,0,0,0,0,r,0,0,0,0,i,0,0,0,0,1,n),n._updateIdentityStatus(1===t&&1===r&&1===i)},e.Translation=function(t,r,i){var n=new e;return e.TranslationToRef(t,r,i,n),n},e.TranslationToRef=function(t,r,i,n){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,r,i,1,n),n._updateIdentityStatus(0===t&&0===r&&0===i)},e.Lerp=function(t,r,i){var n=new e;return e.LerpToRef(t,r,i,n),n},e.LerpToRef=function(e,t,r,i){for(var n=i._m,s=e.m,o=t.m,a=0;a<16;a++)n[a]=s[a]*(1-r)+o[a]*r;i._markAsUpdated()},e.DecomposeLerp=function(t,r,i){var n=new e;return e.DecomposeLerpToRef(t,r,i,n),n},e.DecomposeLerpToRef=function(t,r,i,n){var s=f.Vector3[0],o=f.Quaternion[0],a=f.Vector3[1];t.decompose(s,o,a);var u=f.Vector3[2],c=f.Quaternion[1],p=f.Vector3[3];r.decompose(u,c,p);var d=f.Vector3[4];h.LerpToRef(s,u,i,d);var _=f.Quaternion[2];l.SlerpToRef(o,c,i,_);var g=f.Vector3[5];h.LerpToRef(a,p,i,g),e.ComposeToRef(d,_,g,n)},e.LookAtLH=function(t,r,i){var n=new e;return e.LookAtLHToRef(t,r,i,n),n},e.LookAtLHToRef=function(t,r,i,n){var s=f.Vector3[0],o=f.Vector3[1],a=f.Vector3[2];r.subtractToRef(t,a),a.normalize(),h.CrossToRef(i,a,s);var u=s.lengthSquared();0===u?s.x=1:s.normalizeFromLength(Math.sqrt(u)),h.CrossToRef(a,s,o),o.normalize();var c=-h.Dot(s,t),l=-h.Dot(o,t),p=-h.Dot(a,t);e.FromValuesToRef(s._x,o._x,a._x,0,s._y,o._y,a._y,0,s._z,o._z,a._z,0,c,l,p,1,n)},e.LookAtRH=function(t,r,i){var n=new e;return e.LookAtRHToRef(t,r,i,n),n},e.LookAtRHToRef=function(t,r,i,n){var s=f.Vector3[0],o=f.Vector3[1],a=f.Vector3[2];t.subtractToRef(r,a),a.normalize(),h.CrossToRef(i,a,s);var u=s.lengthSquared();0===u?s.x=1:s.normalizeFromLength(Math.sqrt(u)),h.CrossToRef(a,s,o),o.normalize();var c=-h.Dot(s,t),l=-h.Dot(o,t),p=-h.Dot(a,t);e.FromValuesToRef(s._x,o._x,a._x,0,s._y,o._y,a._y,0,s._z,o._z,a._z,0,c,l,p,1,n)},e.LookDirectionLH=function(t,r){var i=new e;return e.LookDirectionLHToRef(t,r,i),i},e.LookDirectionLHToRef=function(t,r,i){var n=f.Vector3[0];n.copyFrom(t),n.scaleInPlace(-1);var s=f.Vector3[1];h.CrossToRef(r,n,s),e.FromValuesToRef(s._x,s._y,s._z,0,r._x,r._y,r._z,0,n._x,n._y,n._z,0,0,0,0,1,i)},e.LookDirectionRH=function(t,r){var i=new e;return e.LookDirectionRHToRef(t,r,i),i},e.LookDirectionRHToRef=function(t,r,i){var n=f.Vector3[2];h.CrossToRef(r,t,n),e.FromValuesToRef(n._x,n._y,n._z,0,r._x,r._y,r._z,0,t._x,t._y,t._z,0,0,0,0,1,i)},e.OrthoLH=function(t,r,i,n,s){var o=new e;return e.OrthoLHToRef(t,r,i,n,o,s),o},e.OrthoLHToRef=function(t,r,i,n,s,o){var a=2/t,u=2/r,h=2/(n-i),c=-(n+i)/(n-i);e.FromValuesToRef(a,0,0,0,0,u,0,0,0,0,h,0,0,0,c,1,s),o&&s.multiplyToRef(_,s),s._updateIdentityStatus(1===a&&1===u&&1===h&&0===c)},e.OrthoOffCenterLH=function(t,r,i,n,s,o,a){var u=new e;return e.OrthoOffCenterLHToRef(t,r,i,n,s,o,u,a),u},e.OrthoOffCenterLHToRef=function(t,r,i,n,s,o,a,u){var h=2/(r-t),c=2/(n-i),l=2/(o-s),p=-(o+s)/(o-s),f=(t+r)/(t-r),d=(n+i)/(i-n);e.FromValuesToRef(h,0,0,0,0,c,0,0,0,0,l,0,f,d,p,1,a),u&&a.multiplyToRef(_,a),a._markAsUpdated()},e.OrthoOffCenterRH=function(t,r,i,n,s,o,a){var u=new e;return e.OrthoOffCenterRHToRef(t,r,i,n,s,o,u,a),u},e.OrthoOffCenterRHToRef=function(t,r,i,n,s,o,a,u){e.OrthoOffCenterLHToRef(t,r,i,n,s,o,a,u),a._m[10]*=-1},e.PerspectiveLH=function(t,r,i,n,s,o){void 0===o&&(o=0);var a=new e,u=2*i/t,h=2*i/r,c=(n+i)/(n-i),l=-2*n*i/(n-i),p=Math.tan(o);return e.FromValuesToRef(u,0,0,0,0,h,0,p,0,0,c,1,0,0,l,0,a),s&&a.multiplyToRef(_,a),a._updateIdentityStatus(!1),a},e.PerspectiveFovLH=function(t,r,i,n,s,o){void 0===o&&(o=0);var a=new e;return e.PerspectiveFovLHToRef(t,r,i,n,a,!0,s,o),a},e.PerspectiveFovLHToRef=function(t,r,i,n,s,o,a,u){void 0===o&&(o=!0),void 0===u&&(u=0);var h=i,c=n,l=1/Math.tan(.5*t),p=o?l/r:l,f=o?l:l*r,d=0!==c?(c+h)/(c-h):1,g=0!==c?-2*c*h/(c-h):-2*h,m=Math.tan(u);e.FromValuesToRef(p,0,0,0,0,f,0,m,0,0,d,1,0,0,g,0,s),a&&s.multiplyToRef(_,s),s._updateIdentityStatus(!1)},e.PerspectiveFovReverseLHToRef=function(t,r,i,n,s,o,a,u){void 0===o&&(o=!0),void 0===u&&(u=0);var h=1/Math.tan(.5*t),c=o?h/r:h,l=o?h:h*r,p=Math.tan(u);e.FromValuesToRef(c,0,0,0,0,l,0,p,0,0,-i,1,0,0,1,0,s),a&&s.multiplyToRef(_,s),s._updateIdentityStatus(!1)},e.PerspectiveFovRH=function(t,r,i,n,s,o){void 0===o&&(o=0);var a=new e;return e.PerspectiveFovRHToRef(t,r,i,n,a,!0,s,o),a},e.PerspectiveFovRHToRef=function(t,r,i,n,s,o,a,u){void 0===o&&(o=!0),void 0===u&&(u=0);var h=i,c=n,l=1/Math.tan(.5*t),p=o?l/r:l,f=o?l:l*r,d=0!==c?-(c+h)/(c-h):-1,g=0!==c?-2*c*h/(c-h):-2*h,m=Math.tan(u);e.FromValuesToRef(p,0,0,0,0,f,0,m,0,0,d,-1,0,0,g,0,s),a&&s.multiplyToRef(_,s),s._updateIdentityStatus(!1)},e.PerspectiveFovReverseRHToRef=function(t,r,i,n,s,o,a,u){void 0===o&&(o=!0),void 0===u&&(u=0);var h=1/Math.tan(.5*t),c=o?h/r:h,l=o?h:h*r,p=Math.tan(u);e.FromValuesToRef(c,0,0,0,0,l,0,p,0,0,-i,-1,0,0,-1,0,s),a&&s.multiplyToRef(_,s),s._updateIdentityStatus(!1)},e.PerspectiveFovWebVRToRef=function(e,t,r,i,n,s,o){void 0===n&&(n=!1),void 0===o&&(o=0);var a=n?-1:1,u=Math.tan(e.upDegrees*Math.PI/180),h=Math.tan(e.downDegrees*Math.PI/180),c=Math.tan(e.leftDegrees*Math.PI/180),l=Math.tan(e.rightDegrees*Math.PI/180),p=2/(c+l),f=2/(u+h),d=Math.tan(o),g=i._m;g[0]=p,g[1]=g[2]=g[3]=g[4]=0,g[5]=f,g[6]=0,g[7]=d,g[8]=(c-l)*p*.5,g[9]=-(u-h)*f*.5,g[10]=-r/(t-r),g[11]=1*a,g[12]=g[13]=g[15]=0,g[14]=-2*r*t/(r-t),s&&i.multiplyToRef(_,i),i._markAsUpdated()},e.GetFinalMatrix=function(t,r,i,n,s,o){var a=t.width,u=t.height,h=t.x,c=t.y,l=e.FromValues(a/2,0,0,0,0,-u/2,0,0,0,0,o-s,0,h+a/2,u/2+c,s,1),p=f.Matrix[0];return r.multiplyToRef(i,p),p.multiplyToRef(n,p),p.multiply(l)},e.GetAsMatrix2x2=function(e){var t=e.m,r=[t[0],t[1],t[4],t[5]];return a.Z.MatrixUse64Bits?r:new Float32Array(r)},e.GetAsMatrix3x3=function(e){var t=e.m,r=[t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]];return a.Z.MatrixUse64Bits?r:new Float32Array(r)},e.Transpose=function(t){var r=new e;return e.TransposeToRef(t,r),r},e.TransposeToRef=function(e,t){var r=t._m,i=e.m;r[0]=i[0],r[1]=i[4],r[2]=i[8],r[3]=i[12],r[4]=i[1],r[5]=i[5],r[6]=i[9],r[7]=i[13],r[8]=i[2],r[9]=i[6],r[10]=i[10],r[11]=i[14],r[12]=i[3],r[13]=i[7],r[14]=i[11],r[15]=i[15],t._updateIdentityStatus(e._isIdentity,e._isIdentityDirty)},e.Reflection=function(t){var r=new e;return e.ReflectionToRef(t,r),r},e.ReflectionToRef=function(t,r){t.normalize();var i=t.normal.x,n=t.normal.y,s=t.normal.z,o=-2*i,a=-2*n,u=-2*s;e.FromValuesToRef(o*i+1,a*i,u*i,0,o*n,a*n+1,u*n,0,o*s,a*s,u*s+1,0,o*t.d,a*t.d,u*t.d,1,r)},e.FromXYZAxesToRef=function(t,r,i,n){e.FromValuesToRef(t._x,t._y,t._z,0,r._x,r._y,r._z,0,i._x,i._y,i._z,0,0,0,0,1,n)},e.FromQuaternionToRef=function(e,t){var r=e._x*e._x,i=e._y*e._y,n=e._z*e._z,s=e._x*e._y,o=e._z*e._w,a=e._z*e._x,u=e._y*e._w,h=e._y*e._z,c=e._x*e._w;t._m[0]=1-2*(i+n),t._m[1]=2*(s+o),t._m[2]=2*(a-u),t._m[3]=0,t._m[4]=2*(s-o),t._m[5]=1-2*(n+r),t._m[6]=2*(h+c),t._m[7]=0,t._m[8]=2*(a+u),t._m[9]=2*(h-c),t._m[10]=1-2*(i+r),t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t._markAsUpdated()},e._updateFlagSeed=0,e._identityReadOnly=e.Identity(),e}(),f=function(){function e(){}return e.Vector3=s.B.BuildTuple(11,h.Zero),e.Matrix=s.B.BuildTuple(2,p.Identity),e.Quaternion=s.B.BuildTuple(3,l.Zero),e}(),d=function(){function e(){}return e.Vector2=s.B.BuildTuple(3,u.Zero),e.Vector3=s.B.BuildTuple(13,h.Zero),e.Vector4=s.B.BuildTuple(3,c.Zero),e.Quaternion=s.B.BuildTuple(2,l.Zero),e.Matrix=s.B.BuildTuple(8,p.Identity),e}();o.Q.RegisteredTypes["BABYLON.Vector2"]=u,o.Q.RegisteredTypes["BABYLON.Vector3"]=h,o.Q.RegisteredTypes["BABYLON.Vector4"]=c,o.Q.RegisteredTypes["BABYLON.Matrix"]=p;var _=p.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},745:(e,t,r)=>{"use strict";r.d(t,{e:()=>n});var i=r(4471),n=(function(){function e(e,t){void 0===e&&(e=i.P.Zero()),void 0===t&&(t=i.P.Up()),this.position=e,this.normal=t}e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone())}}(),function(){function e(e,t,r){void 0===e&&(e=i.P.Zero()),void 0===t&&(t=i.P.Up()),void 0===r&&(r=i.FM.Zero()),this.position=e,this.normal=t,this.uv=r}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone(),this.uv.clone())},e}())},2013:(e,t,r)=>{"use strict";r.d(t,{l:()=>i});var i=function(){function e(e,t,r,i){this.x=e,this.y=t,this.width=r,this.height=i}return e.prototype.toGlobal=function(t,r){return new e(this.x*t,this.y*r,this.width*t,this.height*r)},e.prototype.toGlobalToRef=function(e,t,r){return r.x=this.x*e,r.y=this.y*t,r.width=this.width*e,r.height=this.height*t,this},e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e}()},809:(e,t,r)=>{"use strict";r.d(t,{M:()=>n});var i=r(3940),n=function(e){function t(t){var r=e.call(this)||this;return r._buffer=t,r}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),t}(r(3173).h)},9838:(e,t,r)=>{"use strict";r.d(t,{C:()=>n});var i=r(3940),n=function(e){function t(t){var r=e.call(this)||this;return r._buffer=t,r}return(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),t}(r(3173).h)},7121:(e,t,r)=>{"use strict";r.d(t,{q:()=>i});var i=function(){function e(){}return e.Eval=function(t,r){return"true"===(t=t.match(/\([^\(\)]*\)/g)?t.replace(/\([^\(\)]*\)/g,(function(t){return t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,r)})):e._HandleParenthesisContent(t,r))||"false"!==t&&e.Eval(t,r)},e._HandleParenthesisContent=function(t,r){var i;r=r||function(e){return"true"===e};var n=t.split("||");for(var s in n)if(n.hasOwnProperty(s)){var o=e._SimplifyNegation(n[s].trim()),a=o.split("&&");if(a.length>1)for(var u=0;u<a.length;++u){var h=e._SimplifyNegation(a[u].trim());if(!(i="true"!==h&&"false"!==h?"!"===h[0]?!r(h.substring(1)):r(h):"true"===h)){o="false";break}}if(i||"true"===o){i=!0;break}i="true"!==o&&"false"!==o?"!"===o[0]?!r(o.substring(1)):r(o):"true"===o}return i?"true":"false"},e._SimplifyNegation=function(e){return"!true"===(e=(e=e.replace(/^[\s!]+/,(function(e){return(e=e.replace(/[\s]/g,(function(){return""}))).length%2?"!":""}))).trim())?e="false":"!false"===e&&(e="true"),e},e}()},56:(e,t,r)=>{"use strict";r.d(t,{B:()=>i});var i=function(){function e(){}return e.BuildArray=function(e,t){for(var r=[],i=0;i<e;++i)r.push(t());return r},e.BuildTuple=function(t,r){return e.BuildArray(t,r)},e}()},5192:(e,t,r)=>{"use strict";r.d(t,{r:()=>n});var i=r(3940),n=function(){function e(){}return e.GenerateBase64StringFromPixelData=function(e,t,r){void 0===r&&(r=!1);var i=t.width,n=t.height;if(e instanceof Float32Array){for(var s=e.byteLength/e.BYTES_PER_ELEMENT,o=new Uint8Array(s);--s>=0;){var a=e[s];a<0?a=0:a>1&&(a=1),o[s]=255*a}e=o}var u=document.createElement("canvas");u.width=i,u.height=n;var h=u.getContext("2d");if(!h)return null;var c=h.createImageData(i,n);if(c.data.set(e),h.putImageData(c,0,0),r){var l=document.createElement("canvas");l.width=i,l.height=n;var p=l.getContext("2d");return p?(p.translate(0,n),p.scale(1,-1),p.drawImage(u,0,0),l.toDataURL("image/png")):null}return u.toDataURL("image/png")},e.GenerateBase64StringFromTexture=function(t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=t.getInternalTexture();if(!n)return null;var s=t._readPixelsSync(r,i);return s?e.GenerateBase64StringFromPixelData(s,t.getSize(),n.invertY):null},e.GenerateBase64StringFromTextureAsync=function(t,r,n){return void 0===r&&(r=0),void 0===n&&(n=0),(0,i.mG)(this,void 0,void 0,(function(){var s,o;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return(s=t.getInternalTexture())?[4,t.readPixels(r,n)]:[2,null];case 1:return(o=i.sent())?[2,e.GenerateBase64StringFromPixelData(o,t.getSize(),s.invertY)]:[2,null]}}))}))},e}()},3536:(e,t,r)=>{"use strict";r.d(t,{wz:()=>p,qC:()=>f,oU:()=>d,n9:()=>_,qQ:()=>g,QC:()=>m,hd:()=>y,RR:()=>v,N$:()=>b,XX:()=>x,rX:()=>R,mv:()=>T,oQ:()=>E,VE:()=>S,p4:()=>C,G6:()=>A});var i=r(5356),n=r(4471),s=r(7936),o=r(2172),a={},u={},h=function(e,t,r){var n=e();i.$&&i.$.AddTagsTo(n,t.tags);var s=c(n);for(var o in s){var a=s[o],u=t[o],h=a.type;if(null!=u&&("uniqueId"!==o||C.AllowLoadingUniqueId))switch(h){case 0:case 6:case 11:n[o]=u;break;case 1:n[o]=r||u.isRenderTarget?u:u.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:n[o]=r?u:u.clone()}}return n};function c(e){var t=e.getClassName();if(u[t])return u[t];u[t]={};for(var r=u[t],i=e,n=t;n;){var s=a[n];for(var o in s)r[o]=s[o];var h=void 0,c=!1;do{if(!(h=Object.getPrototypeOf(i)).getClassName){c=!0;break}if(h.getClassName()!==n)break;i=h}while(h);if(c)break;n=h.getClassName(),i=h}return r}function l(e,t){return function(r,i){var n=function(e){var t=e.getClassName();return a[t]||(a[t]={}),a[t]}(r);n[i]||(n[i]={type:e,sourceName:t})}}function p(e,t){return void 0===t&&(t=null),function(e,t){return void 0===t&&(t=null),function(r,i){var n=t||"_"+i;Object.defineProperty(r,i,{get:function(){return this[n]},set:function(t){this[n]!==t&&(this[n]=t,r[e].apply(this))},enumerable:!0,configurable:!0})}}(e,t)}function f(e){return l(0,e)}function d(e){return l(1,e)}function _(e){return l(2,e)}function g(e){return l(3,e)}function m(e){return l(4,e)}function y(e){return l(5,e)}function v(e){return l(6,e)}function b(e){return l(7,e)}function x(e){return l(8,e)}function R(e){return l(9,e)}function T(e){return l(10,e)}function E(e){return l(12,e)}function S(e){return l(11,e)}var C=function(){function e(){}return e.AppendSerializedAnimations=function(e,t){if(e.animations){t.animations=[];for(var r=0;r<e.animations.length;r++){var i=e.animations[r];t.animations.push(i.serialize())}}},e.Serialize=function(t,r){r||(r={}),i.$&&(r.tags=i.$.GetTags(t));var n=c(t);for(var s in n){var o=n[s],a=o.sourceName||s,u=o.type,h=t[s];if(null!=h&&("uniqueId"!==s||e.AllowLoadingUniqueId))switch(u){case 0:r[a]=h;break;case 1:r[a]=h.serialize();break;case 2:r[a]=h.asArray();break;case 3:r[a]=h.serialize();break;case 4:case 5:r[a]=h.asArray();break;case 6:r[a]=h.id;break;case 7:r[a]=h.serialize();break;case 8:r[a]=h.asArray();break;case 9:r[a]=h.serialize();break;case 10:r[a]=h.asArray();break;case 11:r[a]=h.id;break;case 12:r[a]=h.asArray()}}return r},e.Parse=function(t,r,s,a){void 0===a&&(a=null);var u=t();a||(a=""),i.$&&i.$.AddTagsTo(u,r.tags);var h=c(u);for(var l in h){var p=h[l],f=r[p.sourceName||l],d=p.type;if(null!=f&&("uniqueId"!==l||e.AllowLoadingUniqueId)){var _=u;switch(d){case 0:_[l]=f;break;case 1:s&&(_[l]=e._TextureParser(f,s,a));break;case 2:_[l]=o.Wo.FromArray(f);break;case 3:_[l]=e._FresnelParametersParser(f);break;case 4:_[l]=n.FM.FromArray(f);break;case 5:_[l]=n.P.FromArray(f);break;case 6:s&&(_[l]=s.getLastMeshById(f));break;case 7:_[l]=e._ColorCurvesParser(f);break;case 8:_[l]=o.HE.FromArray(f);break;case 9:_[l]=e._ImageProcessingConfigurationParser(f);break;case 10:_[l]=n._f.FromArray(f);break;case 11:s&&(_[l]=s.getCameraById(f));case 12:_[l]=n.y3.FromArray(f)}}}return u},e.Clone=function(e,t){return h(e,t,!1)},e.Instanciate=function(e,t){return h(e,t,!0)},e.AllowLoadingUniqueId=!1,e._ImageProcessingConfigurationParser=function(e){throw s.f.WarnImport("ImageProcessingConfiguration")},e._FresnelParametersParser=function(e){throw s.f.WarnImport("FresnelParameters")},e._ColorCurvesParser=function(e){throw s.f.WarnImport("ColorCurves")},e._TextureParser=function(e,t,r){throw s.f.WarnImport("Texture")},e}();function A(e,t,r,i){var n=r.value;r.value=function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];var o=n;if("undefined"!=typeof _native&&_native[t]){var a=_native[t];o=i?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.apply(void 0,e)?a.apply(void 0,e):n.apply(void 0,e)}:a}return e[t]=o,o.apply(void 0,r)}}A.filter=function(e){return function(t,r,i){return A(t,r,i,e)}}},2471:(e,t,r)=>{"use strict";r.d(t,{j:()=>o});var i=r(2519),n=r(4462),s=function(e,t){return e?e.getClassName&&"Mesh"===e.getClassName()?null:e.getClassName&&"SubMesh"===e.getClassName()?e.clone(t):e.clone?e.clone():null:null},o=function(){function e(){}return e.DeepCopy=function(e,t,r,o){for(var a=0,u=function(e){var t=[];do{Object.getOwnPropertyNames(e).forEach((function(e){-1===t.indexOf(e)&&t.push(e)}))}while(e=Object.getPrototypeOf(e));return t}(e);a<u.length;a++){var h=u[a];if(("_"!==h[0]||o&&-1!==o.indexOf(h))&&!(i.M.EndsWith(h,"Observable")||r&&-1!==r.indexOf(h))){var c=e[h],l=typeof c;if("function"!==l)try{if("object"===l)if(c instanceof Array){if(t[h]=[],c.length>0)if("object"==typeof c[0])for(var p=0;p<c.length;p++){var f=s(c[p],t);-1===t[h].indexOf(f)&&t[h].push(f)}else t[h]=c.slice(0)}else t[h]=s(c,t);else t[h]=c}catch(e){n.Y.Warn(e.message)}}}},e}()},7936:(e,t,r)=>{"use strict";r.d(t,{f:()=>i});var i=function(){function e(){}return e.WarnImport=function(e){return e+" needs to be imported before as it contains a side-effect required by your code."},e}()},5511:(e,t,r)=>{"use strict";r.d(t,{M:()=>i});var i=function(){function e(){}return e.IsWindowObjectExist=function(){return"undefined"!=typeof window},e.IsNavigatorAvailable=function(){return"undefined"!=typeof navigator},e.IsDocumentAvailable=function(){return"undefined"!=typeof document},e.GetDOMTextContent=function(e){for(var t="",r=e.firstChild;r;)3===r.nodeType&&(t+=r.textContent),r=r.nextSibling;return t},e}()},5873:(e,t,r)=>{"use strict";r.d(t,{e0:()=>b,eh:()=>m});var i=r(3940),n=r(6471),s=r(5511),o=r(8131),a=r(1026),u=r(6173),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,i.ZT)(t,e),t._setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t}(Error),c=r(2519),l=r(5210),p=r(1910),f=r(3852),d=r(4462),_=r(6684),g=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i),m=function(e){function t(r,i){var s=e.call(this,r)||this;return s.name="LoadFileError",h._setPrototypeOf(s,t.prototype),i instanceof n.g?s.request=i:s.file=i,s}return(0,i.ZT)(t,e),t}(h),y=function(e){function t(r,i){var n=e.call(this,r)||this;return n.request=i,n.name="RequestFileError",h._setPrototypeOf(n,t.prototype),n}return(0,i.ZT)(t,e),t}(h),v=function(e){function t(r,i){var n=e.call(this,r)||this;return n.file=i,n.name="ReadFileError",h._setPrototypeOf(n,t.prototype),n}return(0,i.ZT)(t,e),t}(h),b=function(){function e(){}return e._CleanUrl=function(e){return e.replace(/#/gm,"%23")},e.SetCorsBehavior=function(t,r){if((!t||0!==t.indexOf("data:"))&&e.CorsBehavior)if("string"==typeof e.CorsBehavior||this.CorsBehavior instanceof String)r.crossOrigin=e.CorsBehavior;else{var i=e.CorsBehavior(t);i&&(r.crossOrigin=i)}},e.LoadImage=function(t,r,i,n,s){var o,u;void 0===s&&(s="");var h=!1;t instanceof ArrayBuffer||ArrayBuffer.isView(t)?"undefined"!=typeof Blob?(u=URL.createObjectURL(new Blob([t],{type:s})),h=!0):u="data:"+s+";base64,"+c.M.EncodeArrayBufferToBase64(t):t instanceof Blob?(u=URL.createObjectURL(t),h=!0):(u=e._CleanUrl(t),u=e.PreprocessUrl(t));var l=f.l.LastCreatedEngine;if("undefined"==typeof Image||null!==(o=null==l?void 0:l._features.forceBitmapOverHTMLImageElement)&&void 0!==o&&o)return e.LoadFile(u,(function(e){l.createImageBitmap(new Blob([e],{type:s}),{premultiplyAlpha:"none"}).then((function(e){r(e),h&&URL.revokeObjectURL(u)})).catch((function(e){i&&i("Error while trying to load image: "+t,e)}))}),void 0,n||void 0,!0,(function(e,r){i&&i("Error while trying to load image: "+t,r)})),null;var p=new Image;e.SetCorsBehavior(u,p);var d=function(){p.removeEventListener("load",d),p.removeEventListener("error",_),r(p),h&&p.src&&URL.revokeObjectURL(p.src)},_=function(e){if(p.removeEventListener("load",d),p.removeEventListener("error",_),i){var r=t.toString();i("Error while trying to load image: "+(r.length<32?r:r.slice(0,32)+"..."),e)}h&&p.src&&URL.revokeObjectURL(p.src)};p.addEventListener("load",d),p.addEventListener("error",_);var g=function(){p.src=u};if("data:"!==u.substr(0,5)&&n&&n.enableTexturesOffline)n.open((function(){n&&n.loadImage(u,p)}),g);else{if(-1!==u.indexOf("file:")){var m=decodeURIComponent(u.substring(5).toLowerCase());if(a.X.FilesToLoad[m]){try{var y;try{y=URL.createObjectURL(a.X.FilesToLoad[m])}catch(e){y=URL.createObjectURL(a.X.FilesToLoad[m])}p.src=y,h=!0}catch(e){p.src=""}return p}}g()}return p},e.ReadFile=function(e,t,r,i,n){var s=new FileReader,a={onCompleteObservable:new o.y$,abort:function(){return s.abort()}};return s.onloadend=function(e){return a.onCompleteObservable.notifyObservers(a)},n&&(s.onerror=function(t){n(new v("Unable to read "+e.name,e))}),s.onload=function(e){t(e.target.result)},r&&(s.onprogress=r),i?s.readAsArrayBuffer(e):s.readAsText(e),a},e.LoadFile=function(t,r,i,n,s,u,h){if(t.name)return e.ReadFile(t,r,i,s,u?function(e){u(void 0,e)}:void 0);var c=t;if(-1!==c.indexOf("file:")){var l=decodeURIComponent(c.substring(5).toLowerCase());0===l.indexOf("./")&&(l=l.substring(2));var p=a.X.FilesToLoad[l];if(p)return e.ReadFile(p,r,i,s,u?function(e){return u(void 0,new m(e.message,e.file))}:void 0)}if(e.IsBase64DataUrl(c)){var f={onCompleteObservable:new o.y$,abort:function(){return function(){}}};try{r(s?e.DecodeBase64UrlToBinary(c):e.DecodeBase64UrlToString(c))}catch(e){u?u(void 0,e):d.Y.Error(e.message||"Failed to parse the Data URL")}return _.Q.SetImmediate((function(){f.onCompleteObservable.notifyObservers(f)})),f}return e.RequestFile(c,(function(e,t){r(e,t?t.responseURL:void 0)}),i,n,s,u?function(e){u(e.request,new m(e.message,e.request))}:void 0,h)},e.RequestFile=function(t,r,i,a,u,h,c){t=e._CleanUrl(t),t=e.PreprocessUrl(t);var l=e.BaseUrl+t,p=!1,f={onCompleteObservable:new o.y$,abort:function(){return p=!0}},_=function(){var t=new n.g,o=null;f.abort=function(){p=!0,t.readyState!==(XMLHttpRequest.DONE||4)&&t.abort(),null!==o&&(clearTimeout(o),o=null)};var a=function(e){var r=e.message||"Unknown error";h?h(new y(r,t)):d.Y.Error(r)},_=function(d){if(t.open("GET",l),c)try{c(t)}catch(e){return void a(e)}u&&(t.responseType="arraybuffer"),i&&t.addEventListener("progress",i);var g=function(){t.removeEventListener("loadend",g),f.onCompleteObservable.notifyObservers(f),f.onCompleteObservable.clear()};t.addEventListener("loadend",g);var m=function(){if(!p&&t.readyState===(XMLHttpRequest.DONE||4)){if(t.removeEventListener("readystatechange",m),t.status>=200&&t.status<300||0===t.status&&(!s.M.IsWindowObjectExist()||e.IsFileURL())){try{r(u?t.response:t.responseText,t)}catch(e){a(e)}return}var i=e.DefaultRetryStrategy;if(i){var c=i(l,t,d);if(-1!==c)return t.removeEventListener("loadend",g),t=new n.g,void(o=setTimeout((function(){return _(d+1)}),c))}var f=new y("Error status: "+t.status+" "+t.statusText+" - Unable to load "+l,t);h&&h(f)}};t.addEventListener("readystatechange",m),t.send()};_(0)};if(a&&a.enableSceneOffline){var g=function(e){e&&e.status>400?h&&h(e):_()};a.open((function(){a&&a.loadFile(e.BaseUrl+t,(function(e){p||r(e),f.onCompleteObservable.notifyObservers(f)}),i?function(e){p||i(e)}:void 0,g,u)}),g)}else _();return f},e.IsFileURL=function(){return"undefined"!=typeof location&&"file:"===location.protocol},e.IsBase64DataUrl=function(e){return g.test(e)},e.DecodeBase64UrlToBinary=function(e){return c.M.DecodeBase64ToBinary(e.split(",")[1])},e.DecodeBase64UrlToString=function(e){return c.M.DecodeBase64ToString(e.split(",")[1])},e.DefaultRetryStrategy=u.b.ExponentialBackoff(),e.BaseUrl="",e.CorsBehavior="anonymous",e.PreprocessUrl=function(e){return e},e}();p.B._FileToolsLoadImage=b.LoadImage.bind(b),p.B._FileToolsLoadFile=b.LoadFile.bind(b),l.L._FileToolsLoadFile=b.LoadFile.bind(b)},1026:(e,t,r)=>{"use strict";r.d(t,{X:()=>i});var i=function(){function e(){}return e.FilesToLoad={},e}()},1018:(e,t,r)=>{"use strict";r.d(t,{x:()=>i});var i=function(){function e(){}return e.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},e}()},5472:(e,t,r)=>{"use strict";r.d(t,{K:()=>s});var i=r(4462),n=r(2997),s=function(){function e(){}return e.Instantiate=function(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];var t=n.Q.GetClass(e);if(t)return t;i.Y.Warn(e+" not found, you may have missed an import.");for(var r=e.split("."),s=window||this,o=0,a=r.length;o<a;o++)s=s[r[o]];return"function"!=typeof s?null:s},e.RegisteredExternalClasses={},e}()},4462:(e,t,r)=>{"use strict";r.d(t,{Y:()=>i});var i=function(){function e(){}return e._CheckLimit=function(t,r){var i=e._LogLimitOutputs[t];return i?i.current++:(i={limit:r,current:1},e._LogLimitOutputs[t]=i),i.current<=i.limit},e._GenerateLimitMessage=function(t,r){var i=e._LogLimitOutputs[t];if(i&&e.MessageLimitReached&&i.current===i.limit)switch(r){case 0:e.Log(e.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,"log"));break;case 1:e.Warn(e.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,"warning"));break;case 2:e.Error(e.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,"error"))}},e._AddLogEntry=function(t){e._LogCache=t+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(t)},e._FormatMessage=function(e){var t=function(e){return e<10?"0"+e:""+e},r=new Date;return"["+t(r.getHours())+":"+t(r.getMinutes())+":"+t(r.getSeconds())+"]: "+e},e._LogDisabled=function(e,t){},e._LogEnabled=function(t,r){if(void 0===r||e._CheckLimit(t,r)){var i=e._FormatMessage(t);console.log("BJS - "+i);var n="<div style='color:white'>"+i+"</div><br>";e._AddLogEntry(n),e._GenerateLimitMessage(t,0)}},e._WarnDisabled=function(e,t){},e._WarnEnabled=function(t,r){if(void 0===r||e._CheckLimit(t,r)){var i=e._FormatMessage(t);console.warn("BJS - "+i);var n="<div style='color:orange'>"+t+"</div><br>";e._AddLogEntry(n),e._GenerateLimitMessage(t,1)}},e._ErrorDisabled=function(e,t){},e._ErrorEnabled=function(t,r){if(void 0===r||e._CheckLimit(t,r)){var i=e._FormatMessage(t);e.errorsCount++,console.error("BJS - "+i);var n="<div style='color:red'>"+i+"</div><br>";e._AddLogEntry(n),e._GenerateLimitMessage(t,2)}},Object.defineProperty(e,"LogCache",{get:function(){return e._LogCache},enumerable:!1,configurable:!0}),e.ClearLogCache=function(){e._LogCache="",e._LogLimitOutputs={},e.errorsCount=0},Object.defineProperty(e,"LogLevels",{set:function(t){(t&e.MessageLogLevel)===e.MessageLogLevel?e.Log=e._LogEnabled:e.Log=e._LogDisabled,(t&e.WarningLogLevel)===e.WarningLogLevel?e.Warn=e._WarnEnabled:e.Warn=e._WarnDisabled,(t&e.ErrorLogLevel)===e.ErrorLogLevel?e.Error=e._ErrorEnabled:e.Error=e._ErrorDisabled},enumerable:!1,configurable:!0}),e.NoneLogLevel=0,e.MessageLogLevel=1,e.WarningLogLevel=2,e.ErrorLogLevel=4,e.AllLogLevel=7,e.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",e._LogCache="",e._LogLimitOutputs={},e.errorsCount=0,e.Log=e._LogEnabled,e.Warn=e._WarnEnabled,e.Error=e._ErrorEnabled,e}()},8131:(e,t,r)=>{"use strict";r.d(t,{he:()=>i,y$:()=>s});var i=function(){function e(e,t,r,i){void 0===t&&(t=!1),this.initialize(e,t,r,i)}return e.prototype.initialize=function(e,t,r,i){return void 0===t&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=r,this.currentTarget=i,this},e}(),n=function(e,t,r){void 0===r&&(r=null),this.callback=e,this.mask=t,this.scope=r,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1},s=(function(){function e(){}e.prototype.dispose=function(){if(this._observers&&this._observables)for(var e=0;e<this._observers.length;e++)this._observables[e].remove(this._observers[e]);this._observers=null,this._observables=null},e.Watch=function(t,r,i,n){void 0===i&&(i=-1),void 0===n&&(n=null);var s=new e;s._observers=new Array,s._observables=t;for(var o=0,a=t;o<a.length;o++){var u=a[o].add(r,i,!1,n);u&&s._observers.push(u)}return s}}(),function(){function e(e){this._observers=new Array,this._eventState=new i(0),e&&(this._onObserverAdded=e)}return Object.defineProperty(e.prototype,"observers",{get:function(){return this._observers},enumerable:!1,configurable:!0}),e.prototype.add=function(e,t,r,i,s){if(void 0===t&&(t=-1),void 0===r&&(r=!1),void 0===i&&(i=null),void 0===s&&(s=!1),!e)return null;var o=new n(e,t,i);return o.unregisterOnNextCall=s,r?this._observers.unshift(o):this._observers.push(o),this._onObserverAdded&&this._onObserverAdded(o),o},e.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},e.prototype.remove=function(e){return!!e&&-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0)},e.prototype.removeCallback=function(e,t){for(var r=0;r<this._observers.length;r++){var i=this._observers[r];if(!(i._willBeUnregistered||i.callback!==e||t&&t!==i.scope))return this._deferUnregister(i),!0}return!1},e.prototype._deferUnregister=function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout((function(){t._remove(e)}),0)},e.prototype._remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)},e.prototype.makeObserverTopPriority=function(e){this._remove(e),this._observers.unshift(e)},e.prototype.makeObserverBottomPriority=function(e){this._remove(e),this._observers.push(e)},e.prototype.notifyObservers=function(e,t,r,i,n){if(void 0===t&&(t=-1),!this._observers.length)return!0;var s=this._eventState;s.mask=t,s.target=r,s.currentTarget=i,s.skipNextObservers=!1,s.lastReturnValue=e,s.userInfo=n;for(var o=0,a=this._observers;o<a.length;o++){var u=a[o];if(!u._willBeUnregistered&&(u.mask&t&&(u.scope?s.lastReturnValue=u.callback.apply(u.scope,[e,s]):s.lastReturnValue=u.callback(e,s),u.unregisterOnNextCall&&this._deferUnregister(u)),s.skipNextObservers))return!1}return!0},e.prototype.notifyObserversWithPromise=function(e,t,r,i,n){var s=this;void 0===t&&(t=-1);var o=Promise.resolve(e);if(!this._observers.length)return o;var a=this._eventState;return a.mask=t,a.target=r,a.currentTarget=i,a.skipNextObservers=!1,a.userInfo=n,this._observers.forEach((function(r){a.skipNextObservers||r._willBeUnregistered||r.mask&t&&(o=r.scope?o.then((function(t){return a.lastReturnValue=t,r.callback.apply(r.scope,[e,a])})):o.then((function(t){return a.lastReturnValue=t,r.callback(e,a)})),r.unregisterOnNextCall&&s._deferUnregister(r))})),o.then((function(){return e}))},e.prototype.notifyObserver=function(e,t,r){if(void 0===r&&(r=-1),!e._willBeUnregistered){var i=this._eventState;i.mask=r,i.skipNextObservers=!1,e.callback(t,i),e.unregisterOnNextCall&&this._deferUnregister(e)}},e.prototype.hasObservers=function(){return this._observers.length>0},e.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},e.prototype.clone=function(){var t=new e;return t._observers=this._observers.slice(0),t},e.prototype.hasSpecificMask=function(e){void 0===e&&(e=-1);for(var t=0,r=this._observers;t<r.length;t++){var i=r[t];if(i.mask&e||i.mask===e)return!0}return!1},e}())},3221:(e,t,r)=>{"use strict";r.d(t,{z:()=>n});var i=r(9903),n=function(){function e(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._average},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!1,configurable:!0}),e.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},e.prototype.addCount=function(t,r){e.Enabled&&(this._current+=t,r&&this._fetchResult())},e.prototype.beginMonitoring=function(){e.Enabled&&(this._startMonitoringTime=i.F.Now)},e.prototype.endMonitoring=function(t){if(void 0===t&&(t=!0),e.Enabled){t&&this.fetchNewFrame();var r=i.F.Now;this._current=r-this._startMonitoringTime,t&&this._fetchResult()}},e.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=i.F.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)},e.Enabled=!0,e}()},8134:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var i=r(9903),n=function(){function e(e){void 0===e&&(e=30),this._enabled=!0,this._rollingFrameTime=new s(e)}return e.prototype.sampleFrame=function(e){if(void 0===e&&(e=i.F.Now),this._enabled){if(null!=this._lastFrameTimeMs){var t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}},Object.defineProperty(e.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"instantaneousFPS",{get:function(){var e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!1,configurable:!0}),e.prototype.enable=function(){this._enabled=!0},e.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},e}(),s=function(){function e(e){this._samples=new Array(e),this.reset()}return e.prototype.add=function(e){var t;if(this.isSaturated()){var r=this._samples[this._pos];t=r-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(r-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length},e.prototype.history=function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]},e.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},e.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},e.prototype._wrapPosition=function(e){var t=this._samples.length;return(e%t+t)%t},e}()},9903:(e,t,r)=>{"use strict";r.d(t,{F:()=>n});var i=r(5511),n=function(){function e(){}return Object.defineProperty(e,"Now",{get:function(){return i.M.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!1,configurable:!0}),e}()},2179:(e,t,r)=>{"use strict";var i;r.d(t,{l:()=>o}),function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(i||(i={}));var n=function(){this.count=0,this.target=0,this.results=[]},s=function(){function e(e){var t=this;if(this._state=i.Pending,this._children=new Array,this._rejectWasConsumed=!1,e)try{e((function(e){t._resolve(e)}),(function(e){t._reject(e)}))}catch(e){this._reject(e)}}return Object.defineProperty(e.prototype,"_result",{get:function(){return this._resultValue},set:function(e){this._resultValue=e,this._parent&&void 0===this._parent._result&&(this._parent._result=e)},enumerable:!1,configurable:!0}),e.prototype.catch=function(e){return this.then(void 0,e)},e.prototype.then=function(t,r){var n=this,s=new e;return s._onFulfilled=t,s._onRejected=r,this._children.push(s),s._parent=this,this._state!==i.Pending&&setTimeout((function(){n._state===i.Fulfilled||n._rejectWasConsumed?s._resolve(n._result):s._reject(n._reason)})),s},e.prototype._moveChildren=function(e){var t,r=this;if((t=this._children).push.apply(t,e.splice(0,e.length)),this._children.forEach((function(e){e._parent=r})),this._state===i.Fulfilled)for(var n=0,s=this._children;n<s.length;n++)s[n]._resolve(this._result);else if(this._state===i.Rejected)for(var o=0,a=this._children;o<a.length;o++)a[o]._reject(this._reason)},e.prototype._resolve=function(e){try{this._state=i.Fulfilled;var t=null;if(this._onFulfilled&&(t=this._onFulfilled(e)),null!=t)if(void 0!==t._state){var r=t;r._parent=this,r._moveChildren(this._children),e=r._result}else e=t;this._result=e;for(var n=0,s=this._children;n<s.length;n++)s[n]._resolve(e);this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(e){this._reject(e,!0)}},e.prototype._reject=function(e,t){if(void 0===t&&(t=!1),this._state=i.Rejected,this._reason=e,this._onRejected&&!t)try{this._onRejected(e),this._rejectWasConsumed=!0}catch(t){e=t}for(var r=0,n=this._children;r<n.length;r++){var s=n[r];this._rejectWasConsumed?s._resolve(null):s._reject(e)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},e.resolve=function(t){var r=new e;return r._resolve(t),r},e._RegisterForFulfillment=function(e,t,r){e.then((function(e){return t.results[r]=e,t.count++,t.count===t.target&&t.rootPromise._resolve(t.results),null}),(function(e){t.rootPromise._state!==i.Rejected&&t.rootPromise._reject(e)}))},e.all=function(t){var r=new e,i=new n;if(i.target=t.length,i.rootPromise=r,t.length)for(var s=0;s<t.length;s++)e._RegisterForFulfillment(t[s],i,s);else r._resolve([]);return r},e.race=function(t){var r=new e;if(t.length)for(var i=0,n=t;i<n.length;i++)n[i].then((function(e){return r&&(r._resolve(e),r=null),null}),(function(e){r&&(r._reject(e),r=null)}));return r},e}(),o=function(){function e(){}return e.Apply=function(e){void 0===e&&(e=!1),(e||"undefined"==typeof Promise)&&(window.Promise=s)},e}()},6173:(e,t,r)=>{"use strict";r.d(t,{b:()=>i});var i=function(){function e(){}return e.ExponentialBackoff=function(e,t){return void 0===e&&(e=3),void 0===t&&(t=500),function(r,i,n){return 0!==i.status||n>=e||-1!==r.indexOf("file:")?-1:Math.pow(2,n)*t}},e}()},9510:(e,t,r)=>{"use strict";r.d(t,{u:()=>i});var i=function(){function e(){}return e.Slice=function(e,t,r){return e.slice?e.slice(t,r):Array.prototype.slice.call(e,t,r)},e.SliceToArray=function(e,t,r){return Array.isArray(e)?e.slice(t,r):Array.prototype.slice.call(e,t,r)},e}()},8169:(e,t,r)=>{"use strict";r.d(t,{t:()=>n,f:()=>s});var i=r(3940),n=function(){function e(t){this.length=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)},e.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this.data[t])},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0},e.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},e.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},e.prototype.contains=function(e){return-1!==this.indexOf(e)},e._GlobalId=0,e}(),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._duplicateId=0,t}return(0,i.ZT)(t,e),t.prototype.push=function(t){e.prototype.push.call(this,t),t.__smartArrayFlags||(t.__smartArrayFlags={}),t.__smartArrayFlags[this._id]=this._duplicateId},t.prototype.pushNoDuplicate=function(e){return!(e.__smartArrayFlags&&e.__smartArrayFlags[this._id]===this._duplicateId||(this.push(e),0))},t.prototype.reset=function(){e.prototype.reset.call(this),this._duplicateId++},t.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var r=(e.data||e)[t];this.pushNoDuplicate(r)}}},t}(n)},2519:(e,t,r)=>{"use strict";r.d(t,{M:()=>i});var i=function(){function e(){}return e.EndsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},e.StartsWith=function(e,t){return!!e&&0===e.indexOf(t)},e.Decode=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return t},e.EncodeArrayBufferToBase64=function(e){for(var t,r,i,n,s,o,a,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h="",c=0,l=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);c<l.length;)n=(t=l[c++])>>2,s=(3&t)<<4|(r=c<l.length?l[c++]:Number.NaN)>>4,o=(15&r)<<2|(i=c<l.length?l[c++]:Number.NaN)>>6,a=63&i,isNaN(r)?o=a=64:isNaN(i)&&(a=64),h+=u.charAt(n)+u.charAt(s)+u.charAt(o)+u.charAt(a);return h},e.DecodeBase64ToString=function(e){return atob(e)},e.DecodeBase64ToBinary=function(t){for(var r=e.DecodeBase64ToString(t),i=r.length,n=new Uint8Array(new ArrayBuffer(i)),s=0;s<i;s++)n[s]=r.charCodeAt(s);return n.buffer},e.PadNumber=function(e,t){for(var r=String(e);r.length<t;)r="0"+r;return r},e}()},5356:(e,t,r)=>{"use strict";r.d(t,{$:()=>n});var i=r(7121),n=function(){function e(){}return e.EnableFor=function(t){t._tags=t._tags||{},t.hasTags=function(){return e.HasTags(t)},t.addTags=function(r){return e.AddTagsTo(t,r)},t.removeTags=function(r){return e.RemoveTagsFrom(t,r)},t.matchesTagsQuery=function(r){return e.MatchesQuery(t,r)}},e.DisableFor=function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery},e.HasTags=function(e){if(!e._tags)return!1;var t=e._tags;for(var r in t)if(t.hasOwnProperty(r))return!0;return!1},e.GetTags=function(e,t){if(void 0===t&&(t=!0),!e._tags)return null;if(t){var r=[];for(var i in e._tags)e._tags.hasOwnProperty(i)&&!0===e._tags[i]&&r.push(i);return r.join(" ")}return e._tags},e.AddTagsTo=function(t,r){r&&"string"==typeof r&&r.split(" ").forEach((function(r,i,n){e._AddTagTo(t,r)}))},e._AddTagTo=function(t,r){""!==(r=r.trim())&&"true"!==r&&"false"!==r&&(r.match(/[\s]/)||r.match(/^([!]|([|]|[&]){2})/)||(e.EnableFor(t),t._tags[r]=!0))},e.RemoveTagsFrom=function(t,r){if(e.HasTags(t)){var i=r.split(" ");for(var n in i)e._RemoveTagFrom(t,i[n])}},e._RemoveTagFrom=function(e,t){delete e._tags[t]},e.MatchesQuery=function(t,r){return void 0===r||(""===r?e.HasTags(t):i.q.Eval(r,(function(r){return e.HasTags(t)&&t._tags[r]})))},e}()},714:(e,t,r)=>{"use strict";r.d(t,{O:()=>a});var i=r(1263),n=r(5808),s=r(540),o=r(1039),a=function(){function e(){}return e.CreateResizedCopy=function(e,t,r,o){void 0===o&&(o=!0);var a=e.getScene(),u=a.getEngine(),h=new n._("resized"+e.name,{width:t,height:r},a,!e.noMipmap,!0,e._texture.type,!1,e.samplingMode,!1);h.wrapU=e.wrapU,h.wrapV=e.wrapV,h.uOffset=e.uOffset,h.vOffset=e.vOffset,h.uScale=e.uScale,h.vScale=e.vScale,h.uAng=e.uAng,h.vAng=e.vAng,h.wAng=e.wAng,h.coordinatesIndex=e.coordinatesIndex,h.level=e.level,h.anisotropicFilteringLevel=e.anisotropicFilteringLevel,h._texture.isReady=!1,e.wrapU=i.x.CLAMP_ADDRESSMODE,e.wrapV=i.x.CLAMP_ADDRESSMODE;var c=new s.Q("pass",1,null,o?i.x.BILINEAR_SAMPLINGMODE:i.x.NEAREST_SAMPLINGMODE,u,!1,0);return c.getEffect().executeWhenCompiled((function(){c.onApply=function(t){t.setTexture("textureSampler",e)};var t=h.getInternalTexture();t&&(a.postProcessManager.directRender([c],t),u.unBindFramebuffer(t),h.disposeFramebufferObjects(),c.dispose(),t.isReady=!0)})),h},e.ApplyPostProcess=function(e,t,r,i,n,s){var a=t.getEngine();return t.isReady=!1,n=null!=n?n:t.samplingMode,i=null!=i?i:t.type,s=null!=s?s:t.format,-1===i&&(i=0),new Promise((function(u){var h=new o.D("postprocess",e,null,null,1,null,n,a,!1,void 0,i,void 0,null,!1,s),c=a.createRenderTargetTexture({width:t.width,height:t.height},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:n,type:i,format:s});h.getEffect().executeWhenCompiled((function(){h.onApply=function(e){e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},r.postProcessManager.directRender([h],c,!0),a.restoreDefaultFramebuffer(),a._releaseTexture(t),a._releaseFramebufferObjects(c),h&&h.dispose(),c._swapAndDie(t),t.type=i,t.format=5,t.isReady=!0,u(t)}))}))},e.ToHalfFloat=function(t){e._FloatView||(e._FloatView=new Float32Array(1),e._Int32View=new Int32Array(e._FloatView.buffer)),e._FloatView[0]=t;var r=e._Int32View[0],i=r>>16&32768,n=r>>12&2047,s=r>>23&255;return s<103?i:s>142?(i|=31744,i|=(255==s?0:1)&&8388607&r):s<113?i|=((n|=2048)>>114-s)+(n>>113-s&1):(i|=s-112<<10|n>>1,i+=1&n)},e.FromHalfFloat=function(e){var t=(32768&e)>>15,r=(31744&e)>>10,i=1023&e;return 0===r?(t?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):31==r?i?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,r-15)*(1+i/Math.pow(2,10))},e}()},6684:(e,t,r)=>{"use strict";r.d(t,{Q:()=>n});var i=r(5511),n=function(){function e(){}return e.SetImmediate=function(e){i.M.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)},e}()},2281:(e,t,r)=>{"use strict";r.d(t,{w1:()=>y,$g:()=>v});var i=r(3940),n=r(8131),s=r(5511),o=r(4462),a=r(2471),u=r(9903),h=r(7936),c=r(6471),l=r(3852),p=r(5873),f=r(2179),d=r(6684),_=r(5472),g=r(1018),m=r(9510),y=function(){function e(){}return Object.defineProperty(e,"BaseUrl",{get:function(){return p.e0.BaseUrl},set:function(e){p.e0.BaseUrl=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DefaultRetryStrategy",{get:function(){return p.e0.DefaultRetryStrategy},set:function(e){p.e0.DefaultRetryStrategy=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"CorsBehavior",{get:function(){return p.e0.CorsBehavior},set:function(e){p.e0.CorsBehavior=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"UseFallbackTexture",{get:function(){return l.l.UseFallbackTexture},set:function(e){l.l.UseFallbackTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"RegisteredExternalClasses",{get:function(){return _.K.RegisteredExternalClasses},set:function(e){_.K.RegisteredExternalClasses=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"fallbackTexture",{get:function(){return l.l.FallbackTexture},set:function(e){l.l.FallbackTexture=e},enumerable:!1,configurable:!0}),e.FetchToRef=function(e,t,r,i,n,s){var o=4*((Math.abs(e)*r%r|0)+(Math.abs(t)*i%i|0)*r);s.r=n[o]/255,s.g=n[o+1]/255,s.b=n[o+2]/255,s.a=n[o+3]/255},e.Mix=function(e,t,r){return e*(1-r)+t*r},e.Instantiate=function(e){return _.K.Instantiate(e)},e.Slice=function(e,t,r){return m.u.Slice(e,t,r)},e.SliceToArray=function(e,t,r){return m.u.SliceToArray(e,t,r)},e.SetImmediate=function(e){d.Q.SetImmediate(e)},e.IsExponentOfTwo=function(e){var t=1;do{t*=2}while(t<e);return t===e},e.FloatRound=function(t){return Math.fround?Math.fround(t):(e._tmpFloatArray[0]=t,e._tmpFloatArray[0])},e.GetFilename=function(e){var t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)},e.GetFolderPath=function(e,t){void 0===t&&(t=!1);var r=e.lastIndexOf("/");return r<0?t?e:"":e.substring(0,r+1)},e.ToDegrees=function(e){return 180*e/Math.PI},e.ToRadians=function(e){return e*Math.PI/180},e.MakeArray=function(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null},e.GetPointerPrefix=function(e){var t="pointer";return s.M.IsWindowObjectExist()&&!window.PointerEvent&&s.M.IsNavigatorAvailable()&&!navigator.pointerEnabled&&(t="mouse"),!e._badDesktopOS||e._badOS||document&&"ontouchend"in document||(t="mouse"),t},e.SetCorsBehavior=function(e,t){p.e0.SetCorsBehavior(e,t)},e.CleanUrl=function(e){return e.replace(/#/gm,"%23")},Object.defineProperty(e,"PreprocessUrl",{get:function(){return p.e0.PreprocessUrl},set:function(e){p.e0.PreprocessUrl=e},enumerable:!1,configurable:!0}),e.LoadImage=function(e,t,r,i,n){return p.e0.LoadImage(e,t,r,i,n)},e.LoadFile=function(e,t,r,i,n,s){return p.e0.LoadFile(e,t,r,i,n,s)},e.LoadFileAsync=function(e,t){return void 0===t&&(t=!0),new Promise((function(r,i){p.e0.LoadFile(e,(function(e){r(e)}),void 0,void 0,t,(function(e,t){i(t)}))}))},e.LoadScript=function(e,t,r,i){if(s.M.IsWindowObjectExist()){var n=document.getElementsByTagName("head")[0],o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("src",e),i&&(o.id=i),o.onload=function(){t&&t()},o.onerror=function(t){r&&r("Unable to load script '"+e+"'",t)},n.appendChild(o)}},e.LoadScriptAsync=function(e,t){var r=this;return new Promise((function(t,i){r.LoadScript(e,(function(){t()}),(function(e,t){i(t)}))}))},e.ReadFileAsDataURL=function(e,t,r){var i=new FileReader,s={onCompleteObservable:new n.y$,abort:function(){return i.abort()}};return i.onloadend=function(e){s.onCompleteObservable.notifyObservers(s)},i.onload=function(e){t(e.target.result)},i.onprogress=r,i.readAsDataURL(e),s},e.ReadFile=function(e,t,r,i,n){return p.e0.ReadFile(e,t,r,i,n)},e.FileAsURL=function(e){var t=new Blob([e]);return(window.URL||window.webkitURL).createObjectURL(t)},e.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},e.DeepCopy=function(e,t,r,i){a.j.DeepCopy(e,t,r,i)},e.IsEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},e.RegisterTopRootEvents=function(e,t){for(var r=0;r<t.length;r++){var i=t[r];e.addEventListener(i.name,i.handler,!1);try{window.parent&&window.parent.addEventListener(i.name,i.handler,!1)}catch(e){}}},e.UnregisterTopRootEvents=function(e,t){for(var r=0;r<t.length;r++){var i=t[r];e.removeEventListener(i.name,i.handler);try{e.parent&&e.parent.removeEventListener(i.name,i.handler)}catch(e){}}},e.DumpFramebuffer=function(t,r,n,s,o,a){return void 0===o&&(o="image/png"),(0,i.mG)(this,void 0,void 0,(function(){var u,h;return(0,i.Jh)(this,(function(i){switch(i.label){case 0:return[4,n.readPixels(0,0,t,r)];case 1:return u=i.sent(),h=new Uint8Array(u.buffer),e.DumpData(t,r,h,s,o,a,!0),[2]}}))}))},e.DumpData=function(t,r,i,n,s,o,a,u){void 0===s&&(s="image/png"),void 0===a&&(a=!1),void 0===u&&(u=!1),e._ScreenshotCanvas||(e._ScreenshotCanvas=document.createElement("canvas")),e._ScreenshotCanvas.width=t,e._ScreenshotCanvas.height=r;var h=e._ScreenshotCanvas.getContext("2d");if(h){if(i instanceof Float32Array){for(var c=new Uint8Array(i.length),l=i.length;l--;){var p=i[l];c[l]=p<0?0:p>1?1:Math.round(255*p)}i=c}var f=h.createImageData(t,r);f.data.set(i),h.putImageData(f,0,0);var d=e._ScreenshotCanvas;if(a){var _=document.createElement("canvas");_.width=t,_.height=r;var g=_.getContext("2d");if(!g)return;g.translate(0,r),g.scale(1,-1),g.drawImage(e._ScreenshotCanvas,0,0),d=_}u?e.ToBlob(d,(function(e){var t=new FileReader;t.onload=function(e){var t=e.target.result;n&&n(t)},t.readAsArrayBuffer(e)})):e.EncodeScreenshotCanvasData(n,s,o,d)}},e.DumpDataAsync=function(t,r,i,n,s,o,a){return void 0===n&&(n="image/png"),void 0===o&&(o=!1),void 0===a&&(a=!1),new Promise((function(u){e.DumpData(t,r,i,(function(e){return u(e)}),n,s,o,a)}))},e.ToBlob=function(e,t,r){void 0===r&&(r="image/png"),e.toBlob||(e.toBlob=function(e,t,r){var i=this;setTimeout((function(){for(var n=atob(i.toDataURL(t,r).split(",")[1]),s=n.length,o=new Uint8Array(s),a=0;a<s;a++)o[a]=n.charCodeAt(a);e(new Blob([o]))}))}),e.toBlob((function(e){t(e)}),r)},e.EncodeScreenshotCanvasData=function(t,r,i,n){void 0===r&&(r="image/png"),t?t((null!=n?n:e._ScreenshotCanvas).toDataURL(r)):this.ToBlob(null!=n?n:e._ScreenshotCanvas,(function(t){if("download"in document.createElement("a")){if(!i){var r=new Date,n=(r.getFullYear()+"-"+(r.getMonth()+1)).slice(2)+"-"+r.getDate()+"_"+r.getHours()+"-"+("0"+r.getMinutes()).slice(-2);i="screenshot_"+n+".png"}e.Download(t,i)}else{var s=URL.createObjectURL(t),o=window.open("");if(!o)return;var a=o.document.createElement("img");a.onload=function(){URL.revokeObjectURL(s)},a.src=s,o.document.body.appendChild(a)}}),r)},e.Download=function(e,t){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(e,t);else{var r=window.URL.createObjectURL(e),i=document.createElement("a");document.body.appendChild(i),i.style.display="none",i.href=r,i.download=t,i.addEventListener("click",(function(){i.parentElement&&i.parentElement.removeChild(i)})),i.click(),window.URL.revokeObjectURL(r)}},e.BackCompatCameraNoPreventDefault=function(e){return"boolean"==typeof e[0]?e[0]:"boolean"==typeof e[1]&&e[1]},e.CreateScreenshot=function(e,t,r,i,n){throw void 0===n&&(n="image/png"),h.f.WarnImport("ScreenshotTools")},e.CreateScreenshotAsync=function(e,t,r,i){throw void 0===i&&(i="image/png"),h.f.WarnImport("ScreenshotTools")},e.CreateScreenshotUsingRenderTarget=function(e,t,r,i,n,s,o,a){throw void 0===n&&(n="image/png"),void 0===s&&(s=1),void 0===o&&(o=!1),h.f.WarnImport("ScreenshotTools")},e.CreateScreenshotUsingRenderTargetAsync=function(e,t,r,i,n,s,o){throw void 0===i&&(i="image/png"),void 0===n&&(n=1),void 0===s&&(s=!1),h.f.WarnImport("ScreenshotTools")},e.RandomId=function(){return g.x.RandomId()},e.IsBase64=function(e){return p.e0.IsBase64DataUrl(e)},e.DecodeBase64=function(e){return p.e0.DecodeBase64UrlToBinary(e)},e.GetAbsoluteUrl=function(e){var t=document.createElement("a");return t.href=e,t.href},Object.defineProperty(e,"errorsCount",{get:function(){return o.Y.errorsCount},enumerable:!1,configurable:!0}),e.Log=function(e){o.Y.Log(e)},e.Warn=function(e){o.Y.Warn(e)},e.Error=function(e){o.Y.Error(e)},Object.defineProperty(e,"LogCache",{get:function(){return o.Y.LogCache},enumerable:!1,configurable:!0}),e.ClearLogCache=function(){o.Y.ClearLogCache()},Object.defineProperty(e,"LogLevels",{set:function(e){o.Y.LogLevels=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"PerformanceLogLevel",{set:function(t){return(t&e.PerformanceUserMarkLogLevel)===e.PerformanceUserMarkLogLevel?(e.StartPerformanceCounter=e._StartUserMark,void(e.EndPerformanceCounter=e._EndUserMark)):(t&e.PerformanceConsoleLogLevel)===e.PerformanceConsoleLogLevel?(e.StartPerformanceCounter=e._StartPerformanceConsole,void(e.EndPerformanceCounter=e._EndPerformanceConsole)):(e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,void(e.EndPerformanceCounter=e._EndPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),e._StartPerformanceCounterDisabled=function(e,t){},e._EndPerformanceCounterDisabled=function(e,t){},e._StartUserMark=function(t,r){if(void 0===r&&(r=!0),!e._performance){if(!s.M.IsWindowObjectExist())return;e._performance=window.performance}r&&e._performance.mark&&e._performance.mark(t+"-Begin")},e._EndUserMark=function(t,r){void 0===r&&(r=!0),r&&e._performance.mark&&(e._performance.mark(t+"-End"),e._performance.measure(t,t+"-Begin",t+"-End"))},e._StartPerformanceConsole=function(t,r){void 0===r&&(r=!0),r&&(e._StartUserMark(t,r),console.time&&console.time(t))},e._EndPerformanceConsole=function(t,r){void 0===r&&(r=!0),r&&(e._EndUserMark(t,r),console.timeEnd(t))},Object.defineProperty(e,"Now",{get:function(){return u.F.Now},enumerable:!1,configurable:!0}),e.GetClassName=function(e,t){void 0===t&&(t=!1);var r=null;return!t&&e.getClassName?r=e.getClassName():(e instanceof Object&&(r=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__),r||(r=typeof e)),r},e.First=function(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(t(n))return n}return null},e.getFullClassName=function(e,t){void 0===t&&(t=!1);var r=null,i=null;if(!t&&e.getClassName)r=e.getClassName();else{if(e instanceof Object){var n=t?e:Object.getPrototypeOf(e);r=n.constructor.__bjsclassName__,i=n.constructor.__bjsmoduleName__}r||(r=typeof e)}return r?(null!=i?i+".":"")+r:null},e.DelayAsync=function(e){return new Promise((function(t){setTimeout((function(){t()}),e)}))},e.IsSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},e.UseCustomRequestHeaders=!1,e.CustomRequestHeaders=c.g.CustomRequestHeaders,e._tmpFloatArray=new Float32Array(1),e.GetDOMTextContent=s.M.GetDOMTextContent,e.NoneLogLevel=o.Y.NoneLogLevel,e.MessageLogLevel=o.Y.MessageLogLevel,e.WarningLogLevel=o.Y.WarningLogLevel,e.ErrorLogLevel=o.Y.ErrorLogLevel,e.AllLogLevel=o.Y.AllLogLevel,e.IsWindowObjectExist=s.M.IsWindowObjectExist,e.PerformanceNoneLogLevel=0,e.PerformanceUserMarkLogLevel=1,e.PerformanceConsoleLogLevel=2,e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,e.EndPerformanceCounter=e._EndPerformanceCounterDisabled,e}(),v=function(){function e(e,t,r,i){void 0===i&&(i=0),this.iterations=e,this.index=i-1,this._done=!1,this._fn=t,this._successCallback=r}return e.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},e.prototype.breakLoop=function(){this._done=!0,this._successCallback()},e.Run=function(t,r,i,n){void 0===n&&(n=0);var s=new e(t,r,i,n);return s.executeNext(),s},e.SyncAsyncForLoop=function(t,r,i,n,s,o){return void 0===o&&(o=0),e.Run(Math.ceil(t/r),(function(e){s&&s()?e.breakLoop():setTimeout((function(){for(var n=0;n<r;++n){var o=e.index*r+n;if(o>=t)break;if(i(o),s&&s()){e.breakLoop();break}}e.executeNext()}),o)}),n)},e}();l.l.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",f.l.Apply()},2997:(e,t,r)=>{"use strict";r.d(t,{Q:()=>i});var i=function(){function e(){}return e.GetClass=function(e){return this.RegisteredTypes&&this.RegisteredTypes[e]?this.RegisteredTypes[e]:null},e.RegisteredTypes={},e}()},6471:(e,t,r)=>{"use strict";r.d(t,{g:()=>i});var i=function(){function e(){this._xhr="undefined"!=typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest}return e.prototype._injectCustomRequestHeaders=function(){for(var t in e.CustomRequestHeaders){var r=e.CustomRequestHeaders[t];r&&this._xhr.setRequestHeader(t,r)}},Object.defineProperty(e.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(e){this._xhr.onprogress=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._xhr.status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"response",{get:function(){return this._xhr.response},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(e){this._xhr.responseType=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timeout",{get:function(){return this._xhr.timeout},set:function(e){this._xhr.timeout=e},enumerable:!1,configurable:!0}),e.prototype.addEventListener=function(e,t,r){this._xhr.addEventListener(e,t,r)},e.prototype.removeEventListener=function(e,t,r){this._xhr.removeEventListener(e,t,r)},e.prototype.abort=function(){this._xhr.abort()},e.prototype.send=function(t){e.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(t)},e.prototype.open=function(t,r){for(var i=0,n=e.CustomRequestModifiers;i<n.length;i++)(0,n[i])(this._xhr,r);return r=(r=r.replace("file:http:","http:")).replace("file:https:","https:"),this._xhr.open(t,r,!0)},e.prototype.setRequestHeader=function(e,t){this._xhr.setRequestHeader(e,t)},e.prototype.getResponseHeader=function(e){return this._xhr.getResponseHeader(e)},e.CustomRequestHeaders={},e.CustomRequestModifiers=new Array,e}()},540:(e,t,r)=>{"use strict";r.d(t,{Q:()=>h});var i=r(3940),n=r(1039),s=r(6940),o=r(5589);o.Q.ShadersStore.passPixelShader="\nvarying vec2 vUV;\nuniform sampler2D textureSampler;\nvoid main(void)\n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}";o.Q.ShadersStore.passCubePixelShader="\nvarying vec2 vUV;\nuniform samplerCube textureSampler;\nvoid main(void)\n{\nvec2 uv=vUV*2.0-1.0;\n#ifdef POSITIVEX\ngl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x));\n#endif\n#ifdef NEGATIVEX\ngl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x));\n#endif\n#ifdef POSITIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x));\n#endif\n#ifdef NEGATIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x));\n#endif\n#ifdef POSITIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,1.001));\n#endif\n#ifdef NEGATIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,-1.001));\n#endif\n}";var a=r(2997),u=r(3536),h=function(e){function t(t,r,i,n,s,o,a,u){return void 0===i&&(i=null),void 0===a&&(a=0),void 0===u&&(u=!1),e.call(this,t,"pass",null,null,r,i,n,s,o,void 0,a,void 0,null,u)||this}return(0,i.ZT)(t,e),t.prototype.getClassName=function(){return"PassPostProcess"},t._Parse=function(e,r,i,n){return u.p4.Parse((function(){return new t(e.name,e.options,r,e.renderTargetSamplingMode,e._engine,e.reusable)}),e,i,n)},t}(n.D);a.Q.RegisteredTypes["BABYLON.PassPostProcess"]=h,function(e){function t(t,r,i,n,s,o,a,u){void 0===i&&(i=null),void 0===a&&(a=0),void 0===u&&(u=!1);var h=e.call(this,t,"passCube",null,null,r,i,n,s,o,"#define POSITIVEX",a,void 0,null,u)||this;return h._face=0,h}(0,i.ZT)(t,e),Object.defineProperty(t.prototype,"face",{get:function(){return this._face},set:function(e){if(!(e<0||e>5))switch(this._face=e,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"PassCubePostProcess"},t._Parse=function(e,r,i,n){return u.p4.Parse((function(){return new t(e.name,e.options,r,e.renderTargetSamplingMode,e._engine,e.reusable)}),e,i,n)}}(n.D),s.D._RescalePostProcessFactory=function(e){return new h("rescale",1,null,2,e,!1,0)}},1039:(e,t,r)=>{"use strict";r.d(t,{D:()=>l});var i=r(3940),n=r(8169),s=r(8131),o=r(4471),a=(r(8969),r(6940)),u=(r(346),r(3536)),h=r(2997),c=r(9666),l=function(){function e(e,t,r,i,a,u,h,l,p,f,d,_,g,m,y){void 0===h&&(h=1),void 0===f&&(f=null),void 0===d&&(d=0),void 0===_&&(_="postprocess"),void 0===m&&(m=!1),void 0===y&&(y=5),this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.alphaMode=0,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._renderId=0,this._textures=new n.t(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new o.FM(1,1),this._texelSize=o.FM.Zero(),this.onActivateObservable=new s.y$,this.onSizeChangedObservable=new s.y$,this.onApplyObservable=new s.y$,this.onBeforeRenderObservable=new s.y$,this.onAfterRenderObservable=new s.y$,this.name=e,null!=u?(this._camera=u,this._scene=u.getScene(),u.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):l&&(this._engine=l,this._engine.postProcesses.push(this)),this._options=a,this.renderTargetSamplingMode=h||1,this._reusable=p||!1,this._textureType=d,this._textureFormat=y,this._samplers=i||[],this._samplers.push("textureSampler"),this._fragmentUrl=t,this._vertexUrl=_,this._parameters=r||[],this._parameters.push("scale"),this._indexParameters=g,this._drawWrapper=new c.q(this._engine),m||this.updateEffect(f)}return Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},set:function(e){var t=this;this._samples=Math.min(e,this._engine.getCaps().maxMSAASamples),this._textures.forEach((function(e){e.samples!==t._samples&&t._engine.updateRenderTargetTextureSampleCount(e,t._samples)}))},enumerable:!1,configurable:!0}),e.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(e.prototype,"onActivate",{set:function(e){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),e&&(this._onActivateObserver=this.onActivateObservable.add(e))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSizeChanged",{set:function(e){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onApply",{set:function(e){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBeforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onAfterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(e){this._forcedOutputTexture=e},enumerable:!1,configurable:!0}),e.prototype.restoreDefaultInputTexture=function(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())},e.prototype.getCamera=function(){return this._camera},Object.defineProperty(e.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"PostProcess"},e.prototype.getEngine=function(){return this._engine},e.prototype.getEffect=function(){return this._drawWrapper.effect},e.prototype.shareOutputWith=function(e){return this._disposeTextures(),this._shareOutputWithPostProcess=e,this},e.prototype.useOwnOutput=function(){0==this._textures.length&&(this._textures=new n.t(2)),this._shareOutputWithPostProcess=null},e.prototype.updateEffect=function(e,t,r,i,n,s,o,a){void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=null),this._postProcessDefines=e,this._drawWrapper.effect=this._engine.createEffect({vertex:null!=o?o:this._vertexUrl,fragment:null!=a?a:this._fragmentUrl},["position"],t||this._parameters,r||this._samplers,null!==e?e:"",void 0,n,s,i||this._indexParameters)},e.prototype.isReusable=function(){return this._reusable},e.prototype.markTextureDirty=function(){this.width=-1},e.prototype._createRenderTargetTexture=function(e,t,r){void 0===r&&(r=0);for(var i=0;i<this._textureCache.length;i++)if(this._textureCache[i].texture.width===e.width&&this._textureCache[i].texture.height===e.height&&this._textureCache[i].postProcessChannel===r)return this._textureCache[i].texture;var n=this._engine.createRenderTargetTexture(e,t);return this._textureCache.push({texture:n,postProcessChannel:r,lastUsedRenderId:-1}),n},e.prototype._flushTextureCache=function(){for(var e=this._renderId,t=this._textureCache.length-1;t>=0;t--)if(e-this._textureCache[t].lastUsedRenderId>100){for(var r=!1,i=0;i<this._textures.length;i++)if(this._textures.data[i]===this._textureCache[t].texture){r=!0;break}r||(this._engine._releaseTexture(this._textureCache[t].texture),this._textureCache.splice(t,1))}},e.prototype._resize=function(e,t,r,i,n){this._textures.length>0&&this._textures.reset(),this.width=e,this.height=t;var s={width:this.width,height:this.height},o={generateMipMaps:i,generateDepthBuffer:n||0===r._postProcesses.indexOf(this),generateStencilBuffer:(n||0===r._postProcesses.indexOf(this))&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat};this._textures.push(this._createRenderTargetTexture(s,o,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(s,o,1)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)},e.prototype.activate=function(e,t,r){var i,n,s=this;void 0===t&&(t=null);var o=(e=e||this._camera).getScene(),u=o.getEngine(),h=u.getCaps().maxTextureSize,c=(t?t.width:this._engine.getRenderWidth(!0))*this._options|0,l=(t?t.height:this._engine.getRenderHeight(!0))*this._options|0,p=e.parent;!p||p.leftCamera!=e&&p.rightCamera!=e||(c/=2);var f,d=this._options.width||c,_=this._options.height||l,g=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var m=u.currentViewport;m&&(d*=m.width,_*=m.height)}(g||this.alwaysForcePOT)&&(this._options.width||(d=u.needPOTTextures?a.D.GetExponentOfTwo(d,h,this.scaleMode):d),this._options.height||(_=u.needPOTTextures?a.D.GetExponentOfTwo(_,h,this.scaleMode):_)),this.width===d&&this.height===_||this._resize(d,_,e,g,r),this._textures.forEach((function(e){e.samples!==s.samples&&s._engine.updateRenderTargetTextureSampleCount(e,s.samples)})),this._flushTextureCache(),this._renderId++}if(this._shareOutputWithPostProcess)f=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)f=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{f=this.inputTexture;for(var y=void 0,v=0;v<this._textureCache.length;v++)if(this._textureCache[v].texture===f){y=this._textureCache[v];break}y&&(y.lastUsedRenderId=this._renderId)}return this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(c/d,l/_),this._engine.bindFramebuffer(f,0,c,l,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(f,0,void 0,void 0,this.forceFullscreenViewport)),null===(n=(i=this._engine)._debugInsertMarker)||void 0===n||n.call(i,"post process "+this.name+" input"),this.onActivateObservable.notifyObservers(e),this.autoClear&&0===this.alphaMode&&this._engine.clear(this.clearColor?this.clearColor:o.clearColor,o._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),f},Object.defineProperty(e.prototype,"isSupported",{get:function(){return this._drawWrapper.effect.isSupported},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!1,configurable:!0}),e.prototype.isReady=function(){var e,t;return null!==(t=null===(e=this._drawWrapper.effect)||void 0===e?void 0:e.isReady())&&void 0!==t&&t},e.prototype.apply=function(){var e,t;return(null===(e=this._drawWrapper.effect)||void 0===e?void 0:e.isReady())?(this._engine.enableEffect(this._drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),t=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this._drawWrapper.effect._bindTexture("textureSampler",t),this._drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._drawWrapper.effect),this._drawWrapper.effect):null},e.prototype._disposeTextures=function(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())},e.prototype._disposeTextureCache=function(){for(var e=this._textureCache.length-1;e>=0;e--)this._engine._releaseTexture(this._textureCache[e].texture);this._textureCache.length=0},e.prototype.setPrePassRenderer=function(e){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=e.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)},e.prototype.dispose=function(e){var t;if(e=e||this._camera,this._disposeTextures(),this._scene&&-1!==(t=this._scene.postProcesses.indexOf(this))&&this._scene.postProcesses.splice(t,1),this._parentContainer){var r=this._parentContainer.postProcesses.indexOf(this);r>-1&&this._parentContainer.postProcesses.splice(r,1),this._parentContainer=null}if(-1!==(t=this._engine.postProcesses.indexOf(this))&&this._engine.postProcesses.splice(t,1),e){if(e.detachPostProcess(this),0===(t=e._postProcesses.indexOf(this))&&e._postProcesses.length>0){var i=this._camera._getFirstPostProcess();i&&i.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},e.prototype.serialize=function(){var e=u.p4.Serialize(this),t=this.getCamera()||this._scene&&this._scene.activeCamera;return e.customType="BABYLON."+this.getClassName(),e.cameraId=t?t.id:null,e.reusable=this._reusable,e.textureType=this._textureType,e.fragmentUrl=this._fragmentUrl,e.parameters=this._parameters,e.samplers=this._samplers,e.options=this._options,e.defines=this._postProcessDefines,e.textureFormat=this._textureFormat,e.vertexUrl=this._vertexUrl,e.indexParameters=this._indexParameters,e},e.prototype.clone=function(){var t=this.serialize();t._engine=this._engine,t.cameraId=null;var r=e.Parse(t,this._scene,"");return r?(r.onActivateObservable=this.onActivateObservable.clone(),r.onSizeChangedObservable=this.onSizeChangedObservable.clone(),r.onApplyObservable=this.onApplyObservable.clone(),r.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),r.onAfterRenderObservable=this.onAfterRenderObservable.clone(),r._prePassEffectConfiguration=this._prePassEffectConfiguration,r):null},e.Parse=function(e,t,r){var i=h.Q.GetClass(e.customType);if(!i||!i._Parse)return null;var n=t?t.getCameraById(e.cameraId):null;return i._Parse(e,n,t,r)},e._Parse=function(t,r,i,n){return u.p4.Parse((function(){return new e(t.name,t.fragmentUrl,t.parameters,t.samplers,t.options,r,t.renderTargetSamplingMode,t._engine,t.reusable,t.defines,t.textureType,t.vertexUrl,t.indexParameters,!1,t.textureFormat)}),t,i,n)},(0,i.gn)([(0,u.qC)()],e.prototype,"uniqueId",void 0),(0,i.gn)([(0,u.qC)()],e.prototype,"name",void 0),(0,i.gn)([(0,u.qC)()],e.prototype,"width",void 0),(0,i.gn)([(0,u.qC)()],e.prototype,"height",void 0),(0,i.gn)([(0,u.qC)()],e.prototype,"renderTargetSamplingMode",void 0),(0,i.gn)([(0,u.XX)()],e.prototype,"clearColor",void 0),(0,i.gn)([(0,u.qC)()],e.prototype,"autoClear",void 0),(0,i.gn)([(0,u.qC)()],e.prototype,"alphaMode",void 0),(0,i.gn)([(0,u.qC)()],e.prototype,"alphaConstants",void 0),(0,i.gn)([(0,u.qC)()],e.prototype,"enablePixelPerfectMode",void 0),(0,i.gn)([(0,u.qC)()],e.prototype,"forceFullscreenViewport",void 0),(0,i.gn)([(0,u.qC)()],e.prototype,"scaleMode",void 0),(0,i.gn)([(0,u.qC)()],e.prototype,"alwaysForcePOT",void 0),(0,i.gn)([(0,u.qC)("samples")],e.prototype,"_samples",void 0),(0,i.gn)([(0,u.qC)()],e.prototype,"adaptScaleToCurrentViewport",void 0),e}();h.Q.RegisteredTypes["BABYLON.PostProcess"]=l},6758:(e,t,r)=>{"use strict";r.d(t,{O:()=>n});var i=r(798),n=function(){function e(e){this._vertexBuffers={},this._scene=e}return e.prototype._prepareBuffers=function(){if(!this._vertexBuffers[i.o.PositionKind]){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[i.o.PositionKind]=new i.o(this._scene.getEngine(),e,i.o.PositionKind,!1,!1,2),this._buildIndexBuffer()}},e.prototype._buildIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)},e.prototype._rebuild=function(){var e=this._vertexBuffers[i.o.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())},e.prototype._prepareFrame=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var r=this._scene.activeCamera;return!(!r||!(t=t||r._postProcesses.filter((function(e){return null!=e})))||0===t.length||!this._scene.postProcessesEnabled||(t[0].activate(r,e,null!=t),0))},e.prototype.directRender=function(e,t,r,i,n,s){var o;void 0===t&&(t=null),void 0===r&&(r=!1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=!1);for(var a=this._scene.getEngine(),u=0;u<e.length;u++){u<e.length-1?e[u+1].activate(this._scene.activeCamera,t):(t?a.bindFramebuffer(t,i,void 0,void 0,r,n):s||a.restoreDefaultFramebuffer(),null===(o=a._debugInsertMarker)||void 0===o||o.call(a,"post process "+e[u].name+" output"));var h=e[u],c=h.apply();c&&(h.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,c),a.drawElementsType(0,0,6),h.onAfterRenderObservable.notifyObservers(c))}a.setDepthBuffer(!0),a.setDepthWrite(!0)},e.prototype._finalizeFrame=function(e,t,r,i,n){var s;void 0===n&&(n=!1);var o=this._scene.activeCamera;if(o&&0!==(i=i||o._postProcesses.filter((function(e){return null!=e}))).length&&this._scene.postProcessesEnabled){for(var a=this._scene.getEngine(),u=0,h=i.length;u<h;u++){var c=i[u];if(u<h-1?c._outputTexture=i[u+1].activate(o,t):(t?(a.bindFramebuffer(t,r,void 0,void 0,n),c._outputTexture=t):(a.restoreDefaultFramebuffer(),c._outputTexture=null),null===(s=a._debugInsertMarker)||void 0===s||s.call(a,"post process "+i[u].name+" output")),e)break;var l=c.apply();l&&(c.onBeforeRenderObservable.notifyObservers(l),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,l),a.drawElementsType(0,0,6),c.onAfterRenderObservable.notifyObservers(l))}a.setDepthBuffer(!0),a.setDepthWrite(!0),a.setAlphaMode(0)}},e.prototype.dispose=function(){var e=this._vertexBuffers[i.o.PositionKind];e&&(e.dispose(),this._vertexBuffers[i.o.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},e}()},8728:(e,t,r)=>{"use strict";r.d(t,{S:()=>s});var i=r(8169),n=r(4471),s=function(){function e(e,t,r,n,s){void 0===r&&(r=null),void 0===n&&(n=null),void 0===s&&(s=null),this.index=e,this._opaqueSubMeshes=new i.t(256),this._transparentSubMeshes=new i.t(256),this._alphaTestSubMeshes=new i.t(256),this._depthOnlySubMeshes=new i.t(256),this._particleSystems=new i.t(256),this._spriteManagers=new i.t(256),this._edgesRenderers=new i.f(16),this._scene=t,this.opaqueSortCompareFn=r,this.alphaTestSortCompareFn=n,this.transparentSortCompareFn=s}return Object.defineProperty(e.prototype,"opaqueSortCompareFn",{set:function(t){this._opaqueSortCompareFn=t,this._renderOpaque=t?this.renderOpaqueSorted:e.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaTestSortCompareFn",{set:function(t){this._alphaTestSortCompareFn=t,this._renderAlphaTest=t?this.renderAlphaTestSorted:e.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transparentSortCompareFn",{set:function(t){this._transparentSortCompareFn=t||e.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!1,configurable:!0}),e.prototype.render=function(e,t,r,i){if(e)e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var n=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(n.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),n.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var s=n.getStencilBuffer();if(n.setStencilBuffer(!1),t&&this._renderSprites(),r&&this._renderParticles(i),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length&&(n.setStencilBuffer(s),this._renderTransparent(this._transparentSubMeshes),n.setAlphaMode(0)),n.setStencilBuffer(!1),this._edgesRenderers.length){for(var o=0;o<this._edgesRenderers.length;o++)this._edgesRenderers.data[o].render();n.setAlphaMode(0)}n.setStencilBuffer(s)}},e.prototype.renderOpaqueSorted=function(t){return e.renderSorted(t,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},e.prototype.renderAlphaTestSorted=function(t){return e.renderSorted(t,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},e.prototype.renderTransparentSorted=function(t){return e.renderSorted(t,this._transparentSortCompareFn,this._scene.activeCamera,!0)},e.renderSorted=function(t,r,i,s){for(var o,a=0,u=i?i.globalPosition:e._zeroVector;a<t.length;a++)(o=t.data[a])._alphaIndex=o.getMesh().alphaIndex,o._distanceToCamera=n.P.Distance(o.getBoundingInfo().boundingSphere.centerWorld,u);var h=t.data.slice(0,t.length);for(r&&h.sort(r),a=0;a<h.length;a++){if(o=h[a],s){var c=o.getMaterial();if(c&&c.needDepthPrePass){var l=c.getScene().getEngine();l.setColorWrite(!1),l.setAlphaMode(0),o.render(!1),l.setColorWrite(!0)}}o.render(s)}},e.renderUnsorted=function(e){for(var t=0;t<e.length;t++)e.data[t].render(!1)},e.defaultTransparentSortCompare=function(t,r){return t._alphaIndex>r._alphaIndex?1:t._alphaIndex<r._alphaIndex?-1:e.backToFrontSortCompare(t,r)},e.backToFrontSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0},e.frontToBackSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0},e.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},e.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},e.prototype.dispatch=function(e,t,r){void 0===t&&(t=e.getMesh()),void 0===r&&(r=e.getMaterial()),null!=r&&(r.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):r.needAlphaTesting()?(r.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(r.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(t._edgesRenderer))},e.prototype.dispatchSprites=function(e){this._spriteManagers.push(e)},e.prototype.dispatchParticles=function(e){this._particleSystems.push(e)},e.prototype._renderParticles=function(e){if(0!==this._particleSystems.length){var t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var r=0;r<this._particleSystems.length;r++){var i=this._particleSystems.data[r];if(0!==(t&&t.layerMask&i.layerMask)){var n=i.emitter;n.position&&e&&-1===e.indexOf(n)||this._scene._activeParticles.addCount(i.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},e.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var t=0;t<this._spriteManagers.length;t++){var r=this._spriteManagers.data[t];0!==(e&&e.layerMask&r.layerMask)&&r.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},e._zeroVector=n.P.Zero(),e}()},3009:(e,t,r)=>{"use strict";r.d(t,{$:()=>s});var i=r(8728),n=function(){},s=function(){function e(t){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new n,this._scene=t;for(var r=e.MIN_RENDERINGGROUPS;r<e.MAX_RENDERINGGROUPS;r++)this._autoClearDepthStencil[r]={autoClear:!0,depth:!0,stencil:!0}}return e.prototype._clearDepthStencilBuffer=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)},e.prototype.render=function(t,r,i,n){var s=this._renderingGroupInfo;if(s.scene=this._scene,s.camera=this._scene.activeCamera,this._scene.spriteManagers&&n)for(var o=0;o<this._scene.spriteManagers.length;o++){var a=this._scene.spriteManagers[o];this.dispatchSprites(a)}for(o=e.MIN_RENDERINGGROUPS;o<e.MAX_RENDERINGGROUPS;o++){this._depthStencilBufferAlreadyCleaned=o===e.MIN_RENDERINGGROUPS;var u=this._renderingGroups[o];if(u){var h=Math.pow(2,o);if(s.renderingGroupId=o,this._scene.onBeforeRenderingGroupObservable.notifyObservers(s,h),e.AUTOCLEAR){var c=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(o):this._autoClearDepthStencil[o];c&&c.autoClear&&this._clearDepthStencilBuffer(c.depth,c.stencil)}for(var l=0,p=this._scene._beforeRenderingGroupDrawStage;l<p.length;l++)p[l].action(o);u.render(t,n,i,r);for(var f=0,d=this._scene._afterRenderingGroupDrawStage;f<d.length;f++)d[f].action(o);this._scene.onAfterRenderingGroupObservable.notifyObservers(s,h)}}},e.prototype.reset=function(){for(var t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){var r=this._renderingGroups[t];r&&r.prepare()}},e.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},e.prototype.freeRenderingGroups=function(){for(var t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){var r=this._renderingGroups[t];r&&r.dispose()}},e.prototype._prepareRenderingGroup=function(e){void 0===this._renderingGroups[e]&&(this._renderingGroups[e]=new i.S(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))},e.prototype.dispatchSprites=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchSprites(e)},e.prototype.dispatchParticles=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchParticles(e)},e.prototype.dispatch=function(e,t,r){void 0===t&&(t=e.getMesh());var i=t.renderingGroupId||0;this._prepareRenderingGroup(i),this._renderingGroups[i].dispatch(e,t,r)},e.prototype.setRenderingOrder=function(e,t,r,i){if(void 0===t&&(t=null),void 0===r&&(r=null),void 0===i&&(i=null),this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=r,this._customTransparentSortCompareFn[e]=i,this._renderingGroups[e]){var n=this._renderingGroups[e];n.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],n.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],n.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}},e.prototype.setRenderingAutoClearDepthStencil=function(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=!0),this._autoClearDepthStencil[e]={autoClear:t,depth:r,stencil:i}},e.prototype.getAutoClearDepthStencilSetup=function(e){return this._autoClearDepthStencil[e]},e.MAX_RENDERINGGROUPS=4,e.MIN_RENDERINGGROUPS=0,e.AUTOCLEAR=!0,e}()},8969:(e,t,r)=>{"use strict";r(5589).Q.ShadersStore.postprocessVertexShader="\nattribute vec2 position;\nuniform vec2 scale;\n\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\nvoid main(void) {\nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n}"},6522:(e,t,r)=>{"use strict";r.d(t,{Q:()=>i});var i=function(){function e(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.setAlphaBlendConstants=function(e,t,r,i){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===r&&this._blendConstants[3]===i||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=r,this._blendConstants[3]=i,this._isBlendConstantsDirty=!0)},e.prototype.setAlphaBlendFunctionParameters=function(e,t,r,i){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===r&&this._blendFunctionParameters[3]===i||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=r,this._blendFunctionParameters[3]=i,this._isBlendFunctionParametersDirty=!0)},e.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},e}()},2936:(e,t,r)=>{"use strict";r.d(t,{k:()=>i});var i=function(){function e(e){void 0===e&&(e=!0),this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,e&&this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},e}()},4450:(e,t,r)=>{"use strict";r.d(t,{s:()=>i});var i=function(){function e(){this.reset()}return e.prototype.reset=function(){this.enabled=!1,this.mask=255,this.func=e.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=e.KEEP,this.opDepthFail=e.KEEP,this.opStencilDepthPass=e.REPLACE},Object.defineProperty(e.prototype,"stencilFunc",{get:function(){return this.func},set:function(e){this.func=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncRef",{get:function(){return this.funcRef},set:function(e){this.funcRef=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncMask",{get:function(){return this.funcMask},set:function(e){this.funcMask=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilFail",{get:function(){return this.opStencilFail},set:function(e){this.opStencilFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpDepthFail",{get:function(){return this.opDepthFail},set:function(e){this.opDepthFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilDepthPass",{get:function(){return this.opStencilDepthPass},set:function(e){this.opStencilDepthPass=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilMask",{get:function(){return this.mask},set:function(e){this.mask=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilTest",{get:function(){return this.enabled},set:function(e){this.enabled=e},enumerable:!1,configurable:!0}),e.ALWAYS=519,e.KEEP=7680,e.REPLACE=7681,e}()},693:(e,t,r)=>{"use strict";r.d(t,{C:()=>i});var i=function(){function e(e){void 0===e&&(e=!0),this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"func",{get:function(){return this._func},set:function(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"funcRef",{get:function(){return this._funcRef},set:function(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"funcMask",{get:function(){return this._funcMask},set:function(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opStencilFail",{get:function(){return this._opStencilFail},set:function(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opDepthFail",{get:function(){return this._opDepthFail},set:function(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opStencilDepthPass",{get:function(){return this._opStencilDepthPass},set:function(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){var e;this.stencilMaterial=void 0,null===(e=this.stencilGlobal)||void 0===e||e.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},e.prototype.apply=function(e){var t;if(e){var r=!this.useStencilGlobalOnly&&!!(null===(t=this.stencilMaterial)||void 0===t?void 0:t.enabled);this.enabled=r?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=r?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=r?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=r?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=r?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=r?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=r?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=r?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}},e}()},3940:(e,t,r)=>{"use strict";r.d(t,{ZT:()=>n,pi:()=>s,gn:()=>o,mG:()=>a,Jh:()=>u,ev:()=>h});var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var s=function(){return(s=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function o(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}function a(e,t,r,i){return new(r||(r=Promise))((function(n,s){function o(e){try{u(i.next(e))}catch(e){s(e)}}function a(e){try{u(i.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}u((i=i.apply(e,t||[])).next())}))}function u(e,t){var r,i,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&s[0]?i.return:s[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,s[1])).done)return n;switch(i=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function h(e,t){for(var r=0,i=t.length,n=e.length;r<i;r++,n++)e[n]=t[r];return e}Object.create,Object.create},8386:(e,t,r)=>{var i={"./buoyancy":[4292,9,465,292],"./buoyancy.ts":[4292,9,465,292],"./fft":[7160,9,465,160],"./fft.ts":[7160,9,465,160],"./initialSpectrum":[494,9,465,494],"./initialSpectrum.ts":[494,9,465,494],"./ocean":[4041,9,465,454,584,26,494,699,853,811,41],"./ocean.ts":[4041,9,465,454,584,26,494,699,853,811,41],"./oceanGeometry":[3955,7,955],"./oceanGeometry.ts":[3955,7,955],"./oceanMaterial":[6124,9,465,454,124],"./oceanMaterial.ts":[6124,9,465,454,124],"./skyBox":[4059,9,465,454,699,59],"./skyBox.ts":[4059,9,465,454,699,59],"./tools/RTTDebug":[5811,9,465,454,584,811],"./tools/RTTDebug.ts":[5811,9,465,454,584,811],"./tools/computeHelper":[7014,9,465,14],"./tools/computeHelper.ts":[7014,9,465,14],"./tools/exrSerializer":[1183,9,465,183],"./tools/exrSerializer.ts":[1183,9,465,183],"./tools/math.vector.float32":[1789,9,789],"./tools/math.vector.float32.ts":[1789,9,789],"./tools/skyMaterialExt":[6699,9,465,454,699],"./tools/skyMaterialExt.ts":[6699,9,465,454,699],"./wavesCascade":[650,9,465,494,650],"./wavesCascade.ts":[650,9,465,494,650],"./wavesGenerator":[6853,9,465,494,853],"./wavesGenerator.ts":[6853,9,465,494,853],"./wavesSettings":[6113,9,465,113],"./wavesSettings.ts":[6113,9,465,113]};function n(e){if(!r.o(i,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],n=t[0];return Promise.all(t.slice(2).map(r.e)).then((()=>r.t(n,16|t[1])))}n.keys=()=>Object.keys(i),n.id=8386,e.exports=n}},s={};function o(e){var t=s[e];if(void 0!==t)return t.exports;var r=s[e]={exports:{}};return n[e](r,r.exports,o),r.exports}o.m=n,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"==typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"==typeof r.then)return r}var n=Object.create(null);o.r(n);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&i&&r;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>r[e]));return s.default=()=>r,o.d(n,s),n},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,r)=>(o.f[r](e,t),t)),[])),o.u=e=>"js/"+e+".babylonBundle.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},i="babylonjs-typescript-webpack-simple-scene:",o.l=(e,t,n,s)=>{if(r[e])r[e].push(t);else{var a,u;if(void 0!==n)for(var h=document.getElementsByTagName("script"),c=0;c<h.length;c++){var l=h[c];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")==i+n){a=l;break}}a||(u=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",i+n),a.src=e),r[e]=[t];var p=(t,i)=>{a.onerror=a.onload=null,clearTimeout(f);var n=r[e];if(delete r[e],a.parentNode&&a.parentNode.removeChild(a),n&&n.forEach((e=>e(i))),t)return t(i)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=p.bind(null,a.onerror),a.onload=p.bind(null,a.onload),u&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e+"../"})(),(()=>{var e={179:0};o.f.j=(t,r)=>{var i=o.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var n=new Promise(((r,n)=>i=e[t]=[r,n]));r.push(i[2]=n);var s=o.p+o.u(t),a=new Error;o.l(s,(r=>{if(o.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var n=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+n+": "+s+")",a.name="ChunkLoadError",a.type=n,a.request=s,i[1](a)}}),"chunk-"+t,t)}};var t=(t,r)=>{var i,n,[s,a,u]=r,h=0;for(i in a)o.o(a,i)&&(o.m[i]=a[i]);for(u&&u(o),t&&t(r);h<s.length;h++)n=s[h],o.o(e,n)&&e[n]&&e[n][0](),e[s[h]]=0},r=self.webpackChunkbabylonjs_typescript_webpack_simple_scene=self.webpackChunkbabylonjs_typescript_webpack_simple_scene||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),(()=>{"use strict";var e,t,r=o(8483);(e=void 0,t=function(){var e,t,i,n;return function(e,t){var r,i,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&s[0]?i.return:s[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,s[1])).done)return n;switch(i=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],i=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}(this,(function(s){switch(s.label){case 0:return[4,(a=location.search.split("scene=")[1],void 0===a&&(a="ocean"),o(8386)("./"+a).then((function(e){return e.default})))];case 1:return e=s.sent(),[4,Promise.all(e.preTasks||[])];case 2:return s.sent(),t=document.getElementById("renderCanvas"),[4,(i=new r.f(t,{deviceDescriptor:{requiredFeatures:["texture-compression-bc","timestamp-query","pipeline-statistics-query","depth-clamping","depth24unorm-stencil8","depth32float-stencil8"]}})).initAsync()];case 3:return s.sent(),[4,e.createScene(i,t)];case 4:return n=s.sent(),window.engine=i,window.scene=n,i.runRenderLoop((function(){n.render()})),window.addEventListener("resize",(function(){i.resize()})),[2]}var a}))},new(e||(e=Promise))((function(r,i){function n(e){try{o(t.next(e))}catch(e){i(e)}}function s(e){try{o(t.throw(e))}catch(e){i(e)}}function o(t){var i;t.done?r(t.value):(i=t.value,i instanceof e?i:new e((function(e){e(i)}))).then(n,s)}o((t=t.apply(void 0,[])).next())}))).then((function(){}))})()})();
//# sourceMappingURL=babylonBundle.js.map