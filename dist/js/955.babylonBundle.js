(self.webpackChunkbabylonjs_ocean_demo=self.webpackChunkbabylonjs_ocean_demo||[]).push([[955],{3955:(t,e,i)=>{"use strict";i.r(e),i.d(e,{OceanGeometry:()=>n});var s,r=i(7976);!function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Top=4]="Top",t[t.Bottom=8]="Bottom",t[t.All=15]="All"}(s||(s={}));var n=function(){function t(t,e,i){this.lengthScale=15,this.vertexDensity=30,this.clipLevels=8,this.skirtSize=10,this.noMaterialLod=!0,this.useSkirt=!0,this._oceanMaterial=t,this._camera=e,this._scene=i,this._materials=[],this._root=new r.TransformNode("Ocean",i),this._center=null,this._skirt=null,this._rings=[],this._trims=[],this._trimRotations=[r.Quaternion.RotationAxis(r.Vector3.UpReadOnly,r.Angle.FromDegrees(180).radians()),r.Quaternion.RotationAxis(r.Vector3.UpReadOnly,r.Angle.FromDegrees(90).radians()),r.Quaternion.RotationAxis(r.Vector3.UpReadOnly,r.Angle.FromDegrees(270).radians()),r.Quaternion.Identity()]}return Object.defineProperty(t.prototype,"wireframe",{get:function(){return this._center.material.wireframe},set:function(t){this._center.material.wireframe=t,this._skirt&&(this._skirt.material.wireframe=t),this._rings.forEach((function(e){return e.material.wireframe=t})),this._trims.forEach((function(e){return e.material.wireframe=t}))},enumerable:!1,configurable:!0}),t.prototype.initializeMaterials=function(){var t,e,i,s,r,n,o;return s=this,r=void 0,o=function(){var s,r;return function(t,e){var i,s,r,n,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,s&&(r=2&n[0]?s.return:n[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,n[1])).done)return r;switch(s=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,s=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){o.label=n[1];break}if(6===n[0]&&o.label<r[1]){o.label=r[1],r=n;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(n);break}r[2]&&o.ops.pop(),o.trys.pop();continue}n=e.call(t,o)}catch(t){n=[6,t],s=0}finally{i=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}}(this,(function(n){switch(n.label){case 0:return null===(t=this._materials[0])||void 0===t||t.dispose(),null===(e=this._materials[1])||void 0===e||e.dispose(),null===(i=this._materials[2])||void 0===i||i.dispose(),s=this,[4,this._oceanMaterial.getMaterial(!0,!0)];case 1:return r=[n.sent()],[4,this._oceanMaterial.getMaterial(!0,!1)];case 2:return r=r.concat([n.sent()]),[4,this._oceanMaterial.getMaterial(!1,!1)];case 3:return s._materials=r.concat([n.sent()]),[2]}}))},new((n=void 0)||(n=Promise))((function(t,e){function i(t){try{l(o.next(t))}catch(t){e(t)}}function a(t){try{l(o.throw(t))}catch(t){e(t)}}function l(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(t){t(s)}))).then(i,a)}l((o=o.apply(s,r||[])).next())}))},t.prototype.initializeMeshes=function(){var t,e,i,s;null===(t=this._center)||void 0===t||t.dispose(),null===(e=this._skirt)||void 0===e||e.dispose(),null===(i=this._rings)||void 0===i||i.forEach((function(t){return t.dispose()})),null===(s=this._trims)||void 0===s||s.forEach((function(t){return t.dispose()})),this._skirt=null,this._rings=[],this._trims=[],this._instantiateMeshes()},t.prototype.update=function(){this._updatePositions(),this._updateMaterials()},t.prototype.getMaterial=function(t){return this._materials[t]},t.prototype._updateMaterials=function(){var t=this._activeLodLevels;this._center.material=this._getMaterial(this.noMaterialLod?0:this.clipLevels-t-1);for(var e=0;e<this._rings.length;e++)this._rings[e].material=this._getMaterial(this.noMaterialLod?0:this.clipLevels-t-e),this._trims[e].material=this._getMaterial(this.noMaterialLod?0:this.clipLevels-t-e);this.useSkirt&&(this._skirt.material=this.noMaterialLod?this._materials[0]:this._materials[2])},t.prototype._updatePositions=function(){var t=this._gridSize,e=this._activeLodLevels,i=r.TmpVectors.Vector3[0],s=r.TmpVectors.Vector3[1],n=r.TmpVectors.Vector3[2],o=r.TmpVectors.Vector3[3],a=this._clipLevelScale(-1,e);i.copyFrom(this._camera.position),this._snap(i,2*a),this._offsetFromCenter(-1,e,s),this._center.position.copyFrom(i).addInPlace(s),this._center.scaling.set(a,1,a);for(var l=0;l<this.clipLevels;l++)if(this._rings[l].setEnabled(l<e),this._trims[l].setEnabled(l<e),!(l>=e)){a=this._clipLevelScale(l,e),n.copyFrom(this._camera.position),this._snap(n,2*a),this._offsetFromCenter(l,e,s),o.copyFrom(n).addInPlace(s).addInPlaceFromFloats(a*(t-1)/2,0,a*(t-1)/2);var h=i.x-n.x<=0?1:0,c=i.z-n.z<=0?1:0;o.x+=h*(t+1)*a,o.z+=c*(t+1)*a,this._trims[l].position.copyFrom(o),this._trims[l].rotationQuaternion.copyFrom(this._trimRotations[h+2*c]),this._trims[l].scaling.set(a,1,a),this._rings[l].position.copyFrom(n).addInPlace(s),this._rings[l].scaling.set(a,1,a),i.copyFrom(n)}this.useSkirt&&(a=2*this.lengthScale*Math.pow(2,this.clipLevels),this._skirt.position.copyFrom(i).addInPlaceFromFloats(-a*(this.skirtSize+.5-.5/t),0,-a*(this.skirtSize+.5-.5/t)),this._skirt.scaling.set(a,1,a))},Object.defineProperty(t.prototype,"_activeLodLevels",{get:function(){return this.clipLevels-r.Scalar.Clamp(Math.floor(Math.log2((1.7*Math.abs(this._camera.position.y)+1)/this.lengthScale)),0,this.clipLevels)},enumerable:!1,configurable:!0}),t.prototype._clipLevelScale=function(t,e){return this.lengthScale/this._gridSize*Math.pow(2,this.clipLevels-e+t+1)},t.prototype._offsetFromCenter=function(e,i,s){var r=this._gridSize,n=((1<<this.clipLevels)+t._GeometricProgressionSum(2,2,this.clipLevels-i+e+1,this.clipLevels-1))*this.lengthScale/r*(r-1)/2;s.copyFromFloats(-n,0,-n)},t._GeometricProgressionSum=function(t,e,i,s){return t/(1-e)*(Math.pow(e,s)-Math.pow(e,i))},t.prototype._snap=function(t,e){t.x>=0?t.x=Math.floor(t.x/e)*e:t.x=Math.ceil((t.x-e+1)/e)*e,t.z<0?t.z=Math.floor(t.z/e)*e:t.z=Math.ceil((t.z-e+1)/e)*e,t.y=0},t.prototype._getMaterial=function(t){return t-2<=0?this._materials[0]:t-2<=2?this._materials[1]:this._materials[2]},Object.defineProperty(t.prototype,"_gridSize",{get:function(){return 4*this.vertexDensity+1},enumerable:!1,configurable:!0}),t.prototype._instantiateMeshes=function(){var t=this._gridSize;this._center=this._instantiateElement("Center",this._createPlaneMesh(2*t,2*t,1,s.All),this._materials[this._materials.length-1]);for(var e=this._createRingMesh(t,1),i=this._createTrimMesh(t,1),r=0;r<this.clipLevels;++r)this._rings.push(this._instantiateElement("Ring "+r,e,this._materials[this._materials.length-1],r>0)),this._trims.push(this._instantiateElement("Trim "+r,i,this._materials[this._materials.length-1],r>0));this.useSkirt&&(this._skirt=this._instantiateElement("Skirt",this._createSkirtMesh(t,this.skirtSize),this._materials[this._materials.length-1]))},t.prototype._instantiateElement=function(t,e,i,s){return void 0===s&&(s=!1),s&&(e=e.clone("")),e.name=t,e.material=i,e.parent=this._root,e.receiveShadows=!0,e},t.prototype._createSkirtMesh=function(t,e){var i=this._createPlaneMesh(1,1,1),s=this._createPlaneMesh(t,1,1),n=this._createPlaneMesh(1,t,1),o=new r.Vector3(e,1,e),a=new r.Vector3(1/t,1,e),l=new r.Vector3(e,1,1/t),h=i.clone();h.scaling.copyFrom(o);var c=s.clone();c.scaling.copyFrom(a),c.position.x=e;var p=i.clone();p.scaling.copyFrom(o),p.position.x=e+1;var u=n.clone();u.scaling.copyFrom(l),u.position.z=e;var _=n.clone();_.scaling.copyFrom(l),_.position.x=e+1,_.position.z=e;var m=i.clone();m.scaling.copyFrom(o),m.position.z=e+1;var f=s.clone();f.scaling.copyFrom(a),f.position.x=e,f.position.z=e+1;var v=i.clone();return v.scaling.copyFrom(o),v.position.x=e+1,v.position.z=e+1,i.dispose(!0,!1),s.dispose(!0,!1),n.dispose(!0,!1),r.Mesh.MergeMeshes([h,c,p,u,_,m,f,v],!0,!0)},t.prototype._createTrimMesh=function(t,e){var i=this._createPlaneMesh(t+1,1,e,s.None,1);i.position.set((-t-1)*e,0,-1*e);var n=this._createPlaneMesh(1,t,e,s.None,1);n.position.set(-1*e,0,(-t-1)*e);var o=r.Mesh.MergeMeshes([i,n],!0,!0);return o.rotationQuaternion=new r.Quaternion,o},t.prototype._createRingMesh=function(t,e){var i=this._createPlaneMesh(2*t,t-1>>1,e,s.Bottom|s.Right|s.Left),n=this._createPlaneMesh(2*t,t-1>>1,e,s.Top|s.Right|s.Left);n.position.set(0,0,(t+1+(t-1>>1))*e);var o=this._createPlaneMesh(t-1>>1,t+1,e,s.Left);o.position.set(0,0,(t-1>>1)*e);var a=this._createPlaneMesh(t-1>>1,t+1,e,s.Right);return a.position.set((t+1+(t-1>>1))*e,0,(t-1>>1)*e),r.Mesh.MergeMeshes([i,n,o,a],!0,!0)},t.prototype._createPlaneMesh=function(t,e,i,n,o){void 0===n&&(n=s.None),void 0===o&&(o=0);var a=[],l=[],h=[],c=new r.VertexData;c.positions=a,c.indices=l,c.normals=h;for(var p=0;p<e+1;++p)for(var u=0;u<t+1;++u){var _=u,m=p;(0===p&&n&s.Bottom||p===e&&n&s.Top)&&(_&=-2),(0===u&&n&s.Left||u===t&&n&s.Right)&&(m&=-2),a[0+3*u+p*(t+1)*3]=_*i,a[1+3*u+p*(t+1)*3]=0*i,a[2+3*u+p*(t+1)*3]=m*i,h[0+3*u+p*(t+1)*3]=0,h[1+3*u+p*(t+1)*3]=1,h[2+3*u+p*(t+1)*3]=0}var f=0;for(p=0;p<e;++p)for(u=0;u<t;++u){var v=u+p*(t+1);(p+u+o)%2==0?(l[f++]=v,l[f++]=v+t+2,l[f++]=v+t+1,l[f++]=v,l[f++]=v+1,l[f++]=v+t+2):(l[f++]=v,l[f++]=v+1,l[f++]=v+t+1,l[f++]=v+1,l[f++]=v+t+2,l[f++]=v+t+1)}var d=new r.Mesh("Clipmap plane",this._scene);return c.applyToMesh(d,!0),d},t}()}}]);
//# sourceMappingURL=955.babylonBundle.js.map