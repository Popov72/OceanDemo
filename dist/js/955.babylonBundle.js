(self.webpackChunkbabylonjs_typescript_webpack_simple_scene=self.webpackChunkbabylonjs_typescript_webpack_simple_scene||[]).push([[955],{3955:(t,e,i)=>{"use strict";i.r(e),i.d(e,{OceanGeometry:()=>n});var s,r=i(1465);!function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Top=4]="Top",t[t.Bottom=8]="Bottom",t[t.All=15]="All"}(s||(s={}));var n=function(){function t(t,e,i){this.lengthScale=15,this.vertexDensity=30,this.clipLevels=8,this.skirtSize=55.4,this.noMaterialLod=!0,this.useSkirt=!0,this._oceanMaterial=t,this._camera=e,this._scene=i,this._materials=[],this._root=new r.YOI("Ocean",i),this._center=null,this._skirt=null,this._rings=[],this._trims=[],this._trimRotations=[r._fP.RotationAxis(r.Pa4.UpReadOnly,r.RZi.FromDegrees(180).radians()),r._fP.RotationAxis(r.Pa4.UpReadOnly,r.RZi.FromDegrees(90).radians()),r._fP.RotationAxis(r.Pa4.UpReadOnly,r.RZi.FromDegrees(270).radians()),r._fP.Identity()]}return t.prototype.initialize=function(){return t=this,e=void 0,s=function(){var t,e;return function(t,e){var i,s,r,n,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function o(n){return function(o){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(r=2&n[0]?s.return:n[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,n[1])).done)return r;switch(s=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,s=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){a.label=n[1];break}if(6===n[0]&&a.label<r[1]){a.label=r[1],r=n;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(n);break}r[2]&&a.ops.pop(),a.trys.pop();continue}n=e.call(t,a)}catch(t){n=[6,t],s=0}finally{i=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}}(this,(function(i){switch(i.label){case 0:return t=this,[4,this._oceanMaterial.getMaterial(!0,!0)];case 1:return e=[i.sent()],[4,this._oceanMaterial.getMaterial(!0,!1)];case 2:return e=e.concat([i.sent()]),[4,this._oceanMaterial.getMaterial(!1,!1)];case 3:return t._materials=e.concat([i.sent()]),this._instantiateMeshes(),[2]}}))},new((i=void 0)||(i=Promise))((function(r,n){function a(t){try{l(s.next(t))}catch(t){n(t)}}function o(t){try{l(s.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}l((s=s.apply(t,e||[])).next())}));var t,e,i,s},t.prototype.update=function(){this._updatePositions(),this._updateMaterials()},t.prototype._updateMaterials=function(){var t=this._activeLodLevels;this._center.material=this._getMaterial(this.noMaterialLod?0:this.clipLevels-t-1);for(var e=0;e<this._rings.length;e++)this._rings[e].material=this._getMaterial(this.noMaterialLod?0:this.clipLevels-t-e),this._trims[e].material=this._getMaterial(this.noMaterialLod?0:this.clipLevels-t-e);this.useSkirt&&(this._skirt.material=this.noMaterialLod?this._materials[0]:this._materials[2])},t.prototype._updatePositions=function(){var t=this._gridSize,e=this._activeLodLevels,i=r.jp9.Vector3[0],s=r.jp9.Vector3[1],n=r.jp9.Vector3[2],a=r.jp9.Vector3[3],o=this._clipLevelScale(-1,e);i.copyFrom(this._camera.position),this._snap(i,2*o),this._offsetFromCenter(-1,e,s),this._center.position.copyFrom(i).addInPlace(s),this._center.scaling.set(o,1,o);for(var l=0;l<this.clipLevels;l++)if(this._rings[l].setEnabled(l<e),this._trims[l].setEnabled(l<e),!(l>=e)){o=this._clipLevelScale(l,e),n.copyFrom(this._camera.position),this._snap(n,2*o),this._offsetFromCenter(l,e,s),a.copyFrom(n).addInPlace(s).addInPlaceFromFloats(o*(t-1)/2,0,o*(t-1)/2);var h=i.x-n.x<=0?1:0,c=i.z-n.z<=0?1:0;a.x+=h*(t+1)*o,a.z+=c*(t+1)*o,this._trims[l].position.copyFrom(a),this._trims[l].rotationQuaternion.copyFrom(this._trimRotations[h+2*c]),this._trims[l].scaling.set(o,1,o),this._rings[l].position.copyFrom(n).addInPlace(s),this._rings[l].scaling.set(o,1,o),i.copyFrom(n)}this.useSkirt&&(o=2*this.lengthScale*Math.pow(2,this.clipLevels),this._skirt.position.copyFrom(i).addInPlaceFromFloats(-o*(this.skirtSize+.5-.5/t),0,-o*(this.skirtSize+.5-.5/t)),this._skirt.scaling.set(o,1,o))},Object.defineProperty(t.prototype,"_activeLodLevels",{get:function(){return this.clipLevels-r.Rus.Clamp(Math.floor(Math.log2((1.7*Math.abs(this._camera.position.y)+1)/this.lengthScale)),0,this.clipLevels)},enumerable:!1,configurable:!0}),t.prototype._clipLevelScale=function(t,e){return this.lengthScale/this._gridSize*Math.pow(2,this.clipLevels-e+t+1)},t.prototype._offsetFromCenter=function(e,i,s){var r=this._gridSize,n=((1<<this.clipLevels)+t._GeometricProgressionSum(2,2,this.clipLevels-i+e+1,this.clipLevels-1))*this.lengthScale/r*(r-1)/2;s.copyFromFloats(-n,0,-n)},t._GeometricProgressionSum=function(t,e,i,s){return t/(1-e)*(Math.pow(e,s)-Math.pow(e,i))},t.prototype._snap=function(t,e){t.x>=0?t.x=Math.floor(t.x/e)*e:t.x=Math.ceil((t.x-e+1)/e)*e,t.z<0?t.z=Math.floor(t.z/e)*e:t.z=Math.ceil((t.z-e+1)/e)*e,t.y=0},t.prototype._getMaterial=function(t){return t-2<=0?this._materials[0]:t-2<=2?this._materials[1]:this._materials[2]},Object.defineProperty(t.prototype,"_gridSize",{get:function(){return 4*this.vertexDensity+1},enumerable:!1,configurable:!0}),t.prototype._instantiateMeshes=function(){var t=this._gridSize;this._center=this._instantiateElement("Center",this._createPlaneMesh(2*t,2*t,1,s.All),this._materials[this._materials.length-1]);for(var e=this._createRingMesh(t,1),i=this._createTrimMesh(t,1),r=0;r<this.clipLevels;++r)this._rings.push(this._instantiateElement("Ring "+r,e,this._materials[this._materials.length-1],r>0)),this._trims.push(this._instantiateElement("Trim "+r,i,this._materials[this._materials.length-1],r>0));this.useSkirt&&(this._skirt=this._instantiateElement("Skirt",this._createSkirtMesh(t,this.skirtSize),this._materials[this._materials.length-1]))},t.prototype._instantiateElement=function(t,e,i,s){return void 0===s&&(s=!1),s&&(e=e.clone("")),e.name=t,e.material=i,e.parent=this._root,e},t.prototype._createSkirtMesh=function(t,e){var i=this._createPlaneMesh(1,1,1),s=this._createPlaneMesh(t,1,1),n=this._createPlaneMesh(1,t,1),a=new r.Pa4(e,1,e),o=new r.Pa4(1/t,1,e),l=new r.Pa4(e,1,1/t),h=i.clone();h.scaling.copyFrom(a);var c=s.clone();c.scaling.copyFrom(o),c.position.x=e;var p=i.clone();p.scaling.copyFrom(a),p.position.x=e+1;var _=n.clone();_.scaling.copyFrom(l),_.position.z=e;var u=n.clone();u.scaling.copyFrom(l),u.position.x=e+1,u.position.z=e;var m=i.clone();m.scaling.copyFrom(a),m.position.z=e+1;var f=s.clone();f.scaling.copyFrom(o),f.position.x=e,f.position.z=e+1;var v=i.clone();return v.scaling.copyFrom(a),v.position.x=e+1,v.position.z=e+1,i.dispose(!0,!1),s.dispose(!0,!1),n.dispose(!0,!1),r.Kj0.MergeMeshes([h,c,p,_,u,m,f,v],!0,!0)},t.prototype._createTrimMesh=function(t,e){var i=this._createPlaneMesh(t+1,1,e,s.None,1);i.position.set((-t-1)*e,0,-1*e);var n=this._createPlaneMesh(1,t,e,s.None,1);n.position.set(-1*e,0,(-t-1)*e);var a=r.Kj0.MergeMeshes([i,n],!0,!0);return a.rotationQuaternion=new r._fP,a},t.prototype._createRingMesh=function(t,e){var i=this._createPlaneMesh(2*t,t-1>>1,e,s.Bottom|s.Right|s.Left),n=this._createPlaneMesh(2*t,t-1>>1,e,s.Top|s.Right|s.Left);n.position.set(0,0,(t+1+(t-1>>1))*e);var a=this._createPlaneMesh(t-1>>1,t+1,e,s.Left);a.position.set(0,0,(t-1>>1)*e);var o=this._createPlaneMesh(t-1>>1,t+1,e,s.Right);return o.position.set((t+1+(t-1>>1))*e,0,(t-1>>1)*e),r.Kj0.MergeMeshes([i,n,a,o],!0,!0)},t.prototype._createPlaneMesh=function(t,e,i,n,a){void 0===n&&(n=s.None),void 0===a&&(a=0);var o=[],l=[],h=[],c=new r.xx8;c.positions=o,c.indices=l,c.normals=h;for(var p=0;p<e+1;++p)for(var _=0;_<t+1;++_){var u=_,m=p;(0===p&&n&s.Bottom||p===e&&n&s.Top)&&(u&=-2),(0===_&&n&s.Left||_===t&&n&s.Right)&&(m&=-2),o[0+3*_+p*(t+1)*3]=u*i,o[1+3*_+p*(t+1)*3]=0*i,o[2+3*_+p*(t+1)*3]=m*i,h[0+3*_+p*(t+1)*3]=0,h[1+3*_+p*(t+1)*3]=1,h[2+3*_+p*(t+1)*3]=0}var f=0;for(p=0;p<e;++p)for(_=0;_<t;++_){var v=_+p*(t+1);(p+_+a)%2==0?(l[f++]=v,l[f++]=v+t+2,l[f++]=v+t+1,l[f++]=v,l[f++]=v+1,l[f++]=v+t+2):(l[f++]=v,l[f++]=v+1,l[f++]=v+t+1,l[f++]=v+1,l[f++]=v+t+2,l[f++]=v+t+1)}var g=new r.Kj0("Clipmap plane",this._scene);return c.applyToMesh(g,!0),g},t}()}}]);
//# sourceMappingURL=955.babylonBundle.js.map