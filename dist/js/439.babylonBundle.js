(self.webpackChunkbabylonjs_typescript_webpack_simple_scene=self.webpackChunkbabylonjs_typescript_webpack_simple_scene||[]).push([[439],{6584:(e,t,i)=>{"use strict";i.d(t,{in:()=>ue,oT:()=>x,rj:()=>B,Ae:()=>E,al:()=>M});var n=i(3940),r=i(4462),o=i(8131),s=i(4471),a=i(994),l=i(2281),h=function(){function e(t,i,n){void 0===i&&(i=e.UNITMODE_PIXEL),void 0===n&&(n=!0),this.unit=i,this.negativeValueAllowed=n,this._value=1,this.ignoreAdaptiveScaling=!1,this._value=t,this._originalUnit=i}return Object.defineProperty(e.prototype,"isPercentage",{get:function(){return this.unit===e.UNITMODE_PERCENTAGE},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPixel",{get:function(){return this.unit===e.UNITMODE_PIXEL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"internalValue",{get:function(){return this._value},enumerable:!1,configurable:!0}),e.prototype.getValueInPixel=function(e,t){return this.isPixel?this.getValue(e):this.getValue(e)*t},e.prototype.updateInPlace=function(t,i){return void 0===i&&(i=e.UNITMODE_PIXEL),this._value=t,this.unit=i,this},e.prototype.getValue=function(t){if(t&&!this.ignoreAdaptiveScaling&&this.unit!==e.UNITMODE_PERCENTAGE){var i=0,n=0;if(t.idealWidth&&(i=this._value*t.getSize().width/t.idealWidth),t.idealHeight&&(n=this._value*t.getSize().height/t.idealHeight),t.useSmallestIdeal&&t.idealWidth&&t.idealHeight)return window.innerWidth<window.innerHeight?i:n;if(t.idealWidth)return i;if(t.idealHeight)return n}return this._value},e.prototype.toString=function(t,i){switch(this.unit){case e.UNITMODE_PERCENTAGE:var n=100*this.getValue(t);return(i?n.toFixed(i):n)+"%";case e.UNITMODE_PIXEL:var r=this.getValue(t);return(i?r.toFixed(i):r)+"px"}return this.unit.toString()},e.prototype.fromString=function(t){var i=e._Regex.exec(t.toString());if(!i||0===i.length)return!1;var n=parseFloat(i[1]),r=this._originalUnit;if(this.negativeValueAllowed||n<0&&(n=0),4===i.length)switch(i[3]){case"px":r=e.UNITMODE_PIXEL;break;case"%":r=e.UNITMODE_PERCENTAGE,n/=100}return(n!==this._value||r!==this.unit)&&(this._value=n,this.unit=r,!0)},Object.defineProperty(e,"UNITMODE_PERCENTAGE",{get:function(){return e._UNITMODE_PERCENTAGE},enumerable:!1,configurable:!0}),Object.defineProperty(e,"UNITMODE_PIXEL",{get:function(){return e._UNITMODE_PIXEL},enumerable:!1,configurable:!0}),e._Regex=/(^-?\d*(\.\d+)?)(%|px)?/,e._UNITMODE_PERCENTAGE=0,e._UNITMODE_PIXEL=1,e}(),u=[new s.FM(0,0),new s.FM(0,0),new s.FM(0,0),new s.FM(0,0)],c=[new s.FM(0,0),new s.FM(0,0),new s.FM(0,0),new s.FM(0,0)],f=new s.FM(0,0),_=new s.FM(0,0),d=function(){function e(e,t,i,n){this.left=e,this.top=t,this.width=i,this.height=n}return e.prototype.copyFrom=function(e){this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height},e.prototype.copyFromFloats=function(e,t,i,n){this.left=e,this.top=t,this.width=i,this.height=n},e.CombineToRef=function(e,t,i){var n=Math.min(e.left,t.left),r=Math.min(e.top,t.top),o=Math.max(e.left+e.width,t.left+t.width),s=Math.max(e.top+e.height,t.top+t.height);i.left=n,i.top=r,i.width=o-n,i.height=s-r},e.prototype.addAndTransformToRef=function(e,t,i,n,r,o){var s=this.left+t,a=this.top+i,l=this.width+n,h=this.height+r;u[0].copyFromFloats(s,a),u[1].copyFromFloats(s+l,a),u[2].copyFromFloats(s+l,a+h),u[3].copyFromFloats(s,a+h),f.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE),_.copyFromFloats(0,0);for(var d=0;d<4;d++)e.transformCoordinates(u[d].x,u[d].y,c[d]),f.x=Math.floor(Math.min(f.x,c[d].x)),f.y=Math.floor(Math.min(f.y,c[d].y)),_.x=Math.ceil(Math.max(_.x,c[d].x)),_.y=Math.ceil(Math.max(_.y,c[d].y));o.left=f.x,o.top=f.y,o.width=_.x-f.x,o.height=_.y-f.y},e.prototype.transformToRef=function(e,t){this.addAndTransformToRef(e,0,0,0,0,t)},e.prototype.isEqualsTo=function(e){return this.left===e.left&&this.top===e.top&&this.width===e.width&&this.height===e.height},e.Empty=function(){return new e(0,0,0,0)},e}(),p=i(6588),g=function(e){function t(t,i){void 0===i&&(i=0);var n=e.call(this,t.x,t.y)||this;return n.buttonIndex=i,n}return(0,n.ZT)(t,e),t}(s.FM),m=function(){function e(e,t,i,n,r,o){this.m=new Float32Array(6),this.fromValues(e,t,i,n,r,o)}return e.prototype.fromValues=function(e,t,i,n,r,o){return this.m[0]=e,this.m[1]=t,this.m[2]=i,this.m[3]=n,this.m[4]=r,this.m[5]=o,this},e.prototype.determinant=function(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]},e.prototype.invertToRef=function(e){var t=this.m[0],i=this.m[1],n=this.m[2],r=this.m[3],o=this.m[4],s=this.m[5],a=this.determinant();if(a<p.kn*p.kn)return e.m[0]=0,e.m[1]=0,e.m[2]=0,e.m[3]=0,e.m[4]=0,e.m[5]=0,this;var l=1/a,h=n*s-r*o,u=i*o-t*s;return e.m[0]=r*l,e.m[1]=-i*l,e.m[2]=-n*l,e.m[3]=t*l,e.m[4]=h*l,e.m[5]=u*l,this},e.prototype.multiplyToRef=function(e,t){var i=this.m[0],n=this.m[1],r=this.m[2],o=this.m[3],s=this.m[4],a=this.m[5],l=e.m[0],h=e.m[1],u=e.m[2],c=e.m[3],f=e.m[4],_=e.m[5];return t.m[0]=i*l+n*u,t.m[1]=i*h+n*c,t.m[2]=r*l+o*u,t.m[3]=r*h+o*c,t.m[4]=s*l+a*u+f,t.m[5]=s*h+a*c+_,this},e.prototype.transformCoordinates=function(e,t,i){return i.x=e*this.m[0]+t*this.m[2]+this.m[4],i.y=e*this.m[1]+t*this.m[3]+this.m[5],this},e.Identity=function(){return new e(1,0,0,1,0,0)},e.TranslationToRef=function(e,t,i){i.fromValues(1,0,0,1,e,t)},e.ScalingToRef=function(e,t,i){i.fromValues(e,0,0,t,0,0)},e.RotationToRef=function(e,t){var i=Math.sin(e),n=Math.cos(e);t.fromValues(n,i,-i,n,0,0)},e.ComposeToRef=function(t,i,n,r,o,s,a){e.TranslationToRef(t,i,e._TempPreTranslationMatrix),e.ScalingToRef(r,o,e._TempScalingMatrix),e.RotationToRef(n,e._TempRotationMatrix),e.TranslationToRef(-t,-i,e._TempPostTranslationMatrix),e._TempPreTranslationMatrix.multiplyToRef(e._TempScalingMatrix,e._TempCompose0),e._TempCompose0.multiplyToRef(e._TempRotationMatrix,e._TempCompose1),s?(e._TempCompose1.multiplyToRef(e._TempPostTranslationMatrix,e._TempCompose2),e._TempCompose2.multiplyToRef(s,a)):e._TempCompose1.multiplyToRef(e._TempPostTranslationMatrix,a)},e._TempPreTranslationMatrix=e.Identity(),e._TempPostTranslationMatrix=e.Identity(),e._TempRotationMatrix=e.Identity(),e._TempScalingMatrix=e.Identity(),e._TempCompose0=e.Identity(),e._TempCompose1=e.Identity(),e._TempCompose2=e.Identity(),e}(),v=i(2997),b=i(3536),y=i(6940),x=function(){function e(t){this.name=t,this._alpha=1,this._alphaSet=!1,this._zIndex=0,this._currentMeasure=d.Empty(),this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new h(18,h.UNITMODE_PIXEL,!1),this._width=new h(1,h.UNITMODE_PERCENTAGE,!1),this._height=new h(1,h.UNITMODE_PERCENTAGE,!1),this._color="",this._style=null,this._horizontalAlignment=e.HORIZONTAL_ALIGNMENT_CENTER,this._verticalAlignment=e.VERTICAL_ALIGNMENT_CENTER,this._isDirty=!0,this._wasDirty=!1,this._tempParentMeasure=d.Empty(),this._prevCurrentMeasureTransformedIntoGlobalSpace=d.Empty(),this._cachedParentMeasure=d.Empty(),this._paddingLeft=new h(0),this._paddingRight=new h(0),this._paddingTop=new h(0),this._paddingBottom=new h(0),this._left=new h(0),this._top=new h(0),this._scaleX=1,this._scaleY=1,this._rotation=0,this._transformCenterX=.5,this._transformCenterY=.5,this._transformMatrix=m.Identity(),this._invertTransformMatrix=m.Identity(),this._transformedPosition=s.FM.Zero(),this._isMatrixDirty=!0,this._isVisible=!0,this._isHighlighted=!1,this._highlightLineWidth=2,this._fontSet=!1,this._dummyVector2=s.FM.Zero(),this._downCount=0,this._enterCount=-1,this._doNotRender=!1,this._downPointerIds={},this._isEnabled=!0,this._disabledColor="#9a9a9a",this._disabledColorItem="#6a6a6a",this._rebuildLayout=!1,this._customData={},this._isClipped=!1,this._automaticSize=!1,this.metadata=null,this.isHitTestVisible=!0,this.isPointerBlocker=!1,this.isFocusInvisible=!1,this.clipChildren=!0,this.clipContent=!0,this.useBitmapCache=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowBlur=0,this._previousShadowBlur=0,this._shadowColor="black",this.hoverCursor="",this._linkOffsetX=new h(0),this._linkOffsetY=new h(0),this.onWheelObservable=new o.y$,this.onPointerMoveObservable=new o.y$,this.onPointerOutObservable=new o.y$,this.onPointerDownObservable=new o.y$,this.onPointerUpObservable=new o.y$,this.onPointerClickObservable=new o.y$,this.onPointerEnterObservable=new o.y$,this.onDirtyObservable=new o.y$,this.onBeforeDrawObservable=new o.y$,this.onAfterDrawObservable=new o.y$,this.onDisposeObservable=new o.y$,this.fixedRatio=0,this._fixedRatioMasterIsWidth=!0,this._tmpMeasureA=new d(0,0,0,0)}return Object.defineProperty(e.prototype,"shadowOffsetX",{get:function(){return this._shadowOffsetX},set:function(e){this._shadowOffsetX!==e&&(this._shadowOffsetX=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowOffsetY",{get:function(){return this._shadowOffsetY},set:function(e){this._shadowOffsetY!==e&&(this._shadowOffsetY=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowBlur",{get:function(){return this._shadowBlur},set:function(e){this._shadowBlur!==e&&(this._previousShadowBlur=this._shadowBlur,this._shadowBlur=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowColor",{get:function(){return this._shadowColor},set:function(e){this._shadowColor!==e&&(this._shadowColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typeName",{get:function(){return this._getTypeName()},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return this._getTypeName()},Object.defineProperty(e.prototype,"host",{get:function(){return this._host},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontOffset",{get:function(){return this._fontOffset},set:function(e){this._fontOffset=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha!==e&&(this._alphaSet=!0,this._alpha=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightLineWidth",{get:function(){return this._highlightLineWidth},set:function(e){this._highlightLineWidth!==e&&(this._highlightLineWidth=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHighlighted",{get:function(){return this._isHighlighted},set:function(e){this._isHighlighted!==e&&(this._isHighlighted=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this._scaleX},set:function(e){this._scaleX!==e&&(this._scaleX=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this._scaleY},set:function(e){this._scaleY!==e&&(this._scaleY=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformCenterY",{get:function(){return this._transformCenterY},set:function(e){this._transformCenterY!==e&&(this._transformCenterY=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformCenterX",{get:function(){return this._transformCenterX},set:function(e){this._transformCenterX!==e&&(this._transformCenterX=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"horizontalAlignment",{get:function(){return this._horizontalAlignment},set:function(e){this._horizontalAlignment!==e&&(this._horizontalAlignment=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticalAlignment",{get:function(){return this._verticalAlignment},set:function(e){this._verticalAlignment!==e&&(this._verticalAlignment=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._fixedRatioMasterIsWidth=!0,this._width.toString(this._host)!==e&&this._width.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"widthInPixels",{get:function(){return this._width.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this._fixedRatioMasterIsWidth=!0,this.width=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(e){this._fixedRatioMasterIsWidth=!1,this._height.toString(this._host)!==e&&this._height.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"heightInPixels",{get:function(){return this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this._fixedRatioMasterIsWidth=!1,this.height=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this._fontSet?this._fontFamily:""},set:function(e){this._fontFamily!==e&&(this._fontFamily=e,this._resetFontCache())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){this._fontStyle!==e&&(this._fontStyle=e,this._resetFontCache())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){this._fontWeight!==e&&(this._fontWeight=e,this._resetFontCache())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(e){var t=this;this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this._style=e,this._style&&(this._styleObserver=this._style.onChangedObservable.add((function(){t._markAsDirty(),t._resetFontCache()}))),this._markAsDirty(),this._resetFontCache()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_isFontSizeInPercentage",{get:function(){return this._fontSize.isPercentage},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSizeInPixels",{get:function(){var e=this._style?this._style._fontSize:this._fontSize;return e.isPixel?e.getValue(this._host):e.getValueInPixel(this._host,this._tempParentMeasure.height||this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.fontSize=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize.toString(this._host)},set:function(e){this._fontSize.toString(this._host)!==e&&this._fontSize.fromString(e)&&(this._markAsDirty(),this._resetFontCache())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color!==e&&(this._color=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(e){this.zIndex!==e&&(this._zIndex=e,this.parent&&this.parent._reOrderControl(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"notRenderable",{get:function(){return this._doNotRender},set:function(e){this._doNotRender!==e&&(this._doNotRender=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isVisible",{get:function(){return this._isVisible},set:function(e){this._isVisible!==e&&(this._isVisible=e,this._markAsDirty(!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linkedMesh",{get:function(){return this._linkedMesh},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingLeft",{get:function(){return this._paddingLeft.toString(this._host)},set:function(e){this._paddingLeft.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingLeftInPixels",{get:function(){return this._paddingLeft.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.paddingLeft=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingRight",{get:function(){return this._paddingRight.toString(this._host)},set:function(e){this._paddingRight.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingRightInPixels",{get:function(){return this._paddingRight.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.paddingRight=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingTop",{get:function(){return this._paddingTop.toString(this._host)},set:function(e){this._paddingTop.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingTopInPixels",{get:function(){return this._paddingTop.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.paddingTop=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingBottom",{get:function(){return this._paddingBottom.toString(this._host)},set:function(e){this._paddingBottom.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingBottomInPixels",{get:function(){return this._paddingBottom.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.paddingBottom=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this._left.toString(this._host)},set:function(e){this._left.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftInPixels",{get:function(){return this._left.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.left=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this._top.toString(this._host)},set:function(e){this._top.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topInPixels",{get:function(){return this._top.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.top=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linkOffsetX",{get:function(){return this._linkOffsetX.toString(this._host)},set:function(e){this._linkOffsetX.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linkOffsetXInPixels",{get:function(){return this._linkOffsetX.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.linkOffsetX=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linkOffsetY",{get:function(){return this._linkOffsetY.toString(this._host)},set:function(e){this._linkOffsetY.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linkOffsetYInPixels",{get:function(){return this._linkOffsetY.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.linkOffsetY=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"centerX",{get:function(){return this._currentMeasure.left+this._currentMeasure.width/2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"centerY",{get:function(){return this._currentMeasure.top+this._currentMeasure.height/2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disabledColor",{get:function(){return this._disabledColor},set:function(e){this._disabledColor!==e&&(this._disabledColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disabledColorItem",{get:function(){return this._disabledColorItem},set:function(e){this._disabledColorItem!==e&&(this._disabledColorItem=e,this._markAsDirty())},enumerable:!1,configurable:!0}),e.prototype._getTypeName=function(){return"Control"},e.prototype.getAscendantOfClass=function(e){return this.parent?this.parent.getClassName()===e?this.parent:this.parent.getAscendantOfClass(e):null},e.prototype._resetFontCache=function(){this._fontSet=!0,this._markAsDirty()},e.prototype.isAscendant=function(e){return!!this.parent&&(this.parent===e||this.parent.isAscendant(e))},e.prototype.getLocalCoordinates=function(e){var t=s.FM.Zero();return this.getLocalCoordinatesToRef(e,t),t},e.prototype.getLocalCoordinatesToRef=function(e,t){return t.x=e.x-this._currentMeasure.left,t.y=e.y-this._currentMeasure.top,this},e.prototype.getParentLocalCoordinates=function(e){var t=s.FM.Zero();return t.x=e.x-this._cachedParentMeasure.left,t.y=e.y-this._cachedParentMeasure.top,t},e.prototype.moveToVector3=function(t,i){if(this._host&&this.parent===this._host._rootContainer){this.horizontalAlignment=e.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=e.VERTICAL_ALIGNMENT_TOP;var n=this._host._getGlobalViewport(),r=s.P.Project(t,s.y3.Identity(),i.getTransformMatrix(),n);this._moveToProjectedPosition(r),r.z<0||r.z>1?this.notRenderable=!0:this.notRenderable=!1}else l.w1.Error("Cannot move a control to a vector3 if the control is not at root level")},e.prototype.getDescendantsToRef=function(e,t,i){void 0===t&&(t=!1)},e.prototype.getDescendants=function(e,t){var i=new Array;return this.getDescendantsToRef(i,e,t),i},e.prototype.linkWithMesh=function(t){if(!this._host||this.parent&&this.parent!==this._host._rootContainer)t&&l.w1.Error("Cannot link a control to a mesh if the control is not at root level");else{var i=this._host._linkedControls.indexOf(this);if(-1!==i)return this._linkedMesh=t,void(t||this._host._linkedControls.splice(i,1));t&&(this.horizontalAlignment=e.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=e.VERTICAL_ALIGNMENT_TOP,this._linkedMesh=t,this._host._linkedControls.push(this))}},e.prototype.setPadding=function(e,t,i,n){var r=e,o=null!=t?t:r,s=null!=i?i:r,a=null!=n?n:o;this.paddingTop=r,this.paddingRight=o,this.paddingBottom=s,this.paddingLeft=a},e.prototype.setPaddingInPixels=function(e,t,i,n){var r=e,o=null!=t?t:r,s=null!=i?i:r,a=null!=n?n:o;this.paddingTopInPixels=r,this.paddingRightInPixels=o,this.paddingBottomInPixels=s,this.paddingLeftInPixels=a},e.prototype._moveToProjectedPosition=function(e){var t=this._left.getValue(this._host),i=this._top.getValue(this._host),n=e.x+this._linkOffsetX.getValue(this._host)-this._currentMeasure.width/2,r=e.y+this._linkOffsetY.getValue(this._host)-this._currentMeasure.height/2;this._left.ignoreAdaptiveScaling&&this._top.ignoreAdaptiveScaling&&(Math.abs(n-t)<.5&&(n=t),Math.abs(r-i)<.5&&(r=i)),this.left=n+"px",this.top=r+"px",this._left.ignoreAdaptiveScaling=!0,this._top.ignoreAdaptiveScaling=!0,this._markAsDirty()},e.prototype._offsetLeft=function(e){this._isDirty=!0,this._currentMeasure.left+=e},e.prototype._offsetTop=function(e){this._isDirty=!0,this._currentMeasure.top+=e},e.prototype._markMatrixAsDirty=function(){this._isMatrixDirty=!0,this._flagDescendantsAsMatrixDirty()},e.prototype._flagDescendantsAsMatrixDirty=function(){},e.prototype._intersectsRect=function(e){return this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),!(this._tmpMeasureA.left>=e.left+e.width||this._tmpMeasureA.top>=e.top+e.height||this._tmpMeasureA.left+this._tmpMeasureA.width<=e.left||this._tmpMeasureA.top+this._tmpMeasureA.height<=e.top)},e.prototype.invalidateRect=function(){if(this._transform(),this.host&&this.host.useInvalidateRectOptimization){this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),d.CombineToRef(this._tmpMeasureA,this._prevCurrentMeasureTransformedIntoGlobalSpace,this._tmpMeasureA);var e=this.shadowOffsetX,t=this.shadowOffsetY,i=Math.max(this._previousShadowBlur,this.shadowBlur),n=Math.min(Math.min(e,0)-2*i,0),r=Math.max(Math.max(e,0)+2*i,0),o=Math.min(Math.min(t,0)-2*i,0),s=Math.max(Math.max(t,0)+2*i,0);this.host.invalidateRect(Math.floor(this._tmpMeasureA.left+n),Math.floor(this._tmpMeasureA.top+o),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width+r),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height+s))}},e.prototype._markAsDirty=function(e){void 0===e&&(e=!1),(this._isVisible||e)&&(this._isDirty=!0,this._host&&this._host.markAsDirty())},e.prototype._markAllAsDirty=function(){this._markAsDirty(),this._font&&this._prepareFont()},e.prototype._link=function(e){this._host=e,this._host&&(this.uniqueId=this._host.getScene().getUniqueId())},e.prototype._transform=function(e){if(this._isMatrixDirty||1!==this._scaleX||1!==this._scaleY||0!==this._rotation){var t=this._currentMeasure.width*this._transformCenterX+this._currentMeasure.left,i=this._currentMeasure.height*this._transformCenterY+this._currentMeasure.top;e&&(e.translate(t,i),e.rotate(this._rotation),e.scale(this._scaleX,this._scaleY),e.translate(-t,-i)),(this._isMatrixDirty||this._cachedOffsetX!==t||this._cachedOffsetY!==i)&&(this._cachedOffsetX=t,this._cachedOffsetY=i,this._isMatrixDirty=!1,this._flagDescendantsAsMatrixDirty(),m.ComposeToRef(-t,-i,this._rotation,this._scaleX,this._scaleY,this.parent?this.parent._transformMatrix:null,this._transformMatrix),this._transformMatrix.invertToRef(this._invertTransformMatrix))}},e.prototype._renderHighlight=function(e){this.isHighlighted&&(e.save(),e.strokeStyle="#4affff",e.lineWidth=this._highlightLineWidth,this._renderHighlightSpecific(e),e.restore())},e.prototype._renderHighlightSpecific=function(e){e.strokeRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)},e.prototype._applyStates=function(t){this._isFontSizeInPercentage&&(this._fontSet=!0),this._fontSet&&(this._prepareFont(),this._fontSet=!1),this._font&&(t.font=this._font),this._color&&(t.fillStyle=this._color),e.AllowAlphaInheritance?t.globalAlpha*=this._alpha:this._alphaSet&&(t.globalAlpha=this.parent&&!this.parent.renderToIntermediateTexture?this.parent.alpha*this._alpha:this._alpha)},e.prototype._layout=function(e,t){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;if(this._isDirty||!this._cachedParentMeasure.isEqualsTo(e)){this.host._numLayoutCalls++,this._currentMeasure.addAndTransformToRef(this._transformMatrix,0|-this.paddingLeftInPixels,0|-this.paddingTopInPixels,0|this.paddingRightInPixels,0|this.paddingBottomInPixels,this._prevCurrentMeasureTransformedIntoGlobalSpace),t.save(),this._applyStates(t);var i=0;do{this._rebuildLayout=!1,this._processMeasures(e,t),i++}while(this._rebuildLayout&&i<3);i>=3&&r.Y.Error("Layout cycle detected in GUI (Control name="+this.name+", uniqueId="+this.uniqueId+")"),t.restore(),this.invalidateRect(),this._evaluateClippingState(e)}return this._wasDirty=this._isDirty,this._isDirty=!1,!0},e.prototype._processMeasures=function(e,t){this._currentMeasure.copyFrom(e),this._preMeasure(e,t),this._measure(),this._computeAlignment(e,t),this._currentMeasure.left=0|this._currentMeasure.left,this._currentMeasure.top=0|this._currentMeasure.top,this._currentMeasure.width=0|this._currentMeasure.width,this._currentMeasure.height=0|this._currentMeasure.height,this._additionalProcessing(e,t),this._cachedParentMeasure.copyFrom(e),this.onDirtyObservable.hasObservers()&&this.onDirtyObservable.notifyObservers(this)},e.prototype._evaluateClippingState=function(e){if(this.parent&&this.parent.clipChildren){if(this._currentMeasure.left>e.left+e.width)return void(this._isClipped=!0);if(this._currentMeasure.left+this._currentMeasure.width<e.left)return void(this._isClipped=!0);if(this._currentMeasure.top>e.top+e.height)return void(this._isClipped=!0);if(this._currentMeasure.top+this._currentMeasure.height<e.top)return void(this._isClipped=!0)}this._isClipped=!1},e.prototype._measure=function(){this._width.isPixel?this._currentMeasure.width=this._width.getValue(this._host):this._currentMeasure.width*=this._width.getValue(this._host),this._height.isPixel?this._currentMeasure.height=this._height.getValue(this._host):this._currentMeasure.height*=this._height.getValue(this._host),0!==this.fixedRatio&&(this._fixedRatioMasterIsWidth?this._currentMeasure.height=this._currentMeasure.width*this.fixedRatio:this._currentMeasure.width=this._currentMeasure.height*this.fixedRatio)},e.prototype._computeAlignment=function(t,i){var n=this._currentMeasure.width,r=this._currentMeasure.height,o=t.width,s=t.height,a=0,l=0;switch(this.horizontalAlignment){case e.HORIZONTAL_ALIGNMENT_LEFT:a=0;break;case e.HORIZONTAL_ALIGNMENT_RIGHT:a=o-n;break;case e.HORIZONTAL_ALIGNMENT_CENTER:a=(o-n)/2}switch(this.verticalAlignment){case e.VERTICAL_ALIGNMENT_TOP:l=0;break;case e.VERTICAL_ALIGNMENT_BOTTOM:l=s-r;break;case e.VERTICAL_ALIGNMENT_CENTER:l=(s-r)/2}this._paddingLeft.isPixel?(this._currentMeasure.left+=this._paddingLeft.getValue(this._host),this._currentMeasure.width-=this._paddingLeft.getValue(this._host)):(this._currentMeasure.left+=o*this._paddingLeft.getValue(this._host),this._currentMeasure.width-=o*this._paddingLeft.getValue(this._host)),this._paddingRight.isPixel?this._currentMeasure.width-=this._paddingRight.getValue(this._host):this._currentMeasure.width-=o*this._paddingRight.getValue(this._host),this._paddingTop.isPixel?(this._currentMeasure.top+=this._paddingTop.getValue(this._host),this._currentMeasure.height-=this._paddingTop.getValue(this._host)):(this._currentMeasure.top+=s*this._paddingTop.getValue(this._host),this._currentMeasure.height-=s*this._paddingTop.getValue(this._host)),this._paddingBottom.isPixel?this._currentMeasure.height-=this._paddingBottom.getValue(this._host):this._currentMeasure.height-=s*this._paddingBottom.getValue(this._host),this._left.isPixel?this._currentMeasure.left+=this._left.getValue(this._host):this._currentMeasure.left+=o*this._left.getValue(this._host),this._top.isPixel?this._currentMeasure.top+=this._top.getValue(this._host):this._currentMeasure.top+=s*this._top.getValue(this._host),this._currentMeasure.left+=a,this._currentMeasure.top+=l},e.prototype._preMeasure=function(e,t){},e.prototype._additionalProcessing=function(e,t){},e.prototype._clipForChildren=function(e){},e.prototype._clip=function(t,i){if(t.beginPath(),e._ClipMeasure.copyFrom(this._currentMeasure),i){i.transformToRef(this._invertTransformMatrix,this._tmpMeasureA);var n=new d(0,0,0,0);n.left=Math.max(this._tmpMeasureA.left,this._currentMeasure.left),n.top=Math.max(this._tmpMeasureA.top,this._currentMeasure.top),n.width=Math.min(this._tmpMeasureA.left+this._tmpMeasureA.width,this._currentMeasure.left+this._currentMeasure.width)-n.left,n.height=Math.min(this._tmpMeasureA.top+this._tmpMeasureA.height,this._currentMeasure.top+this._currentMeasure.height)-n.top,e._ClipMeasure.copyFrom(n)}if(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){var r=this.shadowOffsetX,o=this.shadowOffsetY,s=this.shadowBlur,a=Math.min(Math.min(r,0)-2*s,0),l=Math.max(Math.max(r,0)+2*s,0),h=Math.min(Math.min(o,0)-2*s,0),u=Math.max(Math.max(o,0)+2*s,0);t.rect(e._ClipMeasure.left+a,e._ClipMeasure.top+h,e._ClipMeasure.width+l-a,e._ClipMeasure.height+u-h)}else t.rect(e._ClipMeasure.left,e._ClipMeasure.top,e._ClipMeasure.width,e._ClipMeasure.height);t.clip()},e.prototype._render=function(e,t){return!this.isVisible||this.notRenderable||this._isClipped?(this._isDirty=!1,!1):(this.host._numRenderCalls++,e.save(),this._applyStates(e),this._transform(e),this.clipContent&&this._clip(e,t),this.onBeforeDrawObservable.hasObservers()&&this.onBeforeDrawObservable.notifyObservers(this),this.useBitmapCache&&!this._wasDirty&&this._cacheData?e.putImageData(this._cacheData,this._currentMeasure.left,this._currentMeasure.top):this._draw(e,t),this.useBitmapCache&&this._wasDirty&&(this._cacheData=e.getImageData(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._renderHighlight(e),this.onAfterDrawObservable.hasObservers()&&this.onAfterDrawObservable.notifyObservers(this),e.restore(),!0)},e.prototype._draw=function(e,t){},e.prototype.contains=function(e,t){return this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y,!(e<this._currentMeasure.left||e>this._currentMeasure.left+this._currentMeasure.width||t<this._currentMeasure.top||t>this._currentMeasure.top+this._currentMeasure.height||(this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),0))},e.prototype._processPicking=function(e,t,i,n,r,o,s,a){return!(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this._doNotRender||!this.contains(e,t)||(this._processObservables(n,e,t,i,r,o,s,a),0))},e.prototype._onPointerMove=function(e,t,i,n){this.onPointerMoveObservable.notifyObservers(t,-1,e,this,n)&&null!=this.parent&&this.parent._onPointerMove(e,t,i,n)},e.prototype._onPointerEnter=function(e,t){return!(!this._isEnabled||this._enterCount>0||(-1===this._enterCount&&(this._enterCount=0),this._enterCount++,this.onPointerEnterObservable.notifyObservers(this,-1,e,this,t)&&null!=this.parent&&this.parent._onPointerEnter(e,t),0))},e.prototype._onPointerOut=function(e,t,i){if(void 0===i&&(i=!1),i||this._isEnabled&&e!==this){this._enterCount=0;var n=!0;e.isAscendant(this)||(n=this.onPointerOutObservable.notifyObservers(this,-1,e,this,t)),n&&null!=this.parent&&this.parent._onPointerOut(e,t,i)}},e.prototype._onPointerDown=function(e,t,i,n,r){return this._onPointerEnter(this,r),0===this._downCount&&(this._downCount++,this._downPointerIds[i]=!0,this.onPointerDownObservable.notifyObservers(new g(t,n),-1,e,this,r)&&null!=this.parent&&this.parent._onPointerDown(e,t,i,n,r),!0)},e.prototype._onPointerUp=function(e,t,i,n,r,o){if(this._isEnabled){this._downCount=0,delete this._downPointerIds[i];var s=r;r&&(this._enterCount>0||-1===this._enterCount)&&(s=this.onPointerClickObservable.notifyObservers(new g(t,n),-1,e,this,o)),this.onPointerUpObservable.notifyObservers(new g(t,n),-1,e,this,o)&&null!=this.parent&&this.parent._onPointerUp(e,t,i,n,s,o)}},e.prototype._forcePointerUp=function(e){if(void 0===e&&(e=null),null!==e)this._onPointerUp(this,s.FM.Zero(),e,0,!0);else for(var t in this._downPointerIds)this._onPointerUp(this,s.FM.Zero(),+t,0,!0)},e.prototype._onWheelScroll=function(e,t){this._isEnabled&&this.onWheelObservable.notifyObservers(new s.FM(e,t))&&null!=this.parent&&this.parent._onWheelScroll(e,t)},e.prototype._onCanvasBlur=function(){},e.prototype._processObservables=function(e,t,i,n,r,o,s,l){if(!this._isEnabled)return!1;if(this._dummyVector2.copyFromFloats(t,i),e===a.kD.POINTERMOVE){this._onPointerMove(this,this._dummyVector2,r,n);var h=this._host._lastControlOver[r];return h&&h!==this&&h._onPointerOut(this,n),h!==this&&this._onPointerEnter(this,n),this._host._lastControlOver[r]=this,!0}return e===a.kD.POINTERDOWN?(this._onPointerDown(this,this._dummyVector2,r,o,n),this._host._registerLastControlDown(this,r),this._host._lastPickedControl=this,!0):e===a.kD.POINTERUP?(this._host._lastControlDown[r]&&this._host._lastControlDown[r]._onPointerUp(this,this._dummyVector2,r,o,!0,n),delete this._host._lastControlDown[r],!0):!(e!==a.kD.POINTERWHEEL||!this._host._lastControlOver[r]||(this._host._lastControlOver[r]._onWheelScroll(s,l),0))},e.prototype._prepareFont=function(){(this._font||this._fontSet)&&(this._style?this._font=this._style.fontStyle+" "+this._style.fontWeight+" "+this.fontSizeInPixels+"px "+this._style.fontFamily:this._font=this._fontStyle+" "+this._fontWeight+" "+this.fontSizeInPixels+"px "+this._fontFamily,this._fontOffset=e._GetFontOffset(this._font))},e.prototype.serialize=function(e){b.p4.Serialize(this,e),e.name=this.name,e.className=this.getClassName(),this._font&&(e.fontFamily=this.fontFamily,e.fontSize=this.fontSize,e.fontWeight=this.fontWeight,e.fontStyle=this.fontStyle)},e.prototype._parseFromContent=function(e,t){e.fontFamily&&(this.fontFamily=e.fontFamily),e.fontSize&&(this.fontSize=e.fontSize),e.fontWeight&&(this.fontWeight=e.fontWeight),e.fontStyle&&(this.fontStyle=e.fontStyle)},e.prototype.dispose=function(){this.onDirtyObservable.clear(),this.onBeforeDrawObservable.clear(),this.onAfterDrawObservable.clear(),this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this.onWheelObservable.clear(),this._styleObserver&&this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this.parent&&(this.parent.removeControl(this),this.parent=null),this._host&&this._host._linkedControls.indexOf(this)>-1&&this.linkWithMesh(null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},Object.defineProperty(e,"HORIZONTAL_ALIGNMENT_LEFT",{get:function(){return e._HORIZONTAL_ALIGNMENT_LEFT},enumerable:!1,configurable:!0}),Object.defineProperty(e,"HORIZONTAL_ALIGNMENT_RIGHT",{get:function(){return e._HORIZONTAL_ALIGNMENT_RIGHT},enumerable:!1,configurable:!0}),Object.defineProperty(e,"HORIZONTAL_ALIGNMENT_CENTER",{get:function(){return e._HORIZONTAL_ALIGNMENT_CENTER},enumerable:!1,configurable:!0}),Object.defineProperty(e,"VERTICAL_ALIGNMENT_TOP",{get:function(){return e._VERTICAL_ALIGNMENT_TOP},enumerable:!1,configurable:!0}),Object.defineProperty(e,"VERTICAL_ALIGNMENT_BOTTOM",{get:function(){return e._VERTICAL_ALIGNMENT_BOTTOM},enumerable:!1,configurable:!0}),Object.defineProperty(e,"VERTICAL_ALIGNMENT_CENTER",{get:function(){return e._VERTICAL_ALIGNMENT_CENTER},enumerable:!1,configurable:!0}),e._GetFontOffset=function(t){if(e._FontHeightSizes[t])return e._FontHeightSizes[t];var i=y.D.LastCreatedEngine;if(!i)throw new Error("Invalid engine. Unable to create a canvas.");var n=i.getFontOffset(t);return e._FontHeightSizes[t]=n,n},e.Parse=function(e,t){var i=l.w1.Instantiate("BABYLON.GUI."+e.className),n=b.p4.Parse((function(){return new i}),e,null);return n.name=e.name,n._parseFromContent(e,t),n},e.drawEllipse=function(e,t,i,n,r){r.translate(e,t),r.scale(i,n),r.beginPath(),r.arc(0,0,1,0,2*Math.PI),r.closePath(),r.scale(1/i,1/n),r.translate(-e,-t)},e.AllowAlphaInheritance=!1,e._ClipMeasure=new d(0,0,0,0),e._HORIZONTAL_ALIGNMENT_LEFT=0,e._HORIZONTAL_ALIGNMENT_RIGHT=1,e._HORIZONTAL_ALIGNMENT_CENTER=2,e._VERTICAL_ALIGNMENT_TOP=0,e._VERTICAL_ALIGNMENT_BOTTOM=1,e._VERTICAL_ALIGNMENT_CENTER=2,e._FontHeightSizes={},e.AddHeader=function(){},(0,n.gn)([(0,b.qC)()],e.prototype,"metadata",void 0),(0,n.gn)([(0,b.qC)()],e.prototype,"isHitTestVisible",void 0),(0,n.gn)([(0,b.qC)()],e.prototype,"isPointerBlocker",void 0),(0,n.gn)([(0,b.qC)()],e.prototype,"isFocusInvisible",void 0),(0,n.gn)([(0,b.qC)()],e.prototype,"clipChildren",void 0),(0,n.gn)([(0,b.qC)()],e.prototype,"clipContent",void 0),(0,n.gn)([(0,b.qC)()],e.prototype,"useBitmapCache",void 0),(0,n.gn)([(0,b.qC)()],e.prototype,"shadowOffsetX",null),(0,n.gn)([(0,b.qC)()],e.prototype,"shadowOffsetY",null),(0,n.gn)([(0,b.qC)()],e.prototype,"shadowBlur",null),(0,n.gn)([(0,b.qC)()],e.prototype,"shadowColor",null),(0,n.gn)([(0,b.qC)()],e.prototype,"hoverCursor",void 0),(0,n.gn)([(0,b.qC)()],e.prototype,"fontOffset",null),(0,n.gn)([(0,b.qC)()],e.prototype,"alpha",null),(0,n.gn)([(0,b.qC)()],e.prototype,"scaleX",null),(0,n.gn)([(0,b.qC)()],e.prototype,"scaleY",null),(0,n.gn)([(0,b.qC)()],e.prototype,"rotation",null),(0,n.gn)([(0,b.qC)()],e.prototype,"transformCenterY",null),(0,n.gn)([(0,b.qC)()],e.prototype,"transformCenterX",null),(0,n.gn)([(0,b.qC)()],e.prototype,"horizontalAlignment",null),(0,n.gn)([(0,b.qC)()],e.prototype,"verticalAlignment",null),(0,n.gn)([(0,b.qC)()],e.prototype,"fixedRatio",void 0),(0,n.gn)([(0,b.qC)()],e.prototype,"width",null),(0,n.gn)([(0,b.qC)()],e.prototype,"height",null),(0,n.gn)([(0,b.qC)()],e.prototype,"style",null),(0,n.gn)([(0,b.qC)()],e.prototype,"color",null),(0,n.gn)([(0,b.qC)()],e.prototype,"zIndex",null),(0,n.gn)([(0,b.qC)()],e.prototype,"notRenderable",null),(0,n.gn)([(0,b.qC)()],e.prototype,"isVisible",null),(0,n.gn)([(0,b.qC)()],e.prototype,"paddingLeft",null),(0,n.gn)([(0,b.qC)()],e.prototype,"paddingRight",null),(0,n.gn)([(0,b.qC)()],e.prototype,"paddingTop",null),(0,n.gn)([(0,b.qC)()],e.prototype,"paddingBottom",null),(0,n.gn)([(0,b.qC)()],e.prototype,"left",null),(0,n.gn)([(0,b.qC)()],e.prototype,"top",null),(0,n.gn)([(0,b.qC)()],e.prototype,"linkOffsetX",null),(0,n.gn)([(0,b.qC)()],e.prototype,"linkOffsetY",null),(0,n.gn)([(0,b.qC)()],e.prototype,"isEnabled",null),(0,n.gn)([(0,b.qC)()],e.prototype,"disabledColor",null),(0,n.gn)([(0,b.qC)()],e.prototype,"disabledColorItem",null),e}();v.Q.RegisteredTypes["BABYLON.GUI.Control"]=x;var P=i(7918),C=i(1263),T=i(322),S=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i._children=new Array,i._measureForChildren=d.Empty(),i._background="",i._adaptWidthToChildren=!1,i._adaptHeightToChildren=!1,i._renderToIntermediateTexture=!1,i._intermediateTexture=null,i.logLayoutCycleErrors=!1,i.maxLayoutCycle=3,i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"renderToIntermediateTexture",{get:function(){return this._renderToIntermediateTexture},set:function(e){this._renderToIntermediateTexture!==e&&(this._renderToIntermediateTexture=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"adaptHeightToChildren",{get:function(){return this._adaptHeightToChildren},set:function(e){this._adaptHeightToChildren!==e&&(this._adaptHeightToChildren=e,e&&(this.height="100%"),this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"adaptWidthToChildren",{get:function(){return this._adaptWidthToChildren},set:function(e){this._adaptWidthToChildren!==e&&(this._adaptWidthToChildren=e,e&&(this.width="100%"),this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._children},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"Container"},t.prototype._flagDescendantsAsMatrixDirty=function(){for(var e=0,t=this.children;e<t.length;e++)t[e]._markMatrixAsDirty()},t.prototype.getChildByName=function(e){for(var t=0,i=this.children;t<i.length;t++){var n=i[t];if(n.name===e)return n}return null},t.prototype.getChildByType=function(e,t){for(var i=0,n=this.children;i<n.length;i++){var r=n[i];if(r.typeName===t)return r}return null},t.prototype.containsControl=function(e){return-1!==this.children.indexOf(e)},t.prototype.addControl=function(e){return e?(-1!==this._children.indexOf(e)||(e._link(this._host),e._markAllAsDirty(),this._reOrderControl(e),this._markAsDirty()),this):this},t.prototype.clearControls=function(){for(var e=0,t=this.children.slice();e<t.length;e++){var i=t[e];this.removeControl(i)}return this},t.prototype.removeControl=function(e){var t=this._children.indexOf(e);return-1!==t&&(this._children.splice(t,1),e.parent=null),e.linkWithMesh(null),this._host&&this._host._cleanControlAfterRemoval(e),this._markAsDirty(),this},t.prototype._reOrderControl=function(e){this.removeControl(e);for(var t=!1,i=0;i<this._children.length;i++)if(this._children[i].zIndex>e.zIndex){this._children.splice(i,0,e),t=!0;break}t||this._children.push(e),e.parent=this,this._markAsDirty()},t.prototype._offsetLeft=function(t){e.prototype._offsetLeft.call(this,t);for(var i=0,n=this._children;i<n.length;i++)n[i]._offsetLeft(t)},t.prototype._offsetTop=function(t){e.prototype._offsetTop.call(this,t);for(var i=0,n=this._children;i<n.length;i++)n[i]._offsetTop(t)},t.prototype._markAllAsDirty=function(){e.prototype._markAllAsDirty.call(this);for(var t=0;t<this._children.length;t++)this._children[t]._markAllAsDirty()},t.prototype._localDraw=function(e){this._background&&(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),e.fillStyle=this._background,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),e.restore())},t.prototype._link=function(t){e.prototype._link.call(this,t);for(var i=0,n=this._children;i<n.length;i++)n[i]._link(t)},t.prototype._beforeLayout=function(){},t.prototype._processMeasures=function(t,i){!this._isDirty&&this._cachedParentMeasure.isEqualsTo(t)||(e.prototype._processMeasures.call(this,t,i),this._evaluateClippingState(t),this._renderToIntermediateTexture&&(this._intermediateTexture&&this._host.getScene()!=this._intermediateTexture.getScene()&&(this._intermediateTexture.dispose(),this._intermediateTexture=null),this._intermediateTexture?this._intermediateTexture.scaleTo(this._currentMeasure.width,this._currentMeasure.height):(this._intermediateTexture=new P.c("",{width:this._currentMeasure.width,height:this._currentMeasure.height},this._host.getScene(),!1,C.x.NEAREST_SAMPLINGMODE,T.g.TEXTUREFORMAT_RGBA,!1),this._intermediateTexture.hasAlpha=!0)))},t.prototype._layout=function(e,t){var i,n;if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;this.host._numLayoutCalls++,this._isDirty&&this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace);var o=0;t.save(),this._applyStates(t),this._beforeLayout();do{var s=-1,a=-1;if(this._rebuildLayout=!1,this._processMeasures(e,t),!this._isClipped){for(var l=0,h=this._children;l<h.length;l++){var u=h[l];u._tempParentMeasure.copyFrom(this._measureForChildren),u._layout(this._measureForChildren,t)&&(this.adaptWidthToChildren&&u._width.isPixel&&(s=Math.max(s,u._currentMeasure.width+u.paddingLeftInPixels+u.paddingRightInPixels)),this.adaptHeightToChildren&&u._height.isPixel&&(a=Math.max(a,u._currentMeasure.height+u.paddingTopInPixels+u.paddingBottomInPixels)))}this.adaptWidthToChildren&&s>=0&&(s+=this.paddingLeftInPixels+this.paddingRightInPixels,this.width!==s+"px"&&(null===(i=this.parent)||void 0===i||i._markAsDirty(),this.width=s+"px",this._rebuildLayout=!0)),this.adaptHeightToChildren&&a>=0&&(a+=this.paddingTopInPixels+this.paddingBottomInPixels,this.height!==a+"px"&&(null===(n=this.parent)||void 0===n||n._markAsDirty(),this.height=a+"px",this._rebuildLayout=!0)),this._postMeasure()}o++}while(this._rebuildLayout&&o<this.maxLayoutCycle);return o>=3&&this.logLayoutCycleErrors&&r.Y.Error("Layout cycle detected in GUI (Container name="+this.name+", uniqueId="+this.uniqueId+")"),t.restore(),this._isDirty&&(this.invalidateRect(),this._isDirty=!1),!0},t.prototype._postMeasure=function(){},t.prototype._draw=function(e,t){var i=this._renderToIntermediateTexture&&this._intermediateTexture,n=i?this._intermediateTexture.getContext():e;i&&(n.save(),n.translate(-this._currentMeasure.left,-this._currentMeasure.top),t?n.clearRect(t.left,t.top,t.width,t.height):n.clearRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._localDraw(n),this.clipChildren&&this._clipForChildren(n);for(var r=0,o=this._children;r<o.length;r++){var s=o[r];t&&!s._intersectsRect(t)||s._render(n,t)}i&&(n.restore(),e.save(),e.globalAlpha=this.alpha,e.drawImage(n.canvas,this._currentMeasure.left,this._currentMeasure.top),e.restore())},t.prototype.getDescendantsToRef=function(e,t,i){if(void 0===t&&(t=!1),this.children)for(var n=0;n<this.children.length;n++){var r=this.children[n];i&&!i(r)||e.push(r),t||r.getDescendantsToRef(e,!1,i)}},t.prototype._processPicking=function(t,i,n,r,o,s,a,l){if(!this._isEnabled||!this.isVisible||this.notRenderable)return!1;if(!e.prototype.contains.call(this,t,i))return!1;for(var h=this._children.length-1;h>=0;h--){var u=this._children[h];if(u._processPicking(t,i,n,r,o,s,a,l))return u.hoverCursor&&this._host._changeCursor(u.hoverCursor),!0}return!!this.isHitTestVisible&&this._processObservables(r,t,i,n,o,s,a,l)},t.prototype._additionalProcessing=function(t,i){e.prototype._additionalProcessing.call(this,t,i),this._measureForChildren.copyFrom(this._currentMeasure)},t.prototype.serialize=function(t){if(e.prototype.serialize.call(this,t),this.children.length){t.children=[];for(var i=0,n=this.children;i<n.length;i++){var r={};n[i].serialize(r),t.children.push(r)}}},t.prototype.dispose=function(){var t;e.prototype.dispose.call(this);for(var i=this.children.length-1;i>=0;i--)this.children[i].dispose();null===(t=this._intermediateTexture)||void 0===t||t.dispose()},t.prototype._parseFromContent=function(t,i){if(e.prototype._parseFromContent.call(this,t,i),this._link(i),t.children)for(var n=0,r=t.children;n<r.length;n++){var o=r[n];this.addControl(x.Parse(o,i))}},(0,n.gn)([(0,b.qC)()],t.prototype,"renderToIntermediateTexture",null),(0,n.gn)([(0,b.qC)()],t.prototype,"maxLayoutCycle",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"adaptHeightToChildren",null),(0,n.gn)([(0,b.qC)()],t.prototype,"adaptWidthToChildren",null),(0,n.gn)([(0,b.qC)()],t.prototype,"background",null),t}(x);v.Q.RegisteredTypes["BABYLON.GUI.Container"]=S;var O,E=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i._thickness=1,i._cornerRadius=0,i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cornerRadius",{get:function(){return this._cornerRadius},set:function(e){e<0&&(e=0),this._cornerRadius!==e&&(this._cornerRadius=e,this._markAsDirty())},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"Rectangle"},t.prototype._localDraw=function(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._background&&(e.fillStyle="Button"===this.typeName?this.isEnabled?this._background:this.disabledColor:this._background,this._cornerRadius?(this._drawRoundedRect(e,this._thickness/2),e.fill()):e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._thickness&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,this._cornerRadius?(this._drawRoundedRect(e,this._thickness/2),e.stroke()):e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),e.restore()},t.prototype._additionalProcessing=function(t,i){e.prototype._additionalProcessing.call(this,t,i),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness},t.prototype._drawRoundedRect=function(e,t){void 0===t&&(t=0);var i=this._currentMeasure.left+t,n=this._currentMeasure.top+t,r=this._currentMeasure.width-2*t,o=this._currentMeasure.height-2*t,s=Math.min(o/2-2,Math.min(r/2-2,this._cornerRadius));e.beginPath(),e.moveTo(i+s,n),e.lineTo(i+r-s,n),e.quadraticCurveTo(i+r,n,i+r,n+s),e.lineTo(i+r,n+o-s),e.quadraticCurveTo(i+r,n+o,i+r-s,n+o),e.lineTo(i+s,n+o),e.quadraticCurveTo(i,n+o,i,n+o-s),e.lineTo(i,n+s),e.quadraticCurveTo(i,n,i+s,n),e.closePath()},t.prototype._clipForChildren=function(e){this._cornerRadius&&(this._drawRoundedRect(e,this._thickness),e.clip())},(0,n.gn)([(0,b.qC)()],t.prototype,"thickness",null),(0,n.gn)([(0,b.qC)()],t.prototype,"cornerRadius",null),t}(S);v.Q.RegisteredTypes["BABYLON.GUI.Rectangle"]=E,function(e){e[e.Clip=0]="Clip",e[e.WordWrap=1]="WordWrap",e[e.Ellipsis=2]="Ellipsis"}(O||(O={}));var M=function(e){function t(t,i){void 0===i&&(i="");var n=e.call(this,t)||this;return n.name=t,n._text="",n._textWrapping=O.Clip,n._textHorizontalAlignment=x.HORIZONTAL_ALIGNMENT_CENTER,n._textVerticalAlignment=x.VERTICAL_ALIGNMENT_CENTER,n._resizeToFit=!1,n._lineSpacing=new h(0),n._outlineWidth=0,n._outlineColor="white",n._underline=!1,n._lineThrough=!1,n.onTextChangedObservable=new o.y$,n.onLinesReadyObservable=new o.y$,n.text=i,n}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"lines",{get:function(){return this._lines},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resizeToFit",{get:function(){return this._resizeToFit},set:function(e){this._resizeToFit!==e&&(this._resizeToFit=e,this._resizeToFit&&(this._width.ignoreAdaptiveScaling=!0,this._height.ignoreAdaptiveScaling=!0),this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textWrapping",{get:function(){return this._textWrapping},set:function(e){this._textWrapping!==e&&(this._textWrapping=+e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){this._text!==e&&(this._text=e,this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textHorizontalAlignment",{get:function(){return this._textHorizontalAlignment},set:function(e){this._textHorizontalAlignment!==e&&(this._textHorizontalAlignment=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textVerticalAlignment",{get:function(){return this._textVerticalAlignment},set:function(e){this._textVerticalAlignment!==e&&(this._textVerticalAlignment=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineSpacing",{get:function(){return this._lineSpacing.toString(this._host)},set:function(e){this._lineSpacing.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"outlineWidth",{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth!==e&&(this._outlineWidth=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"underline",{get:function(){return this._underline},set:function(e){this._underline!==e&&(this._underline=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineThrough",{get:function(){return this._lineThrough},set:function(e){this._lineThrough!==e&&(this._lineThrough=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(e){this._outlineColor!==e&&(this._outlineColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"TextBlock"},t.prototype._processMeasures=function(t,i){this._fontOffset||(this._fontOffset=x._GetFontOffset(i.font)),e.prototype._processMeasures.call(this,t,i),this._lines=this._breakLines(this._currentMeasure.width,i),this.onLinesReadyObservable.notifyObservers(this);for(var n=0,r=0;r<this._lines.length;r++){var o=this._lines[r];o.width>n&&(n=o.width)}if(this._resizeToFit){if(this._textWrapping===O.Clip){var s=this.paddingLeftInPixels+this.paddingRightInPixels+n|0;s!==this._width.internalValue&&(this._width.updateInPlace(s,h.UNITMODE_PIXEL),this._rebuildLayout=!0)}var a=this.paddingTopInPixels+this.paddingBottomInPixels+this._fontOffset.height*this._lines.length|0;if(this._lines.length>0&&0!==this._lineSpacing.internalValue){var l;l=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),a+=(this._lines.length-1)*l}a!==this._height.internalValue&&(this._height.updateInPlace(a,h.UNITMODE_PIXEL),this._rebuildLayout=!0)}},t.prototype._drawText=function(e,t,i,n){var r=this._currentMeasure.width,o=0;switch(this._textHorizontalAlignment){case x.HORIZONTAL_ALIGNMENT_LEFT:o=0;break;case x.HORIZONTAL_ALIGNMENT_RIGHT:o=r-t;break;case x.HORIZONTAL_ALIGNMENT_CENTER:o=(r-t)/2}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(n.shadowColor=this.shadowColor,n.shadowBlur=this.shadowBlur,n.shadowOffsetX=this.shadowOffsetX,n.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&n.strokeText(e,this._currentMeasure.left+o,i),n.fillText(e,this._currentMeasure.left+o,i),this._underline&&(n.beginPath(),n.lineWidth=Math.round(.05*this.fontSizeInPixels),n.moveTo(this._currentMeasure.left+o,i+3),n.lineTo(this._currentMeasure.left+o+t,i+3),n.stroke(),n.closePath()),this._lineThrough&&(n.beginPath(),n.lineWidth=Math.round(.05*this.fontSizeInPixels),n.moveTo(this._currentMeasure.left+o,i-this.fontSizeInPixels/3),n.lineTo(this._currentMeasure.left+o+t,i-this.fontSizeInPixels/3),n.stroke(),n.closePath())},t.prototype._draw=function(e,t){e.save(),this._applyStates(e),this._renderLines(e),e.restore()},t.prototype._applyStates=function(t){e.prototype._applyStates.call(this,t),this.outlineWidth&&(t.lineWidth=this.outlineWidth,t.strokeStyle=this.outlineColor,t.lineJoin="miter",t.miterLimit=2)},t.prototype._breakLines=function(e,t){var i=[],n=this.text.split("\n");if(this._textWrapping===O.Ellipsis)for(var r=0,o=n;r<o.length;r++){var s=o[r];i.push(this._parseLineEllipsis(s,e,t))}else if(this._textWrapping===O.WordWrap)for(var a=0,l=n;a<l.length;a++)s=l[a],i.push.apply(i,this._parseLineWordWrap(s,e,t));else for(var h=0,u=n;h<u.length;h++)s=u[h],i.push(this._parseLine(s,t));return i},t.prototype._parseLine=function(e,t){return void 0===e&&(e=""),{text:e,width:t.measureText(e).width}},t.prototype._parseLineEllipsis=function(e,t,i){void 0===e&&(e="");var n=i.measureText(e).width;n>t&&(e+="…");var r=Array.from&&Array.from(e);if(r)for(;r.length&&n>t;)r.pop(),e=r.join("")+"...",n=i.measureText(e).width;else for(;e.length>2&&n>t;)e=e.slice(0,-2)+"…",n=i.measureText(e).width;return{text:e,width:n}},t.prototype._parseLineWordWrap=function(e,t,i){void 0===e&&(e="");for(var n=[],r=this.wordSplittingFunction?this.wordSplittingFunction(e):e.split(" "),o=0,s=0;s<r.length;s++){var a=s>0?e+" "+r[s]:r[0],l=i.measureText(a).width;l>t&&s>0?(n.push({text:e,width:o}),e=r[s],o=i.measureText(e).width):(o=l,e=a)}return n.push({text:e,width:o}),n},t.prototype._renderLines=function(e){var t=this._currentMeasure.height,i=0;switch(this._textVerticalAlignment){case x.VERTICAL_ALIGNMENT_TOP:i=this._fontOffset.ascent;break;case x.VERTICAL_ALIGNMENT_BOTTOM:i=t-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case x.VERTICAL_ALIGNMENT_CENTER:i=this._fontOffset.ascent+(t-this._fontOffset.height*this._lines.length)/2}i+=this._currentMeasure.top;for(var n=0;n<this._lines.length;n++){var r=this._lines[n];0!==n&&0!==this._lineSpacing.internalValue&&(this._lineSpacing.isPixel?i+=this._lineSpacing.getValue(this._host):i+=this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(r.text,r.width,i,e),i+=this._fontOffset.height}},t.prototype.computeExpectedHeight=function(){var e;if(this.text&&this.widthInPixels){var t=null===(e=y.D.LastCreatedEngine)||void 0===e?void 0:e.createCanvas(0,0).getContext("2d");if(t){this._applyStates(t),this._fontOffset||(this._fontOffset=x._GetFontOffset(t.font));var i=this._lines?this._lines:this._breakLines(this.widthInPixels-this.paddingLeftInPixels-this.paddingRightInPixels,t),n=this.paddingTopInPixels+this.paddingBottomInPixels+this._fontOffset.height*i.length;if(i.length>0&&0!==this._lineSpacing.internalValue){var r;r=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),n+=(i.length-1)*r}return n}}return 0},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onTextChangedObservable.clear()},(0,n.gn)([(0,b.qC)()],t.prototype,"resizeToFit",null),(0,n.gn)([(0,b.qC)()],t.prototype,"textWrapping",null),(0,n.gn)([(0,b.qC)()],t.prototype,"text",null),(0,n.gn)([(0,b.qC)()],t.prototype,"textHorizontalAlignment",null),(0,n.gn)([(0,b.qC)()],t.prototype,"textVerticalAlignment",null),(0,n.gn)([(0,b.qC)()],t.prototype,"lineSpacing",null),(0,n.gn)([(0,b.qC)()],t.prototype,"outlineWidth",null),(0,n.gn)([(0,b.qC)()],t.prototype,"underline",null),(0,n.gn)([(0,b.qC)()],t.prototype,"lineThrough",null),(0,n.gn)([(0,b.qC)()],t.prototype,"outlineColor",null),t}(x);v.Q.RegisteredTypes["BABYLON.GUI.TextBlock"]=M;var w=function(e){function t(i,n){void 0===n&&(n=null);var r=e.call(this,i)||this;return r.name=i,r._workingCanvas=null,r._loaded=!1,r._stretch=t.STRETCH_FILL,r._autoScale=!1,r._sourceLeft=0,r._sourceTop=0,r._sourceWidth=0,r._sourceHeight=0,r._svgAttributesComputationCompleted=!1,r._isSVG=!1,r._cellWidth=0,r._cellHeight=0,r._cellId=-1,r._populateNinePatchSlicesFromImage=!1,r._imageDataCache={data:null,key:""},r.onImageLoadedObservable=new o.y$,r.onSVGAttributesComputedObservable=new o.y$,r.source=n,r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return this._loaded},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"detectPointerOnOpaqueOnly",{get:function(){return this._detectPointerOnOpaqueOnly},set:function(e){this._detectPointerOnOpaqueOnly!==e&&(this._detectPointerOnOpaqueOnly=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sliceLeft",{get:function(){return this._sliceLeft},set:function(e){this._sliceLeft!==e&&(this._sliceLeft=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sliceRight",{get:function(){return this._sliceRight},set:function(e){this._sliceRight!==e&&(this._sliceRight=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sliceTop",{get:function(){return this._sliceTop},set:function(e){this._sliceTop!==e&&(this._sliceTop=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sliceBottom",{get:function(){return this._sliceBottom},set:function(e){this._sliceBottom!==e&&(this._sliceBottom=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sourceLeft",{get:function(){return this._sourceLeft},set:function(e){this._sourceLeft!==e&&(this._sourceLeft=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sourceTop",{get:function(){return this._sourceTop},set:function(e){this._sourceTop!==e&&(this._sourceTop=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sourceWidth",{get:function(){return this._sourceWidth},set:function(e){this._sourceWidth!==e&&(this._sourceWidth=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sourceHeight",{get:function(){return this._sourceHeight},set:function(e){this._sourceHeight!==e&&(this._sourceHeight=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imageWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imageHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"populateNinePatchSlicesFromImage",{get:function(){return this._populateNinePatchSlicesFromImage},set:function(e){this._populateNinePatchSlicesFromImage!==e&&(this._populateNinePatchSlicesFromImage=e,this._populateNinePatchSlicesFromImage&&this._loaded&&this._extractNinePatchSliceDataFromImage())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isSVG",{get:function(){return this._isSVG},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"svgAttributesComputationCompleted",{get:function(){return this._svgAttributesComputationCompleted},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoScale",{get:function(){return this._autoScale},set:function(e){this._autoScale!==e&&(this._autoScale=e,e&&this._loaded&&this.synchronizeSizeWithContent())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stretch",{get:function(){return this._stretch},set:function(e){this._stretch!==e&&(this._stretch=e,this._markAsDirty())},enumerable:!1,configurable:!0}),t.prototype._rotate90=function(e,i){void 0===i&&(i=!1);var n=this._domImage.width,r=this._domImage.height,o=y.D.LastCreatedEngine;if(!o)throw new Error("Invalid engine. Unable to create a canvas.");var s=o.createCanvas(r,n),a=s.getContext("2d");a.translate(s.width/2,s.height/2),a.rotate(e*Math.PI/2),a.drawImage(this._domImage,0,0,n,r,-n/2,-r/2,n,r);var l=s.toDataURL("image/jpg"),h=new t(this.name+"rotated",l);return i&&(h._stretch=this._stretch,h._autoScale=this._autoScale,h._cellId=this._cellId,h._cellWidth=e%1?this._cellHeight:this._cellWidth,h._cellHeight=e%1?this._cellWidth:this._cellHeight),this._handleRotationForSVGImage(this,h,e),this._imageDataCache.data=null,h},t.prototype._handleRotationForSVGImage=function(e,t,i){var n=this;e._isSVG&&(e._svgAttributesComputationCompleted?(this._rotate90SourceProperties(e,t,i),this._markAsDirty()):e.onSVGAttributesComputedObservable.addOnce((function(){n._rotate90SourceProperties(e,t,i),n._markAsDirty()})))},t.prototype._rotate90SourceProperties=function(e,t,i){var n,r,o=e.sourceLeft,s=e.sourceTop,a=e.domImage.width,l=e.domImage.height,h=o,u=s,c=e.sourceWidth,f=e.sourceHeight;if(0!=i){var _=i<0?-1:1;i%=4;for(var d=0;d<Math.abs(i);++d)h=-(s-l/2)*_+l/2,u=(o-a/2)*_+a/2,c=(n=[f,c])[0],f=n[1],i<0?u-=f:h-=c,o=h,s=u,a=(r=[l,a])[0],l=r[1]}t.sourceLeft=h,t.sourceTop=u,t.sourceWidth=c,t.sourceHeight=f},t.prototype._extractNinePatchSliceDataFromImage=function(){var e=this._domImage.width,t=this._domImage.height;if(!this._workingCanvas){var i=y.D.LastCreatedEngine;if(!i)throw new Error("Invalid engine. Unable to create a canvas.");this._workingCanvas=i.createCanvas(e,t)}var n=this._workingCanvas.getContext("2d");n.drawImage(this._domImage,0,0,e,t);var r=n.getImageData(0,0,e,t);this._sliceLeft=-1,this._sliceRight=-1;for(var o=0;o<e;o++)if((a=r.data[4*o+3])>127&&-1===this._sliceLeft)this._sliceLeft=o;else if(a<127&&this._sliceLeft>-1){this._sliceRight=o;break}this._sliceTop=-1,this._sliceBottom=-1;for(var s=0;s<t;s++){var a;if((a=r.data[s*e*4+3])>127&&-1===this._sliceTop)this._sliceTop=s;else if(a<127&&this._sliceTop>-1){this._sliceBottom=s;break}}},Object.defineProperty(t.prototype,"domImage",{get:function(){return this._domImage},set:function(e){var t=this;this._domImage=e,this._loaded=!1,this._imageDataCache.data=null,this._domImage.width?this._onImageLoaded():this._domImage.onload=function(){t._onImageLoaded()}},enumerable:!1,configurable:!0}),t.prototype._onImageLoaded=function(){this._imageDataCache.data=null,this._imageWidth=this._domImage.width,this._imageHeight=this._domImage.height,this._loaded=!0,this._populateNinePatchSlicesFromImage&&this._extractNinePatchSliceDataFromImage(),this._autoScale&&this.synchronizeSizeWithContent(),this.onImageLoadedObservable.notifyObservers(this),this._markAsDirty()},Object.defineProperty(t.prototype,"source",{get:function(){return this._source},set:function(e){var t=this;this._source!==e&&(this._loaded=!1,this._source=e,this._imageDataCache.data=null,e&&(e=this._svgCheck(e)),this._domImage=document.createElement("img"),this._domImage.onload=function(){t._onImageLoaded()},e&&(l.w1.SetCorsBehavior(e,this._domImage),this._domImage.src=e))},enumerable:!1,configurable:!0}),t.prototype._svgCheck=function(e){var t=this;if(window.SVGSVGElement&&-1!==e.search(/.svg#/gi)&&e.indexOf("#")===e.lastIndexOf("#")){this._isSVG=!0;var i=e.split("#")[0],n=e.split("#")[1],r=document.body.querySelector('object[data="'+i+'"]');if(r){var o=r.contentDocument;if(o&&o.documentElement){var s=o.documentElement.getAttribute("viewBox"),a=Number(o.documentElement.getAttribute("width")),l=Number(o.documentElement.getAttribute("height"));if(o.getElementById(n)&&s&&a&&l)return this._getSVGAttribs(r,n),e}r.addEventListener("load",(function(){t._getSVGAttribs(r,n)}))}else{var h=document.createElement("object");h.data=i,h.type="image/svg+xml",h.width="0%",h.height="0%",document.body.appendChild(h),h.onload=function(){var e=document.body.querySelector('object[data="'+i+'"]');e&&t._getSVGAttribs(e,n)}}return i}return e},t.prototype._getSVGAttribs=function(e,t){var i=e.contentDocument;if(i&&i.documentElement){var n=i.documentElement.getAttribute("viewBox"),r=Number(i.documentElement.getAttribute("width")),o=Number(i.documentElement.getAttribute("height")),s=i.getElementById(t);if(n&&r&&o&&s){var a=Number(n.split(" ")[2]),l=Number(n.split(" ")[3]),h=s.getBBox(),u=1,c=1,f=0,_=0;s.transform&&s.transform.baseVal.consolidate()&&(u=s.transform.baseVal.consolidate().matrix.a,c=s.transform.baseVal.consolidate().matrix.d,f=s.transform.baseVal.consolidate().matrix.e,_=s.transform.baseVal.consolidate().matrix.f),this.sourceLeft=(u*h.x+f)*r/a,this.sourceTop=(c*h.y+_)*o/l,this.sourceWidth=h.width*u*(r/a),this.sourceHeight=h.height*c*(o/l),this._svgAttributesComputationCompleted=!0,this.onSVGAttributesComputedObservable.notifyObservers(this)}}},Object.defineProperty(t.prototype,"cellWidth",{get:function(){return this._cellWidth},set:function(e){this._cellWidth!==e&&(this._cellWidth=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cellHeight",{get:function(){return this._cellHeight},set:function(e){this._cellHeight!==e&&(this._cellHeight=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cellId",{get:function(){return this._cellId},set:function(e){this._cellId!==e&&(this._cellId=e,this._markAsDirty())},enumerable:!1,configurable:!0}),t.prototype.contains=function(t,i){if(!e.prototype.contains.call(this,t,i))return!1;if(!this._detectPointerOnOpaqueOnly||!this._workingCanvas)return!0;var n=0|this._currentMeasure.width,r=0|this._currentMeasure.height,o=n+"_"+r,s=this._imageDataCache.data;if(!s||this._imageDataCache.key!==o){var a=this._workingCanvas.getContext("2d");this._imageDataCache.data=s=a.getImageData(0,0,n,r).data,this._imageDataCache.key=o}return s[4*((t=t-this._currentMeasure.left|0)+(i=i-this._currentMeasure.top|0)*n)+3]>0},t.prototype._getTypeName=function(){return"Image"},t.prototype.synchronizeSizeWithContent=function(){this._loaded&&(this.width=this._domImage.width+"px",this.height=this._domImage.height+"px")},t.prototype._processMeasures=function(i,n){if(this._loaded)switch(this._stretch){case t.STRETCH_NONE:case t.STRETCH_FILL:case t.STRETCH_UNIFORM:case t.STRETCH_NINE_PATCH:break;case t.STRETCH_EXTEND:this._autoScale&&this.synchronizeSizeWithContent(),this.parent&&this.parent.parent&&(this.parent.adaptWidthToChildren=!0,this.parent.adaptHeightToChildren=!0)}e.prototype._processMeasures.call(this,i,n)},t.prototype._prepareWorkingCanvasForOpaqueDetection=function(){if(this._detectPointerOnOpaqueOnly){var e=this._currentMeasure.width,t=this._currentMeasure.height;if(!this._workingCanvas){var i=y.D.LastCreatedEngine;if(!i)throw new Error("Invalid engine. Unable to create a canvas.");this._workingCanvas=i.createCanvas(e,t)}this._workingCanvas.getContext("2d").clearRect(0,0,e,t)}},t.prototype._drawImage=function(e,t,i,n,r,o,s,a,l){e.drawImage(this._domImage,t,i,n,r,o,s,a,l),this._detectPointerOnOpaqueOnly&&(e=this._workingCanvas.getContext("2d")).drawImage(this._domImage,t,i,n,r,o-this._currentMeasure.left,s-this._currentMeasure.top,a,l)},t.prototype._draw=function(e){var i,n,r,o;if(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),-1==this.cellId)i=this._sourceLeft,n=this._sourceTop,r=this._sourceWidth?this._sourceWidth:this._imageWidth,o=this._sourceHeight?this._sourceHeight:this._imageHeight;else{var s=this._domImage.naturalWidth/this.cellWidth,a=this.cellId/s>>0,l=this.cellId%s;i=this.cellWidth*l,n=this.cellHeight*a,r=this.cellWidth,o=this.cellHeight}if(this._prepareWorkingCanvasForOpaqueDetection(),this._applyStates(e),this._loaded)switch(this._stretch){case t.STRETCH_NONE:case t.STRETCH_FILL:this._drawImage(e,i,n,r,o,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case t.STRETCH_UNIFORM:var h=this._currentMeasure.width/r,u=this._currentMeasure.height/o,c=Math.min(h,u),f=(this._currentMeasure.width-r*c)/2,_=(this._currentMeasure.height-o*c)/2;this._drawImage(e,i,n,r,o,this._currentMeasure.left+f,this._currentMeasure.top+_,r*c,o*c);break;case t.STRETCH_EXTEND:this._drawImage(e,i,n,r,o,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case t.STRETCH_NINE_PATCH:this._renderNinePatch(e)}e.restore()},t.prototype._renderNinePatch=function(e){var t=this._sliceLeft,i=this._sliceTop,n=this._imageHeight-this._sliceBottom,r=this._imageWidth-this._sliceRight,o=this._sliceRight-this._sliceLeft,s=this._sliceBottom-this._sliceTop,a=this._currentMeasure.width-r-t+2,l=this._currentMeasure.height-n-i+2,h=this._currentMeasure.left+t-1,u=this._currentMeasure.top+i-1,c=this._currentMeasure.left+this._currentMeasure.width-r,f=this._currentMeasure.top+this._currentMeasure.height-n;this._drawImage(e,0,0,t,i,this._currentMeasure.left,this._currentMeasure.top,t,i),this._drawImage(e,this._sliceLeft,0,o,i,h,this._currentMeasure.top,a,i),this._drawImage(e,this.sliceRight,0,r,i,c,this._currentMeasure.top,r,i),this._drawImage(e,0,this._sliceTop,t,s,this._currentMeasure.left,u,t,l),this._drawImage(e,this._sliceLeft,this._sliceTop,o,s,h,u,a,l),this._drawImage(e,this._sliceRight,this._sliceTop,r,s,c,u,r,l),this._drawImage(e,0,this._sliceBottom,t,n,this._currentMeasure.left,f,t,n),this._drawImage(e,this.sliceLeft,this._sliceBottom,o,n,h,f,a,n),this._drawImage(e,this._sliceRight,this._sliceBottom,r,n,c,f,r,n)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onImageLoadedObservable.clear(),this.onSVGAttributesComputedObservable.clear()},t.STRETCH_NONE=0,t.STRETCH_FILL=1,t.STRETCH_UNIFORM=2,t.STRETCH_EXTEND=3,t.STRETCH_NINE_PATCH=4,(0,n.gn)([(0,b.qC)()],t.prototype,"detectPointerOnOpaqueOnly",null),(0,n.gn)([(0,b.qC)()],t.prototype,"sliceLeft",null),(0,n.gn)([(0,b.qC)()],t.prototype,"sliceRight",null),(0,n.gn)([(0,b.qC)()],t.prototype,"sliceTop",null),(0,n.gn)([(0,b.qC)()],t.prototype,"sliceBottom",null),(0,n.gn)([(0,b.qC)()],t.prototype,"sourceLeft",null),(0,n.gn)([(0,b.qC)()],t.prototype,"sourceTop",null),(0,n.gn)([(0,b.qC)()],t.prototype,"sourceWidth",null),(0,n.gn)([(0,b.qC)()],t.prototype,"sourceHeight",null),(0,n.gn)([(0,b.qC)()],t.prototype,"populateNinePatchSlicesFromImage",null),(0,n.gn)([(0,b.qC)()],t.prototype,"autoScale",null),(0,n.gn)([(0,b.qC)()],t.prototype,"stretch",null),(0,n.gn)([(0,b.qC)()],t.prototype,"source",null),t}(x);v.Q.RegisteredTypes["BABYLON.GUI.Image"]=w;var I=function(e){function t(t){var i=e.call(this,t)||this;i.name=t,i.delegatePickingToChildren=!1,i.thickness=1,i.isPointerBlocker=!0;var n=null;return i.pointerEnterAnimation=function(){n=i.alpha,i.alpha-=.1},i.pointerOutAnimation=function(){null!==n&&(i.alpha=n)},i.pointerDownAnimation=function(){i.scaleX-=.05,i.scaleY-=.05},i.pointerUpAnimation=function(){i.scaleX+=.05,i.scaleY+=.05},i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"image",{get:function(){return this._image},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textBlock",{get:function(){return this._textBlock},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"Button"},t.prototype._processPicking=function(t,i,n,r,o,s,a,l){if(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this.notRenderable)return!1;if(!e.prototype.contains.call(this,t,i))return!1;if(this.delegatePickingToChildren){for(var h=!1,u=this._children.length-1;u>=0;u--){var c=this._children[u];if(c.isEnabled&&c.isHitTestVisible&&c.isVisible&&!c.notRenderable&&c.contains(t,i)){h=!0;break}}if(!h)return!1}return this._processObservables(r,t,i,n,o,s,a,l),!0},t.prototype._onPointerEnter=function(t,i){return!!e.prototype._onPointerEnter.call(this,t,i)&&(this.pointerEnterAnimation&&this.pointerEnterAnimation(),!0)},t.prototype._onPointerOut=function(t,i,n){void 0===n&&(n=!1),this.pointerOutAnimation&&this.pointerOutAnimation(),e.prototype._onPointerOut.call(this,t,i,n)},t.prototype._onPointerDown=function(t,i,n,r,o){return!!e.prototype._onPointerDown.call(this,t,i,n,r,o)&&(this.pointerDownAnimation&&this.pointerDownAnimation(),!0)},t.prototype._onPointerUp=function(t,i,n,r,o,s){this.pointerUpAnimation&&this.pointerUpAnimation(),e.prototype._onPointerUp.call(this,t,i,n,r,o,s)},t.CreateImageButton=function(e,t,i){var n=new this(e),r=new M(e+"_button",t);r.textWrapping=!0,r.textHorizontalAlignment=x.HORIZONTAL_ALIGNMENT_CENTER,r.paddingLeft="20%",n.addControl(r);var o=new w(e+"_icon",i);return o.width="20%",o.stretch=w.STRETCH_UNIFORM,o.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,n.addControl(o),n._image=o,n._textBlock=r,n},t.CreateImageOnlyButton=function(e,t){var i=new this(e),n=new w(e+"_icon",t);return n.stretch=w.STRETCH_FILL,n.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,i.addControl(n),i._image=n,i},t.CreateSimpleButton=function(e,t){var i=new this(e),n=new M(e+"_button",t);return n.textWrapping=!0,n.textHorizontalAlignment=x.HORIZONTAL_ALIGNMENT_CENTER,i.addControl(n),i._textBlock=n,i},t.CreateImageWithCenterTextButton=function(e,t,i){var n=new this(e),r=new w(e+"_icon",i);r.stretch=w.STRETCH_FILL,n.addControl(r);var o=new M(e+"_button",t);return o.textWrapping=!0,o.textHorizontalAlignment=x.HORIZONTAL_ALIGNMENT_CENTER,n.addControl(o),n._image=r,n._textBlock=o,n},t}(E);v.Q.RegisteredTypes["BABYLON.GUI.Button"]=I;var A=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i._isVertical=!0,i._manualWidth=!1,i._manualHeight=!1,i._doNotTrackManualChanges=!1,i.ignoreLayoutWarnings=!1,i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"isVertical",{get:function(){return this._isVertical},set:function(e){this._isVertical!==e&&(this._isVertical=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._doNotTrackManualChanges||(this._manualWidth=!0),this._width.toString(this._host)!==e&&this._width.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(e){this._doNotTrackManualChanges||(this._manualHeight=!0),this._height.toString(this._host)!==e&&this._height.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"StackPanel"},t.prototype._preMeasure=function(t,i){for(var n=0,r=this._children;n<r.length;n++){var o=r[n];this._isVertical?o.verticalAlignment=x.VERTICAL_ALIGNMENT_TOP:o.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT}e.prototype._preMeasure.call(this,t,i)},t.prototype._additionalProcessing=function(t,i){e.prototype._additionalProcessing.call(this,t,i),this._measureForChildren.copyFrom(t),this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this.isVertical&&!this._manualWidth||(this._measureForChildren.width=this._currentMeasure.width),(this.isVertical||this._manualHeight)&&(this._measureForChildren.height=this._currentMeasure.height)},t.prototype._postMeasure=function(){for(var t=0,i=0,n=0,r=this._children;n<r.length;n++){var o=r[n];o.isVisible&&!o.notRenderable&&(this._isVertical?(o.top!==i+"px"&&(o.top=i+"px",this._rebuildLayout=!0,o._top.ignoreAdaptiveScaling=!0),o._height.isPercentage&&!o._automaticSize?this.ignoreLayoutWarnings||l.w1.Warn("Control (Name:"+o.name+", UniqueId:"+o.uniqueId+") is using height in percentage mode inside a vertical StackPanel"):i+=o._currentMeasure.height+o.paddingTopInPixels+o.paddingBottomInPixels):(o.left!==t+"px"&&(o.left=t+"px",this._rebuildLayout=!0,o._left.ignoreAdaptiveScaling=!0),o._width.isPercentage&&!o._automaticSize?this.ignoreLayoutWarnings||l.w1.Warn("Control (Name:"+o.name+", UniqueId:"+o.uniqueId+") is using width in percentage mode inside a horizontal StackPanel"):t+=o._currentMeasure.width+o.paddingLeftInPixels+o.paddingRightInPixels))}t+=this.paddingLeftInPixels+this.paddingRightInPixels,i+=this.paddingTopInPixels+this.paddingBottomInPixels,this._doNotTrackManualChanges=!0;var s=!1,a=!1;if(!this._manualHeight&&this._isVertical){var h=this.height;this.height=i+"px",a=h!==this.height||!this._height.ignoreAdaptiveScaling}if(!this._manualWidth&&!this._isVertical){var u=this.width;this.width=t+"px",s=u!==this.width||!this._width.ignoreAdaptiveScaling}a&&(this._height.ignoreAdaptiveScaling=!0),s&&(this._width.ignoreAdaptiveScaling=!0),this._doNotTrackManualChanges=!1,(s||a)&&(this._rebuildLayout=!0),e.prototype._postMeasure.call(this)},t.prototype.serialize=function(t){e.prototype.serialize.call(this,t),t.manualWidth=this._manualWidth,t.manualHeight=this._manualHeight},t.prototype._parseFromContent=function(t,i){this._manualWidth=t.manualWidth,this._manualHeight=t.manualHeight,e.prototype._parseFromContent.call(this,t,i)},(0,n.gn)([(0,b.qC)()],t.prototype,"ignoreLayoutWarnings",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"isVertical",null),(0,n.gn)([(0,b.qC)()],t.prototype,"width",null),(0,n.gn)([(0,b.qC)()],t.prototype,"height",null),t}(S);v.Q.RegisteredTypes["BABYLON.GUI.StackPanel"]=A;var F=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i._isChecked=!1,i._background="black",i._checkSizeRatio=.8,i._thickness=1,i.onIsCheckedChangedObservable=new o.y$,i.isPointerBlocker=!0,i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"checkSizeRatio",{get:function(){return this._checkSizeRatio},set:function(e){e=Math.max(Math.min(1,e),0),this._checkSizeRatio!==e&&(this._checkSizeRatio=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isChecked",{get:function(){return this._isChecked},set:function(e){this._isChecked!==e&&(this._isChecked=e,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(e))},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"Checkbox"},t.prototype._draw=function(e,t){e.save(),this._applyStates(e);var i=this._currentMeasure.width-this._thickness,n=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fillRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,i,n),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._isChecked){e.fillStyle=this._isEnabled?this.color:this._disabledColorItem;var r=i*this._checkSizeRatio,o=n*this._checkSizeRatio;e.fillRect(this._currentMeasure.left+this._thickness/2+(i-r)/2,this._currentMeasure.top+this._thickness/2+(n-o)/2,r,o)}e.strokeStyle=this.color,e.lineWidth=this._thickness,e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,i,n),e.restore()},t.prototype._onPointerDown=function(t,i,n,r,o){return!!e.prototype._onPointerDown.call(this,t,i,n,r,o)&&(this.isChecked=!this.isChecked,!0)},t.AddCheckBoxWithHeader=function(e,i){var n=new A;n.isVertical=!1,n.height="30px";var r=new t;r.width="20px",r.height="20px",r.isChecked=!0,r.color="green",r.onIsCheckedChangedObservable.add(i),n.addControl(r);var o=new M;return o.text=e,o.width="180px",o.paddingLeft="5px",o.textHorizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,o.color="white",n.addControl(o),n},(0,n.gn)([(0,b.qC)()],t.prototype,"thickness",null),(0,n.gn)([(0,b.qC)()],t.prototype,"checkSizeRatio",null),(0,n.gn)([(0,b.qC)()],t.prototype,"background",null),(0,n.gn)([(0,b.qC)()],t.prototype,"isChecked",null),t}(x);v.Q.RegisteredTypes["BABYLON.GUI.Checkbox"]=F;var L=i(6504),D=function(){function e(){}return Object.defineProperty(e.prototype,"text",{get:function(){return this._characters?this._characters.join(""):this._text},set:function(e){this._text=e,this._characters=Array.from&&Array.from(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._characters?this._characters.length:this._text.length},enumerable:!1,configurable:!0}),e.prototype.removePart=function(e,t,i){var r;if(this._text=this._text.slice(0,e)+(i||"")+this._text.slice(t),this._characters){var o=i?Array.from(i):[];(r=this._characters).splice.apply(r,(0,n.ev)([e,t-e],o))}},e.prototype.charAt=function(e){return this._characters?this._characters[e]:this._text.charAt(e)},e.prototype.substr=function(e,t){if(this._characters){e=isNaN(e)?0:e>=0?Math.min(e,this._characters.length):this._characters.length+Math.max(e,-this._characters.length),void 0===t?t=this._characters.length-e:(isNaN(t)||t<0)&&(t=0);for(var i=[];--t>=0;)i[t]=this._characters[e+t];return i.join("")}return this._text.substr(e,t)},e.prototype.substring=function(e,t){if(this._characters){isNaN(e)?e=0:e>this._characters.length?e=this._characters.length:e<0&&(e=0),void 0===t?t=this._characters.length:isNaN(t)?t=0:t>this._characters.length?t=this._characters.length:t<0&&(t=0);for(var i=[],n=0;e<t;)i[n++]=this._characters[e++];return i.join("")}return this._text.substring(e,t)},e.prototype.isWord=function(e){var t=/\w/g;return this._characters?-1!==this._characters[e].search(t):-1!==this._text.search(t)},e}(),R=function(e){function t(t,i){void 0===i&&(i="");var n=e.call(this,t)||this;return n.name=t,n._placeholderText="",n._background="#222222",n._focusedBackground="#000000",n._focusedColor="white",n._placeholderColor="gray",n._thickness=1,n._margin=new h(10,h.UNITMODE_PIXEL),n._autoStretchWidth=!0,n._maxWidth=new h(1,h.UNITMODE_PERCENTAGE,!1),n._isFocused=!1,n._blinkIsEven=!1,n._cursorOffset=0,n._deadKey=!1,n._addKey=!0,n._currentKey="",n._isTextHighlightOn=!1,n._textHighlightColor="#d5e0ff",n._highligherOpacity=.4,n._highlightedText="",n._startHighlightIndex=0,n._endHighlightIndex=0,n._cursorIndex=-1,n._onFocusSelectAll=!1,n._isPointerDown=!1,n.promptMessage="Please enter text:",n.disableMobilePrompt=!1,n.onTextChangedObservable=new o.y$,n.onBeforeKeyAddObservable=new o.y$,n.onFocusObservable=new o.y$,n.onBlurObservable=new o.y$,n.onTextHighlightObservable=new o.y$,n.onTextCopyObservable=new o.y$,n.onTextCutObservable=new o.y$,n.onTextPasteObservable=new o.y$,n.onKeyboardEventProcessedObservable=new o.y$,n.text=i,n.isPointerBlocker=!0,n}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"maxWidth",{get:function(){return this._maxWidth.toString(this._host)},set:function(e){this._maxWidth.toString(this._host)!==e&&this._maxWidth.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxWidthInPixels",{get:function(){return this._maxWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highligherOpacity",{get:function(){return this._highligherOpacity},set:function(e){this._highligherOpacity!==e&&(this._highligherOpacity=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onFocusSelectAll",{get:function(){return this._onFocusSelectAll},set:function(e){this._onFocusSelectAll!==e&&(this._onFocusSelectAll=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textHighlightColor",{get:function(){return this._textHighlightColor},set:function(e){this._textHighlightColor!==e&&(this._textHighlightColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"margin",{get:function(){return this._margin.toString(this._host)},set:function(e){this._margin.toString(this._host)!==e&&this._margin.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"marginInPixels",{get:function(){return this._margin.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoStretchWidth",{get:function(){return this._autoStretchWidth},set:function(e){this._autoStretchWidth!==e&&(this._autoStretchWidth=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"focusedBackground",{get:function(){return this._focusedBackground},set:function(e){this._focusedBackground!==e&&(this._focusedBackground=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"focusedColor",{get:function(){return this._focusedColor},set:function(e){this._focusedColor!==e&&(this._focusedColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"placeholderColor",{get:function(){return this._placeholderColor},set:function(e){this._placeholderColor!==e&&(this._placeholderColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"placeholderText",{get:function(){return this._placeholderText},set:function(e){this._placeholderText!==e&&(this._placeholderText=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"deadKey",{get:function(){return this._deadKey},set:function(e){this._deadKey=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"highlightedText",{get:function(){return this._highlightedText},set:function(e){this._highlightedText!==e&&(this._highlightedText=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"addKey",{get:function(){return this._addKey},set:function(e){this._addKey=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentKey",{get:function(){return this._currentKey},set:function(e){this._currentKey=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._textWrapper.text},set:function(e){var t=e.toString();this._textWrapper||(this._textWrapper=new D),this._textWrapper.text!==t&&(this._textWrapper.text=t,this._textHasChanged())},enumerable:!1,configurable:!0}),t.prototype._textHasChanged=function(){this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._width.toString(this._host)!==e&&(this._width.fromString(e)&&this._markAsDirty(),this.autoStretchWidth=!1)},enumerable:!1,configurable:!0}),t.prototype.onBlur=function(){this._isFocused=!1,this._scrollLeft=null,this._cursorOffset=0,clearTimeout(this._blinkTimeout),this._markAsDirty(),this.onBlurObservable.notifyObservers(this),this._host.unRegisterClipboardEvents(),this._onClipboardObserver&&this._host.onClipboardObservable.remove(this._onClipboardObserver);var e=this._host.getScene();this._onPointerDblTapObserver&&e&&e.onPointerObservable.remove(this._onPointerDblTapObserver)},t.prototype.onFocus=function(){var e=this;if(this._isEnabled){if(this._scrollLeft=null,this._isFocused=!0,this._blinkIsEven=!1,this._cursorOffset=0,this._markAsDirty(),this.onFocusObservable.notifyObservers(this),-1!==navigator.userAgent.indexOf("Mobile")&&!this.disableMobilePrompt){var t=prompt(this.promptMessage);return null!==t&&(this.text=t),void(this._host.focusedControl=null)}this._host.registerClipboardEvents(),this._onClipboardObserver=this._host.onClipboardObservable.add((function(t){switch(t.type){case L.p.COPY:e._onCopyText(t.event),e.onTextCopyObservable.notifyObservers(e);break;case L.p.CUT:e._onCutText(t.event),e.onTextCutObservable.notifyObservers(e);break;case L.p.PASTE:e._onPasteText(t.event),e.onTextPasteObservable.notifyObservers(e);break;default:return}}));var i=this._host.getScene();i&&(this._onPointerDblTapObserver=i.onPointerObservable.add((function(t){e._isFocused&&t.type===a.kD.POINTERDOUBLETAP&&e._processDblClick(t)}))),this._onFocusSelectAll&&this._selectAllText()}},t.prototype.focus=function(){this._host.moveFocusToControl(this)},t.prototype.blur=function(){this._host.focusedControl=null},t.prototype._getTypeName=function(){return"InputText"},t.prototype.keepsFocusWith=function(){return this._connectedVirtualKeyboard?[this._connectedVirtualKeyboard]:null},t.prototype.processKey=function(e,t,i){if(!i||!i.ctrlKey&&!i.metaKey||67!==e&&86!==e&&88!==e){if(i&&(i.ctrlKey||i.metaKey)&&65===e)return this._selectAllText(),void i.preventDefault();switch(e){case 32:t=" ";break;case 191:i&&i.preventDefault();break;case 8:if(this._textWrapper.text&&this._textWrapper.length>0){if(this._isTextHighlightOn)return this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this._isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this._blinkIsEven=!1,void(i&&i.preventDefault());0===this._cursorOffset?this.text=this._textWrapper.substr(0,this._textWrapper.length-1):(n=this._textWrapper.length-this._cursorOffset)>0&&(this._textWrapper.removePart(n-1,n),this._textHasChanged())}return void(i&&i.preventDefault());case 46:if(this._isTextHighlightOn)return this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this._isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,void(i&&i.preventDefault());if(this._textWrapper.text&&this._textWrapper.length>0&&this._cursorOffset>0){var n=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(n,n+1),this._textHasChanged(),this._cursorOffset--}return void(i&&i.preventDefault());case 13:return this._host.focusedControl=null,void(this._isTextHighlightOn=!1);case 35:return this._cursorOffset=0,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case 36:return this._cursorOffset=this._textWrapper.length,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case 37:if(this._cursorOffset++,this._cursorOffset>this._textWrapper.length&&(this._cursorOffset=this._textWrapper.length),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this._isTextHighlightOn){if(this._textWrapper.length===this._cursorOffset)return;this._endHighlightIndex=this._textWrapper.length-this._cursorOffset+1}return this._startHighlightIndex=0,this._cursorIndex=this._textWrapper.length-this._endHighlightIndex,this._cursorOffset=this._textWrapper.length,this._isTextHighlightOn=!0,void this._markAsDirty()}return this._isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._textWrapper.length-this._endHighlightIndex,this._cursorOffset=0===this._startHighlightIndex?this._textWrapper.length:this._textWrapper.length-this._startHighlightIndex+1):(this._isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset>=this._textWrapper.length?this._textWrapper.length:this._cursorOffset-1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex):this._isTextHighlightOn=!1,void this._markAsDirty()}return this._isTextHighlightOn&&(this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this._isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=this._textWrapper.length,i.preventDefault()),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty();case 39:if(this._cursorOffset--,this._cursorOffset<0&&(this._cursorOffset=0),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this._isTextHighlightOn){if(0===this._cursorOffset)return;this._startHighlightIndex=this._textWrapper.length-this._cursorOffset-1}return this._endHighlightIndex=this._textWrapper.length,this._isTextHighlightOn=!0,this._cursorIndex=this._textWrapper.length-this._startHighlightIndex,this._cursorOffset=0,void this._markAsDirty()}return this._isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._textWrapper.length-this._startHighlightIndex,this._cursorOffset=this._textWrapper.length===this._endHighlightIndex?0:this._textWrapper.length-this._endHighlightIndex-1):(this._isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset<=0?0:this._cursorOffset+1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex):this._isTextHighlightOn=!1,void this._markAsDirty()}return this._isTextHighlightOn&&(this._cursorOffset=this._textWrapper.length-this._endHighlightIndex,this._isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=0,i.preventDefault()),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty();case 222:i&&i.preventDefault(),this._cursorIndex=-1,this.deadKey=!0}if(t&&(-1===e||32===e||e>47&&e<64||e>64&&e<91||e>159&&e<193||e>218&&e<223||e>95&&e<112)&&(this._currentKey=t,this.onBeforeKeyAddObservable.notifyObservers(this),t=this._currentKey,this._addKey))if(this._isTextHighlightOn)this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex,t),this._textHasChanged(),this._cursorOffset=this._textWrapper.length-(this._startHighlightIndex+1),this._isTextHighlightOn=!1,this._blinkIsEven=!1,this._markAsDirty();else if(0===this._cursorOffset)this.text+=t;else{var r=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(r,r,t),this._textHasChanged()}}},t.prototype._updateValueFromCursorIndex=function(e){if(this._blinkIsEven=!1,-1===this._cursorIndex)this._cursorIndex=e;else if(this._cursorIndex<this._cursorOffset)this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset;else{if(!(this._cursorIndex>this._cursorOffset))return this._isTextHighlightOn=!1,void this._markAsDirty();this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex}this._isTextHighlightOn=!0,this._markAsDirty()},t.prototype._processDblClick=function(e){var t,i;this._startHighlightIndex=this._textWrapper.length-this._cursorOffset,this._endHighlightIndex=this._startHighlightIndex;do{i=this._endHighlightIndex<this._textWrapper.length&&this._textWrapper.isWord(this._endHighlightIndex)?++this._endHighlightIndex:0,t=this._startHighlightIndex>0&&this._textWrapper.isWord(this._startHighlightIndex-1)?--this._startHighlightIndex:0}while(t||i);this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this.onTextHighlightObservable.notifyObservers(this),this._isTextHighlightOn=!0,this._clickedCoordinate=null,this._blinkIsEven=!0,this._cursorIndex=-1,this._markAsDirty()},t.prototype._selectAllText=function(){this._blinkIsEven=!0,this._isTextHighlightOn=!0,this._startHighlightIndex=0,this._endHighlightIndex=this._textWrapper.length,this._cursorOffset=this._textWrapper.length,this._cursorIndex=-1,this._markAsDirty()},t.prototype.processKeyboard=function(e){this.processKey(e.keyCode,e.key,e),this.onKeyboardEventProcessedObservable.notifyObservers(e)},t.prototype._onCopyText=function(e){this._isTextHighlightOn=!1;try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch(e){}this._host.clipboardData=this._highlightedText},t.prototype._onCutText=function(e){if(this._highlightedText){this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this._isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex;try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch(e){}this._host.clipboardData=this._highlightedText,this._highlightedText=""}},t.prototype._onPasteText=function(e){var t;t=e.clipboardData&&-1!==e.clipboardData.types.indexOf("text/plain")?e.clipboardData.getData("text/plain"):this._host.clipboardData;var i=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(i,i,t),this._textHasChanged()},t.prototype._draw=function(e,t){var i=this;e.save(),this._applyStates(e),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._isFocused?this._focusedBackground&&(e.fillStyle=this._isEnabled?this._focusedBackground:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)):this._background&&(e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._fontOffset||(this._fontOffset=x._GetFontOffset(e.font));var n=this._currentMeasure.left+this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this.color&&(e.fillStyle=this.color);var r=this._beforeRenderText(this._textWrapper);this._isFocused||this._textWrapper.text||!this._placeholderText||((r=new D).text=this._placeholderText,this._placeholderColor&&(e.fillStyle=this._placeholderColor)),this._textWidth=e.measureText(r.text).width;var o=2*this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this._autoStretchWidth&&(this.width=Math.min(this._maxWidth.getValueInPixel(this._host,this._tempParentMeasure.width),this._textWidth+o)+"px");var s=this._fontOffset.ascent+(this._currentMeasure.height-this._fontOffset.height)/2,a=this._width.getValueInPixel(this._host,this._tempParentMeasure.width)-o;if(e.save(),e.beginPath(),e.rect(n,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,a+2,this._currentMeasure.height),e.clip(),this._isFocused&&this._textWidth>a){var l=n-this._textWidth+a;this._scrollLeft||(this._scrollLeft=l)}else this._scrollLeft=n;if(e.fillText(r.text,this._scrollLeft,this._currentMeasure.top+s),this._isFocused){if(this._clickedCoordinate){var h=this._scrollLeft+this._textWidth-this._clickedCoordinate,u=0;this._cursorOffset=0;var c=0;do{this._cursorOffset&&(c=Math.abs(h-u)),this._cursorOffset++,u=e.measureText(r.substr(r.length-this._cursorOffset,this._cursorOffset)).width}while(u<h&&r.length>=this._cursorOffset);Math.abs(h-u)>c&&this._cursorOffset--,this._blinkIsEven=!1,this._clickedCoordinate=null}if(!this._blinkIsEven){var f=r.substr(r.length-this._cursorOffset),_=e.measureText(f).width,d=this._scrollLeft+this._textWidth-_;d<n?(this._scrollLeft+=n-d,d=n,this._markAsDirty()):d>n+a&&(this._scrollLeft+=n+a-d,d=n+a,this._markAsDirty()),this._isTextHighlightOn||e.fillRect(d,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,2,this._fontOffset.height)}if(clearTimeout(this._blinkTimeout),this._blinkTimeout=setTimeout((function(){i._blinkIsEven=!i._blinkIsEven,i._markAsDirty()}),500),this._isTextHighlightOn){clearTimeout(this._blinkTimeout);var p=e.measureText(r.substring(this._startHighlightIndex)).width,g=this._scrollLeft+this._textWidth-p;this._highlightedText=r.substring(this._startHighlightIndex,this._endHighlightIndex);var m=e.measureText(r.substring(this._startHighlightIndex,this._endHighlightIndex)).width;g<n&&((m-=n-g)||(m=e.measureText(r.charAt(r.length-this._cursorOffset)).width),g=n),e.globalAlpha=this._highligherOpacity,e.fillStyle=this._textHighlightColor,e.fillRect(g,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,m,this._fontOffset.height),e.globalAlpha=1}}e.restore(),this._thickness&&(this._isFocused?this.focusedColor&&(e.strokeStyle=this.focusedColor):this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),e.restore()},t.prototype._onPointerDown=function(t,i,n,r,o){return!(!e.prototype._onPointerDown.call(this,t,i,n,r,o)||(this._clickedCoordinate=i.x,this._isTextHighlightOn=!1,this._highlightedText="",this._cursorIndex=-1,this._isPointerDown=!0,this._host._capturingControl[n]=this,this._host.focusedControl===this?(clearTimeout(this._blinkTimeout),this._markAsDirty(),0):!this._isEnabled||(this._host.focusedControl=this,0)))},t.prototype._onPointerMove=function(t,i,n,r){this._host.focusedControl===this&&this._isPointerDown&&(this._clickedCoordinate=i.x,this._markAsDirty(),this._updateValueFromCursorIndex(this._cursorOffset)),e.prototype._onPointerMove.call(this,t,i,n,r)},t.prototype._onPointerUp=function(t,i,n,r,o){this._isPointerDown=!1,delete this._host._capturingControl[n],e.prototype._onPointerUp.call(this,t,i,n,r,o)},t.prototype._beforeRenderText=function(e){return e},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.onBlurObservable.clear(),this.onFocusObservable.clear(),this.onTextChangedObservable.clear(),this.onTextCopyObservable.clear(),this.onTextCutObservable.clear(),this.onTextPasteObservable.clear(),this.onTextHighlightObservable.clear(),this.onKeyboardEventProcessedObservable.clear()},(0,n.gn)([(0,b.qC)()],t.prototype,"promptMessage",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"disableMobilePrompt",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"maxWidth",null),(0,n.gn)([(0,b.qC)()],t.prototype,"highligherOpacity",null),(0,n.gn)([(0,b.qC)()],t.prototype,"onFocusSelectAll",null),(0,n.gn)([(0,b.qC)()],t.prototype,"textHighlightColor",null),(0,n.gn)([(0,b.qC)()],t.prototype,"margin",null),(0,n.gn)([(0,b.qC)()],t.prototype,"autoStretchWidth",null),(0,n.gn)([(0,b.qC)()],t.prototype,"thickness",null),(0,n.gn)([(0,b.qC)()],t.prototype,"focusedBackground",null),(0,n.gn)([(0,b.qC)()],t.prototype,"focusedColor",null),(0,n.gn)([(0,b.qC)()],t.prototype,"background",null),(0,n.gn)([(0,b.qC)()],t.prototype,"placeholderColor",null),(0,n.gn)([(0,b.qC)()],t.prototype,"placeholderText",null),(0,n.gn)([(0,b.qC)()],t.prototype,"deadKey",null),(0,n.gn)([(0,b.qC)()],t.prototype,"text",null),(0,n.gn)([(0,b.qC)()],t.prototype,"width",null),t}(x);v.Q.RegisteredTypes["BABYLON.GUI.InputText"]=R;var B=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i._rowDefinitions=new Array,i._columnDefinitions=new Array,i._cells={},i._childControls=new Array,i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"columnCount",{get:function(){return this._columnDefinitions.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rowCount",{get:function(){return this._rowDefinitions.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"children",{get:function(){return this._childControls},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cells",{get:function(){return this._cells},enumerable:!1,configurable:!0}),t.prototype.getRowDefinition=function(e){return e<0||e>=this._rowDefinitions.length?null:this._rowDefinitions[e]},t.prototype.getColumnDefinition=function(e){return e<0||e>=this._columnDefinitions.length?null:this._columnDefinitions[e]},t.prototype.addRowDefinition=function(e,t){return void 0===t&&(t=!1),this._rowDefinitions.push(new h(e,t?h.UNITMODE_PIXEL:h.UNITMODE_PERCENTAGE)),this._markAsDirty(),this},t.prototype.addColumnDefinition=function(e,t){return void 0===t&&(t=!1),this._columnDefinitions.push(new h(e,t?h.UNITMODE_PIXEL:h.UNITMODE_PERCENTAGE)),this._markAsDirty(),this},t.prototype.setRowDefinition=function(e,t,i){if(void 0===i&&(i=!1),e<0||e>=this._rowDefinitions.length)return this;var n=this._rowDefinitions[e];return n&&n.isPixel===i&&n.internalValue===t||(this._rowDefinitions[e]=new h(t,i?h.UNITMODE_PIXEL:h.UNITMODE_PERCENTAGE),this._markAsDirty()),this},t.prototype.setColumnDefinition=function(e,t,i){if(void 0===i&&(i=!1),e<0||e>=this._columnDefinitions.length)return this;var n=this._columnDefinitions[e];return n&&n.isPixel===i&&n.internalValue===t||(this._columnDefinitions[e]=new h(t,i?h.UNITMODE_PIXEL:h.UNITMODE_PERCENTAGE),this._markAsDirty()),this},t.prototype.getChildrenAt=function(e,t){var i=this._cells[e+":"+t];return i?i.children:null},t.prototype.getChildCellInfo=function(e){return e._tag},t.prototype._removeCell=function(t,i){if(t){e.prototype.removeControl.call(this,t);for(var n=0,r=t.children;n<r.length;n++){var o=r[n],s=this._childControls.indexOf(o);-1!==s&&this._childControls.splice(s,1)}delete this._cells[i]}},t.prototype._offsetCell=function(e,t){if(this._cells[t]){this._cells[e]=this._cells[t];for(var i=0,n=this._cells[e].children;i<n.length;i++)n[i]._tag=e;delete this._cells[t]}},t.prototype.removeColumnDefinition=function(e){if(e<0||e>=this._columnDefinitions.length)return this;for(var t=0;t<this._rowDefinitions.length;t++){var i=t+":"+e,n=this._cells[i];this._removeCell(n,i)}for(t=0;t<this._rowDefinitions.length;t++)for(var r=e+1;r<this._columnDefinitions.length;r++){var o=t+":"+(r-1);i=t+":"+r,this._offsetCell(o,i)}return this._columnDefinitions.splice(e,1),this._markAsDirty(),this},t.prototype.removeRowDefinition=function(e){if(e<0||e>=this._rowDefinitions.length)return this;for(var t=0;t<this._columnDefinitions.length;t++){var i=e+":"+t,n=this._cells[i];this._removeCell(n,i)}for(t=0;t<this._columnDefinitions.length;t++)for(var r=e+1;r<this._rowDefinitions.length;r++){var o=r-1+":"+t;i=r+":"+t,this._offsetCell(o,i)}return this._rowDefinitions.splice(e,1),this._markAsDirty(),this},t.prototype.addControl=function(t,i,n){if(void 0===i&&(i=0),void 0===n&&(n=0),0===this._rowDefinitions.length&&this.addRowDefinition(1,!1),0===this._columnDefinitions.length&&this.addColumnDefinition(1,!1),-1!==this._childControls.indexOf(t))return l.w1.Warn("Control (Name:"+t.name+", UniqueId:"+t.uniqueId+") is already associated with this grid. You must remove it before reattaching it"),this;var r=Math.min(i,this._rowDefinitions.length-1)+":"+Math.min(n,this._columnDefinitions.length-1),o=this._cells[r];return o||(o=new S(r),this._cells[r]=o,o.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,o.verticalAlignment=x.VERTICAL_ALIGNMENT_TOP,e.prototype.addControl.call(this,o)),o.addControl(t),this._childControls.push(t),t._tag=r,t.parent=this,this._markAsDirty(),this},t.prototype.removeControl=function(e){var t=this._childControls.indexOf(e);-1!==t&&this._childControls.splice(t,1);var i=this._cells[e._tag];return i&&(i.removeControl(e),e._tag=null),this._markAsDirty(),this},t.prototype._getTypeName=function(){return"Grid"},t.prototype._getGridDefinitions=function(e){for(var t=[],i=[],n=[],r=[],o=this._currentMeasure.width,s=0,a=this._currentMeasure.height,l=0,h=0,u=0,c=this._rowDefinitions;u<c.length;u++)(g=c[u]).isPixel?(a-=p=g.getValue(this._host),i[h]=p):l+=g.internalValue,h++;var f=0;h=0;for(var _=0,d=this._rowDefinitions;_<d.length;_++){var p,g=d[_];r.push(f),g.isPixel?f+=g.getValue(this._host):(f+=p=g.internalValue/l*a,i[h]=p),h++}h=0;for(var m=0,v=this._columnDefinitions;m<v.length;m++)(g=v[m]).isPixel?(o-=P=g.getValue(this._host),t[h]=P):s+=g.internalValue,h++;var b=0;h=0;for(var y=0,x=this._columnDefinitions;y<x.length;y++){var P;g=x[y],n.push(b),g.isPixel?b+=g.getValue(this._host):(b+=P=g.internalValue/s*o,t[h]=P),h++}e(n,r,t,i)},t.prototype._additionalProcessing=function(t,i){var n=this;this._getGridDefinitions((function(e,t,i,r){for(var o in n._cells)if(n._cells.hasOwnProperty(o)){var s=o.split(":"),a=parseInt(s[0]),l=parseInt(s[1]),h=n._cells[o];h.left=e[l]+"px",h.top=t[a]+"px",h.width=i[l]+"px",h.height=r[a]+"px",h._left.ignoreAdaptiveScaling=!0,h._top.ignoreAdaptiveScaling=!0,h._width.ignoreAdaptiveScaling=!0,h._height.ignoreAdaptiveScaling=!0}})),e.prototype._additionalProcessing.call(this,t,i)},t.prototype._flagDescendantsAsMatrixDirty=function(){for(var e in this._cells)this._cells.hasOwnProperty(e)&&this._cells[e]._markMatrixAsDirty()},t.prototype._renderHighlightSpecific=function(t){var i=this;e.prototype._renderHighlightSpecific.call(this,t),this._getGridDefinitions((function(e,n,r,o){for(var s=0;s<e.length;s++){var a=i._currentMeasure.left+e[s]+r[s];t.beginPath(),t.moveTo(a,i._currentMeasure.top),t.lineTo(a,i._currentMeasure.top+i._currentMeasure.height),t.stroke()}for(s=0;s<n.length;s++){var l=i._currentMeasure.top+n[s]+o[s];t.beginPath(),t.moveTo(i._currentMeasure.left,l),t.lineTo(i._currentMeasure.left+i._currentMeasure.width,l),t.stroke()}})),t.restore()},t.prototype.dispose=function(){e.prototype.dispose.call(this);for(var t=0,i=this._childControls;t<i.length;t++)i[t].dispose();this._childControls=[]},t}(S);v.Q.RegisteredTypes["BABYLON.GUI.Grid"]=B;var N=i(2172),k=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i._value=N.Wo.Red(),i._tmpColor=new N.Wo,i._pointerStartedOnSquare=!1,i._pointerStartedOnWheel=!1,i._squareLeft=0,i._squareTop=0,i._squareSize=0,i._h=360,i._s=1,i._v=1,i._lastPointerDownId=-1,i.onValueChangedObservable=new o.y$,i._pointerIsDown=!1,i.value=new N.Wo(.88,.1,.1),i.size="200px",i.isPointerBlocker=!0,i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(e){this._value.equals(e)||(this._value.copyFrom(e),this._value.toHSVToRef(this._tmpColor),this._h=this._tmpColor.r,this._s=Math.max(this._tmpColor.g,1e-5),this._v=Math.max(this._tmpColor.b,1e-5),this._markAsDirty(),this._value.r<=t._Epsilon&&(this._value.r=0),this._value.g<=t._Epsilon&&(this._value.g=0),this._value.b<=t._Epsilon&&(this._value.b=0),this._value.r>=1-t._Epsilon&&(this._value.r=1),this._value.g>=1-t._Epsilon&&(this._value.g=1),this._value.b>=1-t._Epsilon&&(this._value.b=1),this.onValueChangedObservable.notifyObservers(this._value))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._width.toString(this._host)!==e&&this._width.fromString(e)&&(this._height.fromString(e),this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(e){this._height.toString(this._host)!==e&&this._height.fromString(e)&&(this._width.fromString(e),this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.width},set:function(e){this.width=e},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"ColorPicker"},t.prototype._preMeasure=function(e,t){e.width<e.height?this._currentMeasure.height=e.width:this._currentMeasure.width=e.height},t.prototype._updateSquareProps=function(){var e=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),t=2*(e-.2*e)/Math.sqrt(2),i=e-.5*t;this._squareLeft=this._currentMeasure.left+i,this._squareTop=this._currentMeasure.top+i,this._squareSize=t},t.prototype._drawGradientSquare=function(e,t,i,n,r,o){var s=o.createLinearGradient(t,i,n+t,i);s.addColorStop(0,"#fff"),s.addColorStop(1,"hsl("+e+", 100%, 50%)"),o.fillStyle=s,o.fillRect(t,i,n,r);var a=o.createLinearGradient(t,i,t,r+i);a.addColorStop(0,"rgba(0,0,0,0)"),a.addColorStop(1,"#000"),o.fillStyle=a,o.fillRect(t,i,n,r)},t.prototype._drawCircle=function(e,t,i,n){n.beginPath(),n.arc(e,t,i+1,0,2*Math.PI,!1),n.lineWidth=3,n.strokeStyle="#333333",n.stroke(),n.beginPath(),n.arc(e,t,i,0,2*Math.PI,!1),n.lineWidth=3,n.strokeStyle="#ffffff",n.stroke()},t.prototype._createColorWheelCanvas=function(e,t){var i=y.D.LastCreatedEngine;if(!i)throw new Error("Invalid engine. Unable to create a canvas.");for(var n=i.createCanvas(2*e,2*e),r=n.getContext("2d"),o=r.getImageData(0,0,2*e,2*e),s=o.data,a=this._tmpColor,l=e*e,h=e-t,u=h*h,c=-e;c<e;c++)for(var f=-e;f<e;f++){var _=c*c+f*f;if(!(_>l||_<u)){var d=Math.sqrt(_),p=Math.atan2(f,c);N.Wo.HSVtoRGBToRef(180*p/Math.PI+180,d/e,1,a);var g=4*(c+e+2*(f+e)*e);s[g]=255*a.r,s[g+1]=255*a.g,s[g+2]=255*a.b;var m;m=e<50?.2:e>150?.04:-.16*(e-50)/100+.2;var v=(d-h)/(e-h);s[g+3]=v<m?v/m*255:v>1-m?255*(1-(v-(1-m))/m):255}}return r.putImageData(o,0,0),n},t.prototype._draw=function(e){e.save(),this._applyStates(e);var t=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),i=.2*t,n=this._currentMeasure.left,r=this._currentMeasure.top;this._colorWheelCanvas&&this._colorWheelCanvas.width==2*t||(this._colorWheelCanvas=this._createColorWheelCanvas(t,i)),this._updateSquareProps(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY,e.fillRect(this._squareLeft,this._squareTop,this._squareSize,this._squareSize)),e.drawImage(this._colorWheelCanvas,n,r),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._drawGradientSquare(this._h,this._squareLeft,this._squareTop,this._squareSize,this._squareSize,e);var o=this._squareLeft+this._squareSize*this._s,s=this._squareTop+this._squareSize*(1-this._v);this._drawCircle(o,s,.04*t,e);var a=t-.5*i;o=n+t+Math.cos((this._h-180)*Math.PI/180)*a,s=r+t+Math.sin((this._h-180)*Math.PI/180)*a,this._drawCircle(o,s,.35*i,e),e.restore()},t.prototype._updateValueFromPointer=function(e,i){if(this._pointerStartedOnWheel){var n=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),r=n+this._currentMeasure.left,o=n+this._currentMeasure.top;this._h=180*Math.atan2(i-o,e-r)/Math.PI+180}else this._pointerStartedOnSquare&&(this._updateSquareProps(),this._s=(e-this._squareLeft)/this._squareSize,this._v=1-(i-this._squareTop)/this._squareSize,this._s=Math.min(this._s,1),this._s=Math.max(this._s,t._Epsilon),this._v=Math.min(this._v,1),this._v=Math.max(this._v,t._Epsilon));N.Wo.HSVtoRGBToRef(this._h,this._s,this._v,this._tmpColor),this.value=this._tmpColor},t.prototype._isPointOnSquare=function(e,t){this._updateSquareProps();var i=this._squareLeft,n=this._squareTop,r=this._squareSize;return e>=i&&e<=i+r&&t>=n&&t<=n+r},t.prototype._isPointOnWheel=function(e,t){var i=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),n=i-.2*i,r=e-(i+this._currentMeasure.left),o=t-(i+this._currentMeasure.top),s=r*r+o*o;return s<=i*i&&s>=n*n},t.prototype._onPointerDown=function(t,i,n,r,o){if(!e.prototype._onPointerDown.call(this,t,i,n,r,o))return!1;this._pointerIsDown=!0,this._pointerStartedOnSquare=!1,this._pointerStartedOnWheel=!1,this._invertTransformMatrix.transformCoordinates(i.x,i.y,this._transformedPosition);var s=this._transformedPosition.x,a=this._transformedPosition.y;return this._isPointOnSquare(s,a)?this._pointerStartedOnSquare=!0:this._isPointOnWheel(s,a)&&(this._pointerStartedOnWheel=!0),this._updateValueFromPointer(s,a),this._host._capturingControl[n]=this,this._lastPointerDownId=n,!0},t.prototype._onPointerMove=function(t,i,n,r){if(n==this._lastPointerDownId){this._invertTransformMatrix.transformCoordinates(i.x,i.y,this._transformedPosition);var o=this._transformedPosition.x,s=this._transformedPosition.y;this._pointerIsDown&&this._updateValueFromPointer(o,s),e.prototype._onPointerMove.call(this,t,i,n,r)}},t.prototype._onPointerUp=function(t,i,n,r,o,s){this._pointerIsDown=!1,delete this._host._capturingControl[n],e.prototype._onPointerUp.call(this,t,i,n,r,o,s)},t.prototype._onCanvasBlur=function(){this._forcePointerUp(),e.prototype._onCanvasBlur.call(this)},t.ShowPickerDialogAsync=function(e,i){return new Promise((function(n,r){i.pickerWidth=i.pickerWidth||"640px",i.pickerHeight=i.pickerHeight||"400px",i.headerHeight=i.headerHeight||"35px",i.lastColor=i.lastColor||"#000000",i.swatchLimit=i.swatchLimit||20,i.numSwatchesPerLine=i.numSwatchesPerLine||10;var o,s,a,l,h,u,c,f,_,d,p,g,m,v,b,y,P,C,T,S=i.swatchLimit/i.numSwatchesPerLine,O=parseFloat(i.pickerWidth)/i.numSwatchesPerLine,w=Math.floor(.25*O),A=w*(i.numSwatchesPerLine+1),F=Math.floor((parseFloat(i.pickerWidth)-A)/i.numSwatchesPerLine),L=F*S+w*(S+1),D=(parseInt(i.pickerHeight)+L+Math.floor(.25*F)).toString()+"px",k="#c0c0c0",V="#535353",U="#414141",W="515151",z=N.Wo.FromHexString("#dddddd"),H=z.r+z.g+z.b,G=["R","G","B"],j="#454545",Q="#f0f0f0",X=!1;function q(e,t){T=t;var i=e.toHexString();if(P.background=i,d.name!=T&&(d.text=Math.floor(255*e.r).toString()),p.name!=T&&(p.text=Math.floor(255*e.g).toString()),g.name!=T&&(g.text=Math.floor(255*e.b).toString()),m.name!=T&&(m.text=e.r.toString()),v.name!=T&&(v.text=e.g.toString()),b.name!=T&&(b.text=e.b.toString()),y.name!=T){var n=i.split("#");y.text=n[1]}_.name!=T&&(_.value=e)}function Y(e,t){var i=e.text;if(/[^0-9]/g.test(i))e.text=C;else if(""!=i&&(Math.floor(parseInt(i))<0?i="0":Math.floor(parseInt(i))>255?i="255":isNaN(parseInt(i))&&(i="0")),T==e.name&&(C=i),""!=i){i=parseInt(i).toString(),e.text=i;var n=N.Wo.FromHexString(P.background);T==e.name&&q("r"==t?new N.Wo(parseInt(i)/255,n.g,n.b):"g"==t?new N.Wo(n.r,parseInt(i)/255,n.b):new N.Wo(n.r,n.g,parseInt(i)/255),e.name)}}function Z(e,t){var i=e.text;if(/[^0-9\.]/g.test(i))e.text=C;else{""!=i&&"."!=i&&0!=parseFloat(i)&&(parseFloat(i)<0?i="0.0":parseFloat(i)>1?i="1.0":isNaN(parseFloat(i))&&(i="0.0")),T==e.name&&(C=i),""!=i&&"."!=i&&0!=parseFloat(i)?(i=parseFloat(i).toString(),e.text=i):i="0.0";var n=N.Wo.FromHexString(P.background);T==e.name&&q("r"==t?new N.Wo(parseFloat(i),n.g,n.b):"g"==t?new N.Wo(n.r,parseFloat(i),n.b):new N.Wo(n.r,n.g,parseFloat(i)),e.name)}}function K(){if(i.savedColors&&i.savedColors[c]){if(X)var e="b";else e="";var t=I.CreateSimpleButton("Swatch_"+c,e);t.fontFamily="BabylonJSglyphs";var n=N.Wo.FromHexString(i.savedColors[c]),r=n.r+n.g+n.b;t.color=r>H?"#aaaaaa":"#ffffff",t.fontSize=Math.floor(.7*F),t.textBlock.verticalAlignment=x.VERTICAL_ALIGNMENT_CENTER,t.height=t.width=F.toString()+"px",t.background=i.savedColors[c],t.thickness=2;var o=c;return t.pointerDownAnimation=function(){t.thickness=4},t.pointerUpAnimation=function(){t.thickness=3},t.pointerEnterAnimation=function(){t.thickness=3},t.pointerOutAnimation=function(){t.thickness=2},t.onPointerClickObservable.add((function(){var e;X?(e=o,i.savedColors&&i.savedColors.splice(e,1),i.savedColors&&0==i.savedColors.length&&(ee(!1),X=!1),J("",Re)):i.savedColors&&q(N.Wo.FromHexString(i.savedColors[o]),t.name)})),t}return null}function $(e){if(void 0!==e&&(X=e),X){for(var t=0;t<f.children.length;t++)f.children[t].textBlock.text="b";void 0!==a&&(a.textBlock.text="Done")}else{for(t=0;t<f.children.length;t++)f.children[t].textBlock.text="";void 0!==a&&(a.textBlock.text="Edit")}}function J(e,t){if(i.savedColors){""!=e&&i.savedColors.push(e),c=0,f.clearControls();var n=Math.ceil(i.savedColors.length/i.numSwatchesPerLine);if(0==n)var r=0;else r=n+1;if(f.rowCount!=n+r){for(var o=f.rowCount,s=0;s<o;s++)f.removeRowDefinition(0);for(s=0;s<n+r;s++)s%2?f.addRowDefinition(F,!0):f.addRowDefinition(w,!0)}f.height=(F*n+r*w).toString()+"px";for(var a=1,l=1;a<n+r;a+=2,l++){if(i.savedColors.length>l*i.numSwatchesPerLine)var h=i.numSwatchesPerLine;else h=i.savedColors.length-(l-1)*i.numSwatchesPerLine;for(var u=Math.min(Math.max(h,0),i.numSwatchesPerLine),_=0,d=1;_<u;_++)if(!(_>i.numSwatchesPerLine)){var p=K();null!=p&&(f.addControl(p,a,d),d+=2,c++)}}i.savedColors.length>=i.swatchLimit?te(t,!0):te(t,!1)}}function ee(e){e?((a=I.CreateSimpleButton("butEdit","Edit")).width=l,a.height=h,a.left=Math.floor(.1*parseInt(l)).toString()+"px",a.top=(-1*parseFloat(a.left)).toString()+"px",a.verticalAlignment=x.VERTICAL_ALIGNMENT_BOTTOM,a.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,a.thickness=2,a.color=k,a.fontSize=s,a.background=V,a.onPointerEnterObservable.add((function(){a.background=U})),a.onPointerOutObservable.add((function(){a.background=V})),a.pointerDownAnimation=function(){a.background=W},a.pointerUpAnimation=function(){a.background=U},a.onPointerClickObservable.add((function(){X=!X,$()})),ge.addControl(a,1,0)):ge.removeControl(a)}function te(e,t){t?(e.color="#555555",e.background="#454545"):(e.color=k,e.background=V)}function ie(t){i.savedColors&&i.savedColors.length>0?n({savedColors:i.savedColors,pickedColor:t}):n({pickedColor:t}),e.removeControl(ne)}var ne=new B;if(ne.name="Dialog Container",ne.width=i.pickerWidth,i.savedColors){ne.height=D;var re=parseInt(i.pickerHeight)/parseInt(D);ne.addRowDefinition(re,!1),ne.addRowDefinition(1-re,!1)}else ne.height=i.pickerHeight,ne.addRowDefinition(1,!1);if(e.addControl(ne),i.savedColors){(f=new B).name="Swatch Drawer",f.verticalAlignment=x.VERTICAL_ALIGNMENT_TOP,f.background=V,f.width=i.pickerWidth;var oe=i.savedColors.length/i.numSwatchesPerLine;if(0==oe)var se=0;else se=oe+1;f.height=(F*oe+se*w).toString()+"px",f.top=Math.floor(.25*F).toString()+"px";for(var ae=0;ae<2*Math.ceil(i.savedColors.length/i.numSwatchesPerLine)+1;ae++)ae%2!=0?f.addRowDefinition(F,!0):f.addRowDefinition(w,!0);for(ae=0;ae<2*i.numSwatchesPerLine+1;ae++)ae%2!=0?f.addColumnDefinition(F,!0):f.addColumnDefinition(w,!0);ne.addControl(f,1,0)}var le=new B;le.name="Picker Panel",le.height=i.pickerHeight;var he=parseInt(i.headerHeight)/parseInt(i.pickerHeight),ue=[he,1-he];le.addRowDefinition(ue[0],!1),le.addRowDefinition(ue[1],!1),ne.addControl(le,0,0);var ce=new E;ce.name="Dialogue Header Bar",ce.background="#cccccc",ce.thickness=0,le.addControl(ce,0,0);var fe=I.CreateSimpleButton("closeButton","a");fe.fontFamily="BabylonJSglyphs";var _e=N.Wo.FromHexString(ce.background);o=new N.Wo(1-_e.r,1-_e.g,1-_e.b),fe.color=o.toHexString(),fe.fontSize=Math.floor(.6*parseInt(i.headerHeight)),fe.textBlock.textVerticalAlignment=x.VERTICAL_ALIGNMENT_CENTER,fe.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_RIGHT,fe.height=fe.width=i.headerHeight,fe.background=ce.background,fe.thickness=0,fe.pointerDownAnimation=function(){},fe.pointerUpAnimation=function(){fe.background=ce.background},fe.pointerEnterAnimation=function(){fe.color=ce.background,fe.background="red"},fe.pointerOutAnimation=function(){fe.color=o.toHexString(),fe.background=ce.background},fe.onPointerClickObservable.add((function(){ie(Me.background)})),le.addControl(fe,0,0);var de=new B;de.name="Dialogue Body",de.background=V;var pe=[.4375,.5625];de.addRowDefinition(1,!1),de.addColumnDefinition(pe[0],!1),de.addColumnDefinition(pe[1],!1),le.addControl(de,1,0);var ge=new B;ge.name="Picker Grid",ge.addRowDefinition(.85,!1),ge.addRowDefinition(.15,!1),de.addControl(ge,0,0),(_=new t).name="GUI Color Picker",i.pickerHeight<i.pickerWidth?_.width=.89:_.height=.89,_.value=N.Wo.FromHexString(i.lastColor),_.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_CENTER,_.verticalAlignment=x.VERTICAL_ALIGNMENT_CENTER,_.onPointerDownObservable.add((function(){T=_.name,C="",$(!1)})),_.onValueChangedObservable.add((function(e){T==_.name&&q(e,_.name)})),ge.addControl(_,0,0);var me=new B;me.name="Dialogue Right Half",me.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT;var ve=[.514,.486];me.addRowDefinition(ve[0],!1),me.addRowDefinition(ve[1],!1),de.addControl(me,1,1);var be=new B;be.name="Swatches and Buttons";var ye=[.417,.583];be.addRowDefinition(1,!1),be.addColumnDefinition(ye[0],!1),be.addColumnDefinition(ye[1],!1),me.addControl(be,0,0);var xe=new B;xe.name="New and Current Swatches";var Pe=[.04,.16,.64,.16];xe.addRowDefinition(Pe[0],!1),xe.addRowDefinition(Pe[1],!1),xe.addRowDefinition(Pe[2],!1),xe.addRowDefinition(Pe[3],!1),be.addControl(xe,0,0);var Ce=new B;Ce.name="Active Swatches",Ce.width=.67,Ce.addRowDefinition(.5,!1),Ce.addRowDefinition(.5,!1),xe.addControl(Ce,2,0);var Te=Math.floor(parseInt(i.pickerWidth)*pe[1]*ye[0]*.11),Se=Math.floor(parseInt(i.pickerHeight)*ue[1]*ve[0]*Pe[1]*.5);if(i.pickerWidth>i.pickerHeight)var Oe=Se;else Oe=Te;var Ee=new M;Ee.text="new",Ee.name="New Color Label",Ee.color=k,Ee.fontSize=Oe,xe.addControl(Ee,1,0),(P=new E).name="New Color Swatch",P.background=i.lastColor,P.thickness=0,Ce.addControl(P,0,0);var Me=I.CreateSimpleButton("currentSwatch","");Me.background=i.lastColor,Me.thickness=0,Me.onPointerClickObservable.add((function(){q(N.Wo.FromHexString(Me.background),Me.name),$(!1)})),Me.pointerDownAnimation=function(){},Me.pointerUpAnimation=function(){},Me.pointerEnterAnimation=function(){},Me.pointerOutAnimation=function(){},Ce.addControl(Me,1,0);var we=new E;we.name="Swatch Outline",we.width=.67,we.thickness=2,we.color="#404040",we.isHitTestVisible=!1,xe.addControl(we,2,0);var Ie=new M;Ie.name="Current Color Label",Ie.text="current",Ie.color=k,Ie.fontSize=Oe,xe.addControl(Ie,3,0);var Ae=new B;Ae.name="Button Grid",Ae.height=.8;var Fe=1/3;Ae.addRowDefinition(Fe,!1),Ae.addRowDefinition(Fe,!1),Ae.addRowDefinition(Fe,!1),be.addControl(Ae,0,1),l=Math.floor(parseInt(i.pickerWidth)*pe[1]*ye[1]*.67).toString()+"px",h=Math.floor(parseInt(i.pickerHeight)*ue[1]*ve[0]*(parseFloat(Ae.height.toString())/100)*Fe*.7).toString()+"px",s=parseFloat(l)>parseFloat(h)?Math.floor(.45*parseFloat(h)):Math.floor(.11*parseFloat(l));var Le=I.CreateSimpleButton("butOK","OK");Le.width=l,Le.height=h,Le.verticalAlignment=x.VERTICAL_ALIGNMENT_CENTER,Le.thickness=2,Le.color=k,Le.fontSize=s,Le.background=V,Le.onPointerEnterObservable.add((function(){Le.background=U})),Le.onPointerOutObservable.add((function(){Le.background=V})),Le.pointerDownAnimation=function(){Le.background=W},Le.pointerUpAnimation=function(){Le.background=U},Le.onPointerClickObservable.add((function(){$(!1),ie(P.background)})),Ae.addControl(Le,0,0);var De=I.CreateSimpleButton("butCancel","Cancel");if(De.width=l,De.height=h,De.verticalAlignment=x.VERTICAL_ALIGNMENT_CENTER,De.thickness=2,De.color=k,De.fontSize=s,De.background=V,De.onPointerEnterObservable.add((function(){De.background=U})),De.onPointerOutObservable.add((function(){De.background=V})),De.pointerDownAnimation=function(){De.background=W},De.pointerUpAnimation=function(){De.background=U},De.onPointerClickObservable.add((function(){$(!1),ie(Me.background)})),Ae.addControl(De,1,0),i.savedColors){var Re=I.CreateSimpleButton("butSave","Save");Re.width=l,Re.height=h,Re.verticalAlignment=x.VERTICAL_ALIGNMENT_CENTER,Re.thickness=2,Re.fontSize=s,i.savedColors.length<i.swatchLimit?(Re.color=k,Re.background=V):te(Re,!0),Re.onPointerEnterObservable.add((function(){i.savedColors&&i.savedColors.length<i.swatchLimit&&(Re.background=U)})),Re.onPointerOutObservable.add((function(){i.savedColors&&i.savedColors.length<i.swatchLimit&&(Re.background=V)})),Re.pointerDownAnimation=function(){i.savedColors&&i.savedColors.length<i.swatchLimit&&(Re.background=W)},Re.pointerUpAnimation=function(){i.savedColors&&i.savedColors.length<i.swatchLimit&&(Re.background=U)},Re.onPointerClickObservable.add((function(){i.savedColors&&(0==i.savedColors.length&&ee(!0),i.savedColors.length<i.swatchLimit&&J(P.background,Re),$(!1))})),i.savedColors.length>0&&ee(!0),Ae.addControl(Re,2,0)}var Be=new B;Be.name="Dialog Lower Right",Be.addRowDefinition(.02,!1),Be.addRowDefinition(.63,!1),Be.addRowDefinition(.21,!1),Be.addRowDefinition(.14,!1),me.addControl(Be,1,0),u=N.Wo.FromHexString(i.lastColor);var Ne=new B;for(Ne.name="RGB Values",Ne.width=.82,Ne.verticalAlignment=x.VERTICAL_ALIGNMENT_CENTER,Ne.addRowDefinition(1/3,!1),Ne.addRowDefinition(1/3,!1),Ne.addRowDefinition(1/3,!1),Ne.addColumnDefinition(.1,!1),Ne.addColumnDefinition(.2,!1),Ne.addColumnDefinition(.7,!1),Be.addControl(Ne,1,0),ae=0;ae<G.length;ae++)(ke=new M).text=G[ae],ke.color=k,ke.fontSize=s,Ne.addControl(ke,ae,0);(d=new R).width=.83,d.height=.72,d.name="rIntField",d.fontSize=s,d.text=(255*u.r).toString(),d.color=Q,d.background=j,d.onFocusObservable.add((function(){T=d.name,C=d.text,$(!1)})),d.onBlurObservable.add((function(){""==d.text&&(d.text="0"),Y(d,"r"),T==d.name&&(T="")})),d.onTextChangedObservable.add((function(){T==d.name&&Y(d,"r")})),Ne.addControl(d,0,1),(p=new R).width=.83,p.height=.72,p.name="gIntField",p.fontSize=s,p.text=(255*u.g).toString(),p.color=Q,p.background=j,p.onFocusObservable.add((function(){T=p.name,C=p.text,$(!1)})),p.onBlurObservable.add((function(){""==p.text&&(p.text="0"),Y(p,"g"),T==p.name&&(T="")})),p.onTextChangedObservable.add((function(){T==p.name&&Y(p,"g")})),Ne.addControl(p,1,1),(g=new R).width=.83,g.height=.72,g.name="bIntField",g.fontSize=s,g.text=(255*u.b).toString(),g.color=Q,g.background=j,g.onFocusObservable.add((function(){T=g.name,C=g.text,$(!1)})),g.onBlurObservable.add((function(){""==g.text&&(g.text="0"),Y(g,"b"),T==g.name&&(T="")})),g.onTextChangedObservable.add((function(){T==g.name&&Y(g,"b")})),Ne.addControl(g,2,1),(m=new R).width=.95,m.height=.72,m.name="rDecField",m.fontSize=s,m.text=u.r.toString(),m.color=Q,m.background=j,m.onFocusObservable.add((function(){T=m.name,C=m.text,$(!1)})),m.onBlurObservable.add((function(){0!=parseFloat(m.text)&&""!=m.text||(m.text="0",Z(m,"r")),T==m.name&&(T="")})),m.onTextChangedObservable.add((function(){T==m.name&&Z(m,"r")})),Ne.addControl(m,0,2),(v=new R).width=.95,v.height=.72,v.name="gDecField",v.fontSize=s,v.text=u.g.toString(),v.color=Q,v.background=j,v.onFocusObservable.add((function(){T=v.name,C=v.text,$(!1)})),v.onBlurObservable.add((function(){0!=parseFloat(v.text)&&""!=v.text||(v.text="0",Z(v,"g")),T==v.name&&(T="")})),v.onTextChangedObservable.add((function(){T==v.name&&Z(v,"g")})),Ne.addControl(v,1,2),(b=new R).width=.95,b.height=.72,b.name="bDecField",b.fontSize=s,b.text=u.b.toString(),b.color=Q,b.background=j,b.onFocusObservable.add((function(){T=b.name,C=b.text,$(!1)})),b.onBlurObservable.add((function(){0!=parseFloat(b.text)&&""!=b.text||(b.text="0",Z(b,"b")),T==b.name&&(T="")})),b.onTextChangedObservable.add((function(){T==b.name&&Z(b,"b")})),Ne.addControl(b,2,2);var ke,Ve=new B;Ve.name="Hex Value",Ve.width=.82,Ve.addRowDefinition(1,!1),Ve.addColumnDefinition(.1,!1),Ve.addColumnDefinition(.9,!1),Be.addControl(Ve,2,0),(ke=new M).text="#",ke.color=k,ke.fontSize=s,Ve.addControl(ke,0,0),(y=new R).width=.96,y.height=.72,y.name="hexField",y.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_CENTER,y.fontSize=s;var Ue=i.lastColor.split("#");y.text=Ue[1],y.color=Q,y.background=j,y.onFocusObservable.add((function(){T=y.name,C=y.text,$(!1)})),y.onBlurObservable.add((function(){if(3==y.text.length){var e=y.text.split("");y.text=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}""==y.text&&(y.text="000000",q(N.Wo.FromHexString(y.text),"b")),T==y.name&&(T="")})),y.onTextChangedObservable.add((function(){var e=y.text,t=/[^0-9A-F]/i.test(e);if((y.text.length>6||t)&&T==y.name)y.text=C;else{if(y.text.length<6)for(var i=6-y.text.length,n=0;n<i;n++)e="0"+e;if(3==y.text.length){var r=y.text.split("");e=r[0]+r[0]+r[1]+r[1]+r[2]+r[2]}e="#"+e,T==y.name&&(C=y.text,q(N.Wo.FromHexString(e),y.name))}})),Ve.addControl(y,0,1),i.savedColors&&i.savedColors.length>0&&J("",Re)}))},t._Epsilon=1e-6,(0,n.gn)([(0,b.qC)()],t.prototype,"value",null),(0,n.gn)([(0,b.qC)()],t.prototype,"width",null),(0,n.gn)([(0,b.qC)()],t.prototype,"height",null),(0,n.gn)([(0,b.qC)()],t.prototype,"size",null),t}(x);v.Q.RegisteredTypes["BABYLON.GUI.ColorPicker"]=k;var V=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i._thickness=1,i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"Ellipse"},t.prototype._localDraw=function(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),x.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,e),this._background&&(e.fillStyle=this._background,e.fill()),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._thickness&&(this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.stroke()),e.restore()},t.prototype._additionalProcessing=function(t,i){e.prototype._additionalProcessing.call(this,t,i),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness},t.prototype._clipForChildren=function(e){x.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2,this._currentMeasure.height/2,e),e.clip()},(0,n.gn)([(0,b.qC)()],t.prototype,"thickness",null),t}(S);v.Q.RegisteredTypes["BABYLON.GUI.Ellipse"]=V;var U=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i.focusedColor=null,i._isFocused=!1,i._unfocusedColor=null,i.onFocusObservable=new o.y$,i.onBlurObservable=new o.y$,i.onKeyboardEventProcessedObservable=new o.y$,i._unfocusedColor=i.color,i}return(0,n.ZT)(t,e),t.prototype.onBlur=function(){this._isFocused&&(this._isFocused=!1,this.focusedColor&&null!=this._unfocusedColor&&(this.color=this._unfocusedColor),this.onBlurObservable.notifyObservers(this))},t.prototype.onFocus=function(){this._isFocused=!0,this.focusedColor&&(this._unfocusedColor=this.color,this.color=this.focusedColor),this.onFocusObservable.notifyObservers(this)},t.prototype.keepsFocusWith=function(){return null},t.prototype.focus=function(){this._host.moveFocusToControl(this)},t.prototype.blur=function(){this._host.focusedControl=null},t.prototype.processKeyboard=function(e){this.onKeyboardEventProcessedObservable.notifyObservers(e,-1,this)},t.prototype._onPointerDown=function(t,i,n,r,o){return this.focus(),e.prototype._onPointerDown.call(this,t,i,n,r,o)},t.prototype.displose=function(){e.prototype.dispose.call(this),this.onBlurObservable.clear(),this.onFocusObservable.clear(),this.onKeyboardEventProcessedObservable.clear()},t}(I);v.Q.RegisteredTypes["BABYLON.GUI.FocusableButton"]=U;var W=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.ZT)(t,e),t.prototype._beforeRenderText=function(e){for(var t=new D,i="",n=0;n<e.length;n++)i+="•";return t.text=i,t},t}(R);v.Q.RegisteredTypes["BABYLON.GUI.InputPassword"]=W;var z=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i._lineWidth=1,i._x1=new h(0),i._y1=new h(0),i._x2=new h(0),i._y2=new h(0),i._dash=new Array,i._automaticSize=!0,i.isHitTestVisible=!1,i._horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,i._verticalAlignment=x.VERTICAL_ALIGNMENT_TOP,i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"dash",{get:function(){return this._dash},set:function(e){this._dash!==e&&(this._dash=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"connectedControl",{get:function(){return this._connectedControl},set:function(e){var t=this;this._connectedControl!==e&&(this._connectedControlDirtyObserver&&this._connectedControl&&(this._connectedControl.onDirtyObservable.remove(this._connectedControlDirtyObserver),this._connectedControlDirtyObserver=null),e&&(this._connectedControlDirtyObserver=e.onDirtyObservable.add((function(){return t._markAsDirty()}))),this._connectedControl=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x1",{get:function(){return this._x1.toString(this._host)},set:function(e){this._x1.toString(this._host)!==e&&this._x1.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y1",{get:function(){return this._y1.toString(this._host)},set:function(e){this._y1.toString(this._host)!==e&&this._y1.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x2",{get:function(){return this._x2.toString(this._host)},set:function(e){this._x2.toString(this._host)!==e&&this._x2.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y2",{get:function(){return this._y2.toString(this._host)},set:function(e){this._y2.toString(this._host)!==e&&this._y2.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(e){this._lineWidth!==e&&(this._lineWidth=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"horizontalAlignment",{set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"verticalAlignment",{set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_effectiveX2",{get:function(){return(this._connectedControl?this._connectedControl.centerX:0)+this._x2.getValue(this._host)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_effectiveY2",{get:function(){return(this._connectedControl?this._connectedControl.centerY:0)+this._y2.getValue(this._host)},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"Line"},t.prototype._draw=function(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._applyStates(e),e.strokeStyle=this.color,e.lineWidth=this._lineWidth,e.setLineDash(this._dash),e.beginPath(),e.moveTo(this._cachedParentMeasure.left+this._x1.getValue(this._host),this._cachedParentMeasure.top+this._y1.getValue(this._host)),e.lineTo(this._cachedParentMeasure.left+this._effectiveX2,this._cachedParentMeasure.top+this._effectiveY2),e.stroke(),e.restore()},t.prototype._measure=function(){this._currentMeasure.width=Math.abs(this._x1.getValue(this._host)-this._effectiveX2)+this._lineWidth,this._currentMeasure.height=Math.abs(this._y1.getValue(this._host)-this._effectiveY2)+this._lineWidth},t.prototype._computeAlignment=function(e,t){this._currentMeasure.left=e.left+Math.min(this._x1.getValue(this._host),this._effectiveX2)-this._lineWidth/2,this._currentMeasure.top=e.top+Math.min(this._y1.getValue(this._host),this._effectiveY2)-this._lineWidth/2},t.prototype.moveToVector3=function(e,t,i){if(void 0===i&&(i=!1),this._host&&this.parent===this._host._rootContainer){var n=this._host._getGlobalViewport(),r=s.P.Project(e,s.y3.Identity(),t.getTransformMatrix(),n);this._moveToProjectedPosition(r,i),r.z<0||r.z>1?this.notRenderable=!0:this.notRenderable=!1}else l.w1.Error("Cannot move a control to a vector3 if the control is not at root level")},t.prototype._moveToProjectedPosition=function(e,t){void 0===t&&(t=!1);var i=e.x+this._linkOffsetX.getValue(this._host)+"px",n=e.y+this._linkOffsetY.getValue(this._host)+"px";t?(this.x2=i,this.y2=n,this._x2.ignoreAdaptiveScaling=!0,this._y2.ignoreAdaptiveScaling=!0):(this.x1=i,this.y1=n,this._x1.ignoreAdaptiveScaling=!0,this._y1.ignoreAdaptiveScaling=!0)},(0,n.gn)([(0,b.qC)()],t.prototype,"dash",null),(0,n.gn)([(0,b.qC)()],t.prototype,"x1",null),(0,n.gn)([(0,b.qC)()],t.prototype,"y1",null),(0,n.gn)([(0,b.qC)()],t.prototype,"x2",null),(0,n.gn)([(0,b.qC)()],t.prototype,"y2",null),(0,n.gn)([(0,b.qC)()],t.prototype,"lineWidth",null),t}(x);v.Q.RegisteredTypes["BABYLON.GUI.Line"]=z;var H=i(24),G=function(){function e(e){this._multiLine=e,this._x=new h(0),this._y=new h(0),this._point=new s.P(0,0,0)}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x.toString(this._multiLine._host)},set:function(e){this._x.toString(this._multiLine._host)!==e&&this._x.fromString(e)&&this._multiLine._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y.toString(this._multiLine._host)},set:function(e){this._y.toString(this._multiLine._host)!==e&&this._y.fromString(e)&&this._multiLine._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"control",{get:function(){return this._control},set:function(e){this._control!==e&&(this._control&&this._controlObserver&&(this._control.onDirtyObservable.remove(this._controlObserver),this._controlObserver=null),this._control=e,this._control&&(this._controlObserver=this._control.onDirtyObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},set:function(e){this._mesh!==e&&(this._mesh&&this._meshObserver&&this._mesh.getScene().onAfterCameraRenderObservable.remove(this._meshObserver),this._mesh=e,this._mesh&&(this._meshObserver=this._mesh.getScene().onAfterCameraRenderObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())},enumerable:!1,configurable:!0}),e.prototype.resetLinks=function(){this.control=null,this.mesh=null},e.prototype.translate=function(){return this._point=this._translatePoint(),this._point},e.prototype._translatePoint=function(){if(null!=this._mesh)return this._multiLine._host.getProjectedPositionWithZ(this._mesh.getBoundingInfo().boundingSphere.center,this._mesh.getWorldMatrix());if(null!=this._control)return new s.P(this._control.centerX,this._control.centerY,1-p.kn);var e=this._multiLine._host,t=this._x.getValueInPixel(e,Number(e._canvas.width)),i=this._y.getValueInPixel(e,Number(e._canvas.height));return new s.P(t,i,1-p.kn)},e.prototype.dispose=function(){this.resetLinks()},e}(),j=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i._lineWidth=1,i.onPointUpdate=function(){i._markAsDirty()},i._automaticSize=!0,i.isHitTestVisible=!1,i._horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,i._verticalAlignment=x.VERTICAL_ALIGNMENT_TOP,i._dash=[],i._points=[],i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"dash",{get:function(){return this._dash},set:function(e){this._dash!==e&&(this._dash=e,this._markAsDirty())},enumerable:!1,configurable:!0}),t.prototype.getAt=function(e){return this._points[e]||(this._points[e]=new G(this)),this._points[e]},t.prototype.add=function(){for(var e=this,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return t.map((function(t){return e.push(t)}))},t.prototype.push=function(e){var t=this.getAt(this._points.length);return null==e||(e instanceof H.x?t.mesh=e:e instanceof x?t.control=e:null!=e.x&&null!=e.y&&(t.x=e.x,t.y=e.y)),t},t.prototype.remove=function(e){var t;if(e instanceof G){if(-1===(t=this._points.indexOf(e)))return}else t=e;var i=this._points[t];i&&(i.dispose(),this._points.splice(t,1))},t.prototype.reset=function(){for(;this._points.length>0;)this.remove(this._points.length-1)},t.prototype.resetLinks=function(){this._points.forEach((function(e){null!=e&&e.resetLinks()}))},Object.defineProperty(t.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(e){this._lineWidth!==e&&(this._lineWidth=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"horizontalAlignment",{set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"verticalAlignment",{set:function(e){},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"MultiLine"},t.prototype._draw=function(e,t){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._applyStates(e),e.strokeStyle=this.color,e.lineWidth=this._lineWidth,e.setLineDash(this._dash),e.beginPath();var i,n=!0;this._points.forEach((function(t){t&&(n?(e.moveTo(t._point.x,t._point.y),n=!1):t._point.z<1&&i.z<1?e.lineTo(t._point.x,t._point.y):e.moveTo(t._point.x,t._point.y),i=t._point)})),e.stroke(),e.restore()},t.prototype._additionalProcessing=function(e,t){var i=this;this._minX=null,this._minY=null,this._maxX=null,this._maxY=null,this._points.forEach((function(e,t){e&&(e.translate(),(null==i._minX||e._point.x<i._minX)&&(i._minX=e._point.x),(null==i._minY||e._point.y<i._minY)&&(i._minY=e._point.y),(null==i._maxX||e._point.x>i._maxX)&&(i._maxX=e._point.x),(null==i._maxY||e._point.y>i._maxY)&&(i._maxY=e._point.y))})),null==this._minX&&(this._minX=0),null==this._minY&&(this._minY=0),null==this._maxX&&(this._maxX=0),null==this._maxY&&(this._maxY=0)},t.prototype._measure=function(){null!=this._minX&&null!=this._maxX&&null!=this._minY&&null!=this._maxY&&(this._currentMeasure.width=Math.abs(this._maxX-this._minX)+this._lineWidth,this._currentMeasure.height=Math.abs(this._maxY-this._minY)+this._lineWidth)},t.prototype._computeAlignment=function(e,t){null!=this._minX&&null!=this._minY&&(this._currentMeasure.left=this._minX-this._lineWidth/2,this._currentMeasure.top=this._minY-this._lineWidth/2)},t.prototype.dispose=function(){this.reset(),e.prototype.dispose.call(this)},(0,n.gn)([(0,b.qC)()],t.prototype,"dash",null),t}(x);v.Q.RegisteredTypes["BABYLON.GUI.MultiLine"]=j;var Q=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i._isChecked=!1,i._background="black",i._checkSizeRatio=.8,i._thickness=1,i.group="",i.onIsCheckedChangedObservable=new o.y$,i.isPointerBlocker=!0,i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"checkSizeRatio",{get:function(){return this._checkSizeRatio},set:function(e){e=Math.max(Math.min(1,e),0),this._checkSizeRatio!==e&&(this._checkSizeRatio=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isChecked",{get:function(){return this._isChecked},set:function(e){var t=this;this._isChecked!==e&&(this._isChecked=e,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(e),this._isChecked&&this._host&&this._host.executeOnAllControls((function(e){if(e!==t&&void 0!==e.group){var i=e;i.group===t.group&&(i.isChecked=!1)}})))},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"RadioButton"},t.prototype._draw=function(e){e.save(),this._applyStates(e);var t=this._currentMeasure.width-this._thickness,i=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),x.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,e),e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this.color,e.lineWidth=this._thickness,e.stroke(),this._isChecked){e.fillStyle=this._isEnabled?this.color:this._disabledColor;var n=t*this._checkSizeRatio,r=i*this._checkSizeRatio;x.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,n/2-this._thickness/2,r/2-this._thickness/2,e),e.fill()}e.restore()},t.prototype._onPointerDown=function(t,i,n,r,o){return!!e.prototype._onPointerDown.call(this,t,i,n,r,o)&&(this.isChecked||(this.isChecked=!0),!0)},t.AddRadioButtonWithHeader=function(e,i,n,r){var o=new A;o.isVertical=!1,o.height="30px";var s=new t;s.width="20px",s.height="20px",s.isChecked=n,s.color="green",s.group=i,s.onIsCheckedChangedObservable.add((function(e){return r(s,e)})),o.addControl(s);var a=new M;return a.text=e,a.width="180px",a.paddingLeft="5px",a.textHorizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,a.color="white",o.addControl(a),o},(0,n.gn)([(0,b.qC)()],t.prototype,"thickness",null),(0,n.gn)([(0,b.qC)()],t.prototype,"group",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"checkSizeRatio",null),(0,n.gn)([(0,b.qC)()],t.prototype,"background",null),(0,n.gn)([(0,b.qC)()],t.prototype,"isChecked",null),t}(x);v.Q.RegisteredTypes["BABYLON.GUI.RadioButton"]=Q;var X=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i._thumbWidth=new h(20,h.UNITMODE_PIXEL,!1),i._minimum=0,i._maximum=100,i._value=50,i._isVertical=!1,i._barOffset=new h(5,h.UNITMODE_PIXEL,!1),i._isThumbClamped=!1,i._displayThumb=!0,i._step=0,i._lastPointerDownId=-1,i._effectiveBarOffset=0,i.onValueChangedObservable=new o.y$,i._pointerIsDown=!1,i.isPointerBlocker=!0,i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"displayThumb",{get:function(){return this._displayThumb},set:function(e){this._displayThumb!==e&&(this._displayThumb=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"step",{get:function(){return this._step},set:function(e){this._step!==e&&(this._step=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"barOffset",{get:function(){return this._barOffset.toString(this._host)},set:function(e){this._barOffset.toString(this._host)!==e&&this._barOffset.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"barOffsetInPixels",{get:function(){return this._barOffset.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thumbWidth",{get:function(){return this._thumbWidth.toString(this._host)},set:function(e){this._thumbWidth.toString(this._host)!==e&&this._thumbWidth.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thumbWidthInPixels",{get:function(){return this._thumbWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minimum",{get:function(){return this._minimum},set:function(e){this._minimum!==e&&(this._minimum=e,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maximum",{get:function(){return this._maximum},set:function(e){this._maximum!==e&&(this._maximum=e,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(e){e=Math.max(Math.min(e,this._maximum),this._minimum),this._value!==e&&(this._value=e,this._markAsDirty(),this.onValueChangedObservable.notifyObservers(this._value))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isVertical",{get:function(){return this._isVertical},set:function(e){this._isVertical!==e&&(this._isVertical=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isThumbClamped",{get:function(){return this._isThumbClamped},set:function(e){this._isThumbClamped!==e&&(this._isThumbClamped=e,this._markAsDirty())},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"BaseSlider"},t.prototype._getThumbPosition=function(){return this.isVertical?(this.maximum-this.value)/(this.maximum-this.minimum)*this._backgroundBoxLength:(this.value-this.minimum)/(this.maximum-this.minimum)*this._backgroundBoxLength},t.prototype._getThumbThickness=function(e){var t=0;switch(e){case"circle":t=this._thumbWidth.isPixel?Math.max(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host);break;case"rectangle":t=this._thumbWidth.isPixel?Math.min(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)}return t},t.prototype._prepareRenderingData=function(e){this._effectiveBarOffset=0,this._renderLeft=this._currentMeasure.left,this._renderTop=this._currentMeasure.top,this._renderWidth=this._currentMeasure.width,this._renderHeight=this._currentMeasure.height,this._backgroundBoxLength=Math.max(this._currentMeasure.width,this._currentMeasure.height),this._backgroundBoxThickness=Math.min(this._currentMeasure.width,this._currentMeasure.height),this._effectiveThumbThickness=this._getThumbThickness(e),this.displayThumb&&(this._backgroundBoxLength-=this._effectiveThumbThickness),this.isVertical&&this._currentMeasure.height<this._currentMeasure.width?console.error("Height should be greater than width"):(this._barOffset.isPixel?this._effectiveBarOffset=Math.min(this._barOffset.getValue(this._host),this._backgroundBoxThickness):this._effectiveBarOffset=this._backgroundBoxThickness*this._barOffset.getValue(this._host),this._backgroundBoxThickness-=2*this._effectiveBarOffset,this.isVertical?(this._renderLeft+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderTop+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxLength,this._renderWidth=this._backgroundBoxThickness):(this._renderTop+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderLeft+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxThickness,this._renderWidth=this._backgroundBoxLength))},t.prototype._updateValueFromPointer=function(e,t){var i;0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y),i=this._isVertical?this._minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this._maximum-this._minimum):this._minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this._maximum-this._minimum),this.value=this._step?(i/this._step|0)*this._step:i},t.prototype._onPointerDown=function(t,i,n,r,o){return!!e.prototype._onPointerDown.call(this,t,i,n,r,o)&&(this._pointerIsDown=!0,this._updateValueFromPointer(i.x,i.y),this._host._capturingControl[n]=this,this._lastPointerDownId=n,!0)},t.prototype._onPointerMove=function(t,i,n,r){n==this._lastPointerDownId&&(this._pointerIsDown&&this._updateValueFromPointer(i.x,i.y),e.prototype._onPointerMove.call(this,t,i,n,r))},t.prototype._onPointerUp=function(t,i,n,r,o){this._pointerIsDown=!1,delete this._host._capturingControl[n],e.prototype._onPointerUp.call(this,t,i,n,r,o)},t.prototype._onCanvasBlur=function(){this._forcePointerUp(),e.prototype._onCanvasBlur.call(this)},(0,n.gn)([(0,b.qC)()],t.prototype,"displayThumb",null),(0,n.gn)([(0,b.qC)()],t.prototype,"step",null),(0,n.gn)([(0,b.qC)()],t.prototype,"barOffset",null),(0,n.gn)([(0,b.qC)()],t.prototype,"thumbWidth",null),(0,n.gn)([(0,b.qC)()],t.prototype,"minimum",null),(0,n.gn)([(0,b.qC)()],t.prototype,"maximum",null),(0,n.gn)([(0,b.qC)()],t.prototype,"value",null),(0,n.gn)([(0,b.qC)()],t.prototype,"isVertical",null),(0,n.gn)([(0,b.qC)()],t.prototype,"isThumbClamped",null),t}(x),q=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i._background="black",i._borderColor="white",i._thumbColor="",i._isThumbCircle=!1,i._displayValueBar=!0,i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"displayValueBar",{get:function(){return this._displayValueBar},set:function(e){this._displayValueBar!==e&&(this._displayValueBar=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"borderColor",{get:function(){return this._borderColor},set:function(e){this._borderColor!==e&&(this._borderColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thumbColor",{get:function(){return this._thumbColor},set:function(e){this._thumbColor!==e&&(this._thumbColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isThumbCircle",{get:function(){return this._isThumbCircle},set:function(e){this._isThumbCircle!==e&&(this._isThumbCircle=e,this._markAsDirty())},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"Slider"},t.prototype._draw=function(e,t){e.save(),this._applyStates(e),this._prepareRenderingData(this.isThumbCircle?"circle":"rectangle");var i=this._renderLeft,n=this._renderTop,r=this._renderWidth,o=this._renderHeight,s=0;this.isThumbClamped&&this.isThumbCircle?(this.isVertical?n+=this._effectiveThumbThickness/2:i+=this._effectiveThumbThickness/2,s=this._backgroundBoxThickness/2):s=(this._effectiveThumbThickness-this._effectiveBarOffset)/2,(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY);var a=this._getThumbPosition();e.fillStyle=this._background,this.isVertical?this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(i+this._backgroundBoxThickness/2,n,s,Math.PI,2*Math.PI),e.fill(),e.fillRect(i,n,r,o)):e.fillRect(i,n,r,o+this._effectiveThumbThickness):e.fillRect(i,n,r,o):this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(i+this._backgroundBoxLength,n+this._backgroundBoxThickness/2,s,0,2*Math.PI),e.fill(),e.fillRect(i,n,r,o)):e.fillRect(i,n,r+this._effectiveThumbThickness,o):e.fillRect(i,n,r,o),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.fillStyle=this.color,this._displayValueBar&&(this.isVertical?this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(i+this._backgroundBoxThickness/2,n+this._backgroundBoxLength,s,0,2*Math.PI),e.fill(),e.fillRect(i,n+a,r,o-a)):e.fillRect(i,n+a,r,o-a+this._effectiveThumbThickness):e.fillRect(i,n+a,r,o-a):this.isThumbClamped&&this.isThumbCircle?(e.beginPath(),e.arc(i,n+this._backgroundBoxThickness/2,s,0,2*Math.PI),e.fill(),e.fillRect(i,n,a,o)):e.fillRect(i,n,a,o)),e.fillStyle=this._thumbColor||this.color,this.displayThumb&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._isThumbCircle?(e.beginPath(),this.isVertical?e.arc(i+this._backgroundBoxThickness/2,n+a,s,0,2*Math.PI):e.arc(i+a,n+this._backgroundBoxThickness/2,s,0,2*Math.PI),e.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this._borderColor,e.stroke()):(this.isVertical?e.fillRect(i-this._effectiveBarOffset,this._currentMeasure.top+a,this._currentMeasure.width,this._effectiveThumbThickness):e.fillRect(this._currentMeasure.left+a,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this._borderColor,this.isVertical?e.strokeRect(i-this._effectiveBarOffset,this._currentMeasure.top+a,this._currentMeasure.width,this._effectiveThumbThickness):e.strokeRect(this._currentMeasure.left+a,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height))),e.restore()},(0,n.gn)([(0,b.qC)()],t.prototype,"displayValueBar",null),(0,n.gn)([(0,b.qC)()],t.prototype,"borderColor",null),(0,n.gn)([(0,b.qC)()],t.prototype,"background",null),(0,n.gn)([(0,b.qC)()],t.prototype,"thumbColor",null),(0,n.gn)([(0,b.qC)()],t.prototype,"isThumbCircle",null),t}(X);v.Q.RegisteredTypes["BABYLON.GUI.Slider"]=q;var Y=function(){function e(e){this.name=e,this._groupPanel=new A,this._selectors=new Array,this._groupPanel.verticalAlignment=x.VERTICAL_ALIGNMENT_TOP,this._groupPanel.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,this._groupHeader=this._addGroupHeader(e)}return Object.defineProperty(e.prototype,"groupPanel",{get:function(){return this._groupPanel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectors",{get:function(){return this._selectors},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"header",{get:function(){return this._groupHeader.text},set:function(e){"label"!==this._groupHeader.text&&(this._groupHeader.text=e)},enumerable:!1,configurable:!0}),e.prototype._addGroupHeader=function(e){var t=new M("groupHead",e);return t.width=.9,t.height="30px",t.textWrapping=!0,t.color="black",t.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,t.textHorizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,t.left="2px",this._groupPanel.addControl(t),t},e.prototype._getSelector=function(e){if(!(e<0||e>=this._selectors.length))return this._selectors[e]},e.prototype.removeSelector=function(e){e<0||e>=this._selectors.length||(this._groupPanel.removeControl(this._selectors[e]),this._selectors.splice(e,1))},e}(),Z=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}(0,n.ZT)(t,e),t.prototype.addCheckbox=function(e,t,i){void 0===t&&(t=function(e){}),void 0===i&&(i=!1),i=i||!1;var n=new F;n.width="20px",n.height="20px",n.color="#364249",n.background="#CCCCCC",n.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,n.onIsCheckedChangedObservable.add((function(e){t(e)}));var r=x.AddHeader(n,e,"200px",{isHorizontal:!0,controlFirst:!0});r.height="30px",r.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,r.left="4px",this.groupPanel.addControl(r),this.selectors.push(r),n.isChecked=i,this.groupPanel.parent&&this.groupPanel.parent.parent&&(n.color=this.groupPanel.parent.parent.buttonColor,n.background=this.groupPanel.parent.parent.buttonBackground)},t.prototype._setSelectorLabel=function(e,t){this.selectors[e].children[1].text=t},t.prototype._setSelectorLabelColor=function(e,t){this.selectors[e].children[1].color=t},t.prototype._setSelectorButtonColor=function(e,t){this.selectors[e].children[0].color=t},t.prototype._setSelectorButtonBackground=function(e,t){this.selectors[e].children[0].background=t}}(Y),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._selectNb=0,t}(0,n.ZT)(t,e),t.prototype.addRadio=function(e,t,i){void 0===t&&(t=function(e){}),void 0===i&&(i=!1);var n=this._selectNb++,r=new Q;r.name=e,r.width="20px",r.height="20px",r.color="#364249",r.background="#CCCCCC",r.group=this.name,r.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,r.onIsCheckedChangedObservable.add((function(e){e&&t(n)}));var o=x.AddHeader(r,e,"200px",{isHorizontal:!0,controlFirst:!0});o.height="30px",o.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,o.left="4px",this.groupPanel.addControl(o),this.selectors.push(o),r.isChecked=i,this.groupPanel.parent&&this.groupPanel.parent.parent&&(r.color=this.groupPanel.parent.parent.buttonColor,r.background=this.groupPanel.parent.parent.buttonBackground)},t.prototype._setSelectorLabel=function(e,t){this.selectors[e].children[1].text=t},t.prototype._setSelectorLabelColor=function(e,t){this.selectors[e].children[1].color=t},t.prototype._setSelectorButtonColor=function(e,t){this.selectors[e].children[0].color=t},t.prototype._setSelectorButtonBackground=function(e,t){this.selectors[e].children[0].background=t}}(Y),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}(0,n.ZT)(t,e),t.prototype.addSlider=function(e,t,i,n,r,o,s){void 0===t&&(t=function(e){}),void 0===i&&(i="Units"),void 0===n&&(n=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===s&&(s=function(e){return 0|e});var a=new q;a.name=i,a.value=o,a.minimum=n,a.maximum=r,a.width=.9,a.height="20px",a.color="#364249",a.background="#CCCCCC",a.borderColor="black",a.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,a.left="4px",a.paddingBottom="4px",a.onValueChangedObservable.add((function(e){a.parent.children[0].text=a.parent.children[0].name+": "+s(e)+" "+a.name,t(e)}));var l=x.AddHeader(a,e+": "+s(o)+" "+i,"30px",{isHorizontal:!1,controlFirst:!1});l.height="60px",l.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,l.left="4px",l.children[0].name=e,this.groupPanel.addControl(l),this.selectors.push(l),this.groupPanel.parent&&this.groupPanel.parent.parent&&(a.color=this.groupPanel.parent.parent.buttonColor,a.background=this.groupPanel.parent.parent.buttonBackground)},t.prototype._setSelectorLabel=function(e,t){this.selectors[e].children[0].name=t,this.selectors[e].children[0].text=t+": "+this.selectors[e].children[1].value+" "+this.selectors[e].children[1].name},t.prototype._setSelectorLabelColor=function(e,t){this.selectors[e].children[0].color=t},t.prototype._setSelectorButtonColor=function(e,t){this.selectors[e].children[1].color=t},t.prototype._setSelectorButtonBackground=function(e,t){this.selectors[e].children[1].background=t}}(Y),function(e){function t(t,i){void 0===i&&(i=[]);var n=e.call(this,t)||this;if(n.name=t,n.groups=i,n._buttonColor="#364249",n._buttonBackground="#CCCCCC",n._headerColor="black",n._barColor="white",n._barHeight="2px",n._spacerHeight="20px",n._bars=new Array,n._groups=i,n.thickness=2,n._panel=new A,n._panel.verticalAlignment=x.VERTICAL_ALIGNMENT_TOP,n._panel.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,n._panel.top=5,n._panel.left=5,n._panel.width=.95,i.length>0){for(var r=0;r<i.length-1;r++)n._panel.addControl(i[r].groupPanel),n._addSpacer();n._panel.addControl(i[i.length-1].groupPanel)}return n.addControl(n._panel),n}(0,n.ZT)(t,e),t.prototype._getTypeName=function(){return"SelectionPanel"},Object.defineProperty(t.prototype,"panel",{get:function(){return this._panel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"headerColor",{get:function(){return this._headerColor},set:function(e){this._headerColor!==e&&(this._headerColor=e,this._setHeaderColor())},enumerable:!1,configurable:!0}),t.prototype._setHeaderColor=function(){for(var e=0;e<this._groups.length;e++)this._groups[e].groupPanel.children[0].color=this._headerColor},Object.defineProperty(t.prototype,"buttonColor",{get:function(){return this._buttonColor},set:function(e){this._buttonColor!==e&&(this._buttonColor=e,this._setbuttonColor())},enumerable:!1,configurable:!0}),t.prototype._setbuttonColor=function(){for(var e=0;e<this._groups.length;e++)for(var t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorButtonColor(t,this._buttonColor)},Object.defineProperty(t.prototype,"labelColor",{get:function(){return this._labelColor},set:function(e){this._labelColor!==e&&(this._labelColor=e,this._setLabelColor())},enumerable:!1,configurable:!0}),t.prototype._setLabelColor=function(){for(var e=0;e<this._groups.length;e++)for(var t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorLabelColor(t,this._labelColor)},Object.defineProperty(t.prototype,"buttonBackground",{get:function(){return this._buttonBackground},set:function(e){this._buttonBackground!==e&&(this._buttonBackground=e,this._setButtonBackground())},enumerable:!1,configurable:!0}),t.prototype._setButtonBackground=function(){for(var e=0;e<this._groups.length;e++)for(var t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorButtonBackground(t,this._buttonBackground)},Object.defineProperty(t.prototype,"barColor",{get:function(){return this._barColor},set:function(e){this._barColor!==e&&(this._barColor=e,this._setBarColor())},enumerable:!1,configurable:!0}),t.prototype._setBarColor=function(){for(var e=0;e<this._bars.length;e++)this._bars[e].children[0].background=this._barColor},Object.defineProperty(t.prototype,"barHeight",{get:function(){return this._barHeight},set:function(e){this._barHeight!==e&&(this._barHeight=e,this._setBarHeight())},enumerable:!1,configurable:!0}),t.prototype._setBarHeight=function(){for(var e=0;e<this._bars.length;e++)this._bars[e].children[0].height=this._barHeight},Object.defineProperty(t.prototype,"spacerHeight",{get:function(){return this._spacerHeight},set:function(e){this._spacerHeight!==e&&(this._spacerHeight=e,this._setSpacerHeight())},enumerable:!1,configurable:!0}),t.prototype._setSpacerHeight=function(){for(var e=0;e<this._bars.length;e++)this._bars[e].height=this._spacerHeight},t.prototype._addSpacer=function(){var e=new S;e.width=1,e.height=this._spacerHeight,e.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT;var t=new E;t.width=1,t.height=this._barHeight,t.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,t.verticalAlignment=x.VERTICAL_ALIGNMENT_CENTER,t.background=this._barColor,t.color="transparent",e.addControl(t),this._panel.addControl(e),this._bars.push(e)},t.prototype.addGroup=function(e){this._groups.length>0&&this._addSpacer(),this._panel.addControl(e.groupPanel),this._groups.push(e),e.groupPanel.children[0].color=this._headerColor;for(var t=0;t<e.selectors.length;t++)e._setSelectorButtonColor(t,this._buttonColor),e._setSelectorButtonBackground(t,this._buttonBackground)},t.prototype.removeGroup=function(e){if(!(e<0||e>=this._groups.length)){var t=this._groups[e];this._panel.removeControl(t.groupPanel),this._groups.splice(e,1),e<this._bars.length&&(this._panel.removeControl(this._bars[e]),this._bars.splice(e,1))}},t.prototype.setHeaderName=function(e,t){t<0||t>=this._groups.length||(this._groups[t].groupPanel.children[0].text=e)},t.prototype.relabel=function(e,t,i){if(!(t<0||t>=this._groups.length)){var n=this._groups[t];i<0||i>=n.selectors.length||n._setSelectorLabel(i,e)}},t.prototype.removeFromGroupSelector=function(e,t){if(!(e<0||e>=this._groups.length)){var i=this._groups[e];t<0||t>=i.selectors.length||i.removeSelector(t)}},t.prototype.addToGroupCheckbox=function(e,t,i,n){void 0===i&&(i=function(){}),void 0===n&&(n=!1),e<0||e>=this._groups.length||this._groups[e].addCheckbox(t,i,n)},t.prototype.addToGroupRadio=function(e,t,i,n){void 0===i&&(i=function(){}),void 0===n&&(n=!1),e<0||e>=this._groups.length||this._groups[e].addRadio(t,i,n)},t.prototype.addToGroupSlider=function(e,t,i,n,r,o,s,a){void 0===i&&(i=function(){}),void 0===n&&(n="Units"),void 0===r&&(r=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=function(e){return 0|e}),e<0||e>=this._groups.length||this._groups[e].addSlider(t,i,n,r,o,s,a)}}(E),function(e){function t(t){var i=e.call(this,t)||this;return i._freezeControls=!1,i._bucketWidth=0,i._bucketHeight=0,i._buckets={},i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"freezeControls",{get:function(){return this._freezeControls},set:function(e){if(this._freezeControls!==e){e||this._restoreMeasures(),this._freezeControls=!1;var t=this.host.getSize(),i=t.width,n=t.height,r=this.host.getContext(),o=new d(0,0,i,n);this.host._numLayoutCalls=0,this.host._rootContainer._layout(o,r),e&&(this._updateMeasures(),this._useBuckets()&&this._makeBuckets()),this._freezeControls=e,this.host.markAsDirty()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucketWidth",{get:function(){return this._bucketWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucketHeight",{get:function(){return this._bucketHeight},enumerable:!1,configurable:!0}),t.prototype.setBucketSizes=function(e,t){this._bucketWidth=e,this._bucketHeight=t,this._useBuckets()?this._freezeControls&&this._makeBuckets():this._buckets={}},t.prototype._useBuckets=function(){return this._bucketWidth>0&&this._bucketHeight>0},t.prototype._makeBuckets=function(){this._buckets={},this._bucketLen=Math.ceil(this.widthInPixels/this._bucketWidth),this._dispatchInBuckets(this._children),this._oldLeft=null,this._oldTop=null},t.prototype._dispatchInBuckets=function(e){for(var t=0;t<e.length;++t){for(var i=e[t],n=Math.max(0,Math.floor((i._customData._origLeft-this._customData.origLeft)/this._bucketWidth)),r=Math.floor((i._customData._origLeft-this._customData.origLeft+i._currentMeasure.width-1)/this._bucketWidth),o=Math.max(0,Math.floor((i._customData._origTop-this._customData.origTop)/this._bucketHeight)),s=Math.floor((i._customData._origTop-this._customData.origTop+i._currentMeasure.height-1)/this._bucketHeight);o<=s;){for(var a=n;a<=r;++a){var l=o*this._bucketLen+a,h=this._buckets[l];h||(h=[],this._buckets[l]=h),h.push(i)}o++}i instanceof S&&i._children.length>0&&this._dispatchInBuckets(i._children)}},t.prototype._updateMeasures=function(){var e=0|this.leftInPixels,t=0|this.topInPixels;this._measureForChildren.left-=e,this._measureForChildren.top-=t,this._currentMeasure.left-=e,this._currentMeasure.top-=t,this._customData.origLeftForChildren=this._measureForChildren.left,this._customData.origTopForChildren=this._measureForChildren.top,this._customData.origLeft=this._currentMeasure.left,this._customData.origTop=this._currentMeasure.top,this._updateChildrenMeasures(this._children,e,t)},t.prototype._updateChildrenMeasures=function(e,t,i){for(var n=0;n<e.length;++n){var r=e[n];r._currentMeasure.left-=t,r._currentMeasure.top-=i,r._customData._origLeft=r._currentMeasure.left,r._customData._origTop=r._currentMeasure.top,r instanceof S&&r._children.length>0&&this._updateChildrenMeasures(r._children,t,i)}},t.prototype._restoreMeasures=function(){var e=0|this.leftInPixels,t=0|this.topInPixels;this._measureForChildren.left=this._customData.origLeftForChildren+e,this._measureForChildren.top=this._customData.origTopForChildren+t,this._currentMeasure.left=this._customData.origLeft+e,this._currentMeasure.top=this._customData.origTop+t},t.prototype._getTypeName=function(){return"ScrollViewerWindow"},t.prototype._additionalProcessing=function(t,i){e.prototype._additionalProcessing.call(this,t,i),this._parentMeasure=t,this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this._measureForChildren.width=t.width,this._measureForChildren.height=t.height},t.prototype._layout=function(t,i){return this._freezeControls?(this.invalidateRect(),!1):e.prototype._layout.call(this,t,i)},t.prototype._scrollChildren=function(e,t,i){for(var n=0;n<e.length;++n){var r=e[n];r._currentMeasure.left=r._customData._origLeft+t,r._currentMeasure.top=r._customData._origTop+i,r._isClipped=!1,r instanceof S&&r._children.length>0&&this._scrollChildren(r._children,t,i)}},t.prototype._scrollChildrenWithBuckets=function(e,t,i,n){for(var r=Math.max(0,Math.floor(-e/this._bucketWidth)),o=Math.floor((-e+this._parentMeasure.width-1)/this._bucketWidth),s=Math.max(0,Math.floor(-t/this._bucketHeight)),a=Math.floor((-t+this._parentMeasure.height-1)/this._bucketHeight);s<=a;){for(var l=r;l<=o;++l){var h=s*this._bucketLen+l,u=this._buckets[h];if(u)for(var c=0;c<u.length;++c){var f=u[c];f._currentMeasure.left=f._customData._origLeft+i,f._currentMeasure.top=f._customData._origTop+n,f._isClipped=!1}}s++}},t.prototype._draw=function(t,i){if(this._freezeControls){this._localDraw(t),this.clipChildren&&this._clipForChildren(t);var n=0|this.leftInPixels,r=0|this.topInPixels;this._useBuckets()&&null!==this._oldLeft&&null!==this._oldTop?(this._scrollChildrenWithBuckets(this._oldLeft,this._oldTop,n,r),this._scrollChildrenWithBuckets(n,r,n,r)):this._scrollChildren(this._children,n,r),this._oldLeft=n,this._oldTop=r;for(var o=0,s=this._children;o<s.length;o++){var a=s[o];a._intersectsRect(this._parentMeasure)&&a._render(t,this._parentMeasure)}}else e.prototype._draw.call(this,t,i)},t.prototype._postMeasure=function(){if(this._freezeControls)e.prototype._postMeasure.call(this);else{for(var t=this.parentClientWidth,i=this.parentClientHeight,n=0,r=this.children;n<r.length;n++){var o=r[n];o.isVisible&&!o.notRenderable&&(o.horizontalAlignment===x.HORIZONTAL_ALIGNMENT_CENTER&&o._offsetLeft(this._currentMeasure.left-o._currentMeasure.left),o.verticalAlignment===x.VERTICAL_ALIGNMENT_CENTER&&o._offsetTop(this._currentMeasure.top-o._currentMeasure.top),t=Math.max(t,o._currentMeasure.left-this._currentMeasure.left+o._currentMeasure.width+o.paddingRightInPixels),i=Math.max(i,o._currentMeasure.top-this._currentMeasure.top+o._currentMeasure.height+o.paddingBottomInPixels))}this._currentMeasure.width!==t&&(this._width.updateInPlace(t,h.UNITMODE_PIXEL),this._currentMeasure.width=t,this._rebuildLayout=!0,this._isDirty=!0),this._currentMeasure.height!==i&&(this._height.updateInPlace(i,h.UNITMODE_PIXEL),this._currentMeasure.height=i,this._rebuildLayout=!0,this._isDirty=!0),e.prototype._postMeasure.call(this)}},t}(S)),K=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i._background="black",i._borderColor="white",i._tempMeasure=new d(0,0,0,0),i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"borderColor",{get:function(){return this._borderColor},set:function(e){this._borderColor!==e&&(this._borderColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"Scrollbar"},t.prototype._getThumbThickness=function(){return this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)},t.prototype._draw=function(e){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");var t=this._renderLeft,i=this._getThumbPosition();e.fillStyle=this._background,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),e.fillStyle=this.color,this.isVertical?(this._tempMeasure.left=t-this._effectiveBarOffset,this._tempMeasure.top=this._currentMeasure.top+i,this._tempMeasure.width=this._currentMeasure.width,this._tempMeasure.height=this._effectiveThumbThickness):(this._tempMeasure.left=this._currentMeasure.left+i,this._tempMeasure.top=this._currentMeasure.top,this._tempMeasure.width=this._effectiveThumbThickness,this._tempMeasure.height=this._currentMeasure.height),e.fillRect(this._tempMeasure.left,this._tempMeasure.top,this._tempMeasure.width,this._tempMeasure.height),e.restore()},t.prototype._updateValueFromPointer=function(e,t){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y),this._first&&(this._first=!1,this._originX=e,this._originY=t,(e<this._tempMeasure.left||e>this._tempMeasure.left+this._tempMeasure.width||t<this._tempMeasure.top||t>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));var i;i=this.isVertical?-(t-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness):(e-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*(this.maximum-this.minimum),this._originX=e,this._originY=t},t.prototype._onPointerDown=function(t,i,n,r,o){return this._first=!0,e.prototype._onPointerDown.call(this,t,i,n,r,o)},(0,n.gn)([(0,b.qC)()],t.prototype,"borderColor",null),(0,n.gn)([(0,b.qC)()],t.prototype,"background",null),t}(X),$=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i._thumbLength=.5,i._thumbHeight=1,i._barImageHeight=1,i._tempMeasure=new d(0,0,0,0),i.num90RotationInVerticalMode=1,i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"backgroundImage",{get:function(){return this._backgroundBaseImage},set:function(e){var t=this;this._backgroundBaseImage!==e&&(this._backgroundBaseImage=e,this.isVertical&&0!==this.num90RotationInVerticalMode?e.isLoaded?(this._backgroundImage=e._rotate90(this.num90RotationInVerticalMode,!0),this._markAsDirty()):e.onImageLoadedObservable.addOnce((function(){var i=e._rotate90(t.num90RotationInVerticalMode,!0);t._backgroundImage=i,i.isLoaded||i.onImageLoadedObservable.addOnce((function(){t._markAsDirty()})),t._markAsDirty()})):(this._backgroundImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce((function(){t._markAsDirty()})),this._markAsDirty()))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thumbImage",{get:function(){return this._thumbBaseImage},set:function(e){var t=this;this._thumbBaseImage!==e&&(this._thumbBaseImage=e,this.isVertical&&0!==this.num90RotationInVerticalMode?e.isLoaded?(this._thumbImage=e._rotate90(-this.num90RotationInVerticalMode,!0),this._markAsDirty()):e.onImageLoadedObservable.addOnce((function(){var i=e._rotate90(-t.num90RotationInVerticalMode,!0);t._thumbImage=i,i.isLoaded||i.onImageLoadedObservable.addOnce((function(){t._markAsDirty()})),t._markAsDirty()})):(this._thumbImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce((function(){t._markAsDirty()})),this._markAsDirty()))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thumbLength",{get:function(){return this._thumbLength},set:function(e){this._thumbLength!==e&&(this._thumbLength=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thumbHeight",{get:function(){return this._thumbHeight},set:function(e){this._thumbLength!==e&&(this._thumbHeight=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"barImageHeight",{get:function(){return this._barImageHeight},set:function(e){this._barImageHeight!==e&&(this._barImageHeight=e,this._markAsDirty())},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"ImageScrollBar"},t.prototype._getThumbThickness=function(){return this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)},t.prototype._draw=function(e){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");var t=this._getThumbPosition(),i=this._renderLeft,n=this._renderTop,r=this._renderWidth,o=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(i,n,r,o),this.isVertical?(this._tempMeasure.copyFromFloats(i+r*(1-this._barImageHeight)*.5,this._currentMeasure.top,r*this._barImageHeight,o),this._tempMeasure.height+=this._effectiveThumbThickness,this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure)):(this._tempMeasure.copyFromFloats(this._currentMeasure.left,n+o*(1-this._barImageHeight)*.5,r,o*this._barImageHeight),this._tempMeasure.width+=this._effectiveThumbThickness,this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure)),this._backgroundImage._draw(e)),this.isVertical?this._tempMeasure.copyFromFloats(i-this._effectiveBarOffset+this._currentMeasure.width*(1-this._thumbHeight)*.5,this._currentMeasure.top+t,this._currentMeasure.width*this._thumbHeight,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+t,this._currentMeasure.top+this._currentMeasure.height*(1-this._thumbHeight)*.5,this._effectiveThumbThickness,this._currentMeasure.height*this._thumbHeight),this._thumbImage&&(this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(e)),e.restore()},t.prototype._updateValueFromPointer=function(e,t){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y),this._first&&(this._first=!1,this._originX=e,this._originY=t,(e<this._tempMeasure.left||e>this._tempMeasure.left+this._tempMeasure.width||t<this._tempMeasure.top||t>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));var i;i=this.isVertical?-(t-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness):(e-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*(this.maximum-this.minimum),this._originX=e,this._originY=t},t.prototype._onPointerDown=function(t,i,n,r,o){return this._first=!0,e.prototype._onPointerDown.call(this,t,i,n,r,o)},(0,n.gn)([(0,b.qC)()],t.prototype,"num90RotationInVerticalMode",void 0),t}(X),J=function(e){function t(t,i){var n=e.call(this,t)||this;return n._barSize=20,n._pointerIsOver=!1,n._wheelPrecision=.05,n._thumbLength=.5,n._thumbHeight=1,n._barImageHeight=1,n._horizontalBarImageHeight=1,n._verticalBarImageHeight=1,n._oldWindowContentsWidth=0,n._oldWindowContentsHeight=0,n._forceHorizontalBar=!1,n._forceVerticalBar=!1,n._useImageBar=i||!1,n.onDirtyObservable.add((function(){n._horizontalBarSpace.color=n.color,n._verticalBarSpace.color=n.color,n._dragSpace.color=n.color})),n.onPointerEnterObservable.add((function(){n._pointerIsOver=!0})),n.onPointerOutObservable.add((function(){n._pointerIsOver=!1})),n._grid=new B,n._useImageBar?(n._horizontalBar=new $,n._verticalBar=new $):(n._horizontalBar=new K,n._verticalBar=new K),n._window=new Z("scrollViewer_window"),n._window.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,n._window.verticalAlignment=x.VERTICAL_ALIGNMENT_TOP,n._grid.addColumnDefinition(1),n._grid.addColumnDefinition(0,!0),n._grid.addRowDefinition(1),n._grid.addRowDefinition(0,!0),e.prototype.addControl.call(n,n._grid),n._grid.addControl(n._window,0,0),n._verticalBarSpace=new E,n._verticalBarSpace.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,n._verticalBarSpace.verticalAlignment=x.VERTICAL_ALIGNMENT_TOP,n._verticalBarSpace.thickness=1,n._grid.addControl(n._verticalBarSpace,0,1),n._addBar(n._verticalBar,n._verticalBarSpace,!0,Math.PI),n._horizontalBarSpace=new E,n._horizontalBarSpace.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,n._horizontalBarSpace.verticalAlignment=x.VERTICAL_ALIGNMENT_TOP,n._horizontalBarSpace.thickness=1,n._grid.addControl(n._horizontalBarSpace,1,0),n._addBar(n._horizontalBar,n._horizontalBarSpace,!1,0),n._dragSpace=new E,n._dragSpace.thickness=1,n._grid.addControl(n._dragSpace,1,1),n._useImageBar||(n.barColor="grey",n.barBackground="transparent"),n}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"horizontalBar",{get:function(){return this._horizontalBar},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"verticalBar",{get:function(){return this._verticalBar},enumerable:!1,configurable:!0}),t.prototype.addControl=function(e){return e?(this._window.addControl(e),this):this},t.prototype.removeControl=function(e){return this._window.removeControl(e),this},Object.defineProperty(t.prototype,"children",{get:function(){return this._window.children},enumerable:!1,configurable:!0}),t.prototype._flagDescendantsAsMatrixDirty=function(){for(var e=0,t=this._children;e<t.length;e++)t[e]._markMatrixAsDirty()},Object.defineProperty(t.prototype,"freezeControls",{get:function(){return this._window.freezeControls},set:function(e){this._window.freezeControls=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucketWidth",{get:function(){return this._window.bucketWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucketHeight",{get:function(){return this._window.bucketHeight},enumerable:!1,configurable:!0}),t.prototype.setBucketSizes=function(e,t){this._window.setBucketSizes(e,t)},Object.defineProperty(t.prototype,"forceHorizontalBar",{get:function(){return this._forceHorizontalBar},set:function(e){this._grid.setRowDefinition(1,e?this._barSize:0,!0),this._horizontalBar.isVisible=e,this._forceHorizontalBar=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forceVerticalBar",{get:function(){return this._forceVerticalBar},set:function(e){this._grid.setColumnDefinition(1,e?this._barSize:0,!0),this._verticalBar.isVisible=e,this._forceVerticalBar=e},enumerable:!1,configurable:!0}),t.prototype.resetWindow=function(){this._window.width="100%",this._window.height="100%"},t.prototype._getTypeName=function(){return"ScrollViewer"},t.prototype._buildClientSizes=function(){var e=this.host.idealRatio;this._window.parentClientWidth=this._currentMeasure.width-(this._verticalBar.isVisible||this.forceVerticalBar?this._barSize*e:0)-2*this.thickness,this._window.parentClientHeight=this._currentMeasure.height-(this._horizontalBar.isVisible||this.forceHorizontalBar?this._barSize*e:0)-2*this.thickness,this._clientWidth=this._window.parentClientWidth,this._clientHeight=this._window.parentClientHeight},t.prototype._additionalProcessing=function(t,i){e.prototype._additionalProcessing.call(this,t,i),this._buildClientSizes()},t.prototype._postMeasure=function(){e.prototype._postMeasure.call(this),this._updateScroller(),this._setWindowPosition(!1)},Object.defineProperty(t.prototype,"wheelPrecision",{get:function(){return this._wheelPrecision},set:function(e){this._wheelPrecision!==e&&(e<0&&(e=0),e>1&&(e=1),this._wheelPrecision=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollBackground",{get:function(){return this._horizontalBarSpace.background},set:function(e){this._horizontalBarSpace.background!==e&&(this._horizontalBarSpace.background=e,this._verticalBarSpace.background=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"barColor",{get:function(){return this._barColor},set:function(e){this._barColor!==e&&(this._barColor=e,this._horizontalBar.color=e,this._verticalBar.color=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thumbImage",{get:function(){return this._barImage},set:function(e){if(this._barImage!==e){this._barImage=e;var t=this._horizontalBar,i=this._verticalBar;t.thumbImage=e,i.thumbImage=e}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"horizontalThumbImage",{get:function(){return this._horizontalBarImage},set:function(e){this._horizontalBarImage!==e&&(this._horizontalBarImage=e,this._horizontalBar.thumbImage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"verticalThumbImage",{get:function(){return this._verticalBarImage},set:function(e){this._verticalBarImage!==e&&(this._verticalBarImage=e,this._verticalBar.thumbImage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"barSize",{get:function(){return this._barSize},set:function(e){this._barSize!==e&&(this._barSize=e,this._markAsDirty(),this._horizontalBar.isVisible&&this._grid.setRowDefinition(1,this._barSize,!0),this._verticalBar.isVisible&&this._grid.setColumnDefinition(1,this._barSize,!0))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thumbLength",{get:function(){return this._thumbLength},set:function(e){if(this._thumbLength!==e){e<=0&&(e=.1),e>1&&(e=1),this._thumbLength=e;var t=this._horizontalBar,i=this._verticalBar;t.thumbLength=e,i.thumbLength=e,this._markAsDirty()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thumbHeight",{get:function(){return this._thumbHeight},set:function(e){if(this._thumbHeight!==e){e<=0&&(e=.1),e>1&&(e=1),this._thumbHeight=e;var t=this._horizontalBar,i=this._verticalBar;t.thumbHeight=e,i.thumbHeight=e,this._markAsDirty()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"barImageHeight",{get:function(){return this._barImageHeight},set:function(e){if(this._barImageHeight!==e){e<=0&&(e=.1),e>1&&(e=1),this._barImageHeight=e;var t=this._horizontalBar,i=this._verticalBar;t.barImageHeight=e,i.barImageHeight=e,this._markAsDirty()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"horizontalBarImageHeight",{get:function(){return this._horizontalBarImageHeight},set:function(e){this._horizontalBarImageHeight!==e&&(e<=0&&(e=.1),e>1&&(e=1),this._horizontalBarImageHeight=e,this._horizontalBar.barImageHeight=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"verticalBarImageHeight",{get:function(){return this._verticalBarImageHeight},set:function(e){this._verticalBarImageHeight!==e&&(e<=0&&(e=.1),e>1&&(e=1),this._verticalBarImageHeight=e,this._verticalBar.barImageHeight=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"barBackground",{get:function(){return this._barBackground},set:function(e){if(this._barBackground!==e){this._barBackground=e;var t=this._horizontalBar,i=this._verticalBar;t.background=e,i.background=e,this._dragSpace.background=e}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"barImage",{get:function(){return this._barBackgroundImage},set:function(e){this._barBackgroundImage,this._barBackgroundImage=e;var t=this._horizontalBar,i=this._verticalBar;t.backgroundImage=e,i.backgroundImage=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"horizontalBarImage",{get:function(){return this._horizontalBarBackgroundImage},set:function(e){this._horizontalBarBackgroundImage,this._horizontalBarBackgroundImage=e,this._horizontalBar.backgroundImage=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"verticalBarImage",{get:function(){return this._verticalBarBackgroundImage},set:function(e){this._verticalBarBackgroundImage,this._verticalBarBackgroundImage=e,this._verticalBar.backgroundImage=e},enumerable:!1,configurable:!0}),t.prototype._setWindowPosition=function(e){void 0===e&&(e=!0);var t=this.host.idealRatio,i=this._window._currentMeasure.width,n=this._window._currentMeasure.height;if(e||this._oldWindowContentsWidth!==i||this._oldWindowContentsHeight!==n){this._oldWindowContentsWidth=i,this._oldWindowContentsHeight=n;var r=this._clientWidth-i,o=this._clientHeight-n,s=this._horizontalBar.value/t*r+"px",a=this._verticalBar.value/t*o+"px";s!==this._window.left&&(this._window.left=s,this.freezeControls||(this._rebuildLayout=!0)),a!==this._window.top&&(this._window.top=a,this.freezeControls||(this._rebuildLayout=!0))}},t.prototype._updateScroller=function(){var e=this._window._currentMeasure.width,t=this._window._currentMeasure.height;this._horizontalBar.isVisible&&e<=this._clientWidth&&!this.forceHorizontalBar?(this._grid.setRowDefinition(1,0,!0),this._horizontalBar.isVisible=!1,this._horizontalBar.value=0,this._rebuildLayout=!0):!this._horizontalBar.isVisible&&(e>this._clientWidth||this.forceHorizontalBar)&&(this._grid.setRowDefinition(1,this._barSize,!0),this._horizontalBar.isVisible=!0,this._rebuildLayout=!0),this._verticalBar.isVisible&&t<=this._clientHeight&&!this.forceVerticalBar?(this._grid.setColumnDefinition(1,0,!0),this._verticalBar.isVisible=!1,this._verticalBar.value=0,this._rebuildLayout=!0):!this._verticalBar.isVisible&&(t>this._clientHeight||this.forceVerticalBar)&&(this._grid.setColumnDefinition(1,this._barSize,!0),this._verticalBar.isVisible=!0,this._rebuildLayout=!0),this._buildClientSizes();var i=this.host.idealRatio;this._horizontalBar.thumbWidth=.9*this._thumbLength*(this._clientWidth/i)+"px",this._verticalBar.thumbWidth=.9*this._thumbLength*(this._clientHeight/i)+"px"},t.prototype._link=function(t){e.prototype._link.call(this,t),this._attachWheel()},t.prototype._addBar=function(e,t,i,n){var r=this;e.paddingLeft=0,e.width="100%",e.height="100%",e.barOffset=0,e.value=0,e.maximum=1,e.horizontalAlignment=x.HORIZONTAL_ALIGNMENT_CENTER,e.verticalAlignment=x.VERTICAL_ALIGNMENT_CENTER,e.isVertical=i,e.rotation=n,e.isVisible=!1,t.addControl(e),e.onValueChangedObservable.add((function(e){r._setWindowPosition()}))},t.prototype._attachWheel=function(){var e=this;this._host&&!this._onWheelObserver&&(this._onWheelObserver=this.onWheelObservable.add((function(t){e._pointerIsOver&&(1==e._verticalBar.isVisible&&(t.y<0&&e._verticalBar.value>0?e._verticalBar.value-=e._wheelPrecision:t.y>0&&e._verticalBar.value<e._verticalBar.maximum&&(e._verticalBar.value+=e._wheelPrecision)),1==e._horizontalBar.isVisible&&(t.x<0&&e._horizontalBar.value<e._horizontalBar.maximum?e._horizontalBar.value+=e._wheelPrecision:t.x>0&&e._horizontalBar.value>0&&(e._horizontalBar.value-=e._wheelPrecision)))})))},t.prototype._renderHighlightSpecific=function(t){this.isHighlighted&&(e.prototype._renderHighlightSpecific.call(this,t),this._grid._renderHighlightSpecific(t),t.restore())},t.prototype.dispose=function(){this.onWheelObservable.remove(this._onWheelObserver),this._onWheelObserver=null,e.prototype.dispose.call(this)},t}(E);v.Q.RegisteredTypes["BABYLON.GUI.ScrollViewer"]=J;var ee=function(e){function t(t,i){var n=e.call(this,t)||this;n.name=t,n.onIsActiveChangedObservable=new o.y$,n.delegatePickingToChildren=!1,n._isActive=!1,n.group=null!=i?i:"",n.thickness=0,n.isPointerBlocker=!0;var r=null;return n.toActiveAnimation=function(){n.thickness=1},n.toInactiveAnimation=function(){n.thickness=0},n.pointerEnterActiveAnimation=function(){r=n.alpha,n.alpha-=.1},n.pointerOutActiveAnimation=function(){null!==r&&(n.alpha=r)},n.pointerDownActiveAnimation=function(){n.scaleX-=.05,n.scaleY-=.05},n.pointerUpActiveAnimation=function(){n.scaleX+=.05,n.scaleY+=.05},n.pointerEnterInactiveAnimation=function(){r=n.alpha,n.alpha-=.1},n.pointerOutInactiveAnimation=function(){null!==r&&(n.alpha=r)},n.pointerDownInactiveAnimation=function(){n.scaleX-=.05,n.scaleY-=.05},n.pointerUpInactiveAnimation=function(){n.scaleX+=.05,n.scaleY+=.05},n}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"image",{get:function(){return this._image},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textBlock",{get:function(){return this._textBlock},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"group",{get:function(){return this._group},set:function(e){this._group!==e&&(this._group=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isActive",{get:function(){return this._isActive},set:function(e){var t,i,n=this;this._isActive!==e&&(this._isActive=e,this._isActive?null===(t=this.toActiveAnimation)||void 0===t||t.call(this):null===(i=this.toInactiveAnimation)||void 0===i||i.call(this),this._markAsDirty(),this.onIsActiveChangedObservable.notifyObservers(e),this._isActive&&this._host&&this._group&&this._host.executeOnAllControls((function(e){if("ToggleButton"===e.typeName){if(e===n)return;var t=e;t.group===n.group&&(t.isActive=!1)}})))},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"ToggleButton"},t.prototype._processPicking=function(t,i,n,r,o,s,a,l){if(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this.notRenderable)return!1;if(!e.prototype.contains.call(this,t,i))return!1;if(this.delegatePickingToChildren){for(var h=!1,u=this._children.length-1;u>=0;u--){var c=this._children[u];if(c.isEnabled&&c.isHitTestVisible&&c.isVisible&&!c.notRenderable&&c.contains(t,i)){h=!0;break}}if(!h)return!1}return this._processObservables(r,t,i,n,o,s,a,l),!0},t.prototype._onPointerEnter=function(t,i){return!!e.prototype._onPointerEnter.call(this,t,i)&&(this._isActive?this.pointerEnterActiveAnimation&&this.pointerEnterActiveAnimation():this.pointerEnterInactiveAnimation&&this.pointerEnterInactiveAnimation(),!0)},t.prototype._onPointerOut=function(t,i,n){void 0===n&&(n=!1),this._isActive?this.pointerOutActiveAnimation&&this.pointerOutActiveAnimation():this.pointerOutInactiveAnimation&&this.pointerOutInactiveAnimation(),e.prototype._onPointerOut.call(this,t,i,n)},t.prototype._onPointerDown=function(t,i,n,r,o){return!!e.prototype._onPointerDown.call(this,t,i,n,r,o)&&(this._isActive?this.pointerDownActiveAnimation&&this.pointerDownActiveAnimation():this.pointerDownInactiveAnimation&&this.pointerDownInactiveAnimation(),!0)},t.prototype._onPointerUp=function(t,i,n,r,o,s){this._isActive?this.pointerUpActiveAnimation&&this.pointerUpActiveAnimation():this.pointerUpInactiveAnimation&&this.pointerUpInactiveAnimation(),e.prototype._onPointerUp.call(this,t,i,n,r,o,s)},t}(E);v.Q.RegisteredTypes["BABYLON.GUI.ToggleButton"]=ee;var te=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onKeyPressObservable=new o.y$,t.defaultButtonWidth="40px",t.defaultButtonHeight="40px",t.defaultButtonPaddingLeft="2px",t.defaultButtonPaddingRight="2px",t.defaultButtonPaddingTop="2px",t.defaultButtonPaddingBottom="2px",t.defaultButtonColor="#DDD",t.defaultButtonBackground="#070707",t.shiftButtonColor="#7799FF",t.selectedShiftThickness=1,t.shiftState=0,t._currentlyConnectedInputText=null,t._connectedInputTexts=[],t._onKeyPressObserver=null,t}return(0,n.ZT)(t,e),t.prototype._getTypeName=function(){return"VirtualKeyboard"},t.prototype._createKey=function(e,t){var i=this,n=I.CreateSimpleButton(e,e);return n.width=t&&t.width?t.width:this.defaultButtonWidth,n.height=t&&t.height?t.height:this.defaultButtonHeight,n.color=t&&t.color?t.color:this.defaultButtonColor,n.background=t&&t.background?t.background:this.defaultButtonBackground,n.paddingLeft=t&&t.paddingLeft?t.paddingLeft:this.defaultButtonPaddingLeft,n.paddingRight=t&&t.paddingRight?t.paddingRight:this.defaultButtonPaddingRight,n.paddingTop=t&&t.paddingTop?t.paddingTop:this.defaultButtonPaddingTop,n.paddingBottom=t&&t.paddingBottom?t.paddingBottom:this.defaultButtonPaddingBottom,n.thickness=0,n.isFocusInvisible=!0,n.shadowColor=this.shadowColor,n.shadowBlur=this.shadowBlur,n.shadowOffsetX=this.shadowOffsetX,n.shadowOffsetY=this.shadowOffsetY,n.onPointerUpObservable.add((function(){i.onKeyPressObservable.notifyObservers(e)})),n},t.prototype.addKeysRow=function(e,t){var i=new A;i.isVertical=!1,i.isFocusInvisible=!0;for(var n=null,r=0;r<e.length;r++){var o=null;t&&t.length===e.length&&(o=t[r]);var s=this._createKey(e[r],o);(!n||s.heightInPixels>n.heightInPixels)&&(n=s),i.addControl(s)}i.height=n?n.height:this.defaultButtonHeight,this.addControl(i)},t.prototype.applyShiftState=function(e){if(this.children)for(var t=0;t<this.children.length;t++){var i=this.children[t];if(i&&i.children)for(var n=i,r=0;r<n.children.length;r++){var o=n.children[r];if(o&&o.children[0]){var s=o.children[0];"⇧"===s.text&&(o.color=e?this.shiftButtonColor:this.defaultButtonColor,o.thickness=e>1?this.selectedShiftThickness:0),s.text=e>0?s.text.toUpperCase():s.text.toLowerCase()}}}},Object.defineProperty(t.prototype,"connectedInputText",{get:function(){return this._currentlyConnectedInputText},enumerable:!1,configurable:!0}),t.prototype.connect=function(e){var t=this;if(!this._connectedInputTexts.some((function(t){return t.input===e}))){null===this._onKeyPressObserver&&(this._onKeyPressObserver=this.onKeyPressObservable.add((function(e){if(t._currentlyConnectedInputText){switch(t._currentlyConnectedInputText._host.focusedControl=t._currentlyConnectedInputText,e){case"⇧":return t.shiftState++,t.shiftState>2&&(t.shiftState=0),void t.applyShiftState(t.shiftState);case"←":return void t._currentlyConnectedInputText.processKey(8);case"↵":return void t._currentlyConnectedInputText.processKey(13)}t._currentlyConnectedInputText.processKey(-1,t.shiftState?e.toUpperCase():e),1===t.shiftState&&(t.shiftState=0,t.applyShiftState(t.shiftState))}}))),this.isVisible=!1,this._currentlyConnectedInputText=e,e._connectedVirtualKeyboard=this;var i=e.onFocusObservable.add((function(){t._currentlyConnectedInputText=e,e._connectedVirtualKeyboard=t,t.isVisible=!0})),n=e.onBlurObservable.add((function(){e._connectedVirtualKeyboard=null,t._currentlyConnectedInputText=null,t.isVisible=!1}));this._connectedInputTexts.push({input:e,onBlurObserver:n,onFocusObserver:i})}},t.prototype.disconnect=function(e){var t=this;if(e){var i=this._connectedInputTexts.filter((function(t){return t.input===e}));1===i.length&&(this._removeConnectedInputObservables(i[0]),this._connectedInputTexts=this._connectedInputTexts.filter((function(t){return t.input!==e})),this._currentlyConnectedInputText===e&&(this._currentlyConnectedInputText=null))}else this._connectedInputTexts.forEach((function(e){t._removeConnectedInputObservables(e)})),this._connectedInputTexts=[];0===this._connectedInputTexts.length&&(this._currentlyConnectedInputText=null,this.onKeyPressObservable.remove(this._onKeyPressObserver),this._onKeyPressObserver=null)},t.prototype._removeConnectedInputObservables=function(e){e.input._connectedVirtualKeyboard=null,e.input.onFocusObservable.remove(e.onFocusObserver),e.input.onBlurObservable.remove(e.onBlurObserver)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.disconnect()},t.CreateDefaultLayout=function(e){var i=new t(e);return i.addKeysRow(["1","2","3","4","5","6","7","8","9","0","←"]),i.addKeysRow(["q","w","e","r","t","y","u","i","o","p"]),i.addKeysRow(["a","s","d","f","g","h","j","k","l",";","'","↵"]),i.addKeysRow(["⇧","z","x","c","v","b","n","m",",",".","/"]),i.addKeysRow([" "],[{width:"200px"}]),i},t}(A);v.Q.RegisteredTypes["BABYLON.GUI.VirtualKeyboard"]=te;var ie=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i._cellWidth=20,i._cellHeight=20,i._minorLineTickness=1,i._minorLineColor="DarkGray",i._majorLineTickness=2,i._majorLineColor="White",i._majorLineFrequency=5,i._background="Black",i._displayMajorLines=!0,i._displayMinorLines=!0,i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"displayMinorLines",{get:function(){return this._displayMinorLines},set:function(e){this._displayMinorLines!==e&&(this._displayMinorLines=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayMajorLines",{get:function(){return this._displayMajorLines},set:function(e){this._displayMajorLines!==e&&(this._displayMajorLines=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cellWidth",{get:function(){return this._cellWidth},set:function(e){this._cellWidth=e,this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cellHeight",{get:function(){return this._cellHeight},set:function(e){this._cellHeight=e,this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minorLineTickness",{get:function(){return this._minorLineTickness},set:function(e){this._minorLineTickness=e,this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minorLineColor",{get:function(){return this._minorLineColor},set:function(e){this._minorLineColor=e,this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"majorLineTickness",{get:function(){return this._majorLineTickness},set:function(e){this._majorLineTickness=e,this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"majorLineColor",{get:function(){return this._majorLineColor},set:function(e){this._majorLineColor=e,this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"majorLineFrequency",{get:function(){return this._majorLineFrequency},set:function(e){this._majorLineFrequency=e,this._markAsDirty()},enumerable:!1,configurable:!0}),t.prototype._draw=function(e,t){if(e.save(),this._applyStates(e),this._isEnabled){this._background&&(e.fillStyle=this._background,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height));var i=this._currentMeasure.width/this._cellWidth,n=this._currentMeasure.height/this._cellHeight,r=this._currentMeasure.left+this._currentMeasure.width/2,o=this._currentMeasure.top+this._currentMeasure.height/2;if(this._displayMinorLines){e.strokeStyle=this._minorLineColor,e.lineWidth=this._minorLineTickness;for(var s=-i/2;s<i/2;s++){var a=r+s*this.cellWidth;e.beginPath(),e.moveTo(a,this._currentMeasure.top),e.lineTo(a,this._currentMeasure.top+this._currentMeasure.height),e.stroke()}for(var l=-n/2;l<n/2;l++){var h=o+l*this.cellHeight;e.beginPath(),e.moveTo(this._currentMeasure.left,h),e.lineTo(this._currentMeasure.left+this._currentMeasure.width,h),e.stroke()}}if(this._displayMajorLines){for(e.strokeStyle=this._majorLineColor,e.lineWidth=this._majorLineTickness,s=-i/2+this._majorLineFrequency;s<i/2;s+=this._majorLineFrequency)a=r+s*this.cellWidth,e.beginPath(),e.moveTo(a,this._currentMeasure.top),e.lineTo(a,this._currentMeasure.top+this._currentMeasure.height),e.stroke();for(l=-n/2+this._majorLineFrequency;l<n/2;l+=this._majorLineFrequency)h=o+l*this.cellHeight,e.moveTo(this._currentMeasure.left,h),e.lineTo(this._currentMeasure.left+this._currentMeasure.width,h),e.closePath(),e.stroke()}}e.restore()},t.prototype._getTypeName=function(){return"DisplayGrid"},(0,n.gn)([(0,b.qC)()],t.prototype,"displayMinorLines",null),(0,n.gn)([(0,b.qC)()],t.prototype,"displayMajorLines",null),(0,n.gn)([(0,b.qC)()],t.prototype,"background",null),(0,n.gn)([(0,b.qC)()],t.prototype,"cellWidth",null),(0,n.gn)([(0,b.qC)()],t.prototype,"cellHeight",null),(0,n.gn)([(0,b.qC)()],t.prototype,"minorLineTickness",null),(0,n.gn)([(0,b.qC)()],t.prototype,"minorLineColor",null),(0,n.gn)([(0,b.qC)()],t.prototype,"majorLineTickness",null),(0,n.gn)([(0,b.qC)()],t.prototype,"majorLineColor",null),(0,n.gn)([(0,b.qC)()],t.prototype,"majorLineFrequency",null),t}(x);v.Q.RegisteredTypes["BABYLON.GUI.DisplayGrid"]=ie;var ne=function(e){function t(t){var i=e.call(this,t)||this;return i.name=t,i._tempMeasure=new d(0,0,0,0),i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"displayThumb",{get:function(){return this._displayThumb&&null!=this.thumbImage},set:function(e){this._displayThumb!==e&&(this._displayThumb=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"backgroundImage",{get:function(){return this._backgroundImage},set:function(e){var t=this;this._backgroundImage!==e&&(this._backgroundImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce((function(){return t._markAsDirty()})),this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valueBarImage",{get:function(){return this._valueBarImage},set:function(e){var t=this;this._valueBarImage!==e&&(this._valueBarImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce((function(){return t._markAsDirty()})),this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"thumbImage",{get:function(){return this._thumbImage},set:function(e){var t=this;this._thumbImage!==e&&(this._thumbImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce((function(){return t._markAsDirty()})),this._markAsDirty())},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"ImageBasedSlider"},t.prototype._draw=function(e,t){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");var i=this._getThumbPosition(),n=this._renderLeft,r=this._renderTop,o=this._renderWidth,s=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(n,r,o,s),this.isThumbClamped&&this.displayThumb&&(this.isVertical?this._tempMeasure.height+=this._effectiveThumbThickness:this._tempMeasure.width+=this._effectiveThumbThickness),this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure),this._backgroundImage._draw(e)),this._valueBarImage&&(this.isVertical?this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(n,r+i,o,s-i+this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(n,r+i,o,s-i):this.isThumbClamped&&this.displayThumb?this._tempMeasure.copyFromFloats(n,r,i+this._effectiveThumbThickness/2,s):this._tempMeasure.copyFromFloats(n,r,i,s),this._valueBarImage._currentMeasure.copyFrom(this._tempMeasure),this._valueBarImage._draw(e)),this.displayThumb&&(this.isVertical?this._tempMeasure.copyFromFloats(n-this._effectiveBarOffset,this._currentMeasure.top+i,this._currentMeasure.width,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+i,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(e)),e.restore()},(0,n.gn)([(0,b.qC)()],t.prototype,"displayThumb",null),t}(X);v.Q.RegisteredTypes["BABYLON.GUI.ImageBasedSlider"]=ne,x.AddHeader=function(e,t,i,n){var r=new A("panel"),o=!n||n.isHorizontal,s=!n||n.controlFirst;r.isVertical=!o;var a=new M("header");return a.text=t,a.textHorizontalAlignment=x.HORIZONTAL_ALIGNMENT_LEFT,o?a.width=i:a.height=i,s?(r.addControl(e),r.addControl(a),a.paddingLeft="5px"):(r.addControl(a),r.addControl(e),a.paddingRight="5px"),a.shadowBlur=e.shadowBlur,a.shadowColor=e.shadowColor,a.shadowOffsetX=e.shadowOffsetX,a.shadowOffsetY=e.shadowOffsetY,r};var re=i(8841),oe=i(4706),se=i(8427),ae=function(){function e(e){this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new h(18,h.UNITMODE_PIXEL,!1),this.onChangedObservable=new o.y$,this._host=e}return Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize.toString(this._host)},set:function(e){this._fontSize.toString(this._host)!==e&&this._fontSize.fromString(e)&&this.onChangedObservable.notifyObservers(this)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(e){this._fontFamily!==e&&(this._fontFamily=e,this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){this._fontStyle!==e&&(this._fontStyle=e,this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){this._fontWeight!==e&&(this._fontWeight=e,this.onChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this.onChangedObservable.clear()},e}(),le=i(2013),he=i(6471),ue=function(e){function t(t,i,n,r,s,a,l){void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=!1),void 0===a&&(a=C.x.NEAREST_SAMPLINGMODE);var h=e.call(this,t,{width:i,height:n},r,s,a,T.g.TEXTUREFORMAT_RGBA,l)||this;return h._isDirty=!1,h._rootContainer=new S("root"),h._lastControlOver={},h._lastControlDown={},h._capturingControl={},h._linkedControls=new Array,h._isFullscreen=!1,h._fullscreenViewport=new le.l(0,0,1,1),h._idealWidth=0,h._idealHeight=0,h._useSmallestIdeal=!1,h._renderAtIdealSize=!1,h._blockNextFocusCheck=!1,h._renderScale=1,h._cursorChanged=!1,h._defaultMousePointerId=0,h._numLayoutCalls=0,h._numRenderCalls=0,h._clipboardData="",h.onClipboardObservable=new o.y$,h.onControlPickedObservable=new o.y$,h.onBeginLayoutObservable=new o.y$,h.onEndLayoutObservable=new o.y$,h.onBeginRenderObservable=new o.y$,h.onEndRenderObservable=new o.y$,h.premulAlpha=!1,h.applyYInversionOnUpdate=!0,h._useInvalidateRectOptimization=!0,h._invalidatedRectangle=null,h._clearMeasure=new d(0,0,0,0),h.onClipboardCopy=function(e){var t=e,i=new L.o(L.p.COPY,t);h.onClipboardObservable.notifyObservers(i),t.preventDefault()},h.onClipboardCut=function(e){var t=e,i=new L.o(L.p.CUT,t);h.onClipboardObservable.notifyObservers(i),t.preventDefault()},h.onClipboardPaste=function(e){var t=e,i=new L.o(L.p.PASTE,t);h.onClipboardObservable.notifyObservers(i),t.preventDefault()},(r=h.getScene())&&h._texture?(h._rootElement=r.getEngine().getInputElement(),h._renderObserver=r.onBeforeCameraRenderObservable.add((function(e){return h._checkUpdate(e)})),h._preKeyboardObserver=r.onPreKeyboardObservable.add((function(e){h._focusedControl&&(e.type===re.OG.KEYDOWN&&h._focusedControl.processKeyboard(e.event),e.skipOnPointerObservable=!0)})),h._rootContainer._link(h),h.hasAlpha=!0,i&&n||(h._resizeObserver=r.getEngine().onResizeObservable.add((function(){return h._onResize()})),h._onResize()),h._texture.isReady=!0,h):h}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"numLayoutCalls",{get:function(){return this._numLayoutCalls},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numRenderCalls",{get:function(){return this._numRenderCalls},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderScale",{get:function(){return this._renderScale},set:function(e){e!==this._renderScale&&(this._renderScale=e,this._onResize())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this.markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"idealWidth",{get:function(){return this._idealWidth},set:function(e){this._idealWidth!==e&&(this._idealWidth=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"idealHeight",{get:function(){return this._idealHeight},set:function(e){this._idealHeight!==e&&(this._idealHeight=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useSmallestIdeal",{get:function(){return this._useSmallestIdeal},set:function(e){this._useSmallestIdeal!==e&&(this._useSmallestIdeal=e,this.markAsDirty(),this._rootContainer._markAllAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderAtIdealSize",{get:function(){return this._renderAtIdealSize},set:function(e){this._renderAtIdealSize!==e&&(this._renderAtIdealSize=e,this._onResize())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"idealRatio",{get:function(){var e=0,t=0;return this._idealWidth&&(e=this.getSize().width/this._idealWidth),this._idealHeight&&(t=this.getSize().height/this._idealHeight),this._useSmallestIdeal&&this._idealWidth&&this._idealHeight?window.innerWidth<window.innerHeight?e:t:this._idealWidth?e:this._idealHeight?t:1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layer",{get:function(){return this._layerToDispose},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rootContainer",{get:function(){return this._rootContainer},enumerable:!1,configurable:!0}),t.prototype.getChildren=function(){return[this._rootContainer]},t.prototype.getDescendants=function(e,t){return this._rootContainer.getDescendants(e,t)},Object.defineProperty(t.prototype,"focusedControl",{get:function(){return this._focusedControl},set:function(e){this._focusedControl!=e&&(this._focusedControl&&this._focusedControl.onBlur(),e&&e.onFocus(),this._focusedControl=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isForeground",{get:function(){return!this.layer||!this.layer.isBackground},set:function(e){this.layer&&this.layer.isBackground!==!e&&(this.layer.isBackground=!e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clipboardData",{get:function(){return this._clipboardData},set:function(e){this._clipboardData=e},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"AdvancedDynamicTexture"},t.prototype.executeOnAllControls=function(e,t){t||(t=this._rootContainer),e(t);for(var i=0,n=t.children;i<n.length;i++){var r=n[i];r.children?this.executeOnAllControls(e,r):e(r)}},Object.defineProperty(t.prototype,"useInvalidateRectOptimization",{get:function(){return this._useInvalidateRectOptimization},set:function(e){this._useInvalidateRectOptimization=e},enumerable:!1,configurable:!0}),t.prototype.invalidateRect=function(e,t,i,n){if(this._useInvalidateRectOptimization)if(this._invalidatedRectangle){var r=Math.ceil(Math.max(this._invalidatedRectangle.left+this._invalidatedRectangle.width-1,i)),o=Math.ceil(Math.max(this._invalidatedRectangle.top+this._invalidatedRectangle.height-1,n));this._invalidatedRectangle.left=Math.floor(Math.min(this._invalidatedRectangle.left,e)),this._invalidatedRectangle.top=Math.floor(Math.min(this._invalidatedRectangle.top,t)),this._invalidatedRectangle.width=r-this._invalidatedRectangle.left+1,this._invalidatedRectangle.height=o-this._invalidatedRectangle.top+1}else this._invalidatedRectangle=new d(e,t,i-e+1,n-t+1)},t.prototype.markAsDirty=function(){this._isDirty=!0},t.prototype.createStyle=function(){return new ae(this)},t.prototype.addControl=function(e){return this._rootContainer.addControl(e),this},t.prototype.removeControl=function(e){return this._rootContainer.removeControl(e),this},t.prototype.dispose=function(){var t=this.getScene();t&&(this._rootElement=null,t.onBeforeCameraRenderObservable.remove(this._renderObserver),this._resizeObserver&&t.getEngine().onResizeObservable.remove(this._resizeObserver),this._pointerMoveObserver&&t.onPrePointerObservable.remove(this._pointerMoveObserver),this._pointerObserver&&t.onPointerObservable.remove(this._pointerObserver),this._preKeyboardObserver&&t.onPreKeyboardObservable.remove(this._preKeyboardObserver),this._canvasPointerOutObserver&&t.getEngine().onCanvasPointerOutObservable.remove(this._canvasPointerOutObserver),this._canvasBlurObserver&&t.getEngine().onCanvasBlurObservable.remove(this._canvasBlurObserver),this._layerToDispose&&(this._layerToDispose.texture=null,this._layerToDispose.dispose(),this._layerToDispose=null),this._rootContainer.dispose(),this.onClipboardObservable.clear(),this.onControlPickedObservable.clear(),this.onBeginRenderObservable.clear(),this.onEndRenderObservable.clear(),this.onBeginLayoutObservable.clear(),this.onEndLayoutObservable.clear(),e.prototype.dispose.call(this))},t.prototype._onResize=function(){var e=this.getScene();if(e){var t=e.getEngine(),i=this.getSize(),n=t.getRenderWidth()*this._renderScale,r=t.getRenderHeight()*this._renderScale;this._renderAtIdealSize&&(this._idealWidth?(r=r*this._idealWidth/n,n=this._idealWidth):this._idealHeight&&(n=n*this._idealHeight/r,r=this._idealHeight)),i.width===n&&i.height===r||(this.scaleTo(n,r),this.markAsDirty(),(this._idealWidth||this._idealHeight)&&this._rootContainer._markAllAsDirty()),this.invalidateRect(0,0,i.width-1,i.height-1)}},t.prototype._getGlobalViewport=function(){var e=this.getSize();return this._fullscreenViewport.toGlobal(e.width,e.height)},t.prototype.getProjectedPosition=function(e,t){var i=this.getScene();if(!i)return s.FM.Zero();var n=this._getGlobalViewport(),r=s.P.Project(e,t,i.getTransformMatrix(),n);return r.scaleInPlace(this.renderScale),new s.FM(r.x,r.y)},t.prototype.getProjectedPositionWithZ=function(e,t){var i=this.getScene();if(!i)return s.P.Zero();var n=this._getGlobalViewport(),r=s.P.Project(e,t,i.getTransformMatrix(),n);return r.scaleInPlace(this.renderScale),new s.P(r.x,r.y,r.z)},t.prototype._checkUpdate=function(e){if(!this._layerToDispose||0!=(e.layerMask&this._layerToDispose.layerMask)){if(this._isFullscreen&&this._linkedControls.length){var t=this.getScene();if(!t)return;for(var i=this._getGlobalViewport(),n=function(e){if(!e.isVisible)return"continue";var n=e._linkedMesh;if(!n||n.isDisposed())return l.w1.SetImmediate((function(){e.linkWithMesh(null)})),"continue";var o=n.getBoundingInfo?n.getBoundingInfo().boundingSphere.center:s.P.ZeroReadOnly,a=s.P.Project(o,n.getWorldMatrix(),t.getTransformMatrix(),i);if(a.z<0||a.z>1)return e.notRenderable=!0,"continue";e.notRenderable=!1,a.scaleInPlace(r.renderScale),e._moveToProjectedPosition(a)},r=this,o=0,a=this._linkedControls;o<a.length;o++)n(a[o])}(this._isDirty||this._rootContainer.isDirty)&&(this._isDirty=!1,this._render(),this.update(this.applyYInversionOnUpdate,this.premulAlpha))}},t.prototype._render=function(){var e=this.getSize(),t=e.width,i=e.height,n=this.getContext();n.font="18px Arial",n.strokeStyle="white",this.onBeginLayoutObservable.notifyObservers(this);var r=new d(0,0,t,i);this._numLayoutCalls=0,this._rootContainer._layout(r,n),this.onEndLayoutObservable.notifyObservers(this),this._isDirty=!1,this._invalidatedRectangle?this._clearMeasure.copyFrom(this._invalidatedRectangle):this._clearMeasure.copyFromFloats(0,0,t,i),n.clearRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),this._background&&(n.save(),n.fillStyle=this._background,n.fillRect(this._clearMeasure.left,this._clearMeasure.top,this._clearMeasure.width,this._clearMeasure.height),n.restore()),this.onBeginRenderObservable.notifyObservers(this),this._numRenderCalls=0,this._rootContainer._render(n,this._invalidatedRectangle),this.onEndRenderObservable.notifyObservers(this),this._invalidatedRectangle=null},t.prototype._changeCursor=function(e){this._rootElement&&(this._rootElement.style.cursor=e,this._cursorChanged=!0)},t.prototype._registerLastControlDown=function(e,t){this._lastControlDown[t]=e,this.onControlPickedObservable.notifyObservers(e)},t.prototype._doPicking=function(e,t,i,n,r,o,s,l){var h=this.getScene();if(h){var u=h.getEngine(),c=this.getSize();if(this._isFullscreen){var f=(h.cameraToUseForPointers||h.activeCamera).viewport;e*=c.width/(u.getRenderWidth()*f.width),t*=c.height/(u.getRenderHeight()*f.height)}this._capturingControl[r]?this._capturingControl[r]._processObservables(n,e,t,i,r,o):(this._cursorChanged=!1,this._rootContainer._processPicking(e,t,i,n,r,o,s,l)||(h.doNotHandleCursors||this._changeCursor(""),n===a.kD.POINTERMOVE&&this._lastControlOver[r]&&(this._lastControlOver[r]._onPointerOut(this._lastControlOver[r],i),delete this._lastControlOver[r])),this._cursorChanged||h.doNotHandleCursors||this._changeCursor(""),this._manageFocus())}},t.prototype._cleanControlAfterRemovalFromList=function(e,t){for(var i in e)e.hasOwnProperty(i)&&e[i]===t&&delete e[i]},t.prototype._cleanControlAfterRemoval=function(e){this._cleanControlAfterRemovalFromList(this._lastControlDown,e),this._cleanControlAfterRemovalFromList(this._lastControlOver,e)},t.prototype.attach=function(){var e=this,t=this.getScene();if(t){var i=new le.l(0,0,0,0);this._pointerMoveObserver=t.onPrePointerObservable.add((function(n,r){if(!t.isPointerCaptured(n.event.pointerId)&&(n.type===a.kD.POINTERMOVE||n.type===a.kD.POINTERUP||n.type===a.kD.POINTERDOWN||n.type===a.kD.POINTERWHEEL)&&t){n.type===a.kD.POINTERMOVE&&n.event.pointerId&&(e._defaultMousePointerId=n.event.pointerId);var o=t.cameraToUseForPointers||t.activeCamera,s=t.getEngine();o?o.viewport.toGlobalToRef(s.getRenderWidth(),s.getRenderHeight(),i):(i.x=0,i.y=0,i.width=s.getRenderWidth(),i.height=s.getRenderHeight());var l=t.pointerX/s.getHardwareScalingLevel()-i.x,h=t.pointerY/s.getHardwareScalingLevel()-(s.getRenderHeight()-i.y-i.height);e._shouldBlockPointer=!1;var u=n.event.pointerId||e._defaultMousePointerId;e._doPicking(l,h,n,n.type,u,n.event.button,n.event.deltaX,n.event.deltaY),e._shouldBlockPointer&&(n.skipOnPointerObservable=e._shouldBlockPointer)}})),this._attachToOnPointerOut(t),this._attachToOnBlur(t)}},t.prototype.registerClipboardEvents=function(){self.addEventListener("copy",this.onClipboardCopy,!1),self.addEventListener("cut",this.onClipboardCut,!1),self.addEventListener("paste",this.onClipboardPaste,!1)},t.prototype.unRegisterClipboardEvents=function(){self.removeEventListener("copy",this.onClipboardCopy),self.removeEventListener("cut",this.onClipboardCut),self.removeEventListener("paste",this.onClipboardPaste)},t.prototype.attachToMesh=function(e,t){var i=this;void 0===t&&(t=!0);var n=this.getScene();n&&(this._pointerObserver=n.onPointerObservable.add((function(t,n){if(t.type===a.kD.POINTERMOVE||t.type===a.kD.POINTERUP||t.type===a.kD.POINTERDOWN||t.type===a.kD.POINTERWHEEL){t.type===a.kD.POINTERMOVE&&t.event.pointerId&&(i._defaultMousePointerId=t.event.pointerId);var r=t.event.pointerId||i._defaultMousePointerId;if(t.pickInfo&&t.pickInfo.hit&&t.pickInfo.pickedMesh===e){var o=t.pickInfo.getTextureCoordinates();if(o){var s=i.getSize();i._doPicking(o.x*s.width,(i.applyYInversionOnUpdate?1-o.y:o.y)*s.height,t,t.type,r,t.event.button,t.event.deltaX,t.event.deltaY)}}else if(t.type===a.kD.POINTERUP){if(i._lastControlDown[r]&&i._lastControlDown[r]._forcePointerUp(r),delete i._lastControlDown[r],i.focusedControl){var l=i.focusedControl.keepsFocusWith(),h=!0;if(l)for(var u=0,c=l;u<c.length;u++){var f=c[u];if(i!==f._host){var _=f._host;if(_._lastControlOver[r]&&_._lastControlOver[r].isAscendant(f)){h=!1;break}}}h&&(i.focusedControl=null)}}else t.type===a.kD.POINTERMOVE&&(i._lastControlOver[r]&&i._lastControlOver[r]._onPointerOut(i._lastControlOver[r],t,!0),delete i._lastControlOver[r])}})),e.enablePointerMoveEvents=t,this._attachToOnPointerOut(n),this._attachToOnBlur(n))},t.prototype.moveFocusToControl=function(e){this.focusedControl=e,this._lastPickedControl=e,this._blockNextFocusCheck=!0},t.prototype._manageFocus=function(){if(this._blockNextFocusCheck)return this._blockNextFocusCheck=!1,void(this._lastPickedControl=this._focusedControl);if(this._focusedControl&&this._focusedControl!==this._lastPickedControl){if(this._lastPickedControl.isFocusInvisible)return;this.focusedControl=null}},t.prototype._attachToOnPointerOut=function(e){var t=this;this._canvasPointerOutObserver=e.getEngine().onCanvasPointerOutObservable.add((function(e){t._lastControlOver[e.pointerId]&&t._lastControlOver[e.pointerId]._onPointerOut(t._lastControlOver[e.pointerId],null),delete t._lastControlOver[e.pointerId],t._lastControlDown[e.pointerId]&&t._lastControlDown[e.pointerId]!==t._capturingControl[e.pointerId]&&(t._lastControlDown[e.pointerId]._forcePointerUp(),delete t._lastControlDown[e.pointerId])}))},t.prototype._attachToOnBlur=function(e){var t=this;this._canvasBlurObserver=e.getEngine().onCanvasBlurObservable.add((function(e){Object.entries(t._lastControlDown).forEach((function(e){e[0],e[1]._onCanvasBlur()})),t._lastControlDown={}}))},t.prototype.serializeContent=function(){var e={root:{}};return this._rootContainer.serialize(e.root),e},t.prototype.parseContent=function(e){this._rootContainer=x.Parse(e.root,this)},t.prototype.parseFromSnippetAsync=function(e){var i=this;return"_BLANK"===e?Promise.resolve():new Promise((function(n,r){var o=new he.g;o.addEventListener("readystatechange",(function(){if(4==o.readyState)if(200==o.status){var t=JSON.parse(JSON.parse(o.responseText).jsonPayload),s=JSON.parse(t.gui);i.parseContent(s),i.snippetId=e,n()}else r("Unable to load the snippet "+e)})),o.open("GET",t.SnippetUrl+"/"+e.replace(/#/g,"/")),o.send()}))},t.CreateForMesh=function(e,i,n,r,o,s){void 0===i&&(i=1024),void 0===n&&(n=1024),void 0===r&&(r=!0),void 0===o&&(o=!1);var a=new t(e.name+" AdvancedDynamicTexture",i,n,e.getScene(),!0,C.x.TRILINEAR_SAMPLINGMODE,s),l=new oe.K("AdvancedDynamicTextureMaterial",e.getScene());return l.backFaceCulling=!1,l.diffuseColor=N.Wo.Black(),l.specularColor=N.Wo.Black(),o?(l.diffuseTexture=a,l.emissiveTexture=a,a.hasAlpha=!0):(l.emissiveTexture=a,l.opacityTexture=a),e.material=l,a.attachToMesh(e,r),a},t.CreateForMeshTexture=function(e,i,n,r,o){void 0===i&&(i=1024),void 0===n&&(n=1024),void 0===r&&(r=!0);var s=new t(e.name+" AdvancedDynamicTexture",i,n,e.getScene(),!0,C.x.TRILINEAR_SAMPLINGMODE,o);return s.attachToMesh(e,r),s},t.CreateFullscreenUI=function(e,i,n,r){void 0===i&&(i=!0),void 0===n&&(n=null),void 0===r&&(r=C.x.BILINEAR_SAMPLINGMODE);var o=new t(e,0,0,n,!1,r),s=new se.m(e+"_layer",null,n,!i);return s.texture=o,o._layerToDispose=s,o._isFullscreen=!0,o.attach(),o},t.SnippetUrl="https://snippet.babylonjs.com",t}(P.c),ce=i(3221),fe=(function(){function e(e){this.texture=e,this._captureRenderTime=!1,this._renderTime=new ce.z,this._captureLayoutTime=!1,this._layoutTime=new ce.z,this._onBeginRenderObserver=null,this._onEndRenderObserver=null,this._onBeginLayoutObserver=null,this._onEndLayoutObserver=null}Object.defineProperty(e.prototype,"renderTimeCounter",{get:function(){return this._renderTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"layoutTimeCounter",{get:function(){return this._layoutTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"captureRenderTime",{get:function(){return this._captureRenderTime},set:function(e){var t=this;e!==this._captureRenderTime&&(this._captureRenderTime=e,e?(this._onBeginRenderObserver=this.texture.onBeginRenderObservable.add((function(){t._renderTime.beginMonitoring()})),this._onEndRenderObserver=this.texture.onEndRenderObservable.add((function(){t._renderTime.endMonitoring(!0)}))):(this.texture.onBeginRenderObservable.remove(this._onBeginRenderObserver),this._onBeginRenderObserver=null,this.texture.onEndRenderObservable.remove(this._onEndRenderObserver),this._onEndRenderObserver=null))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"captureLayoutTime",{get:function(){return this._captureLayoutTime},set:function(e){var t=this;e!==this._captureLayoutTime&&(this._captureLayoutTime=e,e?(this._onBeginLayoutObserver=this.texture.onBeginLayoutObservable.add((function(){t._layoutTime.beginMonitoring()})),this._onEndLayoutObserver=this.texture.onEndLayoutObservable.add((function(){t._layoutTime.endMonitoring(!0)}))):(this.texture.onBeginLayoutObservable.remove(this._onBeginLayoutObserver),this._onBeginLayoutObserver=null,this.texture.onEndLayoutObservable.remove(this._onEndLayoutObserver),this._onEndLayoutObserver=null))},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this.texture.onBeginRenderObservable.remove(this._onBeginRenderObserver),this._onBeginRenderObserver=null,this.texture.onEndRenderObservable.remove(this._onEndRenderObserver),this._onEndRenderObserver=null,this.texture.onBeginLayoutObservable.remove(this._onBeginLayoutObserver),this._onBeginLayoutObserver=null,this.texture.onEndLayoutObservable.remove(this._onEndLayoutObserver),this._onEndLayoutObserver=null,this.texture=null}}(),function(){function e(e){void 0===e&&(e=null),this._nodes={},this._nodeTypes={element:1,attribute:2,text:3},this._isLoaded=!1,this._objectAttributes={textHorizontalAlignment:1,textVerticalAlignment:2,horizontalAlignment:3,verticalAlignment:4,stretch:5},e&&(this._parentClass=e)}e.prototype._getChainElement=function(e){var t=window;this._parentClass&&(t=this._parentClass);var i=e;i=i.split(".");for(var n=0;n<i.length;n++)t=t[i[n]];return t},e.prototype._getClassAttribute=function(e){var t=e.split(".");return v.Q.GetClass("BABYLON.GUI."+t[0])[t[1]]},e.prototype._createGuiElement=function(e,t,i){void 0===i&&(i=!0);try{var n=new(v.Q.GetClass("BABYLON.GUI."+e.nodeName));t&&i&&t.addControl(n);for(var r=0;r<e.attributes.length;r++)if(!e.attributes[r].name.toLowerCase().includes("datasource"))if(e.attributes[r].name.toLowerCase().includes("observable")){var o=this._getChainElement(e.attributes[r].value);n[e.attributes[r].name].add(o)}else"linkWithMesh"==e.attributes[r].name?this._parentClass?n.linkWithMesh(this._parentClass[e.attributes[r].value]):n.linkWithMesh(window[e.attributes[r].value]):e.attributes[r].value.startsWith("{{")&&e.attributes[r].value.endsWith("}}")?(o=this._getChainElement(e.attributes[r].value.substring(2,e.attributes[r].value.length-2)),n[e.attributes[r].name]=o):this._objectAttributes[e.attributes[r].name]?n[e.attributes[r].name]=this._getClassAttribute(e.attributes[r].value):"true"==e.attributes[r].value||"false"==e.attributes[r].value?n[e.attributes[r].name]="true"==e.attributes[r].value:n[e.attributes[r].name]=isNaN(Number(e.attributes[r].value))?e.attributes[r].value:Number(e.attributes[r].value);if(!e.attributes.getNamedItem("id"))return this._nodes[e.nodeName+Object.keys(this._nodes).length+"_gen"]=n,n;var s=e.attributes.getNamedItem("id").value;if(s.startsWith("{{")&&s.endsWith("}}")&&(s=this._getChainElement(s.substring(2,s.length-2))),this._nodes[s])throw"XmlLoader Exception : Duplicate ID, every element should have an unique ID attribute";return this._nodes[s]=n,n}catch(t){throw"XmlLoader Exception : Error parsing Control "+e.nodeName+","+t+"."}},e.prototype._parseGrid=function(e,t,i){for(var n,r,o,s,a,l=e.children,h=!1,u=-1,c=-1,f=0,_=0;_<l.length;_++)if(l[_].nodeType==this._nodeTypes.element){if("Row"!=l[_].nodeName)throw"XmlLoader Exception : Expecting Row node, received "+l[_].nodeName;if(u+=1,o=l[_].children,!l[_].attributes.getNamedItem("height"))throw"XmlLoader Exception : Height must be defined for grid rows";r=Number(l[_].attributes.getNamedItem("height").nodeValue),h=!!l[_].attributes.getNamedItem("isPixel")&&JSON.parse(l[_].attributes.getNamedItem("isPixel").nodeValue),t.addRowDefinition(r,h);for(var d=0;d<o.length;d++)if(o[d].nodeType==this._nodeTypes.element){if("Column"!=o[d].nodeName)throw"XmlLoader Exception : Expecting Column node, received "+o[d].nodeName;if(c+=1,u>0&&c>f)throw"XmlLoader Exception : In the Grid element, the number of columns is defined in the first row, do not add more columns in the subsequent rows.";if(0==u){if(!o[d].attributes.getNamedItem("width"))throw"XmlLoader Exception : Width must be defined for all the grid columns in the first row";n=Number(o[d].attributes.getNamedItem("width").nodeValue),h=!!o[d].attributes.getNamedItem("isPixel")&&JSON.parse(o[d].attributes.getNamedItem("isPixel").nodeValue),t.addColumnDefinition(n,h)}s=o[d].children;for(var p=0;p<s.length;p++)s[p].nodeType==this._nodeTypes.element&&(a=this._createGuiElement(s[p],t,!1),t.addControl(a,u,c),s[p].firstChild&&this._parseXml(s[p].firstChild,a))}0==u&&(f=c),c=-1}e.nextSibling&&this._parseXml(e.nextSibling,i)},e.prototype._parseElement=function(e,t,i){e.firstChild&&this._parseXml(e.firstChild,t),e.nextSibling&&this._parseXml(e.nextSibling,i)},e.prototype._prepareSourceElement=function(e,t,i,n,r){this._parentClass?this._parentClass[i]=n[r]:window[i]=n[r],e.firstChild&&this._parseXml(e.firstChild,t,!0)},e.prototype._parseElementsFromSource=function(e,t,i){var n=e.attributes.getNamedItem("dataSource").value;if(!n.includes(" in "))throw"XmlLoader Exception : Malformed XML, Data Source must include an in";var r=!0,o=n.split(" in ");if(o.length<2)throw"XmlLoader Exception : Malformed XML, Data Source must have an iterator and a source";var s=o[1];if(s.startsWith("{")&&s.endsWith("}")&&(r=!1),(!r||s.startsWith("[")&&s.endsWith("]"))&&(s=s.substring(1,s.length-1)),s=this._parentClass?this._parentClass[s]:window[s],r)for(var a=0;a<s.length;a++)this._prepareSourceElement(e,t,o[0],s,a);else for(var a in s)this._prepareSourceElement(e,t,o[0],s,a);e.nextSibling&&this._parseXml(e.nextSibling,i)},e.prototype._parseXml=function(e,t,i){if(void 0===i&&(i=!1),e.nodeType==this._nodeTypes.element){i&&e.setAttribute("id",t.id+(t._children.length+1));var n=this._createGuiElement(e,t);this._rootNode||(this._rootNode=n),"Grid"==e.nodeName?this._parseGrid(e,n,t):e.attributes.getNamedItem("dataSource")?this._parseElementsFromSource(e,n,t):this._parseElement(e,n,t)}else e.nextSibling&&this._parseXml(e.nextSibling,t,i)},e.prototype.isLoaded=function(){return this._isLoaded},e.prototype.getNodeById=function(e){return this._nodes[e]},e.prototype.getNodes=function(){return this._nodes},e.prototype.dispose=function(){this._rootNode&&(this._rootNode.dispose(),this._rootNode=null,this._nodes={})},e.prototype.loadLayout=function(e,t,i,n){var r=this;void 0===i&&(i=null),void 0===n&&(n=null);var o=new XMLHttpRequest;o.onload=function(){if(4===o.readyState&&200===o.status){if(!o.responseXML)throw"XmlLoader Exception : XML file is malformed or corrupted.";var e=o.responseXML.documentElement;r._parseXml(e.firstChild,t),r._isLoaded=!0,i&&i()}},o.onerror=function(){n&&n("an error occurred during loading the layout")},o.open("GET",e,!0),o.send()},e.prototype.loadLayoutAsync=function(e,t){return(0,n.mG)(this,void 0,void 0,(function(){var i=this;return(0,n.Jh)(this,(function(n){return[2,new Promise((function(n,r){i.loadLayout(e,t,n,r)}))]}))}))}}(),i(4126)),_e=function(e){function t(t,i){void 0===i&&(i=0);var n=e.call(this,t.x,t.y,t.z)||this;return n.buttonIndex=i,n}return(0,n.ZT)(t,e),t}(s.P),de=function(){function e(e){this.name=e,this._downCount=0,this._enterCount=-1,this._downPointerIds={},this._isVisible=!0,this.onPointerMoveObservable=new o.y$,this.onPointerOutObservable=new o.y$,this.onPointerDownObservable=new o.y$,this.onPointerUpObservable=new o.y$,this.onPointerClickObservable=new o.y$,this.onPointerEnterObservable=new o.y$,this._behaviors=new Array}return Object.defineProperty(e.prototype,"position",{get:function(){return this._node?this._node.position:s.P.Zero()},set:function(e){this._node&&(this._node.position=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaling",{get:function(){return this._node?this._node.scaling:new s.P(1,1,1)},set:function(e){this._node&&(this._node.scaling=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!1,configurable:!0}),e.prototype.addBehavior=function(e){var t=this;if(-1!==this._behaviors.indexOf(e))return this;e.init();var i=this._host.scene;return i.isLoading?i.onDataLoadedObservable.addOnce((function(){e.attach(t)})):e.attach(this),this._behaviors.push(e),this},e.prototype.removeBehavior=function(e){var t=this._behaviors.indexOf(e);return-1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this},e.prototype.getBehaviorByName=function(e){for(var t=0,i=this._behaviors;t<i.length;t++){var n=i[t];if(n.name===e)return n}return null},Object.defineProperty(e.prototype,"isVisible",{get:function(){return this._isVisible},set:function(e){if(this._isVisible!==e){this._isVisible=e;var t=this.mesh;t&&t.setEnabled(e)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typeName",{get:function(){return this._getTypeName()},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return this._getTypeName()},e.prototype._getTypeName=function(){return"Control3D"},Object.defineProperty(e.prototype,"node",{get:function(){return this._node},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._node instanceof H.x?this._node:null},enumerable:!1,configurable:!0}),e.prototype.linkToTransformNode=function(e){return this._node&&(this._node.parent=e),this},e.prototype._prepareNode=function(e){if(!this._node){if(this._node=this._createNode(e),!this.node)return;this._injectGUI3DReservedDataStore(this.node).control=this;var t=this.mesh;t&&(t.isPickable=!0,this._affectMaterial(t))}},e.prototype._injectGUI3DReservedDataStore=function(e){var t,i;return e.reservedDataStore=null!==(t=e.reservedDataStore)&&void 0!==t?t:{},e.reservedDataStore.GUI3D=null!==(i=e.reservedDataStore.GUI3D)&&void 0!==i?i:{},e.reservedDataStore.GUI3D},e.prototype._createNode=function(e){return null},e.prototype._affectMaterial=function(e){e.material=null},e.prototype._IsTouchButton3D=function(e){return void 0!==e._generatePointerEventType},e.prototype._onPointerMove=function(e,t){this.onPointerMoveObservable.notifyObservers(t,-1,e,this)},e.prototype._onPointerEnter=function(e){return-1===this._enterCount&&(this._enterCount=0),this._enterCount++,!(this._enterCount>1||(this.onPointerEnterObservable.notifyObservers(this,-1,e,this),this.pointerEnterAnimation&&this.pointerEnterAnimation(),0))},e.prototype._onPointerOut=function(e){this._enterCount--,this._enterCount>0||(this._enterCount=0,this.onPointerOutObservable.notifyObservers(this,-1,e,this),this.pointerOutAnimation&&this.pointerOutAnimation())},e.prototype._onPointerDown=function(e,t,i,n){return this._downCount++,this._downPointerIds[i]=this._downPointerIds[i]+1||1,1===this._downCount&&(this.onPointerDownObservable.notifyObservers(new _e(t,n),-1,e,this),this.pointerDownAnimation&&this.pointerDownAnimation(),!0)},e.prototype._onPointerUp=function(e,t,i,n,r){this._downCount--,this._downPointerIds[i]--,this._downPointerIds[i]<=0&&delete this._downPointerIds[i],this._downCount<0?this._downCount=0:0==this._downCount&&(r&&(this._enterCount>0||-1===this._enterCount)&&this.onPointerClickObservable.notifyObservers(new _e(t,n),-1,e,this),this.onPointerUpObservable.notifyObservers(new _e(t,n),-1,e,this),this.pointerUpAnimation&&this.pointerUpAnimation())},e.prototype.forcePointerUp=function(e){if(void 0===e&&(e=null),null!==e)this._onPointerUp(this,s.P.Zero(),e,0,!0);else{for(var t in this._downPointerIds)this._onPointerUp(this,s.P.Zero(),+t,0,!0);this._downCount>0&&(this._downCount=1,this._onPointerUp(this,s.P.Zero(),0,0,!0))}},e.prototype._processObservables=function(e,t,i,n,r){if(this._IsTouchButton3D(this)&&i&&(e=this._generatePointerEventType(e,i,this._downCount)),e===a.kD.POINTERMOVE){this._onPointerMove(this,t);var o=this._host._lastControlOver[n];return o&&o!==this&&o._onPointerOut(this),o!==this&&this._onPointerEnter(this),this._host._lastControlOver[n]=this,!0}return e===a.kD.POINTERDOWN?(this._onPointerDown(this,t,n,r),this._host._lastControlDown[n]=this,this._host._lastPickedControl=this,!0):(e===a.kD.POINTERUP||e===a.kD.POINTERDOUBLETAP)&&(this._host._lastControlDown[n]&&this._host._lastControlDown[n]._onPointerUp(this,t,n,r,!0),delete this._host._lastControlDown[n],!0)},e.prototype._disposeNode=function(){this._node&&(this._node.dispose(),this._node=null)},e.prototype.dispose=function(){this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this._disposeNode();for(var e=0,t=this._behaviors;e<t.length;e++)t[e].detach()},e}(),pe=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._contentResolution=512,t._contentScaleRatio=2,t}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"content",{get:function(){return this._content},set:function(e){this._content=e,this._host&&this._host.utilityLayer&&(this._facadeTexture?this._facadeTexture.rootContainer.clearControls():(this._facadeTexture=new ue("Facade",this._contentResolution,this._contentResolution,this._host.utilityLayer.utilityLayerScene,!0,C.x.TRILINEAR_SAMPLINGMODE),this._facadeTexture.rootContainer.scaleX=this._contentScaleRatio,this._facadeTexture.rootContainer.scaleY=this._contentScaleRatio,this._facadeTexture.premulAlpha=!0),this._facadeTexture.addControl(e),this._applyFacade(this._facadeTexture))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"contentResolution",{get:function(){return this._contentResolution},set:function(e){this._contentResolution!==e&&(this._contentResolution=e,this._resetContent())},enumerable:!1,configurable:!0}),t.prototype._disposeFacadeTexture=function(){this._facadeTexture&&(this._facadeTexture.dispose(),this._facadeTexture=null)},t.prototype._resetContent=function(){this._disposeFacadeTexture(),this.content=this._content},t.prototype._applyFacade=function(e){},t}(de),ge=function(e){function t(t){return e.call(this,t)||this}return(0,n.ZT)(t,e),t.prototype._getTypeName=function(){return"AbstractButton3D"},t.prototype._createNode=function(e){return new fe.Y("button"+this.name)},t}(pe),me=i(3362),ve=function(e){function t(t){var i=e.call(this,t)||this;return i.pointerEnterAnimation=function(){i.mesh&&(i._currentMaterial.emissiveColor=N.Wo.Red())},i.pointerOutAnimation=function(){i._currentMaterial.emissiveColor=N.Wo.Black()},i.pointerDownAnimation=function(){i.mesh&&i.mesh.scaling.scaleInPlace(.95)},i.pointerUpAnimation=function(){i.mesh&&i.mesh.scaling.scaleInPlace(1/.95)},i}return(0,n.ZT)(t,e),t.prototype._applyFacade=function(e){this._currentMaterial.emissiveTexture=e},t.prototype._getTypeName=function(){return"Button3D"},t.prototype._createNode=function(e){for(var t=new Array(6),i=0;i<6;i++)t[i]=new s.Lt(0,0,0,0);return t[1]=new s.Lt(0,0,1,1),me.k.CreateBox(this.name+"_rootMesh",{width:1,height:1,depth:.08,faceUV:t},e)},t.prototype._affectMaterial=function(e){var t=new oe.K(this.name+"Material",e.getScene());t.specularColor=N.Wo.Black(),e.material=t,this._currentMaterial=t,this._resetContent()},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._disposeFacadeTexture(),this._currentMaterial&&this._currentMaterial.dispose()},t}(ge),be=function(e){function t(t){var i=e.call(this,t)||this;return i._blockLayout=!1,i._children=new Array,i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"children",{get:function(){return this._children},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blockLayout",{get:function(){return this._blockLayout},set:function(e){this._blockLayout!==e&&(this._blockLayout=e,this._blockLayout||this._arrangeChildren())},enumerable:!1,configurable:!0}),t.prototype.updateLayout=function(){return this._arrangeChildren(),this},t.prototype.containsControl=function(e){return-1!==this._children.indexOf(e)},t.prototype.addControl=function(e){return-1!==this._children.indexOf(e)||(e.parent=this,e._host=this._host,this._children.push(e),this._host.utilityLayer&&(e._prepareNode(this._host.utilityLayer.utilityLayerScene),e.node&&(e.node.parent=this.node),this.blockLayout||this._arrangeChildren())),this},t.prototype._arrangeChildren=function(){},t.prototype._createNode=function(e){return new fe.Y("ContainerNode",e)},t.prototype.removeControl=function(e){var t=this._children.indexOf(e);return-1!==t&&(this._children.splice(t,1),e.parent=null,e._disposeNode()),this},t.prototype._getTypeName=function(){return"Container3D"},t.prototype.dispose=function(){for(var t=0,i=this._children;t<i.length;t++)i[t].dispose();this._children=[],e.prototype.dispose.call(this)},t.UNSET_ORIENTATION=0,t.FACEORIGIN_ORIENTATION=1,t.FACEORIGINREVERSED_ORIENTATION=2,t.FACEFORWARD_ORIENTATION=3,t.FACEFORWARDREVERSED_ORIENTATION=4,t}(de),ye=function(e){function t(t){var i=e.call(this,t)||this;return i._columns=10,i._rows=0,i._rowThenColum=!0,i._orientation=be.FACEORIGIN_ORIENTATION,i.margin=0,i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"orientation",{get:function(){return this._orientation},set:function(e){var t=this;this._orientation!==e&&(this._orientation=e,l.w1.SetImmediate((function(){t._arrangeChildren()})))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"columns",{get:function(){return this._columns},set:function(e){var t=this;this._columns!==e&&(this._columns=e,this._rowThenColum=!0,l.w1.SetImmediate((function(){t._arrangeChildren()})))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rows",{get:function(){return this._rows},set:function(e){var t=this;this._rows!==e&&(this._rows=e,this._rowThenColum=!1,l.w1.SetImmediate((function(){t._arrangeChildren()})))},enumerable:!1,configurable:!0}),t.prototype._arrangeChildren=function(){this._cellWidth=0,this._cellHeight=0;for(var e=0,t=0,i=0,n=s.y3.Invert(this.node.computeWorldMatrix(!0)),r=0,o=this._children;r<o.length;r++)if((v=o[r]).mesh){i++,v.mesh.computeWorldMatrix(!0);var a=v.mesh.getHierarchyBoundingVectors(),l=s.jp.Vector3[0],h=s.jp.Vector3[1];a.max.subtractToRef(a.min,h),h.scaleInPlace(.5),s.P.TransformNormalToRef(h,n,l),this._cellWidth=Math.max(this._cellWidth,2*l.x),this._cellHeight=Math.max(this._cellHeight,2*l.y)}this._cellWidth+=2*this.margin,this._cellHeight+=2*this.margin,this._rowThenColum?(t=this._columns,e=Math.ceil(i/this._columns)):(e=this._rows,t=Math.ceil(i/this._rows));var u=.5*t*this._cellWidth,c=.5*e*this._cellHeight,f=[],_=0;if(this._rowThenColum)for(var d=0;d<e;d++)for(var p=0;p<t&&(f.push(new s.P(p*this._cellWidth-u+this._cellWidth/2,d*this._cellHeight-c+this._cellHeight/2,0)),!(++_>i));p++);else for(p=0;p<t;p++)for(d=0;d<e&&(f.push(new s.P(p*this._cellWidth-u+this._cellWidth/2,d*this._cellHeight-c+this._cellHeight/2,0)),!(++_>i));d++);_=0;for(var g=0,m=this._children;g<m.length;g++){var v;(v=m[g]).mesh&&(this._mapGridNode(v,f[_]),_++)}this._finalProcessing()},t.prototype._finalProcessing=function(){},t}(be),xe=i(1088),Pe=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._radius=5,t}(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){var t=this;this._radius!==e&&(this._radius=e,l.w1.SetImmediate((function(){t._arrangeChildren()})))},enumerable:!1,configurable:!0}),t.prototype._mapGridNode=function(e,t){var i=e.mesh;if(i){var n=this._cylindricalMapping(t);switch(e.position=n,this.orientation){case be.FACEORIGIN_ORIENTATION:i.lookAt(new s.P(2*n.x,n.y,2*n.z));break;case be.FACEORIGINREVERSED_ORIENTATION:i.lookAt(new s.P(-n.x,n.y,-n.z));break;case be.FACEFORWARD_ORIENTATION:break;case be.FACEFORWARDREVERSED_ORIENTATION:i.rotate(xe.RD.Y,Math.PI,xe.T.LOCAL)}}},t.prototype._cylindricalMapping=function(e){var t=new s.P(0,e.y,this._radius),i=e.x/this._radius;return s.y3.RotationYawPitchRollToRef(i,0,0,s.jp.Matrix[0]),s.P.TransformNormal(t,s.jp.Matrix[0])}}(ye),i(1308)),Ce=i(5596),Te=i(6416),Se=i(9901),Oe=i(3177),Ee=i(1344),Me=i(798),we=i(5589);we.Q.ShadersStore.fluentVertexShader="precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\nuniform mat4 world;\nuniform mat4 viewProjection;\nvarying vec2 vUV;\n#ifdef BORDER\nvarying vec2 scaleInfo;\nuniform float borderWidth;\nuniform vec3 scaleFactor;\n#endif\n#ifdef HOVERLIGHT\nvarying vec3 worldPosition;\n#endif\nvoid main(void) {\nvUV=uv;\n#ifdef BORDER\nvec3 scale=scaleFactor;\nfloat minScale=min(min(scale.x,scale.y),scale.z);\nfloat maxScale=max(max(scale.x,scale.y),scale.z);\nfloat minOverMiddleScale=minScale/(scale.x+scale.y+scale.z-minScale-maxScale);\nfloat areaYZ=scale.y*scale.z;\nfloat areaXZ=scale.x*scale.z;\nfloat areaXY=scale.x*scale.y;\nfloat scaledBorderWidth=borderWidth;\nif (abs(normal.x) == 1.0)\n{\nscale.x=scale.y;\nscale.y=scale.z;\nif (areaYZ>areaXZ && areaYZ>areaXY)\n{\nscaledBorderWidth*=minOverMiddleScale;\n}\n}\nelse if (abs(normal.y) == 1.0)\n{\nscale.x=scale.z;\nif (areaXZ>areaXY && areaXZ>areaYZ)\n{\nscaledBorderWidth*=minOverMiddleScale;\n}\n}\nelse\n{\nif (areaXY>areaYZ && areaXY>areaXZ)\n{\nscaledBorderWidth*=minOverMiddleScale;\n}\n}\nfloat scaleRatio=min(scale.x,scale.y)/max(scale.x,scale.y);\nif (scale.x>scale.y)\n{\nscaleInfo.x=1.0-(scaledBorderWidth*scaleRatio);\nscaleInfo.y=1.0-scaledBorderWidth;\n}\nelse\n{\nscaleInfo.x=1.0-scaledBorderWidth;\nscaleInfo.y=1.0-(scaledBorderWidth*scaleRatio);\n}\n#endif\nvec4 worldPos=world*vec4(position,1.0);\n#ifdef HOVERLIGHT\nworldPosition=worldPos.xyz;\n#endif\ngl_Position=viewProjection*worldPos;\n}\n";we.Q.ShadersStore.fluentPixelShader="precision highp float;\nvarying vec2 vUV;\nuniform vec4 albedoColor;\n#ifdef INNERGLOW\nuniform vec4 innerGlowColor;\n#endif\n#ifdef BORDER\nvarying vec2 scaleInfo;\nuniform float edgeSmoothingValue;\nuniform float borderMinValue;\n#endif\n#ifdef HOVERLIGHT\nvarying vec3 worldPosition;\nuniform vec3 hoverPosition;\nuniform vec4 hoverColor;\nuniform float hoverRadius;\n#endif\n#ifdef TEXTURE\nuniform sampler2D albedoSampler;\nuniform mat4 textureMatrix;\nvec2 finalUV;\n#endif\nvoid main(void) {\nvec3 albedo=albedoColor.rgb;\nfloat alpha=albedoColor.a;\n#ifdef TEXTURE\nfinalUV=vec2(textureMatrix*vec4(vUV,1.0,0.0));\nalbedo=texture2D(albedoSampler,finalUV).rgb;\n#endif\n#ifdef HOVERLIGHT\nfloat pointToHover=(1.0-clamp(length(hoverPosition-worldPosition)/hoverRadius,0.,1.))*hoverColor.a;\nalbedo=clamp(albedo+hoverColor.rgb*pointToHover,0.,1.);\n#else\nfloat pointToHover=1.0;\n#endif\n#ifdef BORDER\nfloat borderPower=10.0;\nfloat inverseBorderPower=1.0/borderPower;\nvec3 borderColor=albedo*borderPower;\nvec2 distanceToEdge;\ndistanceToEdge.x=abs(vUV.x-0.5)*2.0;\ndistanceToEdge.y=abs(vUV.y-0.5)*2.0;\nfloat borderValue=max(smoothstep(scaleInfo.x-edgeSmoothingValue,scaleInfo.x+edgeSmoothingValue,distanceToEdge.x),\nsmoothstep(scaleInfo.y-edgeSmoothingValue,scaleInfo.y+edgeSmoothingValue,distanceToEdge.y));\nborderColor=borderColor*borderValue*max(borderMinValue*inverseBorderPower,pointToHover);\nalbedo+=borderColor;\nalpha=max(alpha,borderValue);\n#endif\n#ifdef INNERGLOW\n\nvec2 uvGlow=(vUV-vec2(0.5,0.5))*(innerGlowColor.a*2.0);\nuvGlow=uvGlow*uvGlow;\nuvGlow=uvGlow*uvGlow;\nalbedo+=mix(vec3(0.0,0.0,0.0),innerGlowColor.rgb,uvGlow.x+uvGlow.y);\n#endif\ngl_FragColor=vec4(albedo,alpha);\n}";var Ie=function(e){function t(){var t=e.call(this)||this;return t.INNERGLOW=!1,t.BORDER=!1,t.HOVERLIGHT=!1,t.TEXTURE=!1,t.rebuild(),t}return(0,n.ZT)(t,e),t}(Se.H),Ae=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.innerGlowColorIntensity=.5,n.innerGlowColor=new N.Wo(1,1,1),n.albedoColor=new N.Wo(.3,.35,.4),n.renderBorders=!1,n.borderWidth=.5,n.edgeSmoothingValue=.02,n.borderMinValue=.1,n.renderHoverLight=!1,n.hoverRadius=1,n.hoverColor=new N.HE(.3,.3,.3,1),n.hoverPosition=s.P.Zero(),n}return(0,n.ZT)(t,e),t.prototype.needAlphaBlending=function(){return 1!==this.alpha},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new Ie);var n=this.getScene(),r=t._materialDefines;if(!this.checkReadyOnEveryCall&&t.effect&&r._renderId===n.getRenderId())return!0;if(r._areTexturesDirty)if(r.INNERGLOW=this.innerGlowColorIntensity>0,r.BORDER=this.renderBorders,r.HOVERLIGHT=this.renderHoverLight,this._albedoTexture){if(!this._albedoTexture.isReadyOrNotBlocking())return!1;r.TEXTURE=!0}else r.TEXTURE=!1;var o=n.getEngine();if(r.isDirty){r.markAsProcessed(),n.resetCachedMaterial();var s=[Me.o.PositionKind];s.push(Me.o.NormalKind),s.push(Me.o.UVKind);var a=["world","viewProjection","innerGlowColor","albedoColor","borderWidth","edgeSmoothingValue","scaleFactor","borderMinValue","hoverColor","hoverPosition","hoverRadius","textureMatrix"],l=["albedoSampler"],h=new Array;Oe.G.PrepareUniformsAndSamplersList({uniformsNames:a,uniformBuffersNames:h,samplers:l,defines:r,maxSimultaneousLights:4});var u=r.toString();t.setEffect(n.getEngine().createEffect("fluent",{attributes:s,uniformsNames:a,uniformBuffersNames:h,samplers:l,defines:u,fallbacks:null,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),r,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(r._renderId=n.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n=this.getScene(),r=i._materialDefines;if(r){var o=i.effect;if(o){if(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),this._mustRebind(n,o)&&(this._activeEffect.setColor4("albedoColor",this.albedoColor,this.alpha),r.INNERGLOW&&this._activeEffect.setColor4("innerGlowColor",this.innerGlowColor,this.innerGlowColorIntensity),r.BORDER&&(this._activeEffect.setFloat("borderWidth",this.borderWidth),this._activeEffect.setFloat("edgeSmoothingValue",this.edgeSmoothingValue),this._activeEffect.setFloat("borderMinValue",this.borderMinValue),t.getBoundingInfo().boundingBox.extendSize.multiplyToRef(t.scaling,s.jp.Vector3[0]),this._activeEffect.setVector3("scaleFactor",s.jp.Vector3[0])),r.HOVERLIGHT&&(this._activeEffect.setDirectColor4("hoverColor",this.hoverColor),this._activeEffect.setFloat("hoverRadius",this.hoverRadius),this._activeEffect.setVector3("hoverPosition",this.hoverPosition)),r.TEXTURE&&this._albedoTexture)){this._activeEffect.setTexture("albedoSampler",this._albedoTexture);var a=this._albedoTexture.getTextureMatrix();this._activeEffect.setMatrix("textureMatrix",a)}this._afterBind(t,this._activeEffect)}}},t.prototype.getActiveTextures=function(){return e.prototype.getActiveTextures.call(this)},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var i=this;return b.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var e=b.p4.Serialize(this);return e.customType="BABYLON.GUI.FluentMaterial",e},t.prototype.getClassName=function(){return"FluentMaterial"},t.Parse=function(e,i,n){return b.p4.Parse((function(){return new t(e.name,i)}),e,i,n)},(0,n.gn)([(0,b.qC)(),(0,b.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"innerGlowColorIntensity",void 0),(0,n.gn)([(0,b.n9)()],t.prototype,"innerGlowColor",void 0),(0,n.gn)([(0,b.n9)()],t.prototype,"albedoColor",void 0),(0,n.gn)([(0,b.qC)(),(0,b.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"renderBorders",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"borderWidth",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"edgeSmoothingValue",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"borderMinValue",void 0),(0,n.gn)([(0,b.qC)(),(0,b.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"renderHoverLight",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"hoverRadius",void 0),(0,n.gn)([(0,b.XX)()],t.prototype,"hoverColor",void 0),(0,n.gn)([(0,b.hd)()],t.prototype,"hoverPosition",void 0),(0,n.gn)([(0,b.oU)("albedoTexture")],t.prototype,"_albedoTexture",void 0),(0,n.gn)([(0,b.wz)("_markAllSubMeshesAsTexturesAndMiscDirty")],t.prototype,"albedoTexture",void 0),t}(Ee.a);v.Q.RegisteredTypes["BABYLON.GUI.FluentMaterial"]=Ae;var Fe=i(5511),Le=(function(e){function t(t,i){void 0===i&&(i=!0);var n=e.call(this,t)||this;return n._shareMaterials=!0,n._shareMaterials=i,n.pointerEnterAnimation=function(){n.mesh&&n._frontPlate.setEnabled(!0)},n.pointerOutAnimation=function(){n.mesh&&n._frontPlate.setEnabled(!1)},n}(0,n.ZT)(t,e),t.prototype._disposeTooltip=function(){this._tooltipFade=null,this._tooltipTextBlock&&this._tooltipTextBlock.dispose(),this._tooltipTexture&&this._tooltipTexture.dispose(),this._tooltipMesh&&this._tooltipMesh.dispose(),this.onPointerEnterObservable.remove(this._tooltipHoverObserver),this.onPointerOutObservable.remove(this._tooltipOutObserver)},Object.defineProperty(t.prototype,"renderingGroupId",{get:function(){return this._backPlate.renderingGroupId},set:function(e){this._backPlate.renderingGroupId=e,this._textPlate.renderingGroupId=e,this._frontPlate.renderingGroupId=e,this._tooltipMesh&&(this._tooltipMesh.renderingGroupId=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tooltipText",{get:function(){return this._tooltipTextBlock?this._tooltipTextBlock.text:null},set:function(e){var t=this;if(e){if(!this._tooltipFade){this._tooltipMesh=Ce.m.CreatePlane("",{size:1},this._backPlate._scene);var i=Ce.m.CreatePlane("",{size:1,sideOrientation:Pe.Kj.DOUBLESIDE},this._backPlate._scene),n=new oe.K("",this._backPlate._scene);n.diffuseColor=N.Wo.FromHexString("#212121"),i.material=n,i.isPickable=!1,this._tooltipMesh.addChild(i),i.position.z=.05,this._tooltipMesh.scaling.y=1/3,this._tooltipMesh.position.y=.7,this._tooltipMesh.position.z=-.15,this._tooltipMesh.isPickable=!1,this._tooltipMesh.parent=this._backPlate,this._tooltipTexture=ue.CreateForMesh(this._tooltipMesh),this._tooltipTextBlock=new M,this._tooltipTextBlock.scaleY=3,this._tooltipTextBlock.color="white",this._tooltipTextBlock.fontSize=130,this._tooltipTexture.addControl(this._tooltipTextBlock),this._tooltipFade=new Te.Y,this._tooltipFade.delay=500,this._tooltipMesh.addBehavior(this._tooltipFade),this._tooltipHoverObserver=this.onPointerEnterObservable.add((function(){t._tooltipFade&&t._tooltipFade.fadeIn(!0)})),this._tooltipOutObserver=this.onPointerOutObservable.add((function(){t._tooltipFade&&t._tooltipFade.fadeIn(!1)}))}this._tooltipTextBlock&&(this._tooltipTextBlock.text=e)}else this._disposeTooltip()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){this._text!==e&&(this._text=e,this._rebuildContent())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageUrl",{get:function(){return this._imageUrl},set:function(e){this._imageUrl!==e&&(this._imageUrl=e,this._rebuildContent())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"backMaterial",{get:function(){return this._backMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frontMaterial",{get:function(){return this._frontMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"plateMaterial",{get:function(){return this._plateMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shareMaterials",{get:function(){return this._shareMaterials},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"HolographicButton"},t.prototype._rebuildContent=function(){this._disposeFacadeTexture();var e=new A;if(e.isVertical=!0,Fe.M.IsDocumentAvailable()&&document.createElement&&this._imageUrl){var t=new w;t.source=this._imageUrl,t.paddingTop="40px",t.height="180px",t.width="100px",t.paddingBottom="40px",e.addControl(t)}if(this._text){var i=new M;i.text=this._text,i.color="white",i.height="30px",i.fontSize=24,e.addControl(i)}this._frontPlate&&(this.content=e)},t.prototype._createNode=function(t){return this._backPlate=me.k.CreateBox(this.name+"BackMesh",{width:1,height:1,depth:.08},t),this._frontPlate=me.k.CreateBox(this.name+"FrontMesh",{width:1,height:1,depth:.08},t),this._frontPlate.parent=this._backPlate,this._frontPlate.position.z=-.08,this._frontPlate.isPickable=!1,this._frontPlate.setEnabled(!1),this._textPlate=e.prototype._createNode.call(this,t),this._textPlate.parent=this._backPlate,this._textPlate.position.z=-.08,this._textPlate.isPickable=!1,this._backPlate},t.prototype._applyFacade=function(e){this._plateMaterial.emissiveTexture=e,this._plateMaterial.opacityTexture=e},t.prototype._createBackMaterial=function(e){var t=this;this._backMaterial=new Ae(this.name+"Back Material",e.getScene()),this._backMaterial.renderHoverLight=!0,this._pickedPointObserver=this._host.onPickedPointChangedObservable.add((function(e){e?(t._backMaterial.hoverPosition=e,t._backMaterial.hoverColor.a=1):t._backMaterial.hoverColor.a=0}))},t.prototype._createFrontMaterial=function(e){this._frontMaterial=new Ae(this.name+"Front Material",e.getScene()),this._frontMaterial.innerGlowColorIntensity=0,this._frontMaterial.alpha=.5,this._frontMaterial.renderBorders=!0},t.prototype._createPlateMaterial=function(e){this._plateMaterial=new oe.K(this.name+"Plate Material",e.getScene()),this._plateMaterial.specularColor=N.Wo.Black()},t.prototype._affectMaterial=function(e){this._shareMaterials?(this._host._sharedMaterials.backFluentMaterial?this._backMaterial=this._host._sharedMaterials.backFluentMaterial:(this._createBackMaterial(e),this._host._sharedMaterials.backFluentMaterial=this._backMaterial),this._host._sharedMaterials.frontFluentMaterial?this._frontMaterial=this._host._sharedMaterials.frontFluentMaterial:(this._createFrontMaterial(e),this._host._sharedMaterials.frontFluentMaterial=this._frontMaterial)):(this._createBackMaterial(e),this._createFrontMaterial(e)),this._createPlateMaterial(e),this._backPlate.material=this._backMaterial,this._frontPlate.material=this._frontMaterial,this._textPlate.material=this._plateMaterial,this._rebuildContent()},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._disposeTooltip(),this.shareMaterials||(this._backMaterial.dispose(),this._frontMaterial.dispose(),this._plateMaterial.dispose(),this._pickedPointObserver&&(this._host.onPickedPointChangedObservable.remove(this._pickedPointObserver),this._pickedPointObserver=null))}}(ve),i(584));we.Q.ShadersStore.fluentButtonPixelShader="uniform vec3 cameraPosition;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec4 vColor;\nvarying vec4 vExtra1;\nuniform float _Edge_Width_;\nuniform vec4 _Edge_Color_;\nuniform bool _Relative_Width_;\nuniform float _Proximity_Max_Intensity_;\nuniform float _Proximity_Far_Distance_;\nuniform float _Proximity_Near_Radius_;\nuniform float _Proximity_Anisotropy_;\nuniform float _Selection_Fuzz_;\nuniform float _Selected_;\nuniform float _Selection_Fade_;\nuniform float _Selection_Fade_Size_;\nuniform float _Selected_Distance_;\nuniform float _Selected_Fade_Length_;\nuniform bool _Blob_Enable_;\nuniform vec3 _Blob_Position_;\nuniform float _Blob_Intensity_;\nuniform float _Blob_Near_Size_;\nuniform float _Blob_Far_Size_;\nuniform float _Blob_Near_Distance_;\nuniform float _Blob_Far_Distance_;\nuniform float _Blob_Fade_Length_;\nuniform float _Blob_Inner_Fade_;\nuniform float _Blob_Pulse_;\nuniform float _Blob_Fade_;\nuniform sampler2D _Blob_Texture_;\nuniform bool _Blob_Enable_2_;\nuniform vec3 _Blob_Position_2_;\nuniform float _Blob_Near_Size_2_;\nuniform float _Blob_Inner_Fade_2_;\nuniform float _Blob_Pulse_2_;\nuniform float _Blob_Fade_2_;\nuniform vec3 _Active_Face_Dir_;\nuniform vec3 _Active_Face_Up_;\nuniform bool Enable_Fade;\nuniform float _Fade_Width_;\nuniform bool _Smooth_Active_Face_;\nuniform bool _Show_Frame_;\nuniform bool _Use_Blob_Texture_;\nuniform bool Use_Global_Left_Index;\nuniform bool Use_Global_Right_Index;\nuniform vec4 Global_Left_Index_Tip_Position;\nuniform vec4 Global_Right_Index_Tip_Position;\nuniform vec4 Global_Left_Thumb_Tip_Position;\nuniform vec4 Global_Right_Thumb_Tip_Position;\nuniform float Global_Left_Index_Tip_Proximity;\nuniform float Global_Right_Index_Tip_Proximity;\n\nvoid Holo_Edge_Fragment_B35(\nvec4 Edges,\nfloat Edge_Width,\nout float NotEdge)\n{\nvec2 c=vec2(min(Edges.r,Edges.g),min(Edges.b,Edges.a));\nvec2 df=fwidth(c)*Edge_Width;\nvec2 g=clamp(c/df,0.0,1.0);\nNotEdge=g.x*g.y;\n}\n\n\nvoid Blob_Fragment_B39(\nvec2 UV,\nvec3 Blob_Info,\nsampler2D Blob_Texture,\nout vec4 Blob_Color)\n{\nfloat k=dot(UV,UV);\nBlob_Color=Blob_Info.y*texture(Blob_Texture,vec2(vec2(sqrt(k),Blob_Info.x).x,1.0-vec2(sqrt(k),Blob_Info.x).y))*(1.0-clamp(k,0.0,1.0));\n}\n\n\nvec2 FilterStep(vec2 Edge,vec2 X)\n{\n\nvec2 dX=max(fwidth(X),vec2(0.00001,0.00001));\nreturn clamp( (X+dX-max(Edge,X-dX))/(dX*2.0),0.0,1.0);\n}\nvoid Wireframe_Fragment_B59(\nvec3 Widths,\nvec2 UV,\nfloat Proximity,\nvec4 Edge_Color,\nout vec4 Wireframe)\n{\nvec2 c=min(UV,vec2(1.0,1.0)-UV);\nvec2 g=FilterStep(Widths.xy*0.5,c);\nWireframe=(1.0-min(g.x,g.y))*Proximity*Edge_Color;\n}\n\n\nvoid Proximity_B53(\nvec3 Proximity_Center,\nvec3 Proximity_Center_2,\nfloat Proximity_Max_Intensity,\nfloat Proximity_Near_Radius,\nvec3 Position,\nvec3 Show_Selection,\nvec4 Extra1,\nfloat Dist_To_Face,\nfloat Intensity,\nout float Proximity)\n{\nvec2 delta1=Extra1.xy;\nvec2 delta2=Extra1.zw;\nfloat d2=sqrt(min(dot(delta1,delta1),dot(delta2,delta2))+Dist_To_Face*Dist_To_Face);\n\nProximity=Intensity*Proximity_Max_Intensity*(1.0-clamp(d2/Proximity_Near_Radius,0.0,1.0))*(1.0-Show_Selection.x)+Show_Selection.x;\n}\n\n\nvoid To_XYZ_B46(\nvec3 Vec3,\nout float X,\nout float Y,\nout float Z)\n{\nX=Vec3.x;\nY=Vec3.y;\nZ=Vec3.z;\n}\n\nvoid main()\n{\nfloat NotEdge_Q35;\n#if ENABLE_FADE\nHolo_Edge_Fragment_B35(vColor,_Fade_Width_,NotEdge_Q35);\n#else\nNotEdge_Q35=1.0;\n#endif\n\n\nvec4 Blob_Color_Q39;\nfloat k=dot(vUV,vUV);\nvec2 blobTextureCoord=vec2(vec2(sqrt(k),vTangent.x).x,1.0-vec2(sqrt(k),vTangent.x).y);\nvec4 blobColor=mix(vec4(1.0,1.0,1.0,1.0)*step(1.0-vTangent.x,clamp(sqrt(k)+0.1,0.0,1.0)),texture(_Blob_Texture_,blobTextureCoord),float(_Use_Blob_Texture_));\nBlob_Color_Q39=vTangent.y*blobColor*(1.0-clamp(k,0.0,1.0));\n\nfloat Is_Quad_Q24;\nIs_Quad_Q24=vNormal.z;\n\nvec3 Blob_Position_Q41=mix(_Blob_Position_,Global_Left_Index_Tip_Position.xyz,float(Use_Global_Left_Index));\n\nvec3 Blob_Position_Q42=mix(_Blob_Position_2_,Global_Right_Index_Tip_Position.xyz,float(Use_Global_Right_Index));\nfloat X_Q46;\nfloat Y_Q46;\nfloat Z_Q46;\nTo_XYZ_B46(vBinormal,X_Q46,Y_Q46,Z_Q46);\nfloat Proximity_Q53;\nProximity_B53(Blob_Position_Q41,Blob_Position_Q42,_Proximity_Max_Intensity_,_Proximity_Near_Radius_,vPosition,vBinormal,vExtra1,Y_Q46,Z_Q46,Proximity_Q53);\nvec4 Wireframe_Q59;\nWireframe_Fragment_B59(vNormal,vUV,Proximity_Q53,_Edge_Color_,Wireframe_Q59);\n\nvec4 Wire_Or_Blob_Q23=mix(Wireframe_Q59,Blob_Color_Q39,Is_Quad_Q24);\n\nvec4 Result_Q22;\nResult_Q22=mix(Wire_Or_Blob_Q23,vec4(0.3,0.3,0.3,0.3),float(_Show_Frame_));\n\nvec4 Final_Color_Q37=NotEdge_Q35*Result_Q22;\nvec4 Out_Color=Final_Color_Q37;\nfloat Clip_Threshold=0.0;\nbool To_sRGB=false;\ngl_FragColor=Out_Color;\n}";we.Q.ShadersStore.fluentButtonVertexShader="uniform mat4 world;\nuniform mat4 viewProjection;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec3 tangent;\nattribute vec4 color;\nuniform float _Edge_Width_;\nuniform vec4 _Edge_Color_;\nuniform float _Proximity_Max_Intensity_;\nuniform float _Proximity_Far_Distance_;\nuniform float _Proximity_Near_Radius_;\nuniform float _Proximity_Anisotropy_;\nuniform float _Selection_Fuzz_;\nuniform float _Selected_;\nuniform float _Selection_Fade_;\nuniform float _Selection_Fade_Size_;\nuniform float _Selected_Distance_;\nuniform float _Selected_Fade_Length_;\nuniform bool _Blob_Enable_;\nuniform vec3 _Blob_Position_;\nuniform float _Blob_Intensity_;\nuniform float _Blob_Near_Size_;\nuniform float _Blob_Far_Size_;\nuniform float _Blob_Near_Distance_;\nuniform float _Blob_Far_Distance_;\nuniform float _Blob_Fade_Length_;\nuniform float _Blob_Inner_Fade_;\nuniform float _Blob_Pulse_;\nuniform float _Blob_Fade_;\nuniform sampler2D _Blob_Texture_;\nuniform bool _Blob_Enable_2_;\nuniform vec3 _Blob_Position_2_;\nuniform float _Blob_Near_Size_2_;\nuniform float _Blob_Inner_Fade_2_;\nuniform float _Blob_Pulse_2_;\nuniform float _Blob_Fade_2_;\nuniform vec3 _Active_Face_Dir_;\nuniform vec3 _Active_Face_Up_;\nuniform bool _Enable_Fade_;\nuniform float _Fade_Width_;\nuniform bool _Smooth_Active_Face_;\nuniform bool _Show_Frame_;\nuniform bool Use_Global_Left_Index;\nuniform bool Use_Global_Right_Index;\nuniform vec4 Global_Left_Index_Tip_Position;\nuniform vec4 Global_Right_Index_Tip_Position;\nuniform vec4 Global_Left_Thumb_Tip_Position;\nuniform vec4 Global_Right_Thumb_Tip_Position;\nuniform float Global_Left_Index_Tip_Proximity;\nuniform float Global_Right_Index_Tip_Proximity;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec4 vColor;\nvarying vec4 vExtra1;\n\nvoid Blob_Vertex_B47(\nvec3 Position,\nvec3 Normal,\nvec3 Tangent,\nvec3 Bitangent,\nvec3 Blob_Position,\nfloat Intensity,\nfloat Blob_Near_Size,\nfloat Blob_Far_Size,\nfloat Blob_Near_Distance,\nfloat Blob_Far_Distance,\nvec4 Vx_Color,\nvec2 UV,\nvec3 Face_Center,\nvec2 Face_Size,\nvec2 In_UV,\nfloat Blob_Fade_Length,\nfloat Selection_Fade,\nfloat Selection_Fade_Size,\nfloat Inner_Fade,\nvec3 Active_Face_Center,\nfloat Blob_Pulse,\nfloat Blob_Fade,\nfloat Blob_Enabled,\nout vec3 Out_Position,\nout vec2 Out_UV,\nout vec3 Blob_Info)\n{\nfloat blobSize,fadeIn;\nvec3 Hit_Position;\nBlob_Info=vec3(0.0,0.0,0.0);\nfloat Hit_Distance=dot(Blob_Position-Face_Center,Normal);\nHit_Position=Blob_Position-Hit_Distance*Normal;\nfloat absD=abs(Hit_Distance);\nfloat lerpVal=clamp((absD-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);\nfadeIn=1.0-clamp((absD-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);\nfloat innerFade=1.0-clamp(-Hit_Distance/Inner_Fade,0.0,1.0);\n\nfloat farClip=clamp(1.0-step(Blob_Far_Distance+Blob_Fade_Length,absD),0.0,1.0);\nfloat size=mix(Blob_Near_Size,Blob_Far_Size,lerpVal)*farClip;\nblobSize=mix(size,Selection_Fade_Size,Selection_Fade)*innerFade*Blob_Enabled;\nBlob_Info.x=lerpVal*0.5+0.5;\nBlob_Info.y=fadeIn*Intensity*(1.0-Selection_Fade)*Blob_Fade;\nBlob_Info.x*=(1.0-Blob_Pulse);\n\nvec3 delta=Hit_Position-Face_Center;\nvec2 blobCenterXY=vec2(dot(delta,Tangent),dot(delta,Bitangent));\nvec2 quadUVin=2.0*UV-1.0;\nvec2 blobXY=blobCenterXY+quadUVin*blobSize;\n\nvec2 blobClipped=clamp(blobXY,-Face_Size*0.5,Face_Size*0.5);\nvec2 blobUV=(blobClipped-blobCenterXY)/max(blobSize,0.0001)*2.0;\nvec3 blobCorner=Face_Center+blobClipped.x*Tangent+blobClipped.y*Bitangent;\n\nOut_Position=mix(Position,blobCorner,Vx_Color.rrr);\nOut_UV=mix(In_UV,blobUV,Vx_Color.rr);\n}\n\n\nvec2 ProjectProximity(\nvec3 blobPosition,\nvec3 position,\nvec3 center,\nvec3 dir,\nvec3 xdir,\nvec3 ydir,\nout float vdistance\n)\n{\nvec3 delta=blobPosition-position;\nvec2 xy=vec2(dot(delta,xdir),dot(delta,ydir));\nvdistance=abs(dot(delta,dir));\nreturn xy;\n}\nvoid Proximity_Vertex_B66(\nvec3 Blob_Position,\nvec3 Blob_Position_2,\nvec3 Active_Face_Center,\nvec3 Active_Face_Dir,\nvec3 Position,\nfloat Proximity_Far_Distance,\nfloat Relative_Scale,\nfloat Proximity_Anisotropy,\nvec3 Up,\nout vec4 Extra1,\nout float Distance_To_Face,\nout float Intensity)\n{\nvec3 Active_Face_Dir_X=normalize(cross(Active_Face_Dir,Up));\n\nvec3 Active_Face_Dir_Y=cross(Active_Face_Dir,Active_Face_Dir_X);\nfloat distz1,distz2;\nExtra1.xy=ProjectProximity(Blob_Position,Position,Active_Face_Center,Active_Face_Dir,Active_Face_Dir_X*Proximity_Anisotropy,Active_Face_Dir_Y,distz1)/Relative_Scale;\nExtra1.zw=ProjectProximity(Blob_Position_2,Position,Active_Face_Center,Active_Face_Dir,Active_Face_Dir_X*Proximity_Anisotropy,Active_Face_Dir_Y,distz2)/Relative_Scale;\nDistance_To_Face=dot(Active_Face_Dir,Position-Active_Face_Center);\nIntensity=1.0-clamp(min(distz1,distz2)/Proximity_Far_Distance,0.0,1.0);\n}\n\n\nvoid Holo_Edge_Vertex_B44(\nvec3 Incident,\nvec3 Normal,\nvec2 UV,\nvec3 Tangent,\nvec3 Bitangent,\nbool Smooth_Active_Face,\nfloat Active,\nout vec4 Holo_Edges)\n{\nfloat NdotI=dot(Incident,Normal);\nvec2 flip=(UV-vec2(0.5,0.5));\nfloat udot=dot(Incident,Tangent)*flip.x*NdotI;\nfloat uval=1.0-float(udot>0.0);\nfloat vdot=-dot(Incident,Bitangent)*flip.y*NdotI;\nfloat vval=1.0-float(vdot>0.0);\nfloat Smooth_And_Active=step(1.0,float(Smooth_Active_Face && Active>0.0));\nuval=mix(uval,max(1.0,uval),Smooth_And_Active);\nvval=mix(vval,max(1.0,vval),Smooth_And_Active);\nHolo_Edges=vec4(1.0,1.0,1.0,1.0)-vec4(uval*UV.x,uval*(1.0-UV.x),vval*UV.y,vval*(1.0-UV.y));\n}\n\n\nvoid Object_To_World_Pos_B13(\nvec3 Pos_Object,\nout vec3 Pos_World)\n{\nPos_World=(world*vec4(Pos_Object,1.0)).xyz;\n}\n\n\nvoid Choose_Blob_B38(\nvec4 Vx_Color,\nvec3 Position1,\nvec3 Position2,\nbool Blob_Enable_1,\nbool Blob_Enable_2,\nfloat Near_Size_1,\nfloat Near_Size_2,\nfloat Blob_Inner_Fade_1,\nfloat Blob_Inner_Fade_2,\nfloat Blob_Pulse_1,\nfloat Blob_Pulse_2,\nfloat Blob_Fade_1,\nfloat Blob_Fade_2,\nout vec3 Position,\nout float Near_Size,\nout float Inner_Fade,\nout float Blob_Enable,\nout float Fade,\nout float Pulse)\n{\nPosition=Position1*(1.0-Vx_Color.g)+Vx_Color.g*Position2;\nfloat b1=float(Blob_Enable_1);\nfloat b2=float(Blob_Enable_2);\nBlob_Enable=b1+(b2-b1)*Vx_Color.g;\nPulse=Blob_Pulse_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Pulse_2;\nFade=Blob_Fade_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Fade_2;\nNear_Size=Near_Size_1*(1.0-Vx_Color.g)+Vx_Color.g*Near_Size_2;\nInner_Fade=Blob_Inner_Fade_1*(1.0-Vx_Color.g)+Vx_Color.g*Blob_Inner_Fade_2;\n}\n\n\nvoid Wireframe_Vertex_B51(\nvec3 Position,\nvec3 Normal,\nvec3 Tangent,\nvec3 Bitangent,\nfloat Edge_Width,\nvec2 Face_Size,\nout vec3 Wire_Vx_Pos,\nout vec2 UV,\nout vec2 Widths)\n{\nWidths.xy=Edge_Width/Face_Size;\nfloat x=dot(Position,Tangent);\nfloat y=dot(Position,Bitangent);\nfloat dx=0.5-abs(x);\nfloat newx=(0.5-dx*Widths.x*2.0)*sign(x);\nfloat dy=0.5-abs(y);\nfloat newy=(0.5-dy*Widths.y*2.0)*sign(y);\nWire_Vx_Pos=Normal*0.5+newx*Tangent+newy*Bitangent;\nUV.x=dot(Wire_Vx_Pos,Tangent)+0.5;\nUV.y=dot(Wire_Vx_Pos,Bitangent)+0.5;\n}\n\n\nvec2 ramp2(vec2 start,vec2 end,vec2 x)\n{\nreturn clamp((x-start)/(end-start),vec2(0.0,0.0),vec2(1.0,1.0));\n}\nfloat computeSelection(\nvec3 blobPosition,\nvec3 normal,\nvec3 tangent,\nvec3 bitangent,\nvec3 faceCenter,\nvec2 faceSize,\nfloat selectionFuzz,\nfloat farDistance,\nfloat fadeLength\n)\n{\nvec3 delta=blobPosition-faceCenter;\nfloat absD=abs(dot(delta,normal));\nfloat fadeIn=1.0-clamp((absD-farDistance)/fadeLength,0.0,1.0);\nvec2 blobCenterXY=vec2(dot(delta,tangent),dot(delta,bitangent));\nvec2 innerFace=faceSize*(1.0-selectionFuzz)*0.5;\nvec2 selectPulse=ramp2(-faceSize*0.5,-innerFace,blobCenterXY)-ramp2(innerFace,faceSize*0.5,blobCenterXY);\nreturn selectPulse.x*selectPulse.y*fadeIn;\n}\nvoid Selection_Vertex_B48(\nvec3 Blob_Position,\nvec3 Blob_Position_2,\nvec3 Face_Center,\nvec2 Face_Size,\nvec3 Normal,\nvec3 Tangent,\nvec3 Bitangent,\nfloat Selection_Fuzz,\nfloat Selected,\nfloat Far_Distance,\nfloat Fade_Length,\nvec3 Active_Face_Dir,\nout float Show_Selection)\n{\nfloat select1=computeSelection(Blob_Position,Normal,Tangent,Bitangent,Face_Center,Face_Size,Selection_Fuzz,Far_Distance,Fade_Length);\nfloat select2=computeSelection(Blob_Position_2,Normal,Tangent,Bitangent,Face_Center,Face_Size,Selection_Fuzz,Far_Distance,Fade_Length);\nfloat Active=max(0.0,dot(Active_Face_Dir,Normal));\nShow_Selection=mix(max(select1,select2),1.0,Selected)*Active;\n}\n\n\nvoid Proximity_Visibility_B54(\nfloat Selection,\nvec3 Proximity_Center,\nvec3 Proximity_Center_2,\nfloat Input_Width,\nfloat Proximity_Far_Distance,\nfloat Proximity_Radius,\nvec3 Active_Face_Center,\nvec3 Active_Face_Dir,\nout float Width)\n{\n\nvec3 boxEdges=(world*vec4(vec3(0.5,0.5,0.5),0.0)).xyz;\nfloat boxMaxSize=length(boxEdges);\nfloat d1=dot(Proximity_Center-Active_Face_Center,Active_Face_Dir);\nvec3 blob1=Proximity_Center-d1*Active_Face_Dir;\nfloat d2=dot(Proximity_Center_2-Active_Face_Center,Active_Face_Dir);\nvec3 blob2=Proximity_Center_2-d2*Active_Face_Dir;\n\nvec3 delta1=blob1-Active_Face_Center;\nvec3 delta2=blob2-Active_Face_Center;\nfloat dist1=dot(delta1,delta1);\nfloat dist2=dot(delta2,delta2);\nfloat nearestProxDist=sqrt(min(dist1,dist2));\n\nWidth=Input_Width*(1.0-step(boxMaxSize+Proximity_Radius,nearestProxDist))*(1.0-step(Proximity_Far_Distance,min(d1,d2))*(1.0-step(0.0001,Selection)));\n}\n\n\nvoid Object_To_World_Dir_B67(\nvec3 Dir_Object,\nout vec3 Dir_World)\n{\nDir_World=(world*vec4(Dir_Object,0.0)).xyz;\n}\n\nvoid main()\n{\n\nvec3 Active_Face_Center_Q49;\nActive_Face_Center_Q49=(world*vec4(_Active_Face_Dir_*0.5,1.0)).xyz;\n\nvec3 Blob_Position_Q41=mix(_Blob_Position_,Global_Left_Index_Tip_Position.xyz,float(Use_Global_Left_Index));\n\nvec3 Blob_Position_Q42=mix(_Blob_Position_2_,Global_Right_Index_Tip_Position.xyz,float(Use_Global_Right_Index));\n\nvec3 Active_Face_Dir_Q64=normalize((world*vec4(_Active_Face_Dir_,0.0)).xyz);\n\nfloat Relative_Scale_Q57;\n#if RELATIVE_WIDTH\nRelative_Scale_Q57=length((world*vec4(vec3(0,1,0),0.0)).xyz);\n#else\nRelative_Scale_Q57=1.0;\n#endif\n\nvec3 Tangent_World_Q30;\nTangent_World_Q30=(world*vec4(tangent,0.0)).xyz;\n\nvec3 Binormal_World_Q31;\nBinormal_World_Q31=(world*vec4((cross(normal,tangent)),0.0)).xyz;\n\nvec3 Normal_World_Q60;\nNormal_World_Q60=(world*vec4(normal,0.0)).xyz;\n\nvec3 Result_Q18=0.5*normal;\nvec3 Dir_World_Q67;\nObject_To_World_Dir_B67(_Active_Face_Up_,Dir_World_Q67);\n\nfloat Product_Q56=_Edge_Width_*Relative_Scale_Q57;\n\nvec3 Normal_World_N_Q29=normalize(Normal_World_Q60);\n\nvec3 Tangent_World_N_Q28=normalize(Tangent_World_Q30);\n\nvec3 Binormal_World_N_Q32=normalize(Binormal_World_Q31);\nvec3 Position_Q38;\nfloat Near_Size_Q38;\nfloat Inner_Fade_Q38;\nfloat Blob_Enable_Q38;\nfloat Fade_Q38;\nfloat Pulse_Q38;\nChoose_Blob_B38(color,Blob_Position_Q41,Blob_Position_Q42,_Blob_Enable_,_Blob_Enable_2_,_Blob_Near_Size_,_Blob_Near_Size_2_,_Blob_Inner_Fade_,_Blob_Inner_Fade_2_,_Blob_Pulse_,_Blob_Pulse_2_,_Blob_Fade_,_Blob_Fade_2_,Position_Q38,Near_Size_Q38,Inner_Fade_Q38,Blob_Enable_Q38,Fade_Q38,Pulse_Q38);\n\nvec3 Face_Center_Q33;\nFace_Center_Q33=(world*vec4(Result_Q18,1.0)).xyz;\n\nvec2 Face_Size_Q50=vec2(length(Tangent_World_Q30),length(Binormal_World_Q31));\nfloat Show_Selection_Q48;\nSelection_Vertex_B48(Blob_Position_Q41,Blob_Position_Q42,Face_Center_Q33,Face_Size_Q50,Normal_World_N_Q29,Tangent_World_N_Q28,Binormal_World_N_Q32,_Selection_Fuzz_,_Selected_,_Selected_Distance_,_Selected_Fade_Length_,Active_Face_Dir_Q64,Show_Selection_Q48);\n\nvec3 Normalized_Q72=normalize(Dir_World_Q67);\n\nfloat Active_Q34=max(0.0,dot(Active_Face_Dir_Q64,Normal_World_N_Q29));\nfloat Width_Q54;\nProximity_Visibility_B54(Show_Selection_Q48,Blob_Position_Q41,Blob_Position_Q42,Product_Q56,_Proximity_Far_Distance_,_Proximity_Near_Radius_,Active_Face_Center_Q49,Active_Face_Dir_Q64,Width_Q54);\nvec3 Wire_Vx_Pos_Q51;\nvec2 UV_Q51;\nvec2 Widths_Q51;\nWireframe_Vertex_B51(position,normal,tangent,(cross(normal,tangent)),Width_Q54,Face_Size_Q50,Wire_Vx_Pos_Q51,UV_Q51,Widths_Q51);\n\nvec3 Vec3_Q27=vec3(Widths_Q51.x,Widths_Q51.y,color.r);\nvec3 Pos_World_Q13;\nObject_To_World_Pos_B13(Wire_Vx_Pos_Q51,Pos_World_Q13);\n\nvec3 Incident_Q36=normalize(Pos_World_Q13-cameraPosition);\nvec3 Out_Position_Q47;\nvec2 Out_UV_Q47;\nvec3 Blob_Info_Q47;\nBlob_Vertex_B47(Pos_World_Q13,Normal_World_N_Q29,Tangent_World_N_Q28,Binormal_World_N_Q32,Position_Q38,_Blob_Intensity_,Near_Size_Q38,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,color,uv,Face_Center_Q33,Face_Size_Q50,UV_Q51,_Blob_Fade_Length_,_Selection_Fade_,_Selection_Fade_Size_,Inner_Fade_Q38,Active_Face_Center_Q49,Pulse_Q38,Fade_Q38,Blob_Enable_Q38,Out_Position_Q47,Out_UV_Q47,Blob_Info_Q47);\nvec4 Extra1_Q66;\nfloat Distance_To_Face_Q66;\nfloat Intensity_Q66;\nProximity_Vertex_B66(Blob_Position_Q41,Blob_Position_Q42,Active_Face_Center_Q49,Active_Face_Dir_Q64,Pos_World_Q13,_Proximity_Far_Distance_,Relative_Scale_Q57,_Proximity_Anisotropy_,Normalized_Q72,Extra1_Q66,Distance_To_Face_Q66,Intensity_Q66);\nvec4 Holo_Edges_Q44;\nHolo_Edge_Vertex_B44(Incident_Q36,Normal_World_N_Q29,uv,Tangent_World_Q30,Binormal_World_Q31,_Smooth_Active_Face_,Active_Q34,Holo_Edges_Q44);\n\nvec3 Vec3_Q19=vec3(Show_Selection_Q48,Distance_To_Face_Q66,Intensity_Q66);\nvec3 Position=Out_Position_Q47;\nvec2 UV=Out_UV_Q47;\nvec3 Tangent=Blob_Info_Q47;\nvec3 Binormal=Vec3_Q19;\nvec3 Normal=Vec3_Q27;\nvec4 Extra1=Extra1_Q66;\nvec4 Color=Holo_Edges_Q44;\ngl_Position=viewProjection*vec4(Position,1);\nvPosition=Position;\nvNormal=Normal;\nvUV=UV;\nvTangent=Tangent;\nvBinormal=Binormal;\nvColor=Color;\nvExtra1=Extra1;\n}";var De=function(e){function t(){var t=e.call(this)||this;return t.RELATIVE_WIDTH=!0,t.ENABLE_FADE=!0,t._needNormals=!0,t._needUVs=!0,t.rebuild(),t}return(0,n.ZT)(t,e),t}(Se.H),Re=function(e){function t(i,n){var r=e.call(this,i,n)||this;return r.edgeWidth=.04,r.edgeColor=new N.HE(.592157,.592157,.592157,1),r.proximityMaxIntensity=.45,r.proximityFarDistance=.16,r.proximityNearRadius=1.5,r.proximityAnisotropy=1,r.selectionFuzz=.5,r.selected=0,r.selectionFade=0,r.selectionFadeSize=.3,r.selectedDistance=.08,r.selectedFadeLength=.08,r.blobIntensity=.5,r.blobFarSize=.05,r.blobNearDistance=0,r.blobFarDistance=.08,r.blobFadeLength=.08,r.leftBlobEnable=!0,r.leftBlobNearSize=.025,r.leftBlobPulse=0,r.leftBlobFade=1,r.leftBlobInnerFade=.01,r.rightBlobEnable=!0,r.rightBlobNearSize=.025,r.rightBlobPulse=0,r.rightBlobFade=1,r.rightBlobInnerFade=.01,r.activeFaceDir=new s.P(0,0,-1),r.activeFaceUp=new s.P(0,1,0),r.enableFade=!0,r.fadeWidth=1.5,r.smoothActiveFace=!0,r.showFrame=!1,r.useBlobTexture=!0,r.globalLeftIndexTipPosition=s.P.Zero(),r.globalRightIndexTipPosition=s.P.Zero(),r.alphaMode=T.g.ALPHA_ADD,r.disableDepthWrite=!0,r.backFaceCulling=!1,r._blobTexture=new C.x(t.BLOB_TEXTURE_URL,n,!0,!1,C.x.NEAREST_SAMPLINGMODE),r}return(0,n.ZT)(t,e),t.prototype.needAlphaBlending=function(){return!0},t.prototype.needAlphaTesting=function(){return!0},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new De);var n=t._materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(Oe.G.PrepareDefinesForAttributes(e,n,!0,!1),n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var s=new Le.L;n.FOG&&s.addFallback(1,"FOG"),Oe.G.HandleFallbacksForShadows(n,s),n.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var a=[Me.o.PositionKind];n.NORMAL&&a.push(Me.o.NormalKind),n.UV1&&a.push(Me.o.UVKind),n.UV2&&a.push(Me.o.UV2Kind),n.VERTEXCOLOR&&a.push(Me.o.ColorKind),n.TANGENT&&a.push(Me.o.TangentKind),Oe.G.PrepareAttributesForInstances(a,n);var l=n.toString(),h=["world","viewProjection","cameraPosition","_Edge_Width_","_Edge_Color_","_Relative_Width_","_Proximity_Max_Intensity_","_Proximity_Far_Distance_","_Proximity_Near_Radius_","_Proximity_Anisotropy_","_Selection_Fuzz_","_Selected_","_Selection_Fade_","_Selection_Fade_Size_","_Selected_Distance_","_Selected_Fade_Length_","_Blob_Enable_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Inner_Fade_","_Blob_Pulse_","_Blob_Fade_","_Blob_Texture_","_Blob_Enable_2_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Inner_Fade_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Active_Face_Dir_","_Active_Face_Up_","_Enable_Fade_","_Fade_Width_","_Smooth_Active_Face_","_Show_Frame_","_Use_Blob_Texture_","Use_Global_Left_Index","Use_Global_Right_Index","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position","Global_Left_Thumb_Tip_Position","Global_Right_Thumb_Tip_Position","Global_Left_Index_Tip_Proximity","Global_Right_Index_Tip_Proximity"],u=["_Blob_Texture_"],c=new Array;Oe.G.PrepareUniformsAndSamplersList({uniformsNames:h,uniformBuffersNames:c,samplers:u,defines:n,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect("fluentButton",{attributes:a,uniformsNames:h,uniformBuffersNames:c,samplers:u,defines:l,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),n,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n=this.getScene();if(i._materialDefines){var r=i.effect;r&&(this._activeEffect=r,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",n.activeCamera.position),this._activeEffect.setTexture("_Blob_Texture_",this._blobTexture),this._activeEffect.setFloat("_Edge_Width_",this.edgeWidth),this._activeEffect.setColor4("_Edge_Color_",new N.Wo(this.edgeColor.r,this.edgeColor.g,this.edgeColor.b),this.edgeColor.a),this._activeEffect.setFloat("_Proximity_Max_Intensity_",this.proximityMaxIntensity),this._activeEffect.setFloat("_Proximity_Far_Distance_",this.proximityFarDistance),this._activeEffect.setFloat("_Proximity_Near_Radius_",this.proximityNearRadius),this._activeEffect.setFloat("_Proximity_Anisotropy_",this.proximityAnisotropy),this._activeEffect.setFloat("_Selection_Fuzz_",this.selectionFuzz),this._activeEffect.setFloat("_Selected_",this.selected),this._activeEffect.setFloat("_Selection_Fade_",this.selectionFade),this._activeEffect.setFloat("_Selection_Fade_Size_",this.selectionFadeSize),this._activeEffect.setFloat("_Selected_Distance_",this.selectedDistance),this._activeEffect.setFloat("_Selected_Fade_Length_",this.selectedFadeLength),this._activeEffect.setFloat("_Blob_Enable_",this.leftBlobEnable?1:0),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.leftBlobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Inner_Fade_",this.leftBlobInnerFade),this._activeEffect.setFloat("_Blob_Pulse_",this.leftBlobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.leftBlobFade),this._activeEffect.setFloat("_Blob_Enable_2_",this.rightBlobEnable?1:0),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.rightBlobNearSize),this._activeEffect.setFloat("_Blob_Inner_Fade_2_",this.rightBlobInnerFade),this._activeEffect.setFloat("_Blob_Pulse_2_",this.rightBlobPulse),this._activeEffect.setFloat("_Blob_Fade_2_",this.rightBlobFade),this._activeEffect.setVector3("_Active_Face_Dir_",this.activeFaceDir),this._activeEffect.setVector3("_Active_Face_Up_",this.activeFaceUp),this._activeEffect.setFloat("_Fade_Width_",this.fadeWidth),this._activeEffect.setFloat("_Smooth_Active_Face_",this.smoothActiveFace?1:0),this._activeEffect.setFloat("_Show_Frame_",this.showFrame?1:0),this._activeEffect.setFloat("_Use_Blob_Texture_",this.useBlobTexture?1:0),this._activeEffect.setFloat("Use_Global_Left_Index",1),this._activeEffect.setFloat("Use_Global_Right_Index",1),this._activeEffect.setVector4("Global_Left_Index_Tip_Position",new s.Lt(this.globalLeftIndexTipPosition.x,this.globalLeftIndexTipPosition.y,this.globalLeftIndexTipPosition.z,1)),this._activeEffect.setVector4("Global_Right_Index_Tip_Position",new s.Lt(this.globalRightIndexTipPosition.x,this.globalRightIndexTipPosition.y,this.globalRightIndexTipPosition.z,1)),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){return[]},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var i=this;return b.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var e=b.p4.Serialize(this);return e.customType="BABYLON.FluentButtonMaterial",e},t.prototype.getClassName=function(){return"FluentButtonMaterial"},t.Parse=function(e,i,n){return b.p4.Parse((function(){return new t(e.name,i)}),e,i,n)},t.BLOB_TEXTURE_URL="https://assets.babylonjs.com/meshes/MRTK/mrtk-fluent-button-blob.png",(0,n.gn)([(0,b.qC)()],t.prototype,"edgeWidth",void 0),(0,n.gn)([(0,b.XX)()],t.prototype,"edgeColor",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"proximityMaxIntensity",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"proximityFarDistance",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"proximityNearRadius",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"proximityAnisotropy",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"selectionFuzz",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"selected",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"selectionFade",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"selectionFadeSize",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"selectedDistance",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"selectedFadeLength",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"blobIntensity",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"blobFarSize",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"blobNearDistance",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"blobFarDistance",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"blobFadeLength",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"leftBlobEnable",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"leftBlobNearSize",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"leftBlobPulse",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"leftBlobFade",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"leftBlobInnerFade",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"rightBlobEnable",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"rightBlobNearSize",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"rightBlobPulse",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"rightBlobFade",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"rightBlobInnerFade",void 0),(0,n.gn)([(0,b.hd)()],t.prototype,"activeFaceDir",void 0),(0,n.gn)([(0,b.hd)()],t.prototype,"activeFaceUp",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"enableFade",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"fadeWidth",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"smoothActiveFace",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"showFrame",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"useBlobTexture",void 0),(0,n.gn)([(0,b.hd)()],t.prototype,"globalLeftIndexTipPosition",void 0),(0,n.gn)([(0,b.hd)()],t.prototype,"globalRightIndexTipPosition",void 0),t}(Ee.a);v.Q.RegisteredTypes["BABYLON.GUI.FluentButtonMaterial"]=Re;var Be=function(e){function t(t,i){var n=e.call(this,t)||this;return n.collidableFrontDirection=s.P.Zero(),i&&(n.collisionMesh=i),n}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"collidableFrontDirection",{get:function(){if(this._collisionMesh){var e=s.jp.Vector3[0];return s.P.TransformNormalToRef(this._collidableFrontDirection,this._collisionMesh.getWorldMatrix(),e),e}return this._collidableFrontDirection},set:function(e){if(this._collidableFrontDirection=e.normalize(),this._collisionMesh){var t=s.jp.Matrix[0];t.copyFrom(this._collisionMesh.getWorldMatrix()),t.invert(),s.P.TransformNormalToRef(this._collidableFrontDirection,t,this._collidableFrontDirection)}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionMesh",{set:function(e){this._collisionMesh&&this._collisionMesh.dispose(),!e.parent&&this.mesh&&e.setParent(this.mesh),this._collisionMesh=e,this._injectGUI3DReservedDataStore(this._collisionMesh).control=this,this._collisionMesh.isNearPickable=!0,this.collidableFrontDirection=e.forward},enumerable:!1,configurable:!0}),t.prototype._isInteractionInFrontOfButton=function(e){var t=this.collidableFrontDirection;if(0===t.length())return!0;var i=s.P.Dot(this._collisionMesh.getAbsolutePosition(),t);return s.P.Dot(e,t)>i},t.prototype._generatePointerEventType=function(e,t,i){return e!==a.kD.POINTERDOWN||this._isInteractionInFrontOfButton(t)?e===a.kD.POINTERUP&&0==i?a.kD.POINTERMOVE:e:a.kD.POINTERMOVE},t.prototype._getTypeName=function(){return"TouchButton3D"},t.prototype._createNode=function(t){return e.prototype._createNode.call(this,t)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._collisionMesh&&this._collisionMesh.dispose()},t}(ve),Ne=i(6945),ke=function(e){function t(t,i){void 0===i&&(i=!0);var n=e.call(this,t)||this;return n._shareMaterials=!0,n._shareMaterials=i,n.pointerEnterAnimation=function(){n._frontMaterial.leftBlobEnable=!0,n._frontMaterial.rightBlobEnable=!0},n.pointerOutAnimation=function(){n._frontMaterial.leftBlobEnable=!1,n._frontMaterial.rightBlobEnable=!1},n._pointerHoverObserver=n.onPointerMoveObservable.add((function(e){n._frontMaterial.globalLeftIndexTipPosition=e})),n}return(0,n.ZT)(t,e),t.prototype._disposeTooltip=function(){this._tooltipFade=null,this._tooltipTextBlock&&this._tooltipTextBlock.dispose(),this._tooltipTexture&&this._tooltipTexture.dispose(),this._tooltipMesh&&this._tooltipMesh.dispose(),this.onPointerEnterObservable.remove(this._tooltipHoverObserver),this.onPointerOutObservable.remove(this._tooltipOutObserver)},Object.defineProperty(t.prototype,"renderingGroupId",{get:function(){return this._backPlate.renderingGroupId},set:function(e){this._backPlate.renderingGroupId=e,this._textPlate.renderingGroupId=e,this._frontPlate.renderingGroupId=e,this._tooltipMesh&&(this._tooltipMesh.renderingGroupId=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tooltipText",{get:function(){return this._tooltipTextBlock?this._tooltipTextBlock.text:null},set:function(e){var t=this;if(e){if(!this._tooltipFade){this._tooltipMesh=Ce.m.CreatePlane("",{size:1},this._backPlate._scene);var i=Ce.m.CreatePlane("",{size:1,sideOrientation:Pe.Kj.DOUBLESIDE},this._backPlate._scene),n=new oe.K("",this._backPlate._scene);n.diffuseColor=N.Wo.FromHexString("#212121"),i.material=n,i.isPickable=!1,this._tooltipMesh.addChild(i),i.position.z=.05,this._tooltipMesh.scaling.y=1/3,this._tooltipMesh.position.y=.7,this._tooltipMesh.position.z=-.15,this._tooltipMesh.isPickable=!1,this._tooltipMesh.parent=this._backPlate,this._tooltipTexture=ue.CreateForMesh(this._tooltipMesh),this._tooltipTextBlock=new M,this._tooltipTextBlock.scaleY=3,this._tooltipTextBlock.color="white",this._tooltipTextBlock.fontSize=130,this._tooltipTexture.addControl(this._tooltipTextBlock),this._tooltipFade=new Te.Y,this._tooltipFade.delay=500,this._tooltipMesh.addBehavior(this._tooltipFade),this._tooltipHoverObserver=this.onPointerEnterObservable.add((function(){t._tooltipFade&&t._tooltipFade.fadeIn(!0)})),this._tooltipOutObserver=this.onPointerOutObservable.add((function(){t._tooltipFade&&t._tooltipFade.fadeIn(!1)}))}this._tooltipTextBlock&&(this._tooltipTextBlock.text=e)}else this._disposeTooltip()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){this._text!==e&&(this._text=e,this._rebuildContent())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageUrl",{get:function(){return this._imageUrl},set:function(e){this._imageUrl!==e&&(this._imageUrl=e,this._rebuildContent())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"backMaterial",{get:function(){return this._backMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frontMaterial",{get:function(){return this._frontMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"plateMaterial",{get:function(){return this._plateMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shareMaterials",{get:function(){return this._shareMaterials},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"TouchHolographicButton"},t.prototype._rebuildContent=function(){this._disposeFacadeTexture();var e=new A;if(e.isVertical=!0,Fe.M.IsDocumentAvailable()&&document.createElement&&this._imageUrl){var t=new w;t.source=this._imageUrl,t.paddingTop="40px",t.height="180px",t.width="100px",t.paddingBottom="40px",e.addControl(t)}if(this._text){var i=new M;i.text=this._text,i.color="white",i.height="30px",i.fontSize=24,e.addControl(i)}this.content=e},t.prototype._createNode=function(i){var n,r=this,o=me.k.CreateBox((null!==(n=this.name)&&void 0!==n?n:"TouchHolographicButton")+"_CollisionMesh",{width:1,height:1,depth:1},i);return o.isPickable=!0,o.isNearPickable=!0,o.visibility=0,o.scaling=new s.P(1,1,.5),Ne.n.ImportMeshAsync(void 0,t.MODEL_BASE_URL,t.MODEL_FILENAME,i).then((function(e){var t=e.meshes[1];t.name=r.name+"_frontPlate",t.isPickable=!1,t.parent=o,r._frontMaterial&&(t.material=r._frontMaterial),r._frontPlate=t})),this._backPlate=me.k.CreateBox(this.name+"BackMesh",{width:1,height:1,depth:.04},i),this._backPlate.parent=o,this._backPlate.position.z=.48,this._backPlate.isPickable=!1,this._textPlate=e.prototype._createNode.call(this,i),this._textPlate.parent=o,this._textPlate.position.z=0,this._textPlate.isPickable=!1,this.collisionMesh=o,this.collidableFrontDirection=this._backPlate.forward.negate(),o},t.prototype._applyFacade=function(e){this._plateMaterial.emissiveTexture=e,this._plateMaterial.opacityTexture=e,this._plateMaterial.diffuseColor=new N.Wo(.4,.4,.4)},t.prototype._createBackMaterial=function(e){this._backMaterial=new oe.K(this.name+"Back Material",e.getScene()),this._backMaterial.diffuseColor=new N.Wo(.5,.5,.5)},t.prototype._createFrontMaterial=function(e){this._frontMaterial=new Re(this.name+"Front Material",e.getScene())},t.prototype._createPlateMaterial=function(e){this._plateMaterial=new oe.K(this.name+"Plate Material",e.getScene()),this._plateMaterial.specularColor=N.Wo.Black()},t.prototype._affectMaterial=function(e){this._shareMaterials?(this._host._touchSharedMaterials.backFluentMaterial?this._backMaterial=this._host._touchSharedMaterials.backFluentMaterial:(this._createBackMaterial(e),this._host._touchSharedMaterials.backFluentMaterial=this._backMaterial),this._host._touchSharedMaterials.frontFluentMaterial?this._frontMaterial=this._host._touchSharedMaterials.frontFluentMaterial:(this._createFrontMaterial(e),this._host._touchSharedMaterials.frontFluentMaterial=this._frontMaterial)):(this._createBackMaterial(e),this._createFrontMaterial(e)),this._createPlateMaterial(e),this._backPlate.material=this._backMaterial,this._textPlate.material=this._plateMaterial,this._frontPlate&&(this._frontPlate.material=this._frontMaterial),this._rebuildContent()},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._disposeTooltip(),this.onPointerMoveObservable.remove(this._pointerHoverObserver),this.shareMaterials||(this._backMaterial.dispose(),this._frontMaterial.dispose(),this._plateMaterial.dispose(),this._pickedPointObserver&&(this._host.onPickedPointChangedObservable.remove(this._pickedPointObserver),this._pickedPointObserver=null))},t.MODEL_BASE_URL="https://assets.babylonjs.com/meshes/MRTK/",t.MODEL_FILENAME="mrtk-fluent-button.glb",t}(Be),Ve=i(7972),Ue=i(3906),We=i(15);we.Q.ShadersStore.handleVertexShader="precision highp float;\n\nattribute vec3 position;\n\nuniform vec3 positionOffset;\nuniform mat4 worldViewProjection;\nuniform float scale;\nvoid main(void) {\nvec4 vPos=vec4((vec3(position)+positionOffset)*scale,1.0);\ngl_Position=worldViewProjection*vPos;\n}";we.Q.ShadersStore.handlePixelShader="uniform vec3 color;\nvoid main(void) {\ngl_FragColor=vec4(color,1.0);\n}";var ze,He=function(e){function t(t,i){var n=e.call(this,t,i,"handle",{attributes:["position"],uniforms:["worldViewProjection","color","scale","positionOffset"],needAlphaBlending:!1,needAlphaTesting:!1})||this;return n._hover=!1,n._drag=!1,n._color=new N.Wo,n._scale=1,n._lastTick=-1,n.animationLength=100,n.hoverColor=new N.Wo(0,.467,.84),n.baseColor=new N.Wo(1,1,1),n.hoverScale=.75,n.baseScale=.35,n.dragScale=.55,n._positionOffset=s.P.Zero(),n._updateInterpolationTarget(),n._lastTick=Date.now(),n._onBeforeRender=n.getScene().onBeforeRenderObservable.add((function(){var e=Date.now(),t=e-n._lastTick,i=n._targetScale-n._scale,r=N.zZ.Color3[0].copyFrom(n._targetColor).subtractToRef(n._color,N.zZ.Color3[0]);n._scale=n._scale+i*t/n.animationLength,r.scaleToRef(t/n.animationLength,r),n._color.addToRef(r,n._color),n.setColor3("color",n._color),n.setFloat("scale",n._scale),n.setVector3("positionOffset",n._positionOffset),n._lastTick=e})),n}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"hover",{get:function(){return this._hover},set:function(e){this._hover=e,this._updateInterpolationTarget()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"drag",{get:function(){return this._drag},set:function(e){this._drag=e,this._updateInterpolationTarget()},enumerable:!1,configurable:!0}),t.prototype._updateInterpolationTarget=function(){this.drag?(this._targetColor=this.hoverColor,this._targetScale=this.dragScale):this.hover?(this._targetColor=this.hoverColor,this._targetScale=this.hoverScale):(this._targetColor=this.baseColor,this._targetScale=this.baseScale)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.getScene().onBeforeRenderObservable.remove(this._onBeforeRender)},t}(We.j),Ge=i(5146);!function(e){e[e.IDLE=0]="IDLE",e[e.HOVER=1]="HOVER",e[e.DRAG=2]="DRAG"}(ze||(ze={}));var je=function(){function e(e,t){this._state=ze.IDLE,this._materials=[],this._scene=t,this._gizmo=e,this.node=this.createNode(),this.node.reservedDataStore={handle:this}}return Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gizmo",{get:function(){return this._gizmo},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hover",{set:function(e){e?this._state|=ze.HOVER:this._state&=~ze.HOVER,this._updateMaterial()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"drag",{set:function(e){e?this._state|=ze.DRAG:this._state&=~ze.DRAG,this._updateMaterial()},enumerable:!1,configurable:!0}),e.prototype._createMaterial=function(e){var t=new He("handle",this._scene);return e&&(t._positionOffset=e),t},e.prototype._updateMaterial=function(){for(var e=this._state,t=0,i=this._materials;t<i.length;t++)(a=i[t]).hover=!1,a.drag=!1;if(e&ze.DRAG)for(var n=0,r=this._materials;n<r.length;n++)(a=r[n]).drag=!0;else if(e&ze.HOVER)for(var o=0,s=this._materials;o<s.length;o++){var a;(a=s[o]).hover=!0}},e.prototype.setDragBehavior=function(e,t,i){var n=new Ge.N;this._dragBehavior=n,this._dragStartObserver=n.onDragStartObservable.add(e),this._draggingObserver=n.onDragObservable.add(t),this._dragEndObserver=n.onDragEndObservable.add(i),this._dragBehavior.attach(this.node)},e.prototype.dispose=function(){this._dragBehavior.onDragStartObservable.remove(this._dragStartObserver),this._dragBehavior.onDragObservable.remove(this._draggingObserver),this._dragBehavior.onDragEndObservable.remove(this._dragEndObserver),this._dragBehavior.detach();for(var e=0,t=this._materials;e<t.length;e++)t[e].dispose();this.node.dispose()},e}(),Qe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.ZT)(t,e),t.prototype.createNode=function(){var e=me.k.CreateBox("sideVert",{width:1,height:10,depth:.1},this._scene),t=new fe.Y("side",this._scene);e.parent=t;var i=this._createMaterial();return e.material=i,e.isNearGrabbable=!0,this._materials.push(i),t},t}(je),Xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,n.ZT)(t,e),t.prototype.createNode=function(){var e=me.k.CreateBox("angleHor",{width:3,height:1,depth:.1},this._scene),t=me.k.CreateBox("angleVert",{width:1,height:3,depth:.1},this._scene),i=new fe.Y("angle",this._scene);return e.parent=i,t.parent=i,e.material=this._createMaterial(new s.P(1,0,0)),t.material=this._createMaterial(new s.P(0,1,0)),t.isNearGrabbable=!0,e.isNearGrabbable=!0,this._materials.push(e.material),this._materials.push(t.material),i},t}(je),qe=function(e){function t(t){var i=e.call(this,t)||this;return i._boundingDimensions=new s.P(0,0,0),i._tmpQuaternion=new s._f,i._tmpVector=new s.P(0,0,0),i._corners=[],i._sides=[],i._boundingBoxGizmo={min:new s.P,max:new s.P},i._margin=.35,i._attachedSlate=null,i.fixedScreenSize=!1,i.fixedScreenSizeDistanceFactor=10,i.handleSize=.01,i._createNode(),i.updateScale=!1,i}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"attachedSlate",{get:function(){return this._attachedSlate},set:function(e){var t=this;e?(this.attachedMesh=e.mesh,this.updateBoundingBox(),this._pickedPointObserver=e._host.onPickingObservable.add((function(e){if(!t._handleHovered||e&&e.parent===t._handleHovered.node||(t._handleHovered.hover=!1,t._handleHovered=null),e&&e.parent&&e.parent.reservedDataStore&&e.parent.reservedDataStore.handle){var i=e.parent.reservedDataStore.handle;i.gizmo===t&&(t._handleHovered=i,t._handleHovered.hover=!0)}}))):this._attachedSlate&&this._attachedSlate._host.onPickingObservable.remove(this._pickedPointObserver),this._attachedSlate=e},enumerable:!1,configurable:!0}),t.prototype._createNode=function(){var e=this;this._handlesParent=new fe.Y("handlesParent",this.gizmoLayer.utilityLayerScene),this._handlesParent.rotationQuaternion=s._f.Identity();for(var t=[{dimensions:new s.P(-1,-1,0),origin:new s.P(1,0,0)},{dimensions:new s.P(1,-1,0),origin:new s.P(0,0,0)},{dimensions:new s.P(1,1,0),origin:new s.P(0,1,0)},{dimensions:new s.P(-1,1,0),origin:new s.P(1,1,0)}],i=0;i<4;i++){var n=new Xe(this,this.gizmoLayer.utilityLayerScene);this._corners.push(n),n.node.rotation.z=Math.PI/2*i,n.node.scaling.setAll(this.handleSize),n.node.parent=this._handlesParent,this._assignDragBehaviorCorners(n,(function(t,i,n,r){return e._moveHandle(t,i,n,r,!0)}),t[i])}for(i=0;i<4;i++){var r=new Qe(this,this.gizmoLayer.utilityLayerScene);this._sides.push(r),r.node.rotation.z=Math.PI/2*i,r.node.scaling.copyFromFloats(this.handleSize,this.handleSize,this.handleSize),r.node.parent=this._handlesParent,this._assignDragBehaviorSides(r,i%2==0?new s.P(0,1,0):new s.P(1,0,0))}this._handlesParent.parent=this._rootMesh},t.prototype._keepAspectRatio=function(e,t,i){void 0===i&&(i=!1);var n=s.jp.Vector3[0];n.copyFromFloats(t,1,0).normalize(),i&&(n.y*=-1);var r=s.P.Dot(e,n);e.copyFrom(n).scaleInPlace(r)},t.prototype._clampDimensions=function(e,t,i,n){void 0===n&&(n=!1);var r=s.jp.Vector3[0];r.copyFrom(e).multiplyInPlace(i);var o=s.jp.Vector3[1];o.copyFromFloats(Math.max(this._attachedSlate.minDimensions.x,r.x+t.x),Math.max(this._attachedSlate.minDimensions.y,r.y+t.y),0),r.copyFrom(o).subtractInPlace(t);var a=s.jp.Vector3[2];a.copyFrom(r),n&&(a.x=Math.min(Math.abs(o.x-t.x),Math.abs(o.y-t.y)),a.y=a.x),e.x=Math.sign(e.x)*Math.abs(a.x),e.y=Math.sign(e.y)*Math.abs(a.y)},t.prototype._moveHandle=function(e,t,i,n,r){if(this._attachedSlate){if(r){var o=t.x/t.y;this._keepAspectRatio(i,o,n.dimensions.x*n.dimensions.y<0)}this._clampDimensions(i,t,n.dimensions,r);var a=s.jp.Vector3[0],l=s.jp.Vector3[1];a.copyFrom(i).multiplyInPlace(n.origin),l.copyFrom(i).multiplyInPlace(n.dimensions),this._attachedSlate.origin.copyFrom(e).addInPlace(a),this._attachedSlate.dimensions.copyFrom(t).addInPlace(l),this._attachedSlate.backplateDimensions.x=this._attachedSlate.dimensions.x}},t.prototype._assignDragBehaviorCorners=function(e,t,i){var n=this,r=new s.P,o=new s.P,a=new s.P,l=new s.y3,h=new s.P,u=!1;e.setDragBehavior((function(e){n.attachedSlate&&n.attachedMesh&&(r.copyFrom(n.attachedSlate.dimensions),o.copyFrom(n.attachedSlate.origin),a.copyFrom(e.position),l.copyFrom(n.attachedMesh.computeWorldMatrix(!0)),l.invert(),u=n.attachedSlate.defaultBehavior.followBehaviorEnabled,n.attachedSlate.defaultBehavior.followBehaviorEnabled=!1,s.P.TransformNormalToRef(s.P.Forward(),n.attachedMesh.getWorldMatrix(),h),h.normalize(),n._handleHovered&&(n._handleDragged=n._handleHovered,n._handleDragged.drag=!0))}),(function(e){n.attachedSlate&&n.attachedMesh&&(function(e,t,i,n){e.subtractToRef(i,s.jp.Vector3[0]);var r=s.P.Dot(s.jp.Vector3[0],t);s.jp.Vector3[1].copyFrom(t).scaleInPlace(r),s.jp.Vector3[0].subtractInPlace(s.jp.Vector3[1]),s.jp.Vector3[0].addToRef(i,n)}(e.position,h,a,n._tmpVector),n._tmpVector.subtractInPlace(a),s.P.TransformNormalToRef(n._tmpVector,l,n._tmpVector),t(o,r,n._tmpVector,i),n.attachedSlate._positionElements(),n.updateBoundingBox())}),(function(){n.attachedSlate&&n.attachedNode&&(n.attachedSlate._updatePivot(),n.attachedSlate.defaultBehavior.followBehaviorEnabled=u,n._handleDragged&&(n._handleDragged.drag=!1,n._handleDragged=null))}))},t.prototype._assignDragBehaviorSides=function(e,t){var i,n=this,r=new s._f,o=new s.P,a=new s.P,l=new s.P,h=new s.P;e.setDragBehavior((function(e){n.attachedSlate&&n.attachedMesh&&(r.copyFrom(n.attachedMesh.rotationQuaternion),o.copyFrom(e.position),i=n.attachedSlate.defaultBehavior.followBehaviorEnabled,n.attachedSlate.defaultBehavior.followBehaviorEnabled=!1,l.copyFrom(n.attachedMesh.getAbsolutePivotPoint()),a.copyFrom(o).subtractInPlace(l).normalize(),s.P.TransformNormalToRef(t,n.attachedMesh.getWorldMatrix(),h),h.normalize(),n._handleHovered&&(n._handleDragged=n._handleHovered,n._handleDragged.drag=!0))}),(function(e){if(n.attachedSlate&&n.attachedMesh){n._tmpVector.copyFrom(e.position),n._tmpVector.subtractInPlace(l),n._tmpVector.normalize();var i=-s.P.GetAngleBetweenVectorsOnPlane(n._tmpVector,a,h);s._f.RotationAxisToRef(t,i,n._tmpQuaternion),r.multiplyToRef(n._tmpQuaternion,n.attachedMesh.rotationQuaternion)}}),(function(){n.attachedSlate&&n.attachedNode&&(n.attachedSlate._updatePivot(),n.attachedSlate.defaultBehavior.followBehaviorEnabled=i,n._handleDragged&&(n._handleDragged.drag=!1,n._handleDragged=null))}))},t.prototype._attachedNodeChanged=function(e){e&&this.updateBoundingBox()},t.prototype.updateBoundingBox=function(){if(this.attachedMesh){Ue.m._RemoveAndStorePivotPoint(this.attachedMesh);var e=this.attachedMesh.parent;this.attachedMesh.setParent(null),this._update(),this.attachedMesh.rotationQuaternion||(this.attachedMesh.rotationQuaternion=s._f.RotationYawPitchRoll(this.attachedMesh.rotation.y,this.attachedMesh.rotation.x,this.attachedMesh.rotation.z)),this._tmpQuaternion.copyFrom(this.attachedMesh.rotationQuaternion),this._tmpVector.copyFrom(this.attachedMesh.position),this.attachedMesh.rotationQuaternion.set(0,0,0,1),this.attachedMesh.position.set(0,0,0);var t=this.attachedMesh.getHierarchyBoundingVectors();t.max.subtractToRef(t.min,this._boundingDimensions),this._boundingBoxGizmo.min=t.min,this._boundingBoxGizmo.max=t.max,this._updateHandlesPosition(),this.attachedMesh.rotationQuaternion.copyFrom(this._tmpQuaternion),this.attachedMesh.position.copyFrom(this._tmpVector),Ue.m._RestorePivotPoint(this.attachedMesh),this.attachedMesh.setParent(e),this.attachedMesh.computeWorldMatrix(!0)}},t.prototype._updateHandlesPosition=function(){var e=this._boundingBoxGizmo.min.clone(),t=this._boundingBoxGizmo.max.clone(),i=this._corners[0].node.scaling.length();e.x-=this._margin*i,e.y-=this._margin*i,t.x+=this._margin*i,t.y+=this._margin*i;var n=e.add(t).scaleInPlace(.5);this._corners[0].node.position.copyFromFloats(e.x,e.y,0),this._corners[1].node.position.copyFromFloats(t.x,e.y,0),this._corners[2].node.position.copyFromFloats(t.x,t.y,0),this._corners[3].node.position.copyFromFloats(e.x,t.y,0),this._sides[0].node.position.copyFromFloats(e.x,n.y,0),this._sides[1].node.position.copyFromFloats(n.x,e.y,0),this._sides[2].node.position.copyFromFloats(t.x,n.y,0),this._sides[3].node.position.copyFromFloats(n.x,t.y,0)},t.prototype._update=function(){if(e.prototype._update.call(this),this.gizmoLayer.utilityLayerScene.activeCamera&&this._attachedSlate&&this._attachedSlate.mesh){if(this.fixedScreenSize){this._attachedSlate.mesh.absolutePosition.subtractToRef(this.gizmoLayer.utilityLayerScene.activeCamera.position,this._tmpVector);for(var t=this.handleSize*this._tmpVector.length()/this.fixedScreenSizeDistanceFactor,i=0;i<this._corners.length;i++)this._corners[i].node.scaling.set(t,t,t)}this._updateHandlesPosition()}},t.prototype.dispose=function(){e.prototype.dispose.call(this);for(var t=0,i=this._corners;t<i.length;t++)i[t].dispose();for(var n=0,r=this._sides;n<r.length;n++)r[n].dispose()},t}(Ve.t),Ye=i(3894),Ze=i(7503),Ke=i(5630),$e=function(){function e(){this.followBehaviorEnabled=!1,this.sixDofDragBehaviorEnabled=!0,this.surfaceMagnetismBehaviorEnabled=!0,this._followBehavior=new Ye.j,this._sixDofDragBehavior=new Ze.K,this._surfaceMagnetismBehavior=new Ke.p}return Object.defineProperty(e.prototype,"name",{get:function(){return"Default"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"followBehavior",{get:function(){return this._followBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sixDofDragBehavior",{get:function(){return this._sixDofDragBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"surfaceMagnetismBehavior",{get:function(){return this._surfaceMagnetismBehavior},enumerable:!1,configurable:!0}),e.prototype.init=function(){},e.prototype.attach=function(e,t,i){this._scene=e.getScene(),this.attachedNode=e,this._addObservables(),this._followBehavior.attach(e),this._sixDofDragBehavior.attach(e),this._sixDofDragBehavior.draggableMeshes=t||null,this._sixDofDragBehavior.faceCameraOnDragStart=!0,this._surfaceMagnetismBehavior.attach(e,this._scene),i&&(this._surfaceMagnetismBehavior.meshes=i),this._surfaceMagnetismBehavior.enabled=!1},e.prototype.detach=function(){this.attachedNode=null,this._removeObservables(),this._followBehavior.detach(),this._sixDofDragBehavior.detach(),this._surfaceMagnetismBehavior.detach()},e.prototype._addObservables=function(){var e=this;this._onBeforeRenderObserver=this._scene.onBeforeRenderObservable.add((function(){e._followBehavior._enabled=!e._sixDofDragBehavior.isMoving&&e.followBehaviorEnabled})),this._onDragObserver=this._sixDofDragBehavior.onDragObservable.add((function(t){e._sixDofDragBehavior.disableMovement=e._surfaceMagnetismBehavior.findAndUpdateTarget(t.pickInfo)}))},e.prototype._removeObservables=function(){this._scene.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._sixDofDragBehavior.onDragObservable.remove(this._onDragObserver)},e}(),Je=i(3880),et=i(1027);we.Q.ShadersStore.fluentBackplatePixelShader="uniform vec3 cameraPosition;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec4 vColor;\nvarying vec4 vExtra1;\nvarying vec4 vExtra2;\nvarying vec4 vExtra3;\nuniform float _Radius_;\nuniform float _Line_Width_;\nuniform bool _Absolute_Sizes_;\nuniform float _Filter_Width_;\nuniform vec4 _Base_Color_;\nuniform vec4 _Line_Color_;\nuniform float _Radius_Top_Left_;\nuniform float _Radius_Top_Right_;\nuniform float _Radius_Bottom_Left_;\nuniform float _Radius_Bottom_Right_;\n\nuniform vec3 _Blob_Position_;\nuniform float _Blob_Intensity_;\nuniform float _Blob_Near_Size_;\nuniform float _Blob_Far_Size_;\nuniform float _Blob_Near_Distance_;\nuniform float _Blob_Far_Distance_;\nuniform float _Blob_Fade_Length_;\nuniform float _Blob_Pulse_;\nuniform float _Blob_Fade_;\nuniform sampler2D _Blob_Texture_;\n\nuniform vec3 _Blob_Position_2_;\nuniform float _Blob_Near_Size_2_;\nuniform float _Blob_Pulse_2_;\nuniform float _Blob_Fade_2_;\nuniform float _Rate_;\nuniform vec4 _Highlight_Color_;\nuniform float _Highlight_Width_;\nuniform vec4 _Highlight_Transform_;\nuniform float _Highlight_;\nuniform float _Iridescence_Intensity_;\nuniform float _Iridescence_Edge_Intensity_;\nuniform float _Angle_;\nuniform float _Fade_Out_;\n\nuniform bool _Reflected_;\nuniform float _Frequency_;\nuniform float _Vertical_Offset_;\n\nuniform sampler2D _Iridescent_Map_;\nuniform bool _Use_Global_Left_Index_;\nuniform bool _Use_Global_Right_Index_;\nuniform vec4 Global_Left_Index_Tip_Position;\nuniform vec4 Global_Right_Index_Tip_Position;\n\nvoid Round_Rect_Fragment_B31(\nfloat Radius,\nfloat Line_Width,\nvec4 Line_Color,\nfloat Filter_Width,\nvec2 UV,\nfloat Line_Visibility,\nvec4 Rect_Parms,\nvec4 Fill_Color,\nout vec4 Color)\n{\nfloat d=length(max(abs(UV)-Rect_Parms.xy,0.0));\nfloat dx=max(fwidth(d)*Filter_Width,0.00001);\n\nfloat g=min(Rect_Parms.z,Rect_Parms.w);\nfloat dgrad=max(fwidth(g)*Filter_Width,0.00001);\nfloat Inside_Rect=clamp(g/dgrad,0.0,1.0);\n\n\nfloat inner=clamp((d+dx*0.5-max(Radius-Line_Width,d-dx*0.5))/dx,0.0,1.0);\nColor=clamp(mix(Fill_Color,Line_Color,inner),0.0,1.0)*Inside_Rect;\n\n\n\n}\n\n\nvoid Blob_Fragment_B71(\nsampler2D Blob_Texture,\nvec4 Blob_Info1,\nvec4 Blob_Info2,\nout vec4 Blob_Color)\n{\nfloat k1=dot(Blob_Info1.xy,Blob_Info1.xy);\nfloat k2=dot(Blob_Info2.xy,Blob_Info2.xy);\nvec3 closer=k1<k2 ? vec3(k1,Blob_Info1.z,Blob_Info1.w) : vec3(k2,Blob_Info2.z,Blob_Info2.w);\nBlob_Color=closer.z*texture(Blob_Texture,vec2(vec2(sqrt(closer.x),closer.y).x,1.0-vec2(sqrt(closer.x),closer.y).y))*clamp(1.0-closer.x,0.0,1.0);\n}\n\n\nvoid Line_Fragment_B48(\nvec4 Base_Color,\nvec4 Highlight_Color,\nfloat Highlight_Width,\nvec3 Line_Vertex,\nfloat Highlight,\nout vec4 Line_Color)\n{\nfloat k2=1.0-clamp(abs(Line_Vertex.y/Highlight_Width),0.0,1.0);\nLine_Color=mix(Base_Color,Highlight_Color,Highlight*k2);\n}\n\n\nvoid Scale_RGB_B54(\nvec4 Color,\nfloat Scalar,\nout vec4 Result)\n{\nResult=vec4(Scalar,Scalar,Scalar,1)*Color;\n}\n\n\nvoid Conditional_Float_B38(\nbool Which,\nfloat If_True,\nfloat If_False,\nout float Result)\n{\nResult=Which ? If_True : If_False;\n}\n\nvoid main()\n{\n\nfloat R_Q72;\nfloat G_Q72;\nfloat B_Q72;\nfloat A_Q72;\nR_Q72=vColor.r; G_Q72=vColor.g; B_Q72=vColor.b; A_Q72=vColor.a;\nvec4 Blob_Color_Q71;\n#if BLOB_ENABLE\n\nfloat k1=dot(vExtra2.xy,vExtra2.xy);\nfloat k2=dot(vExtra3.xy,vExtra3.xy);\nvec3 closer=k1<k2 ? vec3(k1,vExtra2.z,vExtra2.w) : vec3(k2,vExtra3.z,vExtra3.w);\nBlob_Color_Q71=closer.z*texture(_Blob_Texture_,vec2(vec2(sqrt(closer.x),closer.y).x,1.0-vec2(sqrt(closer.x),closer.y).y))*clamp(1.0-closer.x,0.0,1.0);\n#else\nBlob_Color_Q71=vec4(0,0,0,0);\n#endif\nvec4 Line_Color_Q48;\nLine_Fragment_B48(_Line_Color_,_Highlight_Color_,_Highlight_Width_,vTangent,_Highlight_,Line_Color_Q48);\n\nfloat X_Q67;\nfloat Y_Q67;\nX_Q67=vUV.x;\nY_Q67=vUV.y;\n\nvec3 Incident_Q66=normalize(vPosition-cameraPosition);\n\nvec3 Reflected_Q60=reflect(Incident_Q66,vBinormal);\n\nfloat Product_Q63=Y_Q67*_Vertical_Offset_;\n\nfloat Dot_Q68=dot(Incident_Q66,Reflected_Q60);\n\nfloat Dot_Q57=dot(vNormal,Incident_Q66);\nfloat Result_Q38;\nConditional_Float_B38(_Reflected_,Dot_Q68,Dot_Q57,Result_Q38);\n\nfloat Product_Q64=Result_Q38*_Frequency_;\n\nfloat Sum_Q69=Product_Q64+1.0;\n\nfloat Product_Q70=Sum_Q69*0.5;\n\nfloat Sum_Q62=Product_Q63+Product_Q70;\n\nfloat FractF_Q59=fract(Sum_Q62);\n\nvec2 Vec2_Q65=vec2(FractF_Q59,0.5);\n\nvec4 Color_Q58;\n#if IRIDESCENT_MAP_ENABLE\nColor_Q58=texture(_Iridescent_Map_,Vec2_Q65);\n#else\nColor_Q58=vec4(0,0,0,0);\n#endif\nvec4 Result_Q54;\nScale_RGB_B54(Color_Q58,_Iridescence_Edge_Intensity_,Result_Q54);\nvec4 Result_Q55;\nScale_RGB_B54(Color_Q58,_Iridescence_Intensity_,Result_Q55);\n\nvec4 Base_And_Iridescent_Q53;\nBase_And_Iridescent_Q53=Line_Color_Q48+vec4(Result_Q54.rgb,0.0);\n\nvec4 Base_And_Iridescent_Q56;\nBase_And_Iridescent_Q56=_Base_Color_+vec4(Result_Q55.rgb,0.0);\n\nvec4 Result_Q52=Base_And_Iridescent_Q53; Result_Q52.a=1.0;\n\nvec4 Result_Q35=Blob_Color_Q71+(1.0-Blob_Color_Q71.a)*Base_And_Iridescent_Q56;\nvec4 Color_Q31;\nRound_Rect_Fragment_B31(R_Q72,G_Q72,Result_Q52,_Filter_Width_,vUV,1.0,vExtra1,Result_Q35,Color_Q31);\n\nvec4 Result_Q47=_Fade_Out_*Color_Q31;\nvec4 Out_Color=Result_Q47;\nfloat Clip_Threshold=0.001;\nbool To_sRGB=false;\ngl_FragColor=Out_Color;\n}";we.Q.ShadersStore.fluentBackplateVertexShader="uniform mat4 world;\nuniform mat4 viewProjection;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef TANGENT\nattribute vec3 tangent;\n#else\nconst vec3 tangent=vec3(0.);\n#endif\nuniform float _Radius_;\nuniform float _Line_Width_;\nuniform bool _Absolute_Sizes_;\nuniform float _Filter_Width_;\nuniform vec4 _Base_Color_;\nuniform vec4 _Line_Color_;\nuniform float _Radius_Top_Left_;\nuniform float _Radius_Top_Right_;\nuniform float _Radius_Bottom_Left_;\nuniform float _Radius_Bottom_Right_;\n\nuniform vec3 _Blob_Position_;\nuniform float _Blob_Intensity_;\nuniform float _Blob_Near_Size_;\nuniform float _Blob_Far_Size_;\nuniform float _Blob_Near_Distance_;\nuniform float _Blob_Far_Distance_;\nuniform float _Blob_Fade_Length_;\nuniform float _Blob_Pulse_;\nuniform float _Blob_Fade_;\nuniform sampler2D _Blob_Texture_;\n\nuniform vec3 _Blob_Position_2_;\nuniform float _Blob_Near_Size_2_;\nuniform float _Blob_Pulse_2_;\nuniform float _Blob_Fade_2_;\nuniform float _Rate_;\nuniform vec4 _Highlight_Color_;\nuniform float _Highlight_Width_;\nuniform vec4 _Highlight_Transform_;\nuniform float _Highlight_;\nuniform float _Iridescence_Intensity_;\nuniform float _Iridescence_Edge_Intensity_;\nuniform float _Angle_;\nuniform float _Fade_Out_;\n\nuniform bool _Reflected_;\nuniform float _Frequency_;\nuniform float _Vertical_Offset_;\n\nuniform sampler2D _Iridescent_Map_;\nuniform bool _Use_Global_Left_Index_;\nuniform bool _Use_Global_Right_Index_;\nuniform vec4 Global_Left_Index_Tip_Position;\nuniform vec4 Global_Right_Index_Tip_Position;\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec4 vColor;\nvarying vec4 vExtra1;\nvarying vec4 vExtra2;\nvarying vec4 vExtra3;\n\nvoid Object_To_World_Pos_B115(\nvec3 Pos_Object,\nout vec3 Pos_World)\n{\nPos_World=(world*vec4(Pos_Object,1.0)).xyz;\n}\n\n\nvoid PickDir_B140(\nfloat Degrees,\nvec3 DirX,\nvec3 DirY,\nout vec3 Dir)\n{\n\nfloat a=Degrees*3.14159/180.0;\nDir=cos(a)*DirX+sin(a)*DirY;\n}\n\n\nvoid Round_Rect_Vertex_B139(\nvec2 UV,\nfloat Radius,\nfloat Margin,\nfloat Anisotropy,\nfloat Gradient1,\nfloat Gradient2,\nout vec2 Rect_UV,\nout vec4 Rect_Parms,\nout vec2 Scale_XY,\nout vec2 Line_UV)\n{\nScale_XY=vec2(Anisotropy,1.0);\nLine_UV=(UV-vec2(0.5,0.5));\nRect_UV=Line_UV*Scale_XY;\nRect_Parms.xy=Scale_XY*0.5-vec2(Radius,Radius)-vec2(Margin,Margin);\nRect_Parms.z=Gradient1;\nRect_Parms.w=Gradient2;\n}\n\n\nvoid Line_Vertex_B135(\nvec2 Scale_XY,\nvec2 UV,\nfloat Time,\nfloat Rate,\nvec4 Highlight_Transform,\nout vec3 Line_Vertex)\n{\nfloat angle2=(Rate*Time)*2.0*3.1416;\nfloat sinAngle2=sin(angle2);\nfloat cosAngle2=cos(angle2);\nvec2 xformUV=UV*Highlight_Transform.xy+Highlight_Transform.zw;\nLine_Vertex.x=0.0;\nLine_Vertex.y=cosAngle2*xformUV.x-sinAngle2*xformUV.y;\nLine_Vertex.z=0.0;\n}\n\n\nvoid Blob_Vertex_B180(\nvec3 Position,\nvec3 Normal,\nvec3 Tangent,\nvec3 Bitangent,\nvec3 Blob_Position,\nfloat Intensity,\nfloat Blob_Near_Size,\nfloat Blob_Far_Size,\nfloat Blob_Near_Distance,\nfloat Blob_Far_Distance,\nfloat Blob_Fade_Length,\nfloat Blob_Pulse,\nfloat Blob_Fade,\nout vec4 Blob_Info)\n{\nvec3 blob=Blob_Position;\nvec3 delta=blob-Position;\nfloat dist=dot(Normal,delta);\nfloat lerpValue=clamp((abs(dist)-Blob_Near_Distance)/(Blob_Far_Distance-Blob_Near_Distance),0.0,1.0);\nfloat fadeValue=1.0-clamp((abs(dist)-Blob_Far_Distance)/Blob_Fade_Length,0.0,1.0);\nfloat size=Blob_Near_Size+(Blob_Far_Size-Blob_Near_Size)*lerpValue;\nvec2 blobXY=vec2(dot(delta,Tangent),dot(delta,Bitangent))/(0.0001+size);\nfloat Fade=fadeValue*Intensity*Blob_Fade;\nfloat Distance=(lerpValue*0.5+0.5)*(1.0-Blob_Pulse);\nBlob_Info=vec4(blobXY.x,blobXY.y,Distance,Fade);\n}\n\n\nvoid Move_Verts_B129(\nfloat Anisotropy,\nvec3 P,\nfloat Radius,\nout vec3 New_P,\nout vec2 New_UV,\nout float Radial_Gradient,\nout vec3 Radial_Dir)\n{\nvec2 UV=P.xy*2.0+0.5;\nvec2 center=clamp(UV,0.0,1.0);\nvec2 delta=UV-center;\nvec2 r2=2.0*vec2(Radius/Anisotropy,Radius);\nNew_UV=center+r2*(UV-2.0*center+0.5);\nNew_P=vec3(New_UV-0.5,P.z);\nRadial_Gradient=1.0-length(delta)*2.0;\nRadial_Dir=vec3(delta*r2,0.0);\n}\n\n\nvoid Object_To_World_Dir_B132(\nvec3 Dir_Object,\nout vec3 Binormal_World,\nout vec3 Binormal_World_N,\nout float Binormal_Length)\n{\nBinormal_World=(world*vec4(Dir_Object,0.0)).xyz;\nBinormal_Length=length(Binormal_World);\nBinormal_World_N=Binormal_World/Binormal_Length;\n}\n\n\nvoid RelativeOrAbsoluteDetail_B147(\nfloat Nominal_Radius,\nfloat Nominal_LineWidth,\nbool Absolute_Measurements,\nfloat Height,\nout float Radius,\nout float Line_Width)\n{\nfloat scale=Absolute_Measurements ? 1.0/Height : 1.0;\nRadius=Nominal_Radius*scale;\nLine_Width=Nominal_LineWidth*scale;\n}\n\n\nvoid Edge_AA_Vertex_B130(\nvec3 Position_World,\nvec3 Position_Object,\nvec3 Normal_Object,\nvec3 Eye,\nfloat Radial_Gradient,\nvec3 Radial_Dir,\nvec3 Tangent,\nout float Gradient1,\nout float Gradient2)\n{\n\nvec3 I=(Eye-Position_World);\nvec3 T=(world* vec4(Tangent,0.0)).xyz;\nfloat g=(dot(T,I)<0.0) ? 0.0 : 1.0;\nif (Normal_Object.z==0.0) {\n\nGradient1=Position_Object.z>0.0 ? g : 1.0;\nGradient2=Position_Object.z>0.0 ? 1.0 : g;\n} else {\n\n\n\n\nGradient1=g+(1.0-g)*(Radial_Gradient);\nGradient2=1.0;\n}\n}\n\n\nvoid Pick_Radius_B144(\nfloat Radius,\nfloat Radius_Top_Left,\nfloat Radius_Top_Right,\nfloat Radius_Bottom_Left,\nfloat Radius_Bottom_Right,\nvec3 Position,\nout float Result)\n{\nbool whichY=Position.y>0.0;\nResult=Position.x<0.0 ? (whichY ? Radius_Top_Left : Radius_Bottom_Left) : (whichY ? Radius_Top_Right : Radius_Bottom_Right);\nResult*=Radius;\n}\n\nvoid main()\n{\n\nvec3 Nrm_World_Q128;\nNrm_World_Q128=normalize((world*vec4(normal,0.0)).xyz);\n\nvec3 Tangent_World_Q131;\nvec3 Tangent_World_N_Q131;\nfloat Tangent_Length_Q131;\nTangent_World_Q131=(world*vec4(vec3(1,0,0),0.0)).xyz;\nTangent_Length_Q131=length(Tangent_World_Q131);\nTangent_World_N_Q131=Tangent_World_Q131/Tangent_Length_Q131;\nvec3 Binormal_World_Q132;\nvec3 Binormal_World_N_Q132;\nfloat Binormal_Length_Q132;\nObject_To_World_Dir_B132(vec3(0,1,0),Binormal_World_Q132,Binormal_World_N_Q132,Binormal_Length_Q132);\n\nfloat Anisotropy_Q133=Tangent_Length_Q131/Binormal_Length_Q132;\n\nvec3 Result_Q177;\nResult_Q177=mix(_Blob_Position_,Global_Left_Index_Tip_Position.xyz,float(_Use_Global_Left_Index_));\n\nvec3 Result_Q178;\nResult_Q178=mix(_Blob_Position_2_,Global_Right_Index_Tip_Position.xyz,float(_Use_Global_Right_Index_));\nfloat Result_Q144;\nPick_Radius_B144(_Radius_,_Radius_Top_Left_,_Radius_Top_Right_,_Radius_Bottom_Left_,_Radius_Bottom_Right_,position,Result_Q144);\nvec3 Dir_Q140;\nPickDir_B140(_Angle_,Tangent_World_N_Q131,Binormal_World_N_Q132,Dir_Q140);\nfloat Radius_Q147;\nfloat Line_Width_Q147;\nRelativeOrAbsoluteDetail_B147(Result_Q144,_Line_Width_,_Absolute_Sizes_,Binormal_Length_Q132,Radius_Q147,Line_Width_Q147);\n\nvec4 Out_Color_Q145=vec4(Radius_Q147,Line_Width_Q147,0,1);\nvec3 New_P_Q129;\nvec2 New_UV_Q129;\nfloat Radial_Gradient_Q129;\nvec3 Radial_Dir_Q129;\nMove_Verts_B129(Anisotropy_Q133,position,Radius_Q147,New_P_Q129,New_UV_Q129,Radial_Gradient_Q129,Radial_Dir_Q129);\nvec3 Pos_World_Q115;\nObject_To_World_Pos_B115(New_P_Q129,Pos_World_Q115);\nvec4 Blob_Info_Q180;\n#if BLOB_ENABLE\nBlob_Vertex_B180(Pos_World_Q115,Nrm_World_Q128,Tangent_World_N_Q131,Binormal_World_N_Q132,Result_Q177,_Blob_Intensity_,_Blob_Near_Size_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_,_Blob_Fade_,Blob_Info_Q180);\n#else\nBlob_Info_Q180=vec4(0,0,0,0);\n#endif\nvec4 Blob_Info_Q181;\n#if BLOB_ENABLE_2\nBlob_Vertex_B180(Pos_World_Q115,Nrm_World_Q128,Tangent_World_N_Q131,Binormal_World_N_Q132,Result_Q178,_Blob_Intensity_,_Blob_Near_Size_2_,_Blob_Far_Size_,_Blob_Near_Distance_,_Blob_Far_Distance_,_Blob_Fade_Length_,_Blob_Pulse_2_,_Blob_Fade_2_,Blob_Info_Q181);\n#else\nBlob_Info_Q181=vec4(0,0,0,0);\n#endif\nfloat Gradient1_Q130;\nfloat Gradient2_Q130;\n#if SMOOTH_EDGES\nEdge_AA_Vertex_B130(Pos_World_Q115,position,normal,cameraPosition,Radial_Gradient_Q129,Radial_Dir_Q129,tangent,Gradient1_Q130,Gradient2_Q130);\n#else\nGradient1_Q130=1.0;\nGradient2_Q130=1.0;\n#endif\nvec2 Rect_UV_Q139;\nvec4 Rect_Parms_Q139;\nvec2 Scale_XY_Q139;\nvec2 Line_UV_Q139;\nRound_Rect_Vertex_B139(New_UV_Q129,Radius_Q147,0.0,Anisotropy_Q133,Gradient1_Q130,Gradient2_Q130,Rect_UV_Q139,Rect_Parms_Q139,Scale_XY_Q139,Line_UV_Q139);\nvec3 Line_Vertex_Q135;\nLine_Vertex_B135(Scale_XY_Q139,Line_UV_Q139,0.0,_Rate_,_Highlight_Transform_,Line_Vertex_Q135);\nvec3 Position=Pos_World_Q115;\nvec3 Normal=Dir_Q140;\nvec2 UV=Rect_UV_Q139;\nvec3 Tangent=Line_Vertex_Q135;\nvec3 Binormal=Nrm_World_Q128;\nvec4 Color=Out_Color_Q145;\nvec4 Extra1=Rect_Parms_Q139;\nvec4 Extra2=Blob_Info_Q180;\nvec4 Extra3=Blob_Info_Q181;\ngl_Position=viewProjection*vec4(Position,1);\nvPosition=Position;\nvNormal=Normal;\nvUV=UV;\nvTangent=Tangent;\nvBinormal=Binormal;\nvColor=Color;\nvExtra1=Extra1;\nvExtra2=Extra2;\nvExtra3=Extra3;\n}";var tt=function(e){function t(){var t=e.call(this)||this;return t.BLOB_ENABLE=!0,t.BLOB_ENABLE_2=!0,t.SMOOTH_EDGES=!0,t.IRIDESCENT_MAP_ENABLE=!0,t._needNormals=!0,t.rebuild(),t}return(0,n.ZT)(t,e),t}(Se.H),it=function(e){function t(i,n){var r=e.call(this,i,n)||this;return r.radius=.03,r.lineWidth=.01,r.absoluteSizes=!1,r._filterWidth=1,r.baseColor=new N.HE(.0392157,.0666667,.207843,1),r.lineColor=new N.HE(.14902,.133333,.384314,1),r.blobIntensity=.98,r.blobFarSize=.04,r.blobNearDistance=0,r.blobFarDistance=.08,r.blobFadeLength=.08,r.blobNearSize=.22,r.blobPulse=0,r.blobFade=0,r.blobNearSize2=.22,r.blobPulse2=0,r.blobFade2=0,r._rate=.135,r.highlightColor=new N.HE(.98,.98,.98,1),r.highlightWidth=.25,r._highlightTransform=new s.Lt(1,1,0,0),r._highlight=1,r.iridescenceIntensity=0,r.iridescenceEdgeIntensity=1,r._angle=-45,r.fadeOut=1,r._reflected=!0,r._frequency=1,r._verticalOffset=0,r.globalLeftIndexTipPosition=s.P.Zero(),r._globalLeftIndexTipPosition4=s.Lt.Zero(),r.globalRightIndexTipPosition=s.P.Zero(),r._globalRightIndexTipPosition4=s.Lt.Zero(),r.alphaMode=T.g.ALPHA_DISABLE,r.backFaceCulling=!1,r._blobTexture=new C.x(t.BLOB_TEXTURE_URL,n,!0,!1,C.x.NEAREST_SAMPLINGMODE),r._iridescentMap=new C.x(t.IM_TEXTURE_URL,n,!0,!1,C.x.NEAREST_SAMPLINGMODE),r}return(0,n.ZT)(t,e),t.prototype.needAlphaBlending=function(){return!1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new tt);var n=t._materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(Oe.G.PrepareDefinesForAttributes(e,n,!1,!1),n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var s=new Le.L;n.FOG&&s.addFallback(1,"FOG"),Oe.G.HandleFallbacksForShadows(n,s),n.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var a=[Me.o.PositionKind];n.NORMAL&&a.push(Me.o.NormalKind),n.UV1&&a.push(Me.o.UVKind),n.UV2&&a.push(Me.o.UV2Kind),n.VERTEXCOLOR&&a.push(Me.o.ColorKind),n.TANGENT&&a.push(Me.o.TangentKind),Oe.G.PrepareAttributesForInstances(a,n);var l=n.toString(),h=["world","viewProjection","cameraPosition","_Radius_","_Line_Width_","_Absolute_Sizes_","_Filter_Width_","_Base_Color_","_Line_Color_","_Radius_Top_Left_","_Radius_Top_Right_","_Radius_Bottom_Left_","_Radius_Bottom_Right_","_Blob_Position_","_Blob_Intensity_","_Blob_Near_Size_","_Blob_Far_Size_","_Blob_Near_Distance_","_Blob_Far_Distance_","_Blob_Fade_Length_","_Blob_Pulse_","_Blob_Fade_","_Blob_Texture_","_Blob_Position_2_","_Blob_Near_Size_2_","_Blob_Pulse_2_","_Blob_Fade_2_","_Rate_","_Highlight_Color_","_Highlight_Width_","_Highlight_Transform_","_Highlight_","_Iridescence_Intensity_","_Iridescence_Edge_Intensity_","_Angle_","_Fade_Out_","_Reflected_","_Frequency_","_Vertical_Offset_","_Iridescent_Map_","_Use_Global_Left_Index_","_Use_Global_Right_Index_","Global_Left_Index_Tip_Position","Global_Right_Index_Tip_Position"],u=["_Blob_Texture_","_Iridescent_Map_"],c=new Array;Oe.G.PrepareUniformsAndSamplersList({uniformsNames:h,uniformBuffersNames:c,samplers:u,defines:n,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect("fluentBackplate",{attributes:a,uniformsNames:h,uniformBuffersNames:c,samplers:u,defines:l,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),n,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n,r;if(i._materialDefines){var o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),this._activeEffect.setVector3("cameraPosition",null!==(r=null===(n=this.getScene().activeCamera)||void 0===n?void 0:n.position)&&void 0!==r?r:s.P.ZeroReadOnly),this._activeEffect.setFloat("_Radius_",this.radius),this._activeEffect.setFloat("_Line_Width_",this.lineWidth),this._activeEffect.setFloat("_Absolute_Sizes_",this.absoluteSizes?1:0),this._activeEffect.setFloat("_Filter_Width_",this._filterWidth),this._activeEffect.setDirectColor4("_Base_Color_",this.baseColor),this._activeEffect.setDirectColor4("_Line_Color_",this.lineColor),this._activeEffect.setFloat("_Radius_Top_Left_",1),this._activeEffect.setFloat("_Radius_Top_Right_",1),this._activeEffect.setFloat("_Radius_Bottom_Left_",1),this._activeEffect.setFloat("_Radius_Bottom_Right_",1),this._activeEffect.setFloat("_Blob_Intensity_",this.blobIntensity),this._activeEffect.setFloat("_Blob_Near_Size_",this.blobNearSize),this._activeEffect.setFloat("_Blob_Far_Size_",this.blobFarSize),this._activeEffect.setFloat("_Blob_Near_Distance_",this.blobNearDistance),this._activeEffect.setFloat("_Blob_Far_Distance_",this.blobFarDistance),this._activeEffect.setFloat("_Blob_Fade_Length_",this.blobFadeLength),this._activeEffect.setFloat("_Blob_Pulse_",this.blobPulse),this._activeEffect.setFloat("_Blob_Fade_",this.blobFade),this._activeEffect.setTexture("_Blob_Texture_",this._blobTexture),this._activeEffect.setFloat("_Blob_Near_Size_2_",this.blobNearSize2),this._activeEffect.setFloat("_Blob_Pulse_2_",this.blobPulse2),this._activeEffect.setFloat("_Blob_Fade_2_",this.blobFade2),this._activeEffect.setFloat("_Rate_",this._rate),this._activeEffect.setDirectColor4("_Highlight_Color_",this.highlightColor),this._activeEffect.setFloat("_Highlight_Width_",this.highlightWidth),this._activeEffect.setVector4("_Highlight_Transform_",this._highlightTransform),this._activeEffect.setFloat("_Highlight_",this._highlight),this._activeEffect.setFloat("_Iridescence_Intensity_",this.iridescenceIntensity),this._activeEffect.setFloat("_Iridescence_Edge_Intensity_",this.iridescenceEdgeIntensity),this._activeEffect.setFloat("_Angle_",this._angle),this._activeEffect.setFloat("_Fade_Out_",this.fadeOut),this._activeEffect.setFloat("_Reflected_",this._reflected?1:0),this._activeEffect.setFloat("_Frequency_",this._frequency),this._activeEffect.setFloat("_Vertical_Offset_",this._verticalOffset),this._activeEffect.setTexture("_Iridescent_Map_",this._iridescentMap),this._activeEffect.setFloat("_Use_Global_Left_Index_",1),this._activeEffect.setFloat("_Use_Global_Right_Index_",1),this._globalLeftIndexTipPosition4.set(this.globalLeftIndexTipPosition.x,this.globalLeftIndexTipPosition.y,this.globalLeftIndexTipPosition.z,1),this._activeEffect.setVector4("Global_Left_Index_Tip_Position",this._globalLeftIndexTipPosition4),this._globalRightIndexTipPosition4.set(this.globalRightIndexTipPosition.x,this.globalRightIndexTipPosition.y,this.globalRightIndexTipPosition.z,1),this._activeEffect.setVector4("Global_Right_Index_Tip_Position",this._globalRightIndexTipPosition4),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){return[]},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t),this._blobTexture.dispose(),this._iridescentMap.dispose()},t.prototype.clone=function(e){var i=this;return b.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var e=b.p4.Serialize(this);return e.customType="BABYLON.FluentBackplateMaterial",e},t.prototype.getClassName=function(){return"FluentBackplateMaterial"},t.Parse=function(e,i,n){return b.p4.Parse((function(){return new t(e.name,i)}),e,i,n)},t.BLOB_TEXTURE_URL="https://assets.babylonjs.com/meshes/MRTK/mrtk-fluent-backplate-blob.png",t.IM_TEXTURE_URL="https://assets.babylonjs.com/meshes/MRTK/mrtk-fluent-backplate-iridescence.png",(0,n.gn)([(0,b.qC)()],t.prototype,"radius",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"lineWidth",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"absoluteSizes",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"baseColor",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"lineColor",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"blobIntensity",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"blobFarSize",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"blobNearDistance",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"blobFarDistance",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"blobFadeLength",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"blobNearSize",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"blobPulse",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"blobFade",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"blobNearSize2",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"blobPulse2",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"blobFade2",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"highlightColor",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"highlightWidth",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"iridescenceIntensity",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"iridescenceEdgeIntensity",void 0),(0,n.gn)([(0,b.qC)()],t.prototype,"fadeOut",void 0),(0,n.gn)([(0,b.hd)()],t.prototype,"globalLeftIndexTipPosition",void 0),(0,n.gn)([(0,b.hd)()],t.prototype,"globalRightIndexTipPosition",void 0),t}(Ee.a);v.Q.RegisteredTypes["BABYLON.GUI.FluentBackplateMaterial"]=it,function(e){function t(t){var i=e.call(this,t)||this;return i.dimensions=new s.P(.7,.4,.001),i.minDimensions=new s.P(.5,.2,.001),i.defaultDimensions=i.dimensions.clone(),i.backplateDimensions=new s.P(.7,.02,.001),i.backPlateMargin=.005,i.origin=new s.P(0,0,0),i._contentScaleRatio=1,i._followButton=new ke("followButton"+i.name),i._closeButton=new ke("closeButton"+i.name),i._contentViewport=new le.l(0,0,1,1),i._contentDragBehavior=new Je.M({dragPlaneNormal:new s.P(0,0,-1)}),i}(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultBehavior",{get:function(){return this._defaultBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderingGroupId",{get:function(){return this._backPlate.renderingGroupId},set:function(e){this._backPlate.renderingGroupId=e,this._contentPlate.renderingGroupId=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageUrl",{get:function(){return this._imageUrl},set:function(e){this._imageUrl!==e&&(this._imageUrl=e,this._rebuildContent(),this._resetContentPositionAndZoom(),this._applyContentViewport())},enumerable:!1,configurable:!0}),t.prototype._applyFacade=function(e){this._contentMaterial.albedoTexture=e},t.prototype._rebuildContent=function(){if(this._disposeFacadeTexture(),Fe.M.IsDocumentAvailable()&&document.createElement&&this._imageUrl){var e=new w;e.source=this._imageUrl,this._contentPlate&&(this.content=e)}},t.prototype._addControl=function(e){e._host=this._host,this._host.utilityLayer&&e._prepareNode(this._host.utilityLayer.utilityLayerScene)},t.prototype._getTypeName=function(){return"HolographicSlate"},t.prototype._positionElements=function(){var e=this._followButton.mesh,t=this._closeButton.mesh,i=this._backPlate,n=this._contentPlate;if(e&&t&&i){var r=this.backplateDimensions.y/1;t.scaling.setAll(r),e.scaling.setAll(r),t.position.copyFromFloats(this.backplateDimensions.x-r/2,-this.backplateDimensions.y/2,-this.backplateDimensions.z/2*(this._host.scene.useRightHandedSystem?-1:1)).addInPlace(this.origin),e.position.copyFromFloats(this.backplateDimensions.x-3*r/2,-this.backplateDimensions.y/2,-this.backplateDimensions.z/2*(this._host.scene.useRightHandedSystem?-1:1)).addInPlace(this.origin);var o=this.dimensions.y-this.backplateDimensions.y-this.backPlateMargin;i.scaling.copyFrom(this.backplateDimensions),n.scaling.copyFromFloats(this.dimensions.x,o,this.dimensions.z),i.position.copyFromFloats(this.backplateDimensions.x/2,-this.backplateDimensions.y/2,0).addInPlace(this.origin),n.position.copyFromFloats(this.dimensions.x/2,-(this.backplateDimensions.y+this.backPlateMargin+o/2),0).addInPlace(this.origin);var s=this.dimensions.x/o;this._contentViewport.width=this._contentScaleRatio,this._contentViewport.height=this._contentScaleRatio/s,this._applyContentViewport()}},t.prototype._applyContentViewport=function(){if(this._contentPlate.material&&this._contentPlate.material.albedoTexture){var e=this._contentPlate.material.albedoTexture;e.uScale=this._contentScaleRatio,e.vScale=this._contentScaleRatio/this._contentViewport.width*this._contentViewport.height,e.uOffset=this._contentViewport.x,e.vOffset=this._contentViewport.y}},t.prototype._resetContentPositionAndZoom=function(){this._contentViewport.x=0,this._contentViewport.y=1-this._contentViewport.height/this._contentViewport.width,this._contentScaleRatio=1},t.prototype._updatePivot=function(){if(this.mesh){var e=this.dimensions.scale(.5);e.y*=-1,e.addInPlace(this.origin),e.z=0;var t=new s.P(0,0,0);s.P.TransformCoordinatesToRef(t,this.mesh.computeWorldMatrix(!0),t),this.mesh.setPivotPoint(e);var i=new s.P(0,0,0);s.P.TransformCoordinatesToRef(i,this.mesh.computeWorldMatrix(!0),i),this.mesh.position.addInPlace(t).subtractInPlace(i)}},t.prototype._createNode=function(e){var i=this,n=new Pe.Kj("slate"+this.name,e);this._backPlate=me.k.CreateBox("backPlate"+this.name,{size:1},e),this._contentPlate=me.k.CreateBox("contentPlate"+this.name,{size:1},e),this._backPlate.parent=n,this._backPlate.isNearGrabbable=!0,this._contentPlate.parent=n,this._attachContentPlateBehavior(),this._addControl(this._followButton),this._addControl(this._closeButton);var r=this._followButton.mesh,o=this._closeButton.mesh;return r.parent=n,o.parent=n,this._positionElements(),this._followButton.imageUrl=t.ASSETS_BASE_URL+t.FOLLOW_ICON_FILENAME,this._closeButton.imageUrl=t.ASSETS_BASE_URL+t.CLOSE_ICON_FILENAME,this._followButton.backMaterial.alpha=0,this._closeButton.backMaterial.alpha=0,this._followButton.onPointerClickObservable.add((function(){i._defaultBehavior.followBehaviorEnabled=!i._defaultBehavior.followBehaviorEnabled,i._defaultBehavior.followBehaviorEnabled&&i._defaultBehavior.followBehavior.recenter()})),this._closeButton.onPointerClickObservable.add((function(){i.dispose()})),n.rotationQuaternion=s._f.Identity(),n.isVisible=!1,n},t.prototype._attachContentPlateBehavior=function(){var e=this;this._contentDragBehavior.attach(this._contentPlate),this._contentDragBehavior.moveAttached=!1,this._contentDragBehavior.useObjectOrientationForDragging=!0,this._contentDragBehavior.updateDragPlane=!1;var t,i,n=new s.P,r=new s.P,o=new s.P,a=new s.P,l=new s.FM;this._contentDragBehavior.onDragStartObservable.add((function(l){e.node&&(t=e._contentViewport.clone(),i=e.node.computeWorldMatrix(!0),n.copyFrom(l.dragPlanePoint),r.copyFrom(e.dimensions),r.y-=e.backplateDimensions.y+e.backPlateMargin,s.P.TransformNormalToRef(r,i,r),o.copyFromFloats(0,1,0),s.P.TransformNormalToRef(o,i,o),a.copyFromFloats(1,0,0),s.P.TransformNormalToRef(a,i,a),o.normalize(),o.scaleInPlace(1/s.P.Dot(o,r)),a.normalize(),a.scaleInPlace(1/s.P.Dot(a,r)))}));var h=new s.P;this._contentDragBehavior.onDragObservable.add((function(i){h.copyFrom(i.dragPlanePoint),h.subtractInPlace(n),l.copyFromFloats(s.P.Dot(h,a),s.P.Dot(h,o)),e._contentViewport.x=et.R.Clamp(t.x-h.x,0,1-e._contentViewport.width*e._contentScaleRatio),e._contentViewport.y=et.R.Clamp(t.y-h.y,0,1-e._contentViewport.height*e._contentScaleRatio),e._applyContentViewport()}))},t.prototype._affectMaterial=function(e){this._backPlateMaterial=new it(this.name+" plateMaterial",e.getScene()),this._pickedPointObserver=this._host.onPickedPointChangedObservable.add((function(e){})),this._contentMaterial=new Ae(this.name+"contentMaterial",e.getScene()),this._contentMaterial.renderBorders=!0,this._backPlate.material=this._backPlateMaterial,this._contentPlate.material=this._contentMaterial,this._rebuildContent(),this._applyContentViewport()},t.prototype._prepareNode=function(t){var i=this;e.prototype._prepareNode.call(this,t),this._gizmo=new qe(this._host.utilityLayer),this._gizmo.attachedSlate=this,this._defaultBehavior=new $e,this._defaultBehavior.attach(this.node,[this._backPlate]),this._positionChangedObserver=this._defaultBehavior.sixDofDragBehavior.onPositionChangedObservable.add((function(){i._gizmo.updateBoundingBox()})),this._updatePivot(),this.resetDefaultAspectAndPose()},t.prototype.resetDefaultAspectAndPose=function(){if(this._host&&this._host.utilityLayer&&this.node){var e=this._host.utilityLayer.utilityLayerScene,t=e.activeCamera;if(t){var i=t.getWorldMatrix(),n=s.P.TransformNormal(s.P.Backward(e.useRightHandedSystem),i);this.dimensions.copyFrom(this.defaultDimensions),this.origin.setAll(0),this._gizmo.updateBoundingBox();var r=this.node.getAbsolutePivotPoint();this.node.position.copyFrom(t.position).subtractInPlace(n).subtractInPlace(r),this.node.rotationQuaternion=s._f.FromLookDirectionLH(n,new s.P(0,1,0))}}},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._backPlateMaterial.dispose(),this._contentMaterial.dispose(),this._backPlate.dispose(),this._contentPlate.dispose(),this._followButton.dispose(),this._closeButton.dispose(),this._host.onPickedPointChangedObservable.remove(this._pickedPointObserver),this._defaultBehavior.sixDofDragBehavior.onPositionChangedObservable.remove(this._positionChangedObserver),this._defaultBehavior.detach(),this._gizmo.dispose(),this._contentDragBehavior.detach()},t.ASSETS_BASE_URL="https://assets.babylonjs.com/meshes/MRTK/",t.CLOSE_ICON_FILENAME="IconClose.png",t.FOLLOW_ICON_FILENAME="IconFollowMe.png"}(pe);var nt=function(e){function t(t){var i=e.call(this,t)||this;return i.backPlateMargin=1.25,i}return(0,n.ZT)(t,e),t.prototype._createNode=function(e){var t=new Pe.Kj("menu_"+this.name,e);return this._backPlate=me.k.CreateBox("backPlate"+this.name,{size:1},e),this._backPlate.parent=t,t},t.prototype._affectMaterial=function(e){var t=this;this._backPlateMaterial=new Ae(this.name+"backPlateMaterial",e.getScene()),this._backPlateMaterial.albedoColor=new N.Wo(.08,.15,.55),this._backPlateMaterial.renderBorders=!0,this._backPlateMaterial.renderHoverLight=!0,this._pickedPointObserver=this._host.onPickedPointChangedObservable.add((function(e){e?(t._backPlateMaterial.hoverPosition=e,t._backPlateMaterial.hoverColor.a=1):t._backPlateMaterial.hoverColor.a=0})),this._backPlate.material=this._backPlateMaterial},t.prototype._mapGridNode=function(e,t){e.mesh&&(e.position=t.clone(),this._currentMin||(this._currentMin=t.clone(),this._currentMax=t.clone()),this._currentMin.minimizeInPlace(t),this._currentMax.maximizeInPlace(t))},t.prototype._finalProcessing=function(){this._currentMin.addInPlaceFromFloats(-this._cellWidth/2,-this._cellHeight/2,0),this._currentMax.addInPlaceFromFloats(this._cellWidth/2,this._cellHeight/2,0);var e=this._currentMax.subtract(this._currentMin);this._backPlate.scaling.x=e.x+this._cellWidth*this.backPlateMargin,this._backPlate.scaling.y=e.y+this._cellHeight*this.backPlateMargin,this._backPlate.scaling.z=.001;for(var t=0;t<this._children.length;t++)this._children[t].position.subtractInPlace(this._currentMin).subtractInPlace(e.scale(.5)),this._children[t].position.z-=.01;this._currentMin=null,this._currentMax=null},t.prototype.addButton=function(t){return e.prototype.addControl.call(this,t),t.backMaterial&&(t.backMaterial.alpha=0),this},t.prototype.addControl=function(e){return r.Y.Warn("TouchHolographicMenu can only contain buttons. Please use the method `addButton` instead."),this},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._host.onPickedPointChangedObservable.remove(this._pickedPointObserver)},t}(ye),rt=i(9964),ot=(function(e){function t(t,i){var n=e.call(this,i)||this;return n._handConstraintBehavior=new rt.q_,n._handConstraintBehavior.linkToXRExperience(t),n.backPlateMargin=.15,n}(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"handConstraintBehavior",{get:function(){return this._handConstraintBehavior},enumerable:!1,configurable:!0}),t.prototype._createNode=function(t){var i=e.prototype._createNode.call(this,t);return this._handConstraintBehavior.attach(i),i},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._handConstraintBehavior.detach()}}(nt),function(e){function t(t,i){var n=e.call(this,i)||this;return n._currentMesh=t,n.pointerEnterAnimation=function(){n.mesh&&n.mesh.scaling.scaleInPlace(1.1)},n.pointerOutAnimation=function(){n.mesh&&n.mesh.scaling.scaleInPlace(1/1.1)},n.pointerDownAnimation=function(){n.mesh&&n.mesh.scaling.scaleInPlace(.95)},n.pointerUpAnimation=function(){n.mesh&&n.mesh.scaling.scaleInPlace(1/.95)},n}(0,n.ZT)(t,e),t.prototype._getTypeName=function(){return"MeshButton3D"},t.prototype._createNode=function(e){var t=this;return this._currentMesh.getChildMeshes().forEach((function(e){t._injectGUI3DReservedDataStore(e).control=t})),this._currentMesh},t.prototype._affectMaterial=function(e){}}(ve),function(e){function t(t){var i=e.call(this,t)||this;return i._isPinned=!1,i._defaultBehavior=new $e,i._dragObserver=i._defaultBehavior.sixDofDragBehavior.onDragObservable.add((function(){i.isPinned=!0})),i}(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"defaultBehavior",{get:function(){return this._defaultBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isPinned",{get:function(){return this._isPinned},set:function(e){this._isPinned=e,this._isPinned?(this._pinMaterial.emissiveColor.copyFromFloats(.25,.4,.95),this._defaultBehavior.followBehaviorEnabled=!1):(this._pinMaterial.emissiveColor.copyFromFloats(.08,.15,.55),this._defaultBehavior.followBehaviorEnabled=!0)},enumerable:!1,configurable:!0}),t.prototype._createPinButton=function(e){var i=this,n=new ke("pin"+this.name,!1);return n.imageUrl=t.ASSETS_BASE_URL+t.PIN_ICON_FILENAME,n.parent=this,n._host=this._host,n.onPointerClickObservable.add((function(){return i.isPinned=!i.isPinned})),this._host.utilityLayer&&(n._prepareNode(this._host.utilityLayer.utilityLayerScene),n.scaling.scaleInPlace(t.NEAR_BUTTON_SCALE),this._pinMaterial=n.backMaterial,this._pinMaterial.diffuseColor.copyFromFloats(0,0,0),n.node&&(n.node.parent=e)),n},t.prototype.addButton=function(i){var n=this.blockLayout;return n||(this.blockLayout=!0),e.prototype.addButton.call(this,i),i.scaling.scaleInPlace(t.NEAR_BUTTON_SCALE),n||(this.blockLayout=!1),this},t.prototype._createNode=function(t){var i=e.prototype._createNode.call(this,t);return this._pinButton=this._createPinButton(i),this.isPinned=!1,this._defaultBehavior.attach(i,[this._backPlate]),this._defaultBehavior.followBehavior.ignoreCameraPitchAndRoll=!0,this._defaultBehavior.followBehavior.pitchOffset=-15,this._defaultBehavior.followBehavior.minimumDistance=.3,this._defaultBehavior.followBehavior.defaultDistance=.4,this._defaultBehavior.followBehavior.maximumDistance=.6,this._backPlate.isNearGrabbable=!0,i.isVisible=!1,i},t.prototype._finalProcessing=function(){e.prototype._finalProcessing.call(this),this._pinButton.position.copyFromFloats(this._backPlate.scaling.x/2+.2,this._backPlate.scaling.y/2,-.1)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._defaultBehavior.sixDofDragBehavior.onDragObservable.remove(this._dragObserver),this._defaultBehavior.detach()},t.ASSETS_BASE_URL="https://assets.babylonjs.com/meshes/MRTK/",t.PIN_ICON_FILENAME="IconPin.png",t.NEAR_BUTTON_SCALE=.32}(nt),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}(0,n.ZT)(t,e),t.prototype._mapGridNode=function(e,t){var i=e.mesh;if(i){e.position=t.clone();var n=s.jp.Vector3[0];switch(n.copyFrom(t),this.orientation){case be.FACEORIGIN_ORIENTATION:case be.FACEFORWARD_ORIENTATION:n.addInPlace(new s.P(0,0,1)),i.lookAt(n);break;case be.FACEFORWARDREVERSED_ORIENTATION:case be.FACEORIGINREVERSED_ORIENTATION:n.addInPlace(new s.P(0,0,-1)),i.lookAt(n)}}}}(ye),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._iteration=100,t}(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"iteration",{get:function(){return this._iteration},set:function(e){var t=this;this._iteration!==e&&(this._iteration=e,l.w1.SetImmediate((function(){t._arrangeChildren()})))},enumerable:!1,configurable:!0}),t.prototype._mapGridNode=function(e,t){var i=e.mesh,n=this._scatterMapping(t);if(i){switch(this.orientation){case be.FACEORIGIN_ORIENTATION:case be.FACEFORWARD_ORIENTATION:i.lookAt(new s.P(0,0,1));break;case be.FACEFORWARDREVERSED_ORIENTATION:case be.FACEORIGINREVERSED_ORIENTATION:i.lookAt(new s.P(0,0,-1))}e.position=n}},t.prototype._scatterMapping=function(e){return e.x=(1-2*Math.random())*this._cellWidth,e.y=(1-2*Math.random())*this._cellHeight,e},t.prototype._finalProcessing=function(){for(var e=[],t=0,i=this._children;t<i.length;t++){var n=i[t];n.mesh&&e.push(n.mesh)}for(var r=0;r<this._iteration;r++){e.sort((function(e,t){var i=e.position.lengthSquared(),n=t.position.lengthSquared();return i<n?1:i>n?-1:0}));for(var o=Math.pow(this.margin,2),a=Math.max(this._cellWidth,this._cellHeight),l=s.jp.Vector2[0],h=s.jp.Vector3[0],u=0;u<e.length-1;u++)for(var c=u+1;c<e.length;c++)if(u!=c){e[c].position.subtractToRef(e[u].position,h),l.x=h.x,l.y=h.y;var f=a,_=l.lengthSquared()-o;(_-=Math.min(_,o))<Math.pow(f,2)&&(l.normalize(),h.scaleInPlace(.5*(f-Math.sqrt(_))),e[c].position.addInPlace(h),e[u].position.subtractInPlace(h))}}}}(ye),i(6714)),st=(function(e){function t(t){var i=e.call(this,t)||this;return i.onValueChangedObservable=new o.y$,i._minimum=0,i._maximum=100,i._step=0,i._value=50,i}(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"mesh",{get:function(){return this.node?this._sliderThumb:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"minimum",{get:function(){return this._minimum},set:function(e){this._minimum!==e&&(this._minimum=Math.max(e,0),this._value=Math.max(Math.min(this._value,this._maximum),this._minimum))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maximum",{get:function(){return this._maximum},set:function(e){this._maximum!==e&&(this._maximum=Math.max(e,this._minimum),this._value=Math.max(Math.min(this._value,this._maximum),this._minimum))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"step",{get:function(){return this._step},set:function(e){this._step!==e&&(this._step=Math.max(Math.min(e,this._maximum-this._minimum),0))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(e){this._value!==e&&(this._value=Math.max(Math.min(e,this._maximum),this._minimum),this.onValueChangedObservable.notifyObservers(this._value))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"start",{get:function(){return this.node?this._sliderBar.position.x-this._sliderBar.scaling.y/2:-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"end",{get:function(){return this.node?this._sliderBar.position.x+this._sliderBar.scaling.y/2:1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sliderBarMaterial",{get:function(){return this._sliderBarMaterial},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sliderThumbMaterial",{get:function(){return this._sliderThumbMaterial},enumerable:!1,configurable:!0}),t.prototype._createNode=function(e){var t=new fe.Y(this.name+"_slider",e),i=ot.H.CreateCylinder(this.name+"_sliderbar",{diameter:.03,height:1},e);i.rotation.z=-Math.PI/2,i.scaling.y=2,i.isPickable=!1,i.setParent(t);var n=me.k.CreateBox(this.name+"_sliderthumb",{size:.1},e);return n.scaling=new s.P(2,2,2),n.position.x=this._convertToPosition(this.value),n.addBehavior(this._createBehavior()),n.setParent(t),this._sliderBar=i,this._sliderThumb=n,t},t.prototype._affectMaterial=function(e){var t=new oe.K(this.name+"_sliderbar_material",e.getScene());t.specularColor=N.Wo.Black(),this._sliderBar.material=t;var i=new oe.K(this.name+"_sliderthumb_material",e.getScene());i.specularColor=N.Wo.Black(),e.material=i,this._sliderBarMaterial=t,this._sliderThumbMaterial=i},t.prototype._createBehavior=function(){var e=this,t=new Je.M({dragAxis:s.P.Right()});return t.moveAttached=!1,t.onDragObservable.add((function(t){var i=e._sliderThumb.position.x+t.dragDistance;e._sliderThumb.position.x=Math.max(Math.min(i,e.end),e.start),e.value=e._convertToValue(e._sliderThumb.position.x)})),t.onDragEndObservable.add((function(t){e._sliderThumb.position.x=e._convertToPosition(e.value)})),t},t.prototype._convertToPosition=function(e){var t=(e-this.minimum)/(this.maximum-this.minimum)*(this.end-this.start)+this.start;return Math.min(Math.max(t,this.start),this.end)},t.prototype._convertToValue=function(e){var t=(e-this.start)/(this.end-this.start)*(this.maximum-this.minimum);return t=this.step?Math.round(t/this.step)*this.step:t,Math.max(Math.min(this.minimum+t,this._maximum),this._minimum)},t.prototype.dispose=function(){var t,i,n,r;e.prototype.dispose.call(this),null===(t=this._sliderBar)||void 0===t||t.dispose(),null===(i=this._sliderThumb)||void 0===i||i.dispose(),null===(n=this._sliderBarMaterial)||void 0===n||n.dispose(),null===(r=this._sliderThumbMaterial)||void 0===r||r.dispose()}}(de),function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._radius=5,t}(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){var t=this;this._radius!==e&&(this._radius=e,l.w1.SetImmediate((function(){t._arrangeChildren()})))},enumerable:!1,configurable:!0}),t.prototype._mapGridNode=function(e,t){var i=e.mesh;if(i){var n=this._sphericalMapping(t);switch(e.position=n,this.orientation){case be.FACEORIGIN_ORIENTATION:i.lookAt(new s.P(2*n.x,2*n.y,2*n.z));break;case be.FACEORIGINREVERSED_ORIENTATION:i.lookAt(new s.P(-n.x,-n.y,-n.z));break;case be.FACEFORWARD_ORIENTATION:break;case be.FACEFORWARDREVERSED_ORIENTATION:i.rotate(xe.RD.Y,Math.PI,xe.T.LOCAL)}}},t.prototype._sphericalMapping=function(e){var t=new s.P(0,0,this._radius),i=e.y/this._radius,n=-e.x/this._radius;return s.y3.RotationYawPitchRollToRef(n,i,0,s.jp.Matrix[0]),s.P.TransformNormal(t,s.jp.Matrix[0])}}(ye),function(e){function t(t){void 0===t&&(t=!1);var i=e.call(this)||this;return i._isVertical=!1,i.margin=.1,i._isVertical=t,i}(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"isVertical",{get:function(){return this._isVertical},set:function(e){var t=this;this._isVertical!==e&&(this._isVertical=e,l.w1.SetImmediate((function(){t._arrangeChildren()})))},enumerable:!1,configurable:!0}),t.prototype._arrangeChildren=function(){for(var e,t=0,i=0,n=0,r=[],o=s.y3.Invert(this.node.computeWorldMatrix(!0)),a=0,l=this._children;a<l.length;a++)if((d=l[a]).mesh){n++,d.mesh.computeWorldMatrix(!0),d.mesh.getWorldMatrix().multiplyToRef(o,s.jp.Matrix[0]);var h=d.mesh.getBoundingInfo().boundingBox,u=s.P.TransformNormal(h.extendSize,s.jp.Matrix[0]);r.push(u),this._isVertical?i+=u.y:t+=u.x}this._isVertical?i+=(n-1)*this.margin/2:t+=(n-1)*this.margin/2,e=this._isVertical?-i:-t;for(var c=0,f=0,_=this._children;f<_.length;f++){var d;(d=_[f]).mesh&&(n--,u=r[c++],this._isVertical?(d.position.y=e+u.y,d.position.x=0,e+=2*u.y):(d.position.x=e+u.x,d.position.y=0,e+=2*u.x),e+=n>0?this.margin:0)}}}(be),function(e){function t(t,i){var n=e.call(this,i,t)||this;return n._currentMesh=t,n.pointerEnterAnimation=function(){n.mesh&&n.mesh.scaling.scaleInPlace(1.1)},n.pointerOutAnimation=function(){n.mesh&&n.mesh.scaling.scaleInPlace(1/1.1)},n.pointerDownAnimation=function(){n.mesh&&n.mesh.scaling.scaleInPlace(.95)},n.pointerUpAnimation=function(){n.mesh&&n.mesh.scaling.scaleInPlace(1/.95)},n}(0,n.ZT)(t,e),t.prototype._getTypeName=function(){return"TouchMeshButton3D"},t.prototype._createNode=function(e){var t=this;return this._currentMesh.getChildMeshes().forEach((function(e){t._injectGUI3DReservedDataStore(e).control=t})),this._currentMesh},t.prototype._affectMaterial=function(e){}}(Be),function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._isPressed=!1,n.onToggleOnObservable=new o.y$,n.onToggleOffObservable=new o.y$,n.onPointerUpObservable.add((function(e){n._onToggle(e)})),n}(0,n.ZT)(t,e),t.prototype._onToggle=function(e){this._isPressed=!this._isPressed,this._isPressed?this.onToggleOnObservable.notifyObservers(e):this.onToggleOffObservable.notifyObservers(e)},t.prototype._getTypeName=function(){return"TouchToggleButton3D"},t.prototype._createNode=function(t){return e.prototype._createNode.call(this,t)},t.prototype._affectMaterial=function(t){e.prototype._affectMaterial.call(this,t)},t.prototype.dispose=function(){this.onToggleOnObservable.clear(),this.onToggleOffObservable.clear(),e.prototype.dispose.call(this)}}(Be),function(e){function t(t,i){void 0===i&&(i=!0);var n=e.call(this,t)||this;return n._shareMaterials=i,n}(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"renderingGroupId",{get:function(){return this._model.renderingGroupId},set:function(e){this._model.renderingGroupId=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._material},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shareMaterials",{get:function(){return this._shareMaterials},enumerable:!1,configurable:!0}),t.prototype._getTypeName=function(){return"HolographicBackplate"},t.prototype._createNode=function(e){var i,n=this,r=me.k.CreateBox((null!==(i=this.name)&&void 0!==i?i:"HolographicBackplate")+"_CollisionMesh",{width:1,height:1,depth:1},e);return r.isPickable=!0,r.visibility=0,Ne.n.ImportMeshAsync(void 0,t.MODEL_BASE_URL,t.MODEL_FILENAME,e).then((function(e){var t=e.meshes[1];t.name=n.name+"_frontPlate",t.isPickable=!1,t.parent=r,n._material&&(t.material=n._material),n._model=t})),r},t.prototype._createMaterial=function(e){this._material=new it(this.name+" Material",e.getScene())},t.prototype._affectMaterial=function(e){this._shareMaterials?this._host._touchSharedMaterials.fluentBackplateMaterial?this._material=this._host._touchSharedMaterials.fluentBackplateMaterial:(this._createMaterial(e),this._host._touchSharedMaterials.fluentBackplateMaterial=this._material):this._createMaterial(e)},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.shareMaterials||this._material.dispose(),this._model.dispose()},t.MODEL_BASE_URL="https://assets.babylonjs.com/meshes/MRTK/",t.MODEL_FILENAME="mrtk-fluent-backplate.glb"}(de),i(1162)),at=i(4140),lt=i(3852);!function(){function e(e){var t=this;this._lastControlOver={},this._lastControlDown={},this.onPickedPointChangedObservable=new o.y$,this.onPickingObservable=new o.y$,this._sharedMaterials={},this._touchSharedMaterials={},this._scene=e||lt.l.LastCreatedScene,this._sceneDisposeObserver=this._scene.onDisposeObservable.add((function(){t._sceneDisposeObserver=null,t._utilityLayer=null,t.dispose()})),this._utilityLayer=at.x._CreateDefaultUtilityLayerFromScene(this._scene),this._utilityLayer.onlyCheckPointerDownEvents=!1,this._utilityLayer.pickUtilitySceneFirst=!1,this._utilityLayer.mainSceneTrackerPredicate=function(e){var t,i,n;return e&&(null===(n=null===(i=null===(t=e.reservedDataStore)||void 0===t?void 0:t.GUI3D)||void 0===i?void 0:i.control)||void 0===n?void 0:n._node)},this._rootContainer=new be("RootContainer"),this._rootContainer._host=this;var i=this._utilityLayer.utilityLayerScene;this._pointerOutObserver=this._utilityLayer.onPointerOutObservable.add((function(e){t._handlePointerOut(e,!0)})),this._pointerObserver=i.onPointerObservable.add((function(e,i){t._doPicking(e)})),this._utilityLayer.utilityLayerScene.autoClear=!1,this._utilityLayer.utilityLayerScene.autoClearDepthAndStencil=!1,new st.e("hemi",s.P.Up(),this._utilityLayer.utilityLayerScene)}Object.defineProperty(e.prototype,"scene",{get:function(){return this._scene},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"utilityLayer",{get:function(){return this._utilityLayer},enumerable:!1,configurable:!0}),e.prototype._handlePointerOut=function(e,t){var i=this._lastControlOver[e];i&&(i._onPointerOut(i),delete this._lastControlOver[e]),t&&this._lastControlDown[e]&&(this._lastControlDown[e].forcePointerUp(),delete this._lastControlDown[e]),this.onPickedPointChangedObservable.notifyObservers(null)},e.prototype._doPicking=function(e){var t,i,n;if(!this._utilityLayer||!this._utilityLayer.shouldRender||!this._utilityLayer.utilityLayerScene.activeCamera)return!1;var r=e.event,o=r.pointerId||0,s=r.button,l=e.pickInfo;if(l&&this.onPickingObservable.notifyObservers(l.pickedMesh),!l||!l.hit)return this._handlePointerOut(o,e.type===a.kD.POINTERUP),!1;l.pickedPoint&&this.onPickedPointChangedObservable.notifyObservers(l.pickedPoint);var h=null===(i=null===(t=l.pickedMesh.reservedDataStore)||void 0===t?void 0:t.GUI3D)||void 0===i?void 0:i.control;return h&&!h._processObservables(e.type,l.pickedPoint,(null===(n=l.originMesh)||void 0===n?void 0:n.position)||null,o,s)&&e.type===a.kD.POINTERMOVE&&(this._lastControlOver[o]&&this._lastControlOver[o]._onPointerOut(this._lastControlOver[o]),delete this._lastControlOver[o]),e.type===a.kD.POINTERUP&&(this._lastControlDown[r.pointerId]&&(this._lastControlDown[r.pointerId].forcePointerUp(),delete this._lastControlDown[r.pointerId]),"touch"===r.pointerType&&this._handlePointerOut(o,!1)),!0},Object.defineProperty(e.prototype,"rootContainer",{get:function(){return this._rootContainer},enumerable:!1,configurable:!0}),e.prototype.containsControl=function(e){return this._rootContainer.containsControl(e)},e.prototype.addControl=function(e){return this._rootContainer.addControl(e),this},e.prototype.removeControl=function(e){return this._rootContainer.removeControl(e),this},e.prototype.dispose=function(){for(var e in this._rootContainer.dispose(),this._sharedMaterials)this._sharedMaterials.hasOwnProperty(e)&&this._sharedMaterials[e].dispose();for(var e in this._sharedMaterials={},this._touchSharedMaterials)this._touchSharedMaterials.hasOwnProperty(e)&&this._touchSharedMaterials[e].dispose();this._touchSharedMaterials={},this._pointerOutObserver&&this._utilityLayer&&(this._utilityLayer.onPointerOutObservable.remove(this._pointerOutObserver),this._pointerOutObserver=null),this.onPickedPointChangedObservable.clear(),this.onPickingObservable.clear();var t=this._utilityLayer?this._utilityLayer.utilityLayerScene:null;t&&this._pointerObserver&&(t.onPointerObservable.remove(this._pointerObserver),this._pointerObserver=null),this._scene&&this._sceneDisposeObserver&&(this._scene.onDisposeObservable.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null),this._utilityLayer&&this._utilityLayer.dispose()}}()},5454:(e,t,i)=>{"use strict";i.d(t,{tk:()=>y});var n=i(3940),r=i(3536),o=i(2172),s=i(9901),a=i(3177),l=i(1344),h=i(7039),u=i(798),c=i(8356),f=i(2997),_=i(5589),d=(i(8255),i(1544),i(6452),i(154),i(6065),i(1469),i(1742),i(4254),i(9565),i(3117),i(8559),i(8687),"precision highp float;\n\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\n\nvec3 computeCustomDiffuseLighting(lightingInfo info,vec3 diffuseBase,float shadow)\n{\ndiffuseBase=info.diffuse*shadow;\n#ifdef CELLBASIC\nfloat level=1.0;\nif (info.ndl<0.5)\nlevel=0.5;\ndiffuseBase.rgb*vec3(level,level,level);\n#else\nfloat ToonThresholds[4];\nToonThresholds[0]=0.95;\nToonThresholds[1]=0.5;\nToonThresholds[2]=0.2;\nToonThresholds[3]=0.03;\nfloat ToonBrightnessLevels[5];\nToonBrightnessLevels[0]=1.0;\nToonBrightnessLevels[1]=0.8;\nToonBrightnessLevels[2]=0.6;\nToonBrightnessLevels[3]=0.35;\nToonBrightnessLevels[4]=0.2;\nif (info.ndl>ToonThresholds[0])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[0];\n}\nelse if (info.ndl>ToonThresholds[1])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[1];\n}\nelse if (info.ndl>ToonThresholds[2])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[2];\n}\nelse if (info.ndl>ToonThresholds[3])\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[3];\n}\nelse\n{\ndiffuseBase.rgb*=ToonBrightnessLevels[4];\n}\n#endif\nreturn max(diffuseBase,vec3(0.2));\n}\nvoid main(void)\n{\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nlightingInfo info;\nvec3 diffuseBase=vec3(0.,0.,0.);\nfloat shadow=1.;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}");_.Q.ShadersStore.cellPixelShader=d,i(6929),i(2813),i(8720),i(825),i(3178),i(8662),i(2830),i(4591),i(4168);_.Q.ShadersStore.cellVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";var p=i(584),g=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.NDOTL=!0,t.CUSTOMUSERLIGHTING=!0,t.CELLBASIC=!0,t.DEPTHPREPASS=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.rebuild(),t}return(0,n.ZT)(t,e),t}(s.H),m=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.diffuseColor=new o.Wo(1,1,1),n._computeHighLevel=!1,n._disableLighting=!1,n._maxSimultaneousLights=4,n}return(0,n.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new g);var n=t._materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(n._areTexturesDirty&&(n._needUVs=!1,r.texturesEnabled&&this._diffuseTexture&&h.k.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;n._needUVs=!0,n.DIFFUSE=!0}if(n.CELLBASIC=!this.computeHighLevel,a.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),n),n._needNormals=a.G.PrepareDefinesForLights(r,e,n,!1,this._maxSimultaneousLights,this._disableLighting),a.G.PrepareDefinesForFrameBoundValues(r,o,n,!!i),a.G.PrepareDefinesForAttributes(e,n,!0,!0),n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var s=new p.L;n.FOG&&s.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(n,s,this.maxSimultaneousLights),n.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,e),n.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var l=[u.o.PositionKind];n.NORMAL&&l.push(u.o.NormalKind),n.UV1&&l.push(u.o.UVKind),n.UV2&&l.push(u.o.UV2Kind),n.VERTEXCOLOR&&l.push(u.o.ColorKind),a.G.PrepareAttributesForBones(l,e,n,s),a.G.PrepareAttributesForInstances(l,n);var c=n.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix"],_=["diffuseSampler"],d=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:d,samplers:_,defines:n,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("cell",{attributes:l,uniformsNames:f,uniformBuffersNames:d,samplers:_,defines:c,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights-1}},o),n,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n=this.getScene(),r=i._materialDefines;if(r){var o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(n,o)&&(this._diffuseTexture&&h.k.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),a.G.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),n.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),n.lightsEnabled&&!this.disableLighting&&a.G.BindLights(n,t,this._activeEffect,r,this._maxSimultaneousLights),n.fogEnabled&&t.applyFog&&n.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),a.G.BindFogParameters(n,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this._diffuseTexture===t},t.prototype.dispose=function(t){this._diffuseTexture&&this._diffuseTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.getClassName=function(){return"CellMaterial"},t.prototype.clone=function(e){var i=this;return r.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var e=r.p4.Serialize(this);return e.customType="BABYLON.CellMaterial",e},t.Parse=function(e,i,n){return r.p4.Parse((function(){return new t(e.name,i)}),e,i,n)},(0,n.gn)([(0,r.oU)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),(0,n.gn)([(0,r.n9)("diffuse")],t.prototype,"diffuseColor",void 0),(0,n.gn)([(0,r.qC)("computeHighLevel")],t.prototype,"_computeHighLevel",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"computeHighLevel",void 0),(0,n.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,n.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(l.a);f.Q.RegisteredTypes["BABYLON.CellMaterial"]=m;var v=i(4706),b=function(){},y=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.CustomParts=new b,n.customShaderNameResolve=n.Builder,n.FragmentShader=_.Q.ShadersStore.defaultPixelShader,n.VertexShader=_.Q.ShadersStore.defaultVertexShader,n}return(0,n.ZT)(t,e),t.prototype.AttachAfterBind=function(e,t){if(this._newUniformInstances)for(var i in this._newUniformInstances)"vec2"==(n=i.toString().split("-"))[0]?t.setVector2(n[1],this._newUniformInstances[i]):"vec3"==n[0]?t.setVector3(n[1],this._newUniformInstances[i]):"vec4"==n[0]?t.setVector4(n[1],this._newUniformInstances[i]):"mat4"==n[0]?t.setMatrix(n[1],this._newUniformInstances[i]):"float"==n[0]&&t.setFloat(n[1],this._newUniformInstances[i]);if(this._newSamplerInstances)for(var i in this._newSamplerInstances){var n;"sampler2D"==(n=i.toString().split("-"))[0]&&this._newSamplerInstances[i].isReady&&this._newSamplerInstances[i].isReady()&&t.setTexture(n[1],this._newSamplerInstances[i])}},t.prototype.ReviewUniform=function(e,t){if("uniform"==e&&this._newUniforms)for(var i=0;i<this._newUniforms.length;i++)-1==this._customUniform[i].indexOf("sampler")&&t.push(this._newUniforms[i]);if("sampler"==e&&this._newUniforms)for(i=0;i<this._newUniforms.length;i++)-1!=this._customUniform[i].indexOf("sampler")&&t.push(this._newUniforms[i]);return t},t.prototype.Builder=function(e,i,n,r,o,s){var a=this;if(s&&this._customAttributes&&this._customAttributes.length>0&&s.push.apply(s,this._customAttributes),this.ReviewUniform("uniform",i),this.ReviewUniform("sampler",r),this._isCreatedShader)return this._createdShaderName;this._isCreatedShader=!1,t.ShaderIndexer++;var l="custom_"+t.ShaderIndexer,h=this._afterBind.bind(this);return this._afterBind=function(e,t){if(t){a.AttachAfterBind(e,t);try{h(e,t)}catch(t){}}},_.Q.ShadersStore[l+"VertexShader"]=this.VertexShader.replace("#define CUSTOM_VERTEX_BEGIN",this.CustomParts.Vertex_Begin?this.CustomParts.Vertex_Begin:"").replace("#define CUSTOM_VERTEX_DEFINITIONS",(this._customUniform?this._customUniform.join("\n"):"")+(this.CustomParts.Vertex_Definitions?this.CustomParts.Vertex_Definitions:"")).replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.CustomParts.Vertex_MainBegin?this.CustomParts.Vertex_MainBegin:"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.CustomParts.Vertex_Before_PositionUpdated?this.CustomParts.Vertex_Before_PositionUpdated:"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.CustomParts.Vertex_Before_NormalUpdated?this.CustomParts.Vertex_Before_NormalUpdated:"").replace("#define CUSTOM_VERTEX_MAIN_END",this.CustomParts.Vertex_MainEnd?this.CustomParts.Vertex_MainEnd:""),this.CustomParts.Vertex_After_WorldPosComputed&&(_.Q.ShadersStore[l+"VertexShader"]=_.Q.ShadersStore[l+"VertexShader"].replace("#define CUSTOM_VERTEX_UPDATE_WORLDPOS",this.CustomParts.Vertex_After_WorldPosComputed)),_.Q.ShadersStore[l+"PixelShader"]=this.FragmentShader.replace("#define CUSTOM_FRAGMENT_BEGIN",this.CustomParts.Fragment_Begin?this.CustomParts.Fragment_Begin:"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.CustomParts.Fragment_MainBegin?this.CustomParts.Fragment_MainBegin:"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",(this._customUniform?this._customUniform.join("\n"):"")+(this.CustomParts.Fragment_Definitions?this.CustomParts.Fragment_Definitions:"")).replace("#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE",this.CustomParts.Fragment_Custom_Diffuse?this.CustomParts.Fragment_Custom_Diffuse:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.CustomParts.Fragment_Custom_Alpha?this.CustomParts.Fragment_Custom_Alpha:"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.CustomParts.Fragment_Before_Lights?this.CustomParts.Fragment_Before_Lights:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.CustomParts.Fragment_Before_FragColor?this.CustomParts.Fragment_Before_FragColor:""),this.CustomParts.Fragment_Before_Fog&&(_.Q.ShadersStore[l+"PixelShader"]=_.Q.ShadersStore[l+"PixelShader"].replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.CustomParts.Fragment_Before_Fog)),this._isCreatedShader=!0,this._createdShaderName=l,l},t.prototype.AddUniform=function(e,t,i){return this._customUniform||(this._customUniform=new Array,this._newUniforms=new Array,this._newSamplerInstances={},this._newUniformInstances={}),i&&(-1!=t.indexOf("sampler")?this._newSamplerInstances[t+"-"+e]=i:this._newUniformInstances[t+"-"+e]=i),this._customUniform.push("uniform "+t+" "+e+";"),this._newUniforms.push(e),this},t.prototype.AddAttribute=function(e){return this._customAttributes||(this._customAttributes=[]),this._customAttributes.push(e),this},t.prototype.Fragment_Begin=function(e){return this.CustomParts.Fragment_Begin=e,this},t.prototype.Fragment_Definitions=function(e){return this.CustomParts.Fragment_Definitions=e,this},t.prototype.Fragment_MainBegin=function(e){return this.CustomParts.Fragment_MainBegin=e,this},t.prototype.Fragment_Custom_Diffuse=function(e){return this.CustomParts.Fragment_Custom_Diffuse=e.replace("result","diffuseColor"),this},t.prototype.Fragment_Custom_Alpha=function(e){return this.CustomParts.Fragment_Custom_Alpha=e.replace("result","alpha"),this},t.prototype.Fragment_Before_Lights=function(e){return this.CustomParts.Fragment_Before_Lights=e,this},t.prototype.Fragment_Before_Fog=function(e){return this.CustomParts.Fragment_Before_Fog=e,this},t.prototype.Fragment_Before_FragColor=function(e){return this.CustomParts.Fragment_Before_FragColor=e.replace("result","color"),this},t.prototype.Vertex_Begin=function(e){return this.CustomParts.Vertex_Begin=e,this},t.prototype.Vertex_Definitions=function(e){return this.CustomParts.Vertex_Definitions=e,this},t.prototype.Vertex_MainBegin=function(e){return this.CustomParts.Vertex_MainBegin=e,this},t.prototype.Vertex_Before_PositionUpdated=function(e){return this.CustomParts.Vertex_Before_PositionUpdated=e.replace("result","positionUpdated"),this},t.prototype.Vertex_Before_NormalUpdated=function(e){return this.CustomParts.Vertex_Before_NormalUpdated=e.replace("result","normalUpdated"),this},t.prototype.Vertex_After_WorldPosComputed=function(e){return this.CustomParts.Vertex_After_WorldPosComputed=e,this},t.prototype.Vertex_MainEnd=function(e){return this.CustomParts.Vertex_MainEnd=e,this},t.ShaderIndexer=1,t}(v.K);f.Q.RegisteredTypes["BABYLON.CustomMaterial"]=y;var x=i(6931),P=i(4549),C=function(){},T=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.CustomParts=new C,n.customShaderNameResolve=n.Builder,n.FragmentShader=_.Q.ShadersStore.pbrPixelShader,n.VertexShader=_.Q.ShadersStore.pbrVertexShader,n.FragmentShader=n.FragmentShader.replace(/#include<pbrBlockAlbedoOpacity>/g,_.Q.IncludesShadersStore.pbrBlockAlbedoOpacity),n.FragmentShader=n.FragmentShader.replace(/#include<pbrBlockReflectivity>/g,_.Q.IncludesShadersStore.pbrBlockReflectivity),n.FragmentShader=n.FragmentShader.replace(/#include<pbrBlockFinalColorComposition>/g,_.Q.IncludesShadersStore.pbrBlockFinalColorComposition),n}return(0,n.ZT)(t,e),t.prototype.AttachAfterBind=function(e,t){if(this._newUniformInstances)for(var i in this._newUniformInstances)"vec2"==(n=i.toString().split("-"))[0]?t.setVector2(n[1],this._newUniformInstances[i]):"vec3"==n[0]?t.setVector3(n[1],this._newUniformInstances[i]):"vec4"==n[0]?t.setVector4(n[1],this._newUniformInstances[i]):"mat4"==n[0]?t.setMatrix(n[1],this._newUniformInstances[i]):"float"==n[0]&&t.setFloat(n[1],this._newUniformInstances[i]);if(this._newSamplerInstances)for(var i in this._newSamplerInstances){var n;"sampler2D"==(n=i.toString().split("-"))[0]&&this._newSamplerInstances[i].isReady&&this._newSamplerInstances[i].isReady()&&t.setTexture(n[1],this._newSamplerInstances[i])}},t.prototype.ReviewUniform=function(e,t){if("uniform"==e&&this._newUniforms)for(var i=0;i<this._newUniforms.length;i++)-1==this._customUniform[i].indexOf("sampler")&&t.push(this._newUniforms[i]);if("sampler"==e&&this._newUniforms)for(i=0;i<this._newUniforms.length;i++)-1!=this._customUniform[i].indexOf("sampler")&&t.push(this._newUniforms[i]);return t},t.prototype.Builder=function(e,i,n,r,o,s,a){var l=this;if(a&&(a.processFinalCode=function(e,t){if("vertex"===e)return t;var i=new P.Z(t);return i.inlineToken="#define pbr_inline",i.processCode(),i.code}),s&&this._customAttributes&&this._customAttributes.length>0&&s.push.apply(s,this._customAttributes),this.ReviewUniform("uniform",i),this.ReviewUniform("sampler",r),this._isCreatedShader)return this._createdShaderName;this._isCreatedShader=!1,t.ShaderIndexer++;var h="custom_"+t.ShaderIndexer,u=this._afterBind.bind(this);return this._afterBind=function(e,t){if(t){l.AttachAfterBind(e,t);try{u(e,t)}catch(t){}}},_.Q.ShadersStore[h+"VertexShader"]=this.VertexShader.replace("#define CUSTOM_VERTEX_BEGIN",this.CustomParts.Vertex_Begin?this.CustomParts.Vertex_Begin:"").replace("#define CUSTOM_VERTEX_DEFINITIONS",(this._customUniform?this._customUniform.join("\n"):"")+(this.CustomParts.Vertex_Definitions?this.CustomParts.Vertex_Definitions:"")).replace("#define CUSTOM_VERTEX_MAIN_BEGIN",this.CustomParts.Vertex_MainBegin?this.CustomParts.Vertex_MainBegin:"").replace("#define CUSTOM_VERTEX_UPDATE_POSITION",this.CustomParts.Vertex_Before_PositionUpdated?this.CustomParts.Vertex_Before_PositionUpdated:"").replace("#define CUSTOM_VERTEX_UPDATE_NORMAL",this.CustomParts.Vertex_Before_NormalUpdated?this.CustomParts.Vertex_Before_NormalUpdated:"").replace("#define CUSTOM_VERTEX_MAIN_END",this.CustomParts.Vertex_MainEnd?this.CustomParts.Vertex_MainEnd:""),this.CustomParts.Vertex_After_WorldPosComputed&&(_.Q.ShadersStore[h+"VertexShader"]=_.Q.ShadersStore[h+"VertexShader"].replace("#define CUSTOM_VERTEX_UPDATE_WORLDPOS",this.CustomParts.Vertex_After_WorldPosComputed)),_.Q.ShadersStore[h+"PixelShader"]=this.FragmentShader.replace("#define CUSTOM_FRAGMENT_BEGIN",this.CustomParts.Fragment_Begin?this.CustomParts.Fragment_Begin:"").replace("#define CUSTOM_FRAGMENT_MAIN_BEGIN",this.CustomParts.Fragment_MainBegin?this.CustomParts.Fragment_MainBegin:"").replace("#define CUSTOM_FRAGMENT_DEFINITIONS",(this._customUniform?this._customUniform.join("\n"):"")+(this.CustomParts.Fragment_Definitions?this.CustomParts.Fragment_Definitions:"")).replace("#define CUSTOM_FRAGMENT_UPDATE_ALBEDO",this.CustomParts.Fragment_Custom_Albedo?this.CustomParts.Fragment_Custom_Albedo:"").replace("#define CUSTOM_FRAGMENT_UPDATE_ALPHA",this.CustomParts.Fragment_Custom_Alpha?this.CustomParts.Fragment_Custom_Alpha:"").replace("#define CUSTOM_FRAGMENT_BEFORE_LIGHTS",this.CustomParts.Fragment_Before_Lights?this.CustomParts.Fragment_Before_Lights:"").replace("#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS",this.CustomParts.Fragment_Custom_MetallicRoughness?this.CustomParts.Fragment_Custom_MetallicRoughness:"").replace("#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE",this.CustomParts.Fragment_Custom_MicroSurface?this.CustomParts.Fragment_Custom_MicroSurface:"").replace("#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR",this.CustomParts.Fragment_Before_FragColor?this.CustomParts.Fragment_Before_FragColor:""),this.CustomParts.Fragment_Before_Fog&&(_.Q.ShadersStore[h+"PixelShader"]=_.Q.ShadersStore[h+"PixelShader"].replace("#define CUSTOM_FRAGMENT_BEFORE_FOG",this.CustomParts.Fragment_Before_Fog)),this._isCreatedShader=!0,this._createdShaderName=h,h},t.prototype.AddUniform=function(e,t,i){return this._customUniform||(this._customUniform=new Array,this._newUniforms=new Array,this._newSamplerInstances={},this._newUniformInstances={}),i&&(-1!=t.indexOf("sampler")?this._newSamplerInstances[t+"-"+e]=i:this._newUniformInstances[t+"-"+e]=i),this._customUniform.push("uniform "+t+" "+e+";"),this._newUniforms.push(e),this},t.prototype.AddAttribute=function(e){return this._customAttributes||(this._customAttributes=[]),this._customAttributes.push(e),this},t.prototype.Fragment_Begin=function(e){return this.CustomParts.Fragment_Begin=e,this},t.prototype.Fragment_Definitions=function(e){return this.CustomParts.Fragment_Definitions=e,this},t.prototype.Fragment_MainBegin=function(e){return this.CustomParts.Fragment_MainBegin=e,this},t.prototype.Fragment_Custom_Albedo=function(e){return this.CustomParts.Fragment_Custom_Albedo=e.replace("result","surfaceAlbedo"),this},t.prototype.Fragment_Custom_Alpha=function(e){return this.CustomParts.Fragment_Custom_Alpha=e.replace("result","alpha"),this},t.prototype.Fragment_Before_Lights=function(e){return this.CustomParts.Fragment_Before_Lights=e,this},t.prototype.Fragment_Custom_MetallicRoughness=function(e){return this.CustomParts.Fragment_Custom_MetallicRoughness=e,this},t.prototype.Fragment_Custom_MicroSurface=function(e){return this.CustomParts.Fragment_Custom_MicroSurface=e,this},t.prototype.Fragment_Before_Fog=function(e){return this.CustomParts.Fragment_Before_Fog=e,this},t.prototype.Fragment_Before_FragColor=function(e){return this.CustomParts.Fragment_Before_FragColor=e.replace("result","color"),this},t.prototype.Vertex_Begin=function(e){return this.CustomParts.Vertex_Begin=e,this},t.prototype.Vertex_Definitions=function(e){return this.CustomParts.Vertex_Definitions=e,this},t.prototype.Vertex_MainBegin=function(e){return this.CustomParts.Vertex_MainBegin=e,this},t.prototype.Vertex_Before_PositionUpdated=function(e){return this.CustomParts.Vertex_Before_PositionUpdated=e.replace("result","positionUpdated"),this},t.prototype.Vertex_Before_NormalUpdated=function(e){return this.CustomParts.Vertex_Before_NormalUpdated=e.replace("result","normalUpdated"),this},t.prototype.Vertex_After_WorldPosComputed=function(e){return this.CustomParts.Vertex_After_WorldPosComputed=e,this},t.prototype.Vertex_MainEnd=function(e){return this.CustomParts.Vertex_MainEnd=e,this},t.ShaderIndexer=1,t}(x.Y);f.Q.RegisteredTypes["BABYLON.PBRCustomMaterial"]=T;var S=i(5356),O=i(1263);_.Q.ShadersStore.firePixelShader="precision highp float;\n\nuniform vec4 vEyePosition;\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n\nuniform sampler2D distortionSampler;\nuniform sampler2D opacitySampler;\n#ifdef DIFFUSE\nvarying vec2 vDistortionCoords1;\nvarying vec2 vDistortionCoords2;\nvarying vec2 vDistortionCoords3;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvec4 bx2(vec4 x)\n{\nreturn vec4(2.0)*x-vec4(1.0);\n}\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\n\nfloat alpha=1.0;\n#ifdef DIFFUSE\n\nconst float distortionAmount0=0.092;\nconst float distortionAmount1=0.092;\nconst float distortionAmount2=0.092;\nvec2 heightAttenuation=vec2(0.3,0.39);\nvec4 noise0=texture2D(distortionSampler,vDistortionCoords1);\nvec4 noise1=texture2D(distortionSampler,vDistortionCoords2);\nvec4 noise2=texture2D(distortionSampler,vDistortionCoords3);\nvec4 noiseSum=bx2(noise0)*distortionAmount0+bx2(noise1)*distortionAmount1+bx2(noise2)*distortionAmount2;\nvec4 perturbedBaseCoords=vec4(vDiffuseUV,0.0,1.0)+noiseSum*(vDiffuseUV.y*heightAttenuation.x+heightAttenuation.y);\nvec4 opacityColor=texture2D(opacitySampler,perturbedBaseCoords.xy);\n#ifdef ALPHATEST\nif (opacityColor.r<0.1)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor=texture2D(diffuseSampler,perturbedBaseCoords.xy)*2.0;\nbaseColor*=opacityColor;\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 diffuseBase=vec3(1.0,1.0,1.0);\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n\nvec4 color=vec4(baseColor.rgb,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}";_.Q.ShadersStore.fireVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n\nuniform float time;\nuniform float speed;\n#ifdef DIFFUSE\nvarying vec2 vDistortionCoords1;\nvarying vec2 vDistortionCoords2;\nvarying vec2 vDistortionCoords3;\n#endif\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n\n#ifdef DIFFUSE\nvDiffuseUV=uv;\nvDiffuseUV.y-=0.2;\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n#ifdef DIFFUSE\n\nvec3 layerSpeed=vec3(-0.2,-0.52,-0.1)*speed;\nvDistortionCoords1.x=uv.x;\nvDistortionCoords1.y=uv.y+layerSpeed.x*time/1000.0;\nvDistortionCoords2.x=uv.x;\nvDistortionCoords2.y=uv.y+layerSpeed.y*time/1000.0;\nvDistortionCoords3.x=uv.x;\nvDistortionCoords3.y=uv.y+layerSpeed.z*time/1000.0;\n#endif\n}\n";var E=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.UV1=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.BonesPerMesh=0,t.NUM_BONE_INFLUENCERS=0,t.INSTANCES=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.rebuild(),t}return(0,n.ZT)(t,e),t}(s.H),M=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.diffuseColor=new o.Wo(1,1,1),n.speed=1,n._scaledDiffuse=new o.Wo,n._lastTime=0,n}return(0,n.ZT)(t,e),t.prototype.needAlphaBlending=function(){return!1},t.prototype.needAlphaTesting=function(){return!0},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new E);var n=t._materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(n._areTexturesDirty&&(n._needUVs=!1,this._diffuseTexture&&h.k.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;n._needUVs=!0,n.DIFFUSE=!0}if(n.ALPHATEST=!!this._opacityTexture,n._areMiscDirty&&(n.POINTSIZE=this.pointsCloud||r.forcePointsCloud,n.FOG=r.fogEnabled&&e.applyFog&&r.fogMode!==c.x.FOGMODE_NONE&&this.fogEnabled),a.G.PrepareDefinesForFrameBoundValues(r,o,n,!!i),a.G.PrepareDefinesForAttributes(e,n,!1,!0),n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var s=new p.L;n.FOG&&s.addFallback(1,"FOG"),n.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,e),n.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var l=[u.o.PositionKind];n.UV1&&l.push(u.o.UVKind),n.VERTEXCOLOR&&l.push(u.o.ColorKind),a.G.PrepareAttributesForBones(l,e,n,s),a.G.PrepareAttributesForInstances(l,n);var f=n.toString();t.setEffect(r.getEngine().createEffect("fire",{attributes:l,uniformsNames:["world","view","viewProjection","vEyePosition","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","time","speed"],uniformBuffersNames:[],samplers:["diffuseSampler","distortionSampler","opacitySampler"],defines:f,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:null,maxSimultaneousLights:4,transformFeedbackVaryings:null},o),n,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n=this.getScene();if(i._materialDefines){var r=i.effect;r&&(this._activeEffect=r,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(n,r)&&(this._diffuseTexture&&h.k.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix()),this._activeEffect.setTexture("distortionSampler",this._distortionTexture),this._activeEffect.setTexture("opacitySampler",this._opacityTexture)),a.G.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),n.bindEyePosition(r)),this._activeEffect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*t.visibility),n.fogEnabled&&t.applyFog&&n.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),a.G.BindFogParameters(n,t,this._activeEffect),this._lastTime+=n.getEngine().getDeltaTime(),this._activeEffect.setFloat("time",this._lastTime),this._activeEffect.setFloat("speed",this.speed),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._distortionTexture&&this._distortionTexture.animations&&this._distortionTexture.animations.length>0&&e.push(this._distortionTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),this._distortionTexture&&t.push(this._distortionTexture),this._opacityTexture&&t.push(this._opacityTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this._diffuseTexture===t||this._distortionTexture===t||this._opacityTexture===t},t.prototype.getClassName=function(){return"FireMaterial"},t.prototype.dispose=function(t){this._diffuseTexture&&this._diffuseTexture.dispose(),this._distortionTexture&&this._distortionTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var i=this;return r.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var t=e.prototype.serialize.call(this);return t.customType="BABYLON.FireMaterial",t.diffuseColor=this.diffuseColor.asArray(),t.speed=this.speed,this._diffuseTexture&&(t._diffuseTexture=this._diffuseTexture.serialize()),this._distortionTexture&&(t._distortionTexture=this._distortionTexture.serialize()),this._opacityTexture&&(t._opacityTexture=this._opacityTexture.serialize()),t},t.Parse=function(e,i,n){var r=new t(e.name,i);return r.diffuseColor=o.Wo.FromArray(e.diffuseColor),r.speed=e.speed,r.alpha=e.alpha,r.id=e.id,S.$.AddTagsTo(r,e.tags),r.backFaceCulling=e.backFaceCulling,r.wireframe=e.wireframe,e._diffuseTexture&&(r._diffuseTexture=O.x.Parse(e._diffuseTexture,i,n)),e._distortionTexture&&(r._distortionTexture=O.x.Parse(e._distortionTexture,i,n)),e._opacityTexture&&(r._opacityTexture=O.x.Parse(e._opacityTexture,i,n)),r},(0,n.gn)([(0,r.oU)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),(0,n.gn)([(0,r.oU)("distortionTexture")],t.prototype,"_distortionTexture",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"distortionTexture",void 0),(0,n.gn)([(0,r.oU)("opacityTexture")],t.prototype,"_opacityTexture",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"opacityTexture",void 0),(0,n.gn)([(0,r.n9)("diffuse")],t.prototype,"diffuseColor",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"speed",void 0),t}(l.a);f.Q.RegisteredTypes["BABYLON.FireMaterial"]=M;var w=i(4471),I=i(7918);_.Q.ShadersStore.furPixelShader="precision highp float;\n\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nuniform vec4 furColor;\nuniform float furLength;\nvarying vec3 vPositionW;\nvarying float vfur_length;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n\n#ifdef HIGHLEVEL\nuniform float furOffset;\nuniform float furOcclusion;\nuniform sampler2D furTexture;\nvarying vec2 vFurUV;\n#endif\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<fogFragmentDeclaration>\n#include<clipPlaneFragmentDeclaration>\nfloat Rand(vec3 rv) {\nfloat x=dot(rv,vec3(12.9898,78.233,24.65487));\nreturn fract(sin(x)*43758.5453);\n}\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n\nvec4 baseColor=furColor;\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor*=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef HIGHLEVEL\n\nvec4 furTextureColor=texture2D(furTexture,vec2(vFurUV.x,vFurUV.y));\nif (furTextureColor.a<=0.0 || furTextureColor.g<furOffset) {\ndiscard;\n}\nfloat occlusion=mix(0.0,furTextureColor.b*1.2,furOffset);\nbaseColor=vec4(baseColor.xyz*max(occlusion,furOcclusion),1.1-furOffset);\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase.rgb*baseColor.rgb,0.0,1.0);\n\n#ifdef HIGHLEVEL\nvec4 color=vec4(finalDiffuse,alpha);\n#else\nfloat r=vfur_length/furLength*0.5;\nvec4 color=vec4(finalDiffuse*(0.5+r),alpha);\n#endif\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}";_.Q.ShadersStore.furVertexShader="precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\nuniform float furLength;\nuniform float furAngle;\n#ifdef HIGHLEVEL\nuniform float furOffset;\nuniform vec3 furGravity;\nuniform float furTime;\nuniform float furSpacing;\nuniform float furDensity;\n#endif\n#ifdef HEIGHTMAP\nuniform sampler2D heightTexture;\n#endif\n#ifdef HIGHLEVEL\nvarying vec2 vFurUV;\n#endif\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\nvarying float vfur_length;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nfloat Rand(vec3 rv) {\nfloat x=dot(rv,vec3(12.9898,78.233,24.65487));\nreturn fract(sin(x)*43758.5453);\n}\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\n\nfloat r=Rand(position);\n#ifdef HEIGHTMAP\n#if __VERSION__>100\nvfur_length=furLength*texture(heightTexture,uv).x;\n#else\nvfur_length=furLength*texture2D(heightTexture,uv).r;\n#endif\n#else\nvfur_length=(furLength*r);\n#endif\nvec3 tangent1=vec3(normal.y,-normal.x,0);\nvec3 tangent2=vec3(-normal.z,0,normal.x);\nr=Rand(tangent1*r);\nfloat J=(2.0+4.0*r);\nr=Rand(tangent2*r);\nfloat K=(2.0+2.0*r);\ntangent1=tangent1*J+tangent2*K;\ntangent1=normalize(tangent1);\nvec3 newPosition=position+normal*vfur_length*cos(furAngle)+tangent1*vfur_length*sin(furAngle);\n#ifdef HIGHLEVEL\n\nvec3 forceDirection=vec3(0.0,0.0,0.0);\nforceDirection.x=sin(furTime+position.x*0.05)*0.2;\nforceDirection.y=cos(furTime*0.7+position.y*0.04)*0.2;\nforceDirection.z=sin(furTime*0.7+position.z*0.04)*0.2;\nvec3 displacement=vec3(0.0,0.0,0.0);\ndisplacement=furGravity+forceDirection;\nfloat displacementFactor=pow(furOffset,3.0);\nvec3 aNormal=normal;\naNormal.xyz+=displacement*displacementFactor;\nnewPosition=vec3(newPosition.x,newPosition.y,newPosition.z)+(normalize(aNormal)*furOffset*furSpacing);\n#endif\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\ngl_Position=viewProjection*finalWorld*vec4(newPosition,1.0);\nvec4 worldPos=finalWorld*vec4(newPosition,1.0);\nvPositionW=vec3(worldPos);\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#ifdef HIGHLEVEL\nvFurUV=vDiffuseUV*furDensity;\n#endif\n#else\n#ifdef HIGHLEVEL\nvFurUV=uv*furDensity;\n#endif\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";var A=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.HEIGHTMAP=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.HIGHLEVEL=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.rebuild(),t}return(0,n.ZT)(t,e),t}(s.H),F=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.diffuseColor=new o.Wo(1,1,1),n.furLength=1,n.furAngle=0,n.furColor=new o.Wo(.44,.21,.02),n.furOffset=0,n.furSpacing=12,n.furGravity=new w.P(0,0,0),n.furSpeed=100,n.furDensity=20,n.furOcclusion=0,n._disableLighting=!1,n._maxSimultaneousLights=4,n.highLevelFur=!0,n._furTime=0,n}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"furTime",{get:function(){return this._furTime},set:function(e){this._furTime=e},enumerable:!1,configurable:!0}),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.updateFur=function(){for(var e=1;e<this._meshes.length;e++){var t=this._meshes[e].material;t.furLength=this.furLength,t.furAngle=this.furAngle,t.furGravity=this.furGravity,t.furSpacing=this.furSpacing,t.furSpeed=this.furSpeed,t.furColor=this.furColor,t.diffuseTexture=this.diffuseTexture,t.furTexture=this.furTexture,t.highLevelFur=this.highLevelFur,t.furTime=this.furTime,t.furDensity=this.furDensity}},t.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new A);var n=t._materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(n._areTexturesDirty&&r.texturesEnabled){if(this.diffuseTexture&&h.k.DiffuseTextureEnabled){if(!this.diffuseTexture.isReady())return!1;n._needUVs=!0,n.DIFFUSE=!0}if(this.heightTexture&&o.getCaps().maxVertexTextureImageUnits){if(!this.heightTexture.isReady())return!1;n._needUVs=!0,n.HEIGHTMAP=!0}}if(this.highLevelFur!==n.HIGHLEVEL&&(n.HIGHLEVEL=!0,n.markAsUnprocessed()),a.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),n),n._needNormals=a.G.PrepareDefinesForLights(r,e,n,!1,this._maxSimultaneousLights,this._disableLighting),a.G.PrepareDefinesForFrameBoundValues(r,o,n,!!i),a.G.PrepareDefinesForAttributes(e,n,!0,!0),n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var s=new p.L;n.FOG&&s.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(n,s,this.maxSimultaneousLights),n.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,e),n.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var l=[u.o.PositionKind];n.NORMAL&&l.push(u.o.NormalKind),n.UV1&&l.push(u.o.UVKind),n.UV2&&l.push(u.o.UV2Kind),n.VERTEXCOLOR&&l.push(u.o.ColorKind),a.G.PrepareAttributesForBones(l,e,n,s),a.G.PrepareAttributesForInstances(l,n);var c=n.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","furLength","furAngle","furColor","furOffset","furGravity","furTime","furSpacing","furDensity","furOcclusion"],_=["diffuseSampler","heightTexture","furTexture"],d=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:d,samplers:_,defines:n,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("fur",{attributes:l,uniformsNames:f,uniformBuffersNames:d,samplers:_,defines:c,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},o),n,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n=this.getScene(),r=i._materialDefines;if(r){var o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),n.getCachedMaterial()!==this&&(this._diffuseTexture&&h.k.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),this._heightTexture&&this._activeEffect.setTexture("heightTexture",this._heightTexture),a.G.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),n.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),n.lightsEnabled&&!this.disableLighting&&a.G.BindLights(n,t,this._activeEffect,r,this.maxSimultaneousLights),n.fogEnabled&&t.applyFog&&n.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),a.G.BindFogParameters(n,t,this._activeEffect),this._activeEffect.setFloat("furLength",this.furLength),this._activeEffect.setFloat("furAngle",this.furAngle),this._activeEffect.setColor4("furColor",this.furColor,1),this.highLevelFur&&(this._activeEffect.setVector3("furGravity",this.furGravity),this._activeEffect.setFloat("furOffset",this.furOffset),this._activeEffect.setFloat("furSpacing",this.furSpacing),this._activeEffect.setFloat("furDensity",this.furDensity),this._activeEffect.setFloat("furOcclusion",this.furOcclusion),this._furTime+=this.getScene().getEngine().getDeltaTime()/this.furSpeed,this._activeEffect.setFloat("furTime",this._furTime),this._activeEffect.setTexture("furTexture",this.furTexture)),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),this.heightTexture&&this.heightTexture.animations&&this.heightTexture.animations.length>0&&e.push(this.heightTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),this._heightTexture&&t.push(this._heightTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this.diffuseTexture===t||this._heightTexture===t},t.prototype.dispose=function(t){if(this.diffuseTexture&&this.diffuseTexture.dispose(),this._meshes)for(var i=1;i<this._meshes.length;i++){var n=this._meshes[i].material;n&&n.dispose(t),this._meshes[i].dispose()}e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var i=this;return r.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var e=r.p4.Serialize(this);return e.customType="BABYLON.FurMaterial",this._meshes&&(e.sourceMeshName=this._meshes[0].name,e.quality=this._meshes.length),e},t.prototype.getClassName=function(){return"FurMaterial"},t.Parse=function(e,i,n){var o=r.p4.Parse((function(){return new t(e.name,i)}),e,i,n);return e.sourceMeshName&&o.highLevelFur&&i.executeWhenReady((function(){var n=i.getMeshByName(e.sourceMeshName);if(n){var r=t.GenerateTexture("Fur Texture",i);o.furTexture=r,t.FurifyMesh(n,e.quality)}})),o},t.GenerateTexture=function(e,t){for(var i=new I.c("FurTexture "+e,256,t,!0),n=i.getContext(),r=0;r<2e4;++r)n.fillStyle="rgba(255, "+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+", 1)",n.fillRect(Math.random()*i.getSize().width,Math.random()*i.getSize().height,2,2);return i.update(!1),i.wrapU=O.x.WRAP_ADDRESSMODE,i.wrapV=O.x.WRAP_ADDRESSMODE,i},t.FurifyMesh=function(e,i){var n,r=[e],o=e.material;if(!(o instanceof t))throw"The material of the source mesh must be a Fur Material";for(n=1;n<i;n++){var s=new t(o.name+n,e.getScene());e.getScene().materials.pop(),S.$.EnableFor(s),S.$.AddTagsTo(s,"furShellMaterial"),s.furLength=o.furLength,s.furAngle=o.furAngle,s.furGravity=o.furGravity,s.furSpacing=o.furSpacing,s.furSpeed=o.furSpeed,s.furColor=o.furColor,s.diffuseTexture=o.diffuseTexture,s.furOffset=n/i,s.furTexture=o.furTexture,s.highLevelFur=o.highLevelFur,s.furTime=o.furTime,s.furDensity=o.furDensity;var a=e.clone(e.name+n);a.material=s,a.skeleton=e.skeleton,a.position=w.P.Zero(),r.push(a)}for(n=1;n<r.length;n++)r[n].parent=e;return e.material._meshes=r,r},(0,n.gn)([(0,r.oU)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),(0,n.gn)([(0,r.oU)("heightTexture")],t.prototype,"_heightTexture",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"heightTexture",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"diffuseColor",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"furLength",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"furAngle",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"furColor",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"furOffset",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"furSpacing",void 0),(0,n.gn)([(0,r.hd)()],t.prototype,"furGravity",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"furSpeed",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"furDensity",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"furOcclusion",void 0),(0,n.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,n.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"highLevelFur",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"furTime",null),t}(l.a);f.Q.RegisteredTypes["BABYLON.FurMaterial"]=F;_.Q.ShadersStore.gradientPixelShader="precision highp float;\n\nuniform vec4 vEyePosition;\n\nuniform vec4 topColor;\nuniform vec4 bottomColor;\nuniform float offset;\nuniform float scale;\nuniform float smoothness;\n\nvarying vec3 vPositionW;\nvarying vec3 vPosition;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0]\n#include<__decl__lightFragment>[1]\n#include<__decl__lightFragment>[2]\n#include<__decl__lightFragment>[3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\nfloat h=vPosition.y*scale+offset;\nfloat mysmoothness=clamp(smoothness,0.01,max(smoothness,10.));\nvec4 baseColor=mix(bottomColor,topColor,max(pow(max(h,0.0),mysmoothness),0.0));\n\nvec3 diffuseColor=baseColor.rgb;\n\nfloat alpha=baseColor.a;\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\n#ifdef EMISSIVE\nvec3 diffuseBase=baseColor.rgb;\n#else\nvec3 diffuseBase=vec3(0.,0.,0.);\n#endif\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}\n";_.Q.ShadersStore.gradientVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\nvarying vec3 vPosition;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\nvPosition=position;\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";var L=function(e){function t(){var t=e.call(this)||this;return t.EMISSIVE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.rebuild(),t}return(0,n.ZT)(t,e),t}(s.H),D=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._maxSimultaneousLights=4,n.topColor=new o.Wo(1,0,0),n.topColorAlpha=1,n.bottomColor=new o.Wo(0,0,1),n.bottomColorAlpha=1,n.offset=0,n.scale=1,n.smoothness=1,n._disableLighting=!1,n}return(0,n.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1||this.topColorAlpha<1||this.bottomColorAlpha<1},t.prototype.needAlphaTesting=function(){return!0},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new L);var n=t._materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(a.G.PrepareDefinesForFrameBoundValues(r,o,n,!!i),a.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),n),n._needNormals=a.G.PrepareDefinesForLights(r,e,n,!1,this._maxSimultaneousLights,this._disableLighting),n.EMISSIVE=this._disableLighting,a.G.PrepareDefinesForAttributes(e,n,!1,!0),n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var s=new p.L;n.FOG&&s.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(n,s),n.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,e),n.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var l=[u.o.PositionKind];n.NORMAL&&l.push(u.o.NormalKind),n.UV1&&l.push(u.o.UVKind),n.UV2&&l.push(u.o.UV2Kind),n.VERTEXCOLOR&&l.push(u.o.ColorKind),a.G.PrepareAttributesForBones(l,e,n,s),a.G.PrepareAttributesForInstances(l,n);var h=n.toString(),c=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","topColor","bottomColor","offset","smoothness","scale"],f=[],_=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:c,uniformBuffersNames:_,samplers:f,defines:n,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect("gradient",{attributes:l,uniformsNames:c,uniformBuffersNames:_,samplers:f,defines:h,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),n,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n=this.getScene(),r=i._materialDefines;if(r){var o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),a.G.BindBonesParameters(t,o),this._mustRebind(n,o)&&(a.G.BindClipPlane(o,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),n.bindEyePosition(o)),n.lightsEnabled&&!this.disableLighting&&a.G.BindLights(n,t,this._activeEffect,r,this.maxSimultaneousLights),n.fogEnabled&&t.applyFog&&n.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),a.G.BindFogParameters(n,t,this._activeEffect),this._activeEffect.setColor4("topColor",this.topColor,this.topColorAlpha),this._activeEffect.setColor4("bottomColor",this.bottomColor,this.bottomColorAlpha),this._activeEffect.setFloat("offset",this.offset),this._activeEffect.setFloat("scale",this.scale),this._activeEffect.setFloat("smoothness",this.smoothness),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){return[]},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var i=this;return r.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var e=r.p4.Serialize(this);return e.customType="BABYLON.GradientMaterial",e},t.prototype.getClassName=function(){return"GradientMaterial"},t.Parse=function(e,i,n){return r.p4.Parse((function(){return new t(e.name,i)}),e,i,n)},(0,n.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"topColor",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"topColorAlpha",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"bottomColor",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"bottomColorAlpha",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"offset",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"scale",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"smoothness",void 0),(0,n.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),t}(l.a);f.Q.RegisteredTypes["BABYLON.GradientMaterial"]=D;_.Q.ShadersStore.gridPixelShader="#extension GL_OES_standard_derivatives : enable\n#define SQRT2 1.41421356\n#define PI 3.14159\nprecision highp float;\nuniform float visibility;\nuniform vec3 mainColor;\nuniform vec3 lineColor;\nuniform vec4 gridControl;\nuniform vec3 gridOffset;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#include<fogFragmentDeclaration>\n\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\nfloat getDynamicVisibility(float position) {\n\nfloat majorGridFrequency=gridControl.y;\nif (floor(position+0.5) == floor(position/majorGridFrequency+0.5)*majorGridFrequency)\n{\nreturn 1.0;\n}\nreturn gridControl.z;\n}\nfloat getAnisotropicAttenuation(float differentialLength) {\nconst float maxNumberOfLines=10.0;\nreturn clamp(1.0/(differentialLength+1.0)-1.0/maxNumberOfLines,0.0,1.0);\n}\nfloat isPointOnLine(float position,float differentialLength) {\nfloat fractionPartOfPosition=position-floor(position+0.5);\nfractionPartOfPosition/=differentialLength;\nfractionPartOfPosition=clamp(fractionPartOfPosition,-1.,1.);\nfloat result=0.5+0.5*cos(fractionPartOfPosition*PI);\nreturn result;\n}\nfloat contributionOnAxis(float position) {\nfloat differentialLength=length(vec2(dFdx(position),dFdy(position)));\ndifferentialLength*=SQRT2;\n\nfloat result=isPointOnLine(position,differentialLength);\n\nfloat dynamicVisibility=getDynamicVisibility(position);\nresult*=dynamicVisibility;\n\nfloat anisotropicAttenuation=getAnisotropicAttenuation(differentialLength);\nresult*=anisotropicAttenuation;\nreturn result;\n}\nfloat normalImpactOnAxis(float x) {\nfloat normalImpact=clamp(1.0-3.0*abs(x*x*x),0.0,1.0);\nreturn normalImpact;\n}\nvoid main(void) {\n\nfloat gridRatio=gridControl.x;\nvec3 gridPos=(vPosition+gridOffset.xyz)/gridRatio;\n\nfloat x=contributionOnAxis(gridPos.x);\nfloat y=contributionOnAxis(gridPos.y);\nfloat z=contributionOnAxis(gridPos.z);\n\nvec3 normal=normalize(vNormal);\nx*=normalImpactOnAxis(normal.x);\ny*=normalImpactOnAxis(normal.y);\nz*=normalImpactOnAxis(normal.z);\n\nfloat grid=clamp(x+y+z,0.,1.);\n\nvec3 color=mix(mainColor,lineColor,grid);\n#ifdef FOG\n#include<fogFragment>\n#endif\nfloat opacity=1.0;\n#ifdef TRANSPARENT\nopacity=clamp(grid,0.08,gridControl.w*grid);\n#endif\n#ifdef OPACITY\nopacity*=texture2D(opacitySampler,vOpacityUV).a;\n#endif\n\ngl_FragColor=vec4(color.rgb,opacity*visibility);\n#ifdef TRANSPARENT\n#ifdef PREMULTIPLYALPHA\ngl_FragColor.rgb*=opacity;\n#endif\n#else\n#endif\n#include<imageProcessingCompatibility>\n}";_.Q.ShadersStore.gridVertexShader="precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#include<instancesDeclaration>\n\nuniform mat4 projection;\nuniform mat4 view;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#include<fogVertexDeclaration>\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\nvoid main(void) {\n#include<instancesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#include<fogVertex>\nvec4 cameraSpacePosition=view*worldPos;\ngl_Position=projection*cameraSpacePosition;\n#ifdef OPACITY\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\nvPosition=position;\nvNormal=normal;\n}";var R=function(e){function t(){var t=e.call(this)||this;return t.OPACITY=!1,t.TRANSPARENT=!1,t.FOG=!1,t.PREMULTIPLYALPHA=!1,t.UV1=!1,t.UV2=!1,t.INSTANCES=!1,t.THIN_INSTANCES=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.rebuild(),t}return(0,n.ZT)(t,e),t}(s.H),B=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.mainColor=o.Wo.Black(),n.lineColor=o.Wo.Teal(),n.gridRatio=1,n.gridOffset=w.P.Zero(),n.majorUnitFrequency=10,n.minorUnitVisibility=.33,n.opacity=1,n.preMultiplyAlpha=!1,n._gridControl=new w.Lt(n.gridRatio,n.majorUnitFrequency,n.minorUnitVisibility,n.opacity),n}return(0,n.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.opacity<1||this._opacityTexture&&this._opacityTexture.isReady()},t.prototype.needAlphaBlendingForMesh=function(e){return e.visibility<1||this.needAlphaBlending()},t.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new R);var n=t._materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;if(n.TRANSPARENT!==this.opacity<1&&(n.TRANSPARENT=!n.TRANSPARENT,n.markAsUnprocessed()),n.PREMULTIPLYALPHA!=this.preMultiplyAlpha&&(n.PREMULTIPLYALPHA=!n.PREMULTIPLYALPHA,n.markAsUnprocessed()),n._areTexturesDirty&&(n._needUVs=!1,r.texturesEnabled&&this._opacityTexture&&h.k.OpacityTextureEnabled)){if(!this._opacityTexture.isReady())return!1;n._needUVs=!0,n.OPACITY=!0}if(a.G.PrepareDefinesForMisc(e,r,!1,!1,this.fogEnabled,!1,n),a.G.PrepareDefinesForFrameBoundValues(r,r.getEngine(),n,!!i),n.isDirty){n.markAsProcessed(),r.resetCachedMaterial(),a.G.PrepareDefinesForAttributes(e,n,!1,!1);var o=[u.o.PositionKind,u.o.NormalKind];n.UV1&&o.push(u.o.UVKind),n.UV2&&o.push(u.o.UV2Kind),n.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess,a.G.PrepareAttributesForInstances(o,n);var s=n.toString();t.setEffect(r.getEngine().createEffect("grid",o,["projection","mainColor","lineColor","gridControl","gridOffset","vFogInfos","vFogColor","world","view","opacityMatrix","vOpacityInfos","visibility"],["opacitySampler"],s,void 0,this.onCompiled,this.onError),n,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n=this.getScene(),r=i._materialDefines;if(r){var o=i.effect;o&&(this._activeEffect=o,this._activeEffect.setFloat("visibility",t.visibility),r.INSTANCES&&!r.THIN_INSTANCE||this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("view",n.getViewMatrix()),this._activeEffect.setMatrix("projection",n.getProjectionMatrix()),this._mustRebind(n,o)&&(this._activeEffect.setColor3("mainColor",this.mainColor),this._activeEffect.setColor3("lineColor",this.lineColor),this._activeEffect.setVector3("gridOffset",this.gridOffset),this._gridControl.x=this.gridRatio,this._gridControl.y=Math.round(this.majorUnitFrequency),this._gridControl.z=this.minorUnitVisibility,this._gridControl.w=this.opacity,this._activeEffect.setVector4("gridControl",this._gridControl),this._opacityTexture&&h.k.OpacityTextureEnabled&&(this._activeEffect.setTexture("opacitySampler",this._opacityTexture),this._activeEffect.setFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),this._activeEffect.setMatrix("opacityMatrix",this._opacityTexture.getTextureMatrix()))),a.G.BindFogParameters(n,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var i=this;return r.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var e=r.p4.Serialize(this);return e.customType="BABYLON.GridMaterial",e},t.prototype.getClassName=function(){return"GridMaterial"},t.Parse=function(e,i,n){return r.p4.Parse((function(){return new t(e.name,i)}),e,i,n)},(0,n.gn)([(0,r.n9)()],t.prototype,"mainColor",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"lineColor",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"gridRatio",void 0),(0,n.gn)([(0,r.hd)()],t.prototype,"gridOffset",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"majorUnitFrequency",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"minorUnitVisibility",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"opacity",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"preMultiplyAlpha",void 0),(0,n.gn)([(0,r.oU)("opacityTexture")],t.prototype,"_opacityTexture",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"opacityTexture",void 0),t}(l.a);f.Q.RegisteredTypes["BABYLON.GridMaterial"]=B;_.Q.ShadersStore.lavaPixelShader="precision highp float;\n\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nvarying vec3 vPositionW;\n\nuniform float time;\nuniform float speed;\nuniform float movingSpeed;\nuniform vec3 fogColor;\nuniform sampler2D noiseTexture;\nuniform float fogDensity;\n\nvarying float noise;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0]\n#include<__decl__lightFragment>[1]\n#include<__decl__lightFragment>[2]\n#include<__decl__lightFragment>[3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nfloat random( vec3 scale,float seed ){\nreturn fract( sin( dot( gl_FragCoord.xyz+seed,scale ) )*43758.5453+seed ) ;\n}\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\n\nvec4 noiseTex=texture2D( noiseTexture,vDiffuseUV );\nvec2 T1=vDiffuseUV+vec2( 1.5,-1.5 )*time*0.02;\nvec2 T2=vDiffuseUV+vec2( -0.5,2.0 )*time*0.01*speed;\nT1.x+=noiseTex.x*2.0;\nT1.y+=noiseTex.y*2.0;\nT2.x-=noiseTex.y*0.2+time*0.001*movingSpeed;\nT2.y+=noiseTex.z*0.2+time*0.002*movingSpeed;\nfloat p=texture2D( noiseTexture,T1*3.0 ).a;\nvec4 lavaColor=texture2D( diffuseSampler,T2*4.0);\nvec4 temp=lavaColor*( vec4( p,p,p,p )*2. )+( lavaColor*lavaColor-0.1 );\nbaseColor=temp;\nfloat depth=gl_FragCoord.z*4.0;\nconst float LOG2=1.442695;\nfloat fogFactor=exp2(-fogDensity*fogDensity*depth*depth*LOG2 );\nfogFactor=1.0-clamp( fogFactor,0.0,1.0 );\nbaseColor=mix( baseColor,vec4( fogColor,baseColor.w ),fogFactor );\ndiffuseColor=baseColor.rgb;\n\n\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0]\n#include<lightFragment>[1]\n#include<lightFragment>[2]\n#include<lightFragment>[3]\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}";_.Q.ShadersStore.lavaVertexShader="precision highp float;\n\nuniform float time;\nuniform float lowFrequencySpeed;\n\nvarying float noise;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n\n\nvec3 mod289(vec3 x)\n{\nreturn x-floor(x*(1.0/289.0))*289.0;\n}\nvec4 mod289(vec4 x)\n{\nreturn x-floor(x*(1.0/289.0))*289.0;\n}\nvec4 permute(vec4 x)\n{\nreturn mod289(((x*34.0)+1.0)*x);\n}\nvec4 taylorInvSqrt(vec4 r)\n{\nreturn 1.79284291400159-0.85373472095314*r;\n}\nvec3 fade(vec3 t) {\nreturn t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\nfloat pnoise(vec3 P,vec3 rep)\n{\nvec3 Pi0=mod(floor(P),rep);\nvec3 Pi1=mod(Pi0+vec3(1.0),rep);\nPi0=mod289(Pi0);\nPi1=mod289(Pi1);\nvec3 Pf0=fract(P);\nvec3 Pf1=Pf0-vec3(1.0);\nvec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);\nvec4 iy=vec4(Pi0.yy,Pi1.yy);\nvec4 iz0=Pi0.zzzz;\nvec4 iz1=Pi1.zzzz;\nvec4 ixy=permute(permute(ix)+iy);\nvec4 ixy0=permute(ixy+iz0);\nvec4 ixy1=permute(ixy+iz1);\nvec4 gx0=ixy0*(1.0/7.0);\nvec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;\ngx0=fract(gx0);\nvec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);\nvec4 sz0=step(gz0,vec4(0.0));\ngx0-=sz0*(step(0.0,gx0)-0.5);\ngy0-=sz0*(step(0.0,gy0)-0.5);\nvec4 gx1=ixy1*(1.0/7.0);\nvec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;\ngx1=fract(gx1);\nvec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);\nvec4 sz1=step(gz1,vec4(0.0));\ngx1-=sz1*(step(0.0,gx1)-0.5);\ngy1-=sz1*(step(0.0,gy1)-0.5);\nvec3 g000=vec3(gx0.x,gy0.x,gz0.x);\nvec3 g100=vec3(gx0.y,gy0.y,gz0.y);\nvec3 g010=vec3(gx0.z,gy0.z,gz0.z);\nvec3 g110=vec3(gx0.w,gy0.w,gz0.w);\nvec3 g001=vec3(gx1.x,gy1.x,gz1.x);\nvec3 g101=vec3(gx1.y,gy1.y,gz1.y);\nvec3 g011=vec3(gx1.z,gy1.z,gz1.z);\nvec3 g111=vec3(gx1.w,gy1.w,gz1.w);\nvec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));\ng000*=norm0.x;\ng010*=norm0.y;\ng100*=norm0.z;\ng110*=norm0.w;\nvec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));\ng001*=norm1.x;\ng011*=norm1.y;\ng101*=norm1.z;\ng111*=norm1.w;\nfloat n000=dot(g000,Pf0);\nfloat n100=dot(g100,vec3(Pf1.x,Pf0.yz));\nfloat n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));\nfloat n110=dot(g110,vec3(Pf1.xy,Pf0.z));\nfloat n001=dot(g001,vec3(Pf0.xy,Pf1.z));\nfloat n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));\nfloat n011=dot(g011,vec3(Pf0.x,Pf1.yz));\nfloat n111=dot(g111,Pf1);\nvec3 fade_xyz=fade(Pf0);\nvec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);\nvec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);\nfloat n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);\nreturn 2.2*n_xyz;\n}\n\nfloat turbulence( vec3 p ) {\nfloat w=100.0;\nfloat t=-.5;\nfor (float f=1.0 ; f<=10.0 ; f++ ){\nfloat power=pow( 2.0,f );\nt+=abs( pnoise( vec3( power*p ),vec3( 10.0,10.0,10.0 ) )/power );\n}\nreturn t;\n}\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\n#ifdef NORMAL\n\nnoise=10.0*-.10*turbulence( .5*normal+time*1.15 );\n\nfloat b=lowFrequencySpeed*5.0*pnoise( 0.05*position +vec3(time*1.025),vec3( 100.0 ) );\n\nfloat displacement =-1.5*noise+b;\n\nvec3 newPosition=position+normal*displacement;\ngl_Position=viewProjection*finalWorld*vec4( newPosition,1.0 );\nvec4 worldPos=finalWorld*vec4(newPosition,1.0);\nvPositionW=vec3(worldPos);\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}";var N=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.LIGHT0=!1,t.LIGHT1=!1,t.LIGHT2=!1,t.LIGHT3=!1,t.SPOTLIGHT0=!1,t.SPOTLIGHT1=!1,t.SPOTLIGHT2=!1,t.SPOTLIGHT3=!1,t.HEMILIGHT0=!1,t.HEMILIGHT1=!1,t.HEMILIGHT2=!1,t.HEMILIGHT3=!1,t.DIRLIGHT0=!1,t.DIRLIGHT1=!1,t.DIRLIGHT2=!1,t.DIRLIGHT3=!1,t.POINTLIGHT0=!1,t.POINTLIGHT1=!1,t.POINTLIGHT2=!1,t.POINTLIGHT3=!1,t.SHADOW0=!1,t.SHADOW1=!1,t.SHADOW2=!1,t.SHADOW3=!1,t.SHADOWS=!1,t.SHADOWESM0=!1,t.SHADOWESM1=!1,t.SHADOWESM2=!1,t.SHADOWESM3=!1,t.SHADOWPOISSON0=!1,t.SHADOWPOISSON1=!1,t.SHADOWPOISSON2=!1,t.SHADOWPOISSON3=!1,t.SHADOWPCF0=!1,t.SHADOWPCF1=!1,t.SHADOWPCF2=!1,t.SHADOWPCF3=!1,t.SHADOWPCSS0=!1,t.SHADOWPCSS1=!1,t.SHADOWPCSS2=!1,t.SHADOWPCSS3=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.UNLIT=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.rebuild(),t}return(0,n.ZT)(t,e),t}(s.H),k=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.speed=1,n.movingSpeed=1,n.lowFrequencySpeed=1,n.fogDensity=.15,n._lastTime=0,n.diffuseColor=new o.Wo(1,1,1),n._disableLighting=!1,n._unlit=!1,n._maxSimultaneousLights=4,n._scaledDiffuse=new o.Wo,n}return(0,n.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new N);var n=t._materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(n._areTexturesDirty&&(n._needUVs=!1,r.texturesEnabled&&this._diffuseTexture&&h.k.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;n._needUVs=!0,n.DIFFUSE=!0}if(a.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),n),n._needNormals=!0,a.G.PrepareDefinesForLights(r,e,n,!1,this._maxSimultaneousLights,this._disableLighting),a.G.PrepareDefinesForFrameBoundValues(r,o,n,!!i),a.G.PrepareDefinesForAttributes(e,n,!0,!0),n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var s=new p.L;n.FOG&&s.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(n,s),n.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,e),n.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var l=[u.o.PositionKind];n.NORMAL&&l.push(u.o.NormalKind),n.UV1&&l.push(u.o.UVKind),n.UV2&&l.push(u.o.UV2Kind),n.VERTEXCOLOR&&l.push(u.o.ColorKind),a.G.PrepareAttributesForBones(l,e,n,s),a.G.PrepareAttributesForInstances(l,n);var c=n.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","time","speed","movingSpeed","fogColor","fogDensity","lowFrequencySpeed"],_=["diffuseSampler","noiseTexture"],d=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:d,samplers:_,defines:n,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("lava",{attributes:l,uniformsNames:f,uniformBuffersNames:d,samplers:_,defines:c,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},o),n,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n=this.getScene(),r=i._materialDefines;if(r){var s=i.effect;s&&(this._activeEffect=s,r.UNLIT=this._unlit,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(n,s)&&(this.diffuseTexture&&h.k.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this.diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),this.noiseTexture&&this._activeEffect.setTexture("noiseTexture",this.noiseTexture),a.G.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),n.bindEyePosition(s)),this._activeEffect.setColor4("vDiffuseColor",this._scaledDiffuse,this.alpha*t.visibility),n.lightsEnabled&&!this.disableLighting&&a.G.BindLights(n,t,this._activeEffect,r),n.fogEnabled&&t.applyFog&&n.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),a.G.BindFogParameters(n,t,this._activeEffect),this._lastTime+=n.getEngine().getDeltaTime(),this._activeEffect.setFloat("time",this._lastTime*this.speed/1e3),this.fogColor||(this.fogColor=o.Wo.Black()),this._activeEffect.setColor3("fogColor",this.fogColor),this._activeEffect.setFloat("fogDensity",this.fogDensity),this._activeEffect.setFloat("lowFrequencySpeed",this.lowFrequencySpeed),this._activeEffect.setFloat("movingSpeed",this.movingSpeed),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),this.noiseTexture&&this.noiseTexture.animations&&this.noiseTexture.animations.length>0&&e.push(this.noiseTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this.diffuseTexture===t},t.prototype.dispose=function(t){this.diffuseTexture&&this.diffuseTexture.dispose(),this.noiseTexture&&this.noiseTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var i=this;return r.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var e=r.p4.Serialize(this);return e.customType="BABYLON.LavaMaterial",e},t.prototype.getClassName=function(){return"LavaMaterial"},t.Parse=function(e,i,n){return r.p4.Parse((function(){return new t(e.name,i)}),e,i,n)},(0,n.gn)([(0,r.oU)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),(0,n.gn)([(0,r.oU)()],t.prototype,"noiseTexture",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"fogColor",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"speed",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"movingSpeed",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"lowFrequencySpeed",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"fogDensity",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"diffuseColor",void 0),(0,n.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,n.gn)([(0,r.qC)("unlit")],t.prototype,"_unlit",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"unlit",void 0),(0,n.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(l.a);f.Q.RegisteredTypes["BABYLON.LavaMaterial"]=k;_.Q.ShadersStore.mixPixelShader="precision highp float;\n\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;\nuniform sampler2D mixMap1Sampler;\nuniform vec2 vTextureInfos;\n#ifdef MIXMAP2\nuniform sampler2D mixMap2Sampler;\n#endif\nuniform sampler2D diffuse1Sampler;\nuniform sampler2D diffuse2Sampler;\nuniform sampler2D diffuse3Sampler;\nuniform sampler2D diffuse4Sampler;\nuniform vec2 diffuse1Infos;\nuniform vec2 diffuse2Infos;\nuniform vec2 diffuse3Infos;\nuniform vec2 diffuse4Infos;\n#ifdef MIXMAP2\nuniform sampler2D diffuse5Sampler;\nuniform sampler2D diffuse6Sampler;\nuniform sampler2D diffuse7Sampler;\nuniform sampler2D diffuse8Sampler;\nuniform vec2 diffuse5Infos;\nuniform vec2 diffuse6Infos;\nuniform vec2 diffuse7Infos;\nuniform vec2 diffuse8Infos;\n#endif\n#endif\n\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n\nvec4 finalMixColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n#ifdef MIXMAP2\nvec4 mixColor2=vec4(1.,1.,1.,1.);\n#endif\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef DIFFUSE\nvec4 mixColor=texture2D(mixMap1Sampler,vTextureUV);\n#include<depthPrePass>\nmixColor.rgb*=vTextureInfos.y;\nvec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);\nvec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);\nvec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);\nvec4 diffuse4Color=texture2D(diffuse4Sampler,vTextureUV*diffuse4Infos);\ndiffuse1Color.rgb*=mixColor.r;\ndiffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,mixColor.g);\ndiffuse3Color.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,mixColor.b);\nfinalMixColor.rgb=mix(diffuse3Color.rgb,diffuse4Color.rgb,1.0-mixColor.a);\n#ifdef MIXMAP2\nmixColor=texture2D(mixMap2Sampler,vTextureUV);\nmixColor.rgb*=vTextureInfos.y;\nvec4 diffuse5Color=texture2D(diffuse5Sampler,vTextureUV*diffuse5Infos);\nvec4 diffuse6Color=texture2D(diffuse6Sampler,vTextureUV*diffuse6Infos);\nvec4 diffuse7Color=texture2D(diffuse7Sampler,vTextureUV*diffuse7Infos);\nvec4 diffuse8Color=texture2D(diffuse8Sampler,vTextureUV*diffuse8Infos);\ndiffuse5Color.rgb=mix(finalMixColor.rgb,diffuse5Color.rgb,mixColor.r);\ndiffuse6Color.rgb=mix(diffuse5Color.rgb,diffuse6Color.rgb,mixColor.g);\ndiffuse7Color.rgb=mix(diffuse6Color.rgb,diffuse7Color.rgb,mixColor.b);\nfinalMixColor.rgb=mix(diffuse7Color.rgb,diffuse8Color.rgb,1.0-mixColor.a);\n#endif\n#endif\n#ifdef VERTEXCOLOR\nfinalMixColor.rgb*=vColor.rgb;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor*finalMixColor.rgb,0.0,1.0);\n\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}\n";_.Q.ShadersStore.mixVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;\nuniform mat4 textureMatrix;\nuniform vec2 vTextureInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vTextureInfos.x == 0.)\n{\nvTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";var V=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.MIXMAP2=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.rebuild(),t}return(0,n.ZT)(t,e),t}(s.H),U=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.diffuseColor=new o.Wo(1,1,1),n.specularColor=new o.Wo(0,0,0),n.specularPower=64,n._disableLighting=!1,n._maxSimultaneousLights=4,n}return(0,n.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new V);var n=t._materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(r.texturesEnabled){if(!this._mixTexture1||!this._mixTexture1.isReady())return!1;if(n._needUVs=!0,h.k.DiffuseTextureEnabled){if(!this._diffuseTexture1||!this._diffuseTexture1.isReady())return!1;if(n.DIFFUSE=!0,!this._diffuseTexture2||!this._diffuseTexture2.isReady())return!1;if(!this._diffuseTexture3||!this._diffuseTexture3.isReady())return!1;if(!this._diffuseTexture4||!this._diffuseTexture4.isReady())return!1;if(this._mixTexture2){if(!this._mixTexture2.isReady())return!1;if(n.MIXMAP2=!0,!this._diffuseTexture5||!this._diffuseTexture5.isReady())return!1;if(!this._diffuseTexture6||!this._diffuseTexture6.isReady())return!1;if(!this._diffuseTexture7||!this._diffuseTexture7.isReady())return!1;if(!this._diffuseTexture8||!this._diffuseTexture8.isReady())return!1}}}if(a.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),n),n._needNormals=a.G.PrepareDefinesForLights(r,e,n,!1,this._maxSimultaneousLights,this._disableLighting),a.G.PrepareDefinesForFrameBoundValues(r,o,n,!!i),a.G.PrepareDefinesForAttributes(e,n,!0,!0),n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var s=new p.L;n.FOG&&s.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(n,s,this.maxSimultaneousLights),n.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,e),n.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var l=[u.o.PositionKind];n.NORMAL&&l.push(u.o.NormalKind),n.UV1&&l.push(u.o.UVKind),n.UV2&&l.push(u.o.UV2Kind),n.VERTEXCOLOR&&l.push(u.o.ColorKind),a.G.PrepareAttributesForBones(l,e,n,s),a.G.PrepareAttributesForInstances(l,n);var c=n.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vTextureInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMatrix","diffuse1Infos","diffuse2Infos","diffuse3Infos","diffuse4Infos","diffuse5Infos","diffuse6Infos","diffuse7Infos","diffuse8Infos"],_=["mixMap1Sampler","mixMap2Sampler","diffuse1Sampler","diffuse2Sampler","diffuse3Sampler","diffuse4Sampler","diffuse5Sampler","diffuse6Sampler","diffuse7Sampler","diffuse8Sampler"],d=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:d,samplers:_,defines:n,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("mix",{attributes:l,uniformsNames:f,uniformBuffersNames:d,samplers:_,defines:c,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},o),n,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n=this.getScene(),r=i._materialDefines;if(r){var o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(n,o)&&(this._mixTexture1&&(this._activeEffect.setTexture("mixMap1Sampler",this._mixTexture1),this._activeEffect.setFloat2("vTextureInfos",this._mixTexture1.coordinatesIndex,this._mixTexture1.level),this._activeEffect.setMatrix("textureMatrix",this._mixTexture1.getTextureMatrix()),h.k.DiffuseTextureEnabled&&(this._diffuseTexture1&&(this._activeEffect.setTexture("diffuse1Sampler",this._diffuseTexture1),this._activeEffect.setFloat2("diffuse1Infos",this._diffuseTexture1.uScale,this._diffuseTexture1.vScale)),this._diffuseTexture2&&(this._activeEffect.setTexture("diffuse2Sampler",this._diffuseTexture2),this._activeEffect.setFloat2("diffuse2Infos",this._diffuseTexture2.uScale,this._diffuseTexture2.vScale)),this._diffuseTexture3&&(this._activeEffect.setTexture("diffuse3Sampler",this._diffuseTexture3),this._activeEffect.setFloat2("diffuse3Infos",this._diffuseTexture3.uScale,this._diffuseTexture3.vScale)),this._diffuseTexture4&&(this._activeEffect.setTexture("diffuse4Sampler",this._diffuseTexture4),this._activeEffect.setFloat2("diffuse4Infos",this._diffuseTexture4.uScale,this._diffuseTexture4.vScale)))),this._mixTexture2&&(this._activeEffect.setTexture("mixMap2Sampler",this._mixTexture2),h.k.DiffuseTextureEnabled&&(this._diffuseTexture5&&(this._activeEffect.setTexture("diffuse5Sampler",this._diffuseTexture5),this._activeEffect.setFloat2("diffuse5Infos",this._diffuseTexture5.uScale,this._diffuseTexture5.vScale)),this._diffuseTexture6&&(this._activeEffect.setTexture("diffuse6Sampler",this._diffuseTexture6),this._activeEffect.setFloat2("diffuse6Infos",this._diffuseTexture6.uScale,this._diffuseTexture6.vScale)),this._diffuseTexture7&&(this._activeEffect.setTexture("diffuse7Sampler",this._diffuseTexture7),this._activeEffect.setFloat2("diffuse7Infos",this._diffuseTexture7.uScale,this._diffuseTexture7.vScale)),this._diffuseTexture8&&(this._activeEffect.setTexture("diffuse8Sampler",this._diffuseTexture8),this._activeEffect.setFloat2("diffuse8Infos",this._diffuseTexture8.uScale,this._diffuseTexture8.vScale)))),a.G.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),n.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),n.lightsEnabled&&!this.disableLighting&&a.G.BindLights(n,t,this._activeEffect,r,this.maxSimultaneousLights),n.fogEnabled&&t.applyFog&&n.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),a.G.BindFogParameters(n,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this._mixTexture1&&this._mixTexture1.animations&&this._mixTexture1.animations.length>0&&e.push(this._mixTexture1),this._mixTexture2&&this._mixTexture2.animations&&this._mixTexture2.animations.length>0&&e.push(this._mixTexture2),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._mixTexture1&&t.push(this._mixTexture1),this._diffuseTexture1&&t.push(this._diffuseTexture1),this._diffuseTexture2&&t.push(this._diffuseTexture2),this._diffuseTexture3&&t.push(this._diffuseTexture3),this._diffuseTexture4&&t.push(this._diffuseTexture4),this._mixTexture2&&t.push(this._mixTexture2),this._diffuseTexture5&&t.push(this._diffuseTexture5),this._diffuseTexture6&&t.push(this._diffuseTexture6),this._diffuseTexture7&&t.push(this._diffuseTexture7),this._diffuseTexture8&&t.push(this._diffuseTexture8),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this._mixTexture1===t||this._diffuseTexture1===t||this._diffuseTexture2===t||this._diffuseTexture3===t||this._diffuseTexture4===t||this._mixTexture2===t||this._diffuseTexture5===t||this._diffuseTexture6===t||this._diffuseTexture7===t||this._diffuseTexture8===t},t.prototype.dispose=function(t){this._mixTexture1&&this._mixTexture1.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var i=this;return r.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var e=r.p4.Serialize(this);return e.customType="BABYLON.MixMaterial",e},t.prototype.getClassName=function(){return"MixMaterial"},t.Parse=function(e,i,n){return r.p4.Parse((function(){return new t(e.name,i)}),e,i,n)},(0,n.gn)([(0,r.oU)("mixTexture1")],t.prototype,"_mixTexture1",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"mixTexture1",void 0),(0,n.gn)([(0,r.oU)("mixTexture2")],t.prototype,"_mixTexture2",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"mixTexture2",void 0),(0,n.gn)([(0,r.oU)("diffuseTexture1")],t.prototype,"_diffuseTexture1",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture1",void 0),(0,n.gn)([(0,r.oU)("diffuseTexture2")],t.prototype,"_diffuseTexture2",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture2",void 0),(0,n.gn)([(0,r.oU)("diffuseTexture3")],t.prototype,"_diffuseTexture3",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture3",void 0),(0,n.gn)([(0,r.oU)("diffuseTexture4")],t.prototype,"_diffuseTexture4",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture4",void 0),(0,n.gn)([(0,r.oU)("diffuseTexture1")],t.prototype,"_diffuseTexture5",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture5",void 0),(0,n.gn)([(0,r.oU)("diffuseTexture2")],t.prototype,"_diffuseTexture6",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture6",void 0),(0,n.gn)([(0,r.oU)("diffuseTexture3")],t.prototype,"_diffuseTexture7",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture7",void 0),(0,n.gn)([(0,r.oU)("diffuseTexture4")],t.prototype,"_diffuseTexture8",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture8",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"diffuseColor",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"specularColor",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"specularPower",void 0),(0,n.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,n.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(l.a);f.Q.RegisteredTypes["BABYLON.MixMaterial"]=U;_.Q.ShadersStore.normalPixelShader="precision highp float;\n\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef LIGHTING\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0]\n#include<__decl__lightFragment>[1]\n#include<__decl__lightFragment>[2]\n#include<__decl__lightFragment>[3]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#endif\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef NORMAL\nbaseColor=mix(baseColor,vec4(vNormalW,1.0),0.5);\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\n#ifdef LIGHTING\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0]\n#include<lightFragment>[1]\n#include<lightFragment>[2]\n#include<lightFragment>[3]\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=baseColor.rgb;\n#endif\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}";_.Q.ShadersStore.normalVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";var W=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.LIGHT0=!1,t.LIGHT1=!1,t.LIGHT2=!1,t.LIGHT3=!1,t.SPOTLIGHT0=!1,t.SPOTLIGHT1=!1,t.SPOTLIGHT2=!1,t.SPOTLIGHT3=!1,t.HEMILIGHT0=!1,t.HEMILIGHT1=!1,t.HEMILIGHT2=!1,t.HEMILIGHT3=!1,t.DIRLIGHT0=!1,t.DIRLIGHT1=!1,t.DIRLIGHT2=!1,t.DIRLIGHT3=!1,t.POINTLIGHT0=!1,t.POINTLIGHT1=!1,t.POINTLIGHT2=!1,t.POINTLIGHT3=!1,t.SHADOW0=!1,t.SHADOW1=!1,t.SHADOW2=!1,t.SHADOW3=!1,t.SHADOWS=!1,t.SHADOWESM0=!1,t.SHADOWESM1=!1,t.SHADOWESM2=!1,t.SHADOWESM3=!1,t.SHADOWPOISSON0=!1,t.SHADOWPOISSON1=!1,t.SHADOWPOISSON2=!1,t.SHADOWPOISSON3=!1,t.SHADOWPCF0=!1,t.SHADOWPCF1=!1,t.SHADOWPCF2=!1,t.SHADOWPCF3=!1,t.SHADOWPCSS0=!1,t.SHADOWPCSS1=!1,t.SHADOWPCSS2=!1,t.SHADOWPCSS3=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.LIGHTING=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.rebuild(),t}return(0,n.ZT)(t,e),t}(s.H),z=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.diffuseColor=new o.Wo(1,1,1),n._disableLighting=!1,n._maxSimultaneousLights=4,n}return(0,n.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaBlendingForMesh=function(e){return this.needAlphaBlending()||e.visibility<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new W);var n=t.materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(n._areTexturesDirty&&(n._needUVs=!1,r.texturesEnabled&&this._diffuseTexture&&h.k.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;n._needUVs=!0,n.DIFFUSE=!0}if(a.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),n),n._needNormals=!0,a.G.PrepareDefinesForLights(r,e,n,!1,this._maxSimultaneousLights,this._disableLighting),a.G.PrepareDefinesForFrameBoundValues(r,o,n,!!i),n.LIGHTING=!this._disableLighting,a.G.PrepareDefinesForAttributes(e,n,!0,!0),n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var s=new p.L;n.FOG&&s.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(n,s),n.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,e),n.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var l=[u.o.PositionKind];n.NORMAL&&l.push(u.o.NormalKind),n.UV1&&l.push(u.o.UVKind),n.UV2&&l.push(u.o.UV2Kind),a.G.PrepareAttributesForBones(l,e,n,s),a.G.PrepareAttributesForInstances(l,n);var c=n.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix"],_=["diffuseSampler"],d=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:d,samplers:_,defines:n,maxSimultaneousLights:4}),t.setEffect(r.getEngine().createEffect("normal",{attributes:l,uniformsNames:f,uniformBuffersNames:d,samplers:_,defines:c,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:4}},o),n,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n=this.getScene(),r=i._materialDefines;if(r){var o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(n,o)&&(this.diffuseTexture&&h.k.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this.diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this.diffuseTexture.coordinatesIndex,this.diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this.diffuseTexture.getTextureMatrix())),a.G.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),n.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),n.lightsEnabled&&!this.disableLighting&&a.G.BindLights(n,t,this._activeEffect,r),n.fogEnabled&&t.applyFog&&n.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),a.G.BindFogParameters(n,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this.diffuseTexture&&this.diffuseTexture.animations&&this.diffuseTexture.animations.length>0&&e.push(this.diffuseTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this.diffuseTexture===t},t.prototype.dispose=function(t){this.diffuseTexture&&this.diffuseTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var i=this;return r.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var e=r.p4.Serialize(this);return e.customType="BABYLON.NormalMaterial",e},t.prototype.getClassName=function(){return"NormalMaterial"},t.Parse=function(e,i,n){return r.p4.Parse((function(){return new t(e.name,i)}),e,i,n)},(0,n.gn)([(0,r.oU)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"diffuseColor",void 0),(0,n.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,n.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(l.a);f.Q.RegisteredTypes["BABYLON.NormalMaterial"]=z;_.Q.ShadersStore.shadowOnlyPixelShader="precision highp float;\n\nuniform vec4 vEyePosition;\nuniform float alpha;\nuniform vec3 shadowColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#include<lightFragment>[0..1]\n\nvec4 color=vec4(shadowColor,(1.0-clamp(shadow,0.,1.))*alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}";_.Q.ShadersStore.shadowOnlyVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";var H=function(e){function t(){var t=e.call(this)||this;return t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.rebuild(),t}return(0,n.ZT)(t,e),t}(s.H),G=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n._needAlphaBlending=!0,n.shadowColor=o.Wo.Black(),n}return(0,n.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this._needAlphaBlending},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},Object.defineProperty(t.prototype,"activeLight",{get:function(){return this._activeLight},set:function(e){this._activeLight=e},enumerable:!1,configurable:!0}),t.prototype._getFirstShadowLightForMesh=function(e){for(var t=0,i=e.lightSources;t<i.length;t++){var n=i[t];if(n.shadowEnabled)return n}return null},t.prototype.isReadyForSubMesh=function(e,t,i){var n;if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new H);var r=t._materialDefines,o=this.getScene();if(this._isReadyForSubMesh(t))return!0;var s=o.getEngine();if(this._activeLight)for(var l=0,h=e.lightSources;l<h.length;l++){var c=h[l];if(c.shadowEnabled){if(this._activeLight===c)break;var f=e.lightSources.indexOf(this._activeLight);-1!==f&&(e.lightSources.splice(f,1),e.lightSources.splice(0,0,this._activeLight));break}}a.G.PrepareDefinesForFrameBoundValues(o,s,r,!!i),a.G.PrepareDefinesForMisc(e,o,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),r),r._needNormals=a.G.PrepareDefinesForLights(o,e,r,!1,1);var _=null===(n=this._getFirstShadowLightForMesh(e))||void 0===n?void 0:n.getShadowGenerator();if(this._needAlphaBlending=!0,_&&_.getClassName&&"CascadedShadowGenerator"===_.getClassName()){var d=_;this._needAlphaBlending=!d.autoCalcDepthBounds}if(a.G.PrepareDefinesForAttributes(e,r,!1,!0),r.isDirty){r.markAsProcessed(),o.resetCachedMaterial();var g=new p.L;r.FOG&&g.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(r,g,1),r.NUM_BONE_INFLUENCERS>0&&g.addCPUSkinningFallback(0,e),r.IMAGEPROCESSINGPOSTPROCESS=o.imageProcessingConfiguration.applyByPostProcess;var m=[u.o.PositionKind];r.NORMAL&&m.push(u.o.NormalKind),a.G.PrepareAttributesForBones(m,e,r,g),a.G.PrepareAttributesForInstances(m,r);var v=r.toString(),b=["world","view","viewProjection","vEyePosition","vLightsType","vFogInfos","vFogColor","pointSize","alpha","shadowColor","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6"],y=new Array,x=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:b,uniformBuffersNames:x,samplers:y,defines:r,maxSimultaneousLights:1}),t.setEffect(o.getEngine().createEffect("shadowOnly",{attributes:m,uniformsNames:b,uniformBuffersNames:x,samplers:y,defines:v,fallbacks:g,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:1}},s),r,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(r._renderId=o.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n=this.getScene(),r=i._materialDefines;if(r){var o=i.effect;if(o){if(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(n,o)&&(a.G.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._activeEffect.setFloat("alpha",this.alpha),this._activeEffect.setColor3("shadowColor",this.shadowColor),n.bindEyePosition(o)),n.lightsEnabled){a.G.BindLights(n,t,this._activeEffect,r,1);var s=this._getFirstShadowLightForMesh(t);s&&(s._renderId=-1)}(n.fogEnabled&&t.applyFog&&n.fogMode!==c.x.FOGMODE_NONE||r.SHADOWCSM0)&&this._activeEffect.setMatrix("view",n.getViewMatrix()),a.G.BindFogParameters(n,t,this._activeEffect),this._afterBind(t,this._activeEffect)}}},t.prototype.clone=function(e){var i=this;return r.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var e=r.p4.Serialize(this);return e.customType="BABYLON.ShadowOnlyMaterial",e},t.prototype.getClassName=function(){return"ShadowOnlyMaterial"},t.Parse=function(e,i,n){return r.p4.Parse((function(){return new t(e.name,i)}),e,i,n)},t}(l.a);f.Q.RegisteredTypes["BABYLON.ShadowOnlyMaterial"]=G;_.Q.ShadersStore.simplePixelShader="precision highp float;\n\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform sampler2D diffuseSampler;\nuniform vec2 vDiffuseInfos;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\nfloat glossiness=0.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}";_.Q.ShadersStore.simpleVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vDiffuseUV;\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";var j=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.rebuild(),t}return(0,n.ZT)(t,e),t}(s.H),Q=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.diffuseColor=new o.Wo(1,1,1),n._disableLighting=!1,n._maxSimultaneousLights=4,n}return(0,n.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new j);var n=t._materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(n._areTexturesDirty&&(n._needUVs=!1,r.texturesEnabled&&this._diffuseTexture&&h.k.DiffuseTextureEnabled)){if(!this._diffuseTexture.isReady())return!1;n._needUVs=!0,n.DIFFUSE=!0}if(a.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),n),n._needNormals=a.G.PrepareDefinesForLights(r,e,n,!1,this._maxSimultaneousLights,this._disableLighting),a.G.PrepareDefinesForFrameBoundValues(r,o,n,!!i),a.G.PrepareDefinesForAttributes(e,n,!0,!0),n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var s=new p.L;n.FOG&&s.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(n,s,this.maxSimultaneousLights),n.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,e),n.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var l=[u.o.PositionKind];n.NORMAL&&l.push(u.o.NormalKind),n.UV1&&l.push(u.o.UVKind),n.UV2&&l.push(u.o.UV2Kind),n.VERTEXCOLOR&&l.push(u.o.ColorKind),a.G.PrepareAttributesForBones(l,e,n,s),a.G.PrepareAttributesForInstances(l,n);var c=n.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vFogInfos","vFogColor","pointSize","vDiffuseInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix"],_=["diffuseSampler"],d=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:d,samplers:_,defines:n,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("simple",{attributes:l,uniformsNames:f,uniformBuffersNames:d,samplers:_,defines:c,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights-1}},o),n,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n=this.getScene(),r=i._materialDefines;if(r){var o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(n,o)&&(this._diffuseTexture&&h.k.DiffuseTextureEnabled&&(this._activeEffect.setTexture("diffuseSampler",this._diffuseTexture),this._activeEffect.setFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),this._activeEffect.setMatrix("diffuseMatrix",this._diffuseTexture.getTextureMatrix())),a.G.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),n.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),n.lightsEnabled&&!this.disableLighting&&a.G.BindLights(n,t,this._activeEffect,r,this.maxSimultaneousLights),n.fogEnabled&&t.applyFog&&n.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),a.G.BindFogParameters(n,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this.diffuseTexture===t},t.prototype.dispose=function(t){this._diffuseTexture&&this._diffuseTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var i=this;return r.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var e=r.p4.Serialize(this);return e.customType="BABYLON.SimpleMaterial",e},t.prototype.getClassName=function(){return"SimpleMaterial"},t.Parse=function(e,i,n){return r.p4.Parse((function(){return new t(e.name,i)}),e,i,n)},(0,n.gn)([(0,r.oU)("diffuseTexture")],t.prototype,"_diffuseTexture",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture",void 0),(0,n.gn)([(0,r.n9)("diffuse")],t.prototype,"diffuseColor",void 0),(0,n.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,n.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(l.a);f.Q.RegisteredTypes["BABYLON.SimpleMaterial"]=Q;_.Q.ShadersStore.skyPixelShader="precision highp float;\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\n\nuniform vec3 cameraPosition;\nuniform vec3 cameraOffset;\nuniform vec3 up;\nuniform float luminance;\nuniform float turbidity;\nuniform float rayleigh;\nuniform float mieCoefficient;\nuniform float mieDirectionalG;\nuniform vec3 sunPosition;\n\n#include<fogFragmentDeclaration>\n\nconst float e=2.71828182845904523536028747135266249775724709369995957;\nconst float pi=3.141592653589793238462643383279502884197169;\nconst float n=1.0003;\nconst float N=2.545E25;\nconst float pn=0.035;\nconst vec3 lambda=vec3(680E-9,550E-9,450E-9);\nconst vec3 K=vec3(0.686,0.678,0.666);\nconst float v=4.0;\nconst float rayleighZenithLength=8.4E3;\nconst float mieZenithLength=1.25E3;\nconst float EE=1000.0;\nconst float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;\nconst float cutoffAngle=pi/1.95;\nconst float steepness=1.5;\nvec3 totalRayleigh(vec3 lambda)\n{\nreturn (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));\n}\nvec3 simplifiedRayleigh()\n{\nreturn 0.0005/vec3(94,40,18);\n}\nfloat rayleighPhase(float cosTheta)\n{\nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));\n}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{\nfloat c=(0.2*T )*10E-18;\nreturn 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;\n}\nfloat hgPhase(float cosTheta,float g)\n{\nreturn (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));\n}\nfloat sunIntensity(float zenithAngleCos)\n{\nreturn EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));\n}\nfloat A=0.15;\nfloat B=0.50;\nfloat C=0.10;\nfloat D=0.20;\nfloat EEE=0.02;\nfloat F=0.30;\nfloat W=1000.0;\nvec3 Uncharted2Tonemap(vec3 x)\n{\nreturn ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;\n}\nvoid main(void) {\n\n#include<clipPlaneFragment>\n\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);\nfloat rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));\nvec3 sunDirection=normalize(sunPosition);\nfloat sunE=sunIntensity(dot(sunDirection,up));\nvec3 betaR=simplifiedRayleigh()*rayleighCoefficient;\nvec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;\nfloat zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));\nfloat sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nfloat sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\nvec3 Fex=exp(-(betaR*sR+betaM*sM));\nfloat cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);\nfloat rPhase=rayleighPhase(cosTheta*0.5+0.5);\nvec3 betaRTheta=betaR*rPhase;\nfloat mPhase=hgPhase(cosTheta,mieDirectionalG);\nvec3 betaMTheta=betaM*mPhase;\nvec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));\nLin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));\nvec3 direction=normalize(vPositionW-cameraPosition);\nfloat theta=acos(direction.y);\nfloat phi=atan(direction.z,direction.x);\nvec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);\nvec3 L0=vec3(0.1)*Fex;\nfloat sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);\nL0+=(sunE*19000.0*Fex)*sundisk;\nvec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));\nvec3 texColor=(Lin+L0);\ntexColor*=0.04 ;\ntexColor+=vec3(0.0,0.001,0.0025)*0.3;\nfloat g_fMaxLuminance=1.0;\nfloat fLumScaled=0.1/luminance;\nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled);\nfloat ExposureBias=fLumCompressed;\nvec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);\n\n\n\nvec3 retColor=curr*whiteScale;\n\n\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}\n";_.Q.ShadersStore.skyVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\nvoid main(void) {\ngl_Position=viewProjection*world*vec4(position,1.0);\nvec4 worldPos=world*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";var X=function(e){function t(){var t=e.call(this)||this;return t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.POINTSIZE=!1,t.FOG=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.rebuild(),t}return(0,n.ZT)(t,e),t}(s.H),q=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.luminance=1,n.turbidity=10,n.rayleigh=2,n.mieCoefficient=.005,n.mieDirectionalG=.8,n.distance=500,n.inclination=.49,n.azimuth=.25,n.sunPosition=new w.P(0,100,0),n.useSunPosition=!1,n.cameraOffset=w.P.Zero(),n.up=w.P.Up(),n._cameraPosition=w.P.Zero(),n._skyOrientation=new w._f,n}return(0,n.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new X);var n=t._materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;if(a.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,!1,n),a.G.PrepareDefinesForAttributes(e,n,!0,!1),n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var o=new p.L;n.FOG&&o.addFallback(1,"FOG"),n.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var s=[u.o.PositionKind];n.VERTEXCOLOR&&s.push(u.o.ColorKind);var l=n.toString();t.setEffect(r.getEngine().createEffect("sky",s,["world","viewProjection","view","vFogInfos","vFogColor","pointSize","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"],[],l,o,this.onCompiled,this.onError),n,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n=this.getScene();if(i._materialDefines){var r=i.effect;if(r){this._activeEffect=r,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),this._mustRebind(n,r)&&(a.G.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize)),n.fogEnabled&&t.applyFog&&n.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),a.G.BindFogParameters(n,t,this._activeEffect);var o=n.activeCamera;if(o){var s=o.getWorldMatrix();this._cameraPosition.x=s.m[12],this._cameraPosition.y=s.m[13],this._cameraPosition.z=s.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){var l=Math.PI*(this.inclination-.5),h=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(h),this.sunPosition.y=this.distance*Math.sin(h)*Math.sin(l),this.sunPosition.z=this.distance*Math.sin(h)*Math.cos(l),w._f.FromUnitVectorsToRef(w.P.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(t,this._activeEffect)}}},t.prototype.getAnimatables=function(){return[]},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var i=this;return r.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var e=r.p4.Serialize(this);return e.customType="BABYLON.SkyMaterial",e},t.prototype.getClassName=function(){return"SkyMaterial"},t.Parse=function(e,i,n){return r.p4.Parse((function(){return new t(e.name,i)}),e,i,n)},(0,n.gn)([(0,r.qC)()],t.prototype,"luminance",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"turbidity",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"rayleigh",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"mieCoefficient",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"mieDirectionalG",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"distance",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"inclination",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"azimuth",void 0),(0,n.gn)([(0,r.hd)()],t.prototype,"sunPosition",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"useSunPosition",void 0),(0,n.gn)([(0,r.hd)()],t.prototype,"cameraOffset",void 0),(0,n.gn)([(0,r.hd)()],t.prototype,"up",void 0),t}(l.a);f.Q.RegisteredTypes["BABYLON.SkyMaterial"]=q;_.Q.ShadersStore.terrainPixelShader="precision highp float;\n\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;\nuniform sampler2D textureSampler;\nuniform vec2 vTextureInfos;\nuniform sampler2D diffuse1Sampler;\nuniform sampler2D diffuse2Sampler;\nuniform sampler2D diffuse3Sampler;\nuniform vec2 diffuse1Infos;\nuniform vec2 diffuse2Infos;\nuniform vec2 diffuse3Infos;\n#endif\n#ifdef BUMP\nuniform sampler2D bump1Sampler;\nuniform sampler2D bump2Sampler;\nuniform sampler2D bump3Sampler;\n#endif\n\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n\n#include<fogFragmentDeclaration>\n\n#ifdef BUMP\n#extension GL_OES_standard_derivatives : enable\n\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\n{\n\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\n\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;\n\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));\nreturn mat3(tangent*invmax,binormal*invmax,normal);\n}\nvec3 perturbNormal(vec3 viewDir,vec3 mixColor)\n{\nvec3 bump1Color=texture2D(bump1Sampler,vTextureUV*diffuse1Infos).xyz;\nvec3 bump2Color=texture2D(bump2Sampler,vTextureUV*diffuse2Infos).xyz;\nvec3 bump3Color=texture2D(bump3Sampler,vTextureUV*diffuse3Infos).xyz;\nbump1Color.rgb*=mixColor.r;\nbump2Color.rgb=mix(bump1Color.rgb,bump2Color.rgb,mixColor.g);\nvec3 map=mix(bump2Color.rgb,bump3Color.rgb,mixColor.b);\nmap=map*255./127.-128./127.;\nmat3 TBN=cotangent_frame(vNormalW*vTextureInfos.y,-viewDir,vTextureUV);\nreturn normalize(TBN*map);\n}\n#endif\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(textureSampler,vTextureUV);\n#if defined(BUMP) && defined(DIFFUSE)\nnormalW=perturbNormal(viewDirectionW,baseColor.rgb);\n#endif\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\nbaseColor.rgb*=vTextureInfos.y;\nvec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);\nvec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);\nvec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);\ndiffuse1Color.rgb*=baseColor.r;\ndiffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,baseColor.g);\nbaseColor.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,baseColor.b);\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor*baseColor.rgb,0.0,1.0);\n\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}\n";_.Q.ShadersStore.terrainVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSE\nvarying vec2 vTextureUV;\nuniform mat4 textureMatrix;\nuniform vec2 vTextureInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef DIFFUSE\nif (vTextureInfos.x == 0.)\n{\nvTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";var Y=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSE=!1,t.BUMP=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.rebuild(),t}return(0,n.ZT)(t,e),t}(s.H),Z=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.diffuseColor=new o.Wo(1,1,1),n.specularColor=new o.Wo(0,0,0),n.specularPower=64,n._disableLighting=!1,n._maxSimultaneousLights=4,n}return(0,n.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new Y);var n=t._materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(r.texturesEnabled){if(!this.mixTexture||!this.mixTexture.isReady())return!1;if(n._needUVs=!0,h.k.DiffuseTextureEnabled){if(!this.diffuseTexture1||!this.diffuseTexture1.isReady())return!1;if(!this.diffuseTexture2||!this.diffuseTexture2.isReady())return!1;if(!this.diffuseTexture3||!this.diffuseTexture3.isReady())return!1;n.DIFFUSE=!0}if(this.bumpTexture1&&this.bumpTexture2&&this.bumpTexture3&&h.k.BumpTextureEnabled){if(!this.bumpTexture1.isReady())return!1;if(!this.bumpTexture2.isReady())return!1;if(!this.bumpTexture3.isReady())return!1;n._needNormals=!0,n.BUMP=!0}}if(a.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),n),n._needNormals=a.G.PrepareDefinesForLights(r,e,n,!1,this._maxSimultaneousLights,this._disableLighting),a.G.PrepareDefinesForFrameBoundValues(r,o,n,!!i),a.G.PrepareDefinesForAttributes(e,n,!0,!0),n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var s=new p.L;n.FOG&&s.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(n,s,this.maxSimultaneousLights),n.NUM_BONE_INFLUENCERS>0&&s.addCPUSkinningFallback(0,e),n.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var l=[u.o.PositionKind];n.NORMAL&&l.push(u.o.NormalKind),n.UV1&&l.push(u.o.UVKind),n.UV2&&l.push(u.o.UV2Kind),n.VERTEXCOLOR&&l.push(u.o.ColorKind),a.G.PrepareAttributesForBones(l,e,n,s),a.G.PrepareAttributesForInstances(l,n);var c=n.toString(),f=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vTextureInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","textureMatrix","diffuse1Infos","diffuse2Infos","diffuse3Infos"],_=["textureSampler","diffuse1Sampler","diffuse2Sampler","diffuse3Sampler","bump1Sampler","bump2Sampler","bump3Sampler"],d=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:f,uniformBuffersNames:d,samplers:_,defines:n,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("terrain",{attributes:l,uniformsNames:f,uniformBuffersNames:d,samplers:_,defines:c,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},o),n,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n=this.getScene(),r=i._materialDefines;if(r){var o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(n,o)&&(this.mixTexture&&(this._activeEffect.setTexture("textureSampler",this._mixTexture),this._activeEffect.setFloat2("vTextureInfos",this._mixTexture.coordinatesIndex,this._mixTexture.level),this._activeEffect.setMatrix("textureMatrix",this._mixTexture.getTextureMatrix()),h.k.DiffuseTextureEnabled&&(this._diffuseTexture1&&(this._activeEffect.setTexture("diffuse1Sampler",this._diffuseTexture1),this._activeEffect.setFloat2("diffuse1Infos",this._diffuseTexture1.uScale,this._diffuseTexture1.vScale)),this._diffuseTexture2&&(this._activeEffect.setTexture("diffuse2Sampler",this._diffuseTexture2),this._activeEffect.setFloat2("diffuse2Infos",this._diffuseTexture2.uScale,this._diffuseTexture2.vScale)),this._diffuseTexture3&&(this._activeEffect.setTexture("diffuse3Sampler",this._diffuseTexture3),this._activeEffect.setFloat2("diffuse3Infos",this._diffuseTexture3.uScale,this._diffuseTexture3.vScale))),h.k.BumpTextureEnabled&&n.getEngine().getCaps().standardDerivatives&&(this._bumpTexture1&&this._activeEffect.setTexture("bump1Sampler",this._bumpTexture1),this._bumpTexture2&&this._activeEffect.setTexture("bump2Sampler",this._bumpTexture2),this._bumpTexture3&&this._activeEffect.setTexture("bump3Sampler",this._bumpTexture3))),a.G.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),n.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),n.lightsEnabled&&!this.disableLighting&&a.G.BindLights(n,t,this._activeEffect,r,this.maxSimultaneousLights),n.fogEnabled&&t.applyFog&&n.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),a.G.BindFogParameters(n,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this.mixTexture&&this.mixTexture.animations&&this.mixTexture.animations.length>0&&e.push(this.mixTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._mixTexture&&t.push(this._mixTexture),this._diffuseTexture1&&t.push(this._diffuseTexture1),this._diffuseTexture2&&t.push(this._diffuseTexture2),this._diffuseTexture3&&t.push(this._diffuseTexture3),this._bumpTexture1&&t.push(this._bumpTexture1),this._bumpTexture2&&t.push(this._bumpTexture2),this._bumpTexture3&&t.push(this._bumpTexture3),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this._mixTexture===t||this._diffuseTexture1===t||this._diffuseTexture2===t||this._diffuseTexture3===t||this._bumpTexture1===t||this._bumpTexture2===t||this._bumpTexture3===t},t.prototype.dispose=function(t){this.mixTexture&&this.mixTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var i=this;return r.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var e=r.p4.Serialize(this);return e.customType="BABYLON.TerrainMaterial",e},t.prototype.getClassName=function(){return"TerrainMaterial"},t.Parse=function(e,i,n){return r.p4.Parse((function(){return new t(e.name,i)}),e,i,n)},(0,n.gn)([(0,r.oU)("mixTexture")],t.prototype,"_mixTexture",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"mixTexture",void 0),(0,n.gn)([(0,r.oU)("diffuseTexture1")],t.prototype,"_diffuseTexture1",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture1",void 0),(0,n.gn)([(0,r.oU)("diffuseTexture2")],t.prototype,"_diffuseTexture2",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture2",void 0),(0,n.gn)([(0,r.oU)("diffuseTexture3")],t.prototype,"_diffuseTexture3",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTexture3",void 0),(0,n.gn)([(0,r.oU)("bumpTexture1")],t.prototype,"_bumpTexture1",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture1",void 0),(0,n.gn)([(0,r.oU)("bumpTexture2")],t.prototype,"_bumpTexture2",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture2",void 0),(0,n.gn)([(0,r.oU)("bumpTexture3")],t.prototype,"_bumpTexture3",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture3",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"diffuseColor",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"specularColor",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"specularPower",void 0),(0,n.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,n.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(l.a);f.Q.RegisteredTypes["BABYLON.TerrainMaterial"]=Z;_.Q.ShadersStore.triplanarPixelShader="precision highp float;\n\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n\n#ifdef DIFFUSEX\nvarying vec2 vTextureUVX;\nuniform sampler2D diffuseSamplerX;\n#ifdef BUMPX\nuniform sampler2D normalSamplerX;\n#endif\n#endif\n#ifdef DIFFUSEY\nvarying vec2 vTextureUVY;\nuniform sampler2D diffuseSamplerY;\n#ifdef BUMPY\nuniform sampler2D normalSamplerY;\n#endif\n#endif\n#ifdef DIFFUSEZ\nvarying vec2 vTextureUVZ;\nuniform sampler2D diffuseSamplerZ;\n#ifdef BUMPZ\nuniform sampler2D normalSamplerZ;\n#endif\n#endif\n#ifdef NORMAL\nvarying mat3 tangentSpace;\n#endif\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<fogFragmentDeclaration>\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n\nvec4 baseColor=vec4(0.,0.,0.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n\n#ifdef NORMAL\nvec3 normalW=tangentSpace[2];\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\n#endif\nvec4 baseNormal=vec4(0.0,0.0,0.0,1.0);\nnormalW*=normalW;\n#ifdef DIFFUSEX\nbaseColor+=texture2D(diffuseSamplerX,vTextureUVX)*normalW.x;\n#ifdef BUMPX\nbaseNormal+=texture2D(normalSamplerX,vTextureUVX)*normalW.x;\n#endif\n#endif\n#ifdef DIFFUSEY\nbaseColor+=texture2D(diffuseSamplerY,vTextureUVY)*normalW.y;\n#ifdef BUMPY\nbaseNormal+=texture2D(normalSamplerY,vTextureUVY)*normalW.y;\n#endif\n#endif\n#ifdef DIFFUSEZ\nbaseColor+=texture2D(diffuseSamplerZ,vTextureUVZ)*normalW.z;\n#ifdef BUMPZ\nbaseNormal+=texture2D(normalSamplerZ,vTextureUVZ)*normalW.z;\n#endif\n#endif\n#ifdef NORMAL\nnormalW=normalize((2.0*baseNormal.xyz-1.0)*tangentSpace);\n#endif\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\n#include<depthPrePass>\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\n\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n}\n";_.Q.ShadersStore.triplanarVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef DIFFUSEX\nvarying vec2 vTextureUVX;\n#endif\n#ifdef DIFFUSEY\nvarying vec2 vTextureUVY;\n#endif\n#ifdef DIFFUSEZ\nvarying vec2 vTextureUVZ;\n#endif\nuniform float tileSize;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying mat3 tangentSpace;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\nvoid main(void)\n{\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\nvPositionW=vec3(worldPos);\n#ifdef DIFFUSEX\nvTextureUVX=worldPos.zy/tileSize;\n#endif\n#ifdef DIFFUSEY\nvTextureUVY=worldPos.xz/tileSize;\n#endif\n#ifdef DIFFUSEZ\nvTextureUVZ=worldPos.xy/tileSize;\n#endif\n#ifdef NORMAL\n\nvec3 xtan=vec3(0,0,1);\nvec3 xbin=vec3(0,1,0);\nvec3 ytan=vec3(1,0,0);\nvec3 ybin=vec3(0,0,1);\nvec3 ztan=vec3(1,0,0);\nvec3 zbin=vec3(0,1,0);\nvec3 normalizedNormal=normalize(normal);\nnormalizedNormal*=normalizedNormal;\nvec3 worldBinormal=normalize(xbin*normalizedNormal.x+ybin*normalizedNormal.y+zbin*normalizedNormal.z);\nvec3 worldTangent=normalize(xtan*normalizedNormal.x+ytan*normalizedNormal.y+ztan*normalizedNormal.z);\nworldTangent=(world*vec4(worldTangent,0.0)).xyz;\nworldBinormal=(world*vec4(worldBinormal,0.0)).xyz;\nvec3 worldNormal=(world*vec4(normalize(normal),0.0)).xyz;\ntangentSpace[0]=worldTangent;\ntangentSpace[1]=worldBinormal;\ntangentSpace[2]=worldNormal;\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\n}\n";var K=function(e){function t(){var t=e.call(this)||this;return t.DIFFUSEX=!1,t.DIFFUSEY=!1,t.DIFFUSEZ=!1,t.BUMPX=!1,t.BUMPY=!1,t.BUMPZ=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.NORMAL=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.rebuild(),t}return(0,n.ZT)(t,e),t}(s.H),$=function(e){function t(t,i){var n=e.call(this,t,i)||this;return n.tileSize=1,n.diffuseColor=new o.Wo(1,1,1),n.specularColor=new o.Wo(.2,.2,.2),n.specularPower=64,n._disableLighting=!1,n._maxSimultaneousLights=4,n}return(0,n.ZT)(t,e),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new K);var n=t._materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(n._areTexturesDirty&&r.texturesEnabled){if(h.k.DiffuseTextureEnabled)for(var s=[this.diffuseTextureX,this.diffuseTextureY,this.diffuseTextureZ],l=["DIFFUSEX","DIFFUSEY","DIFFUSEZ"],c=0;c<s.length;c++)if(s[c]){if(!s[c].isReady())return!1;n[l[c]]=!0}if(h.k.BumpTextureEnabled)for(s=[this.normalTextureX,this.normalTextureY,this.normalTextureZ],l=["BUMPX","BUMPY","BUMPZ"],c=0;c<s.length;c++)if(s[c]){if(!s[c].isReady())return!1;n[l[c]]=!0}}if(a.G.PrepareDefinesForMisc(e,r,!1,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),n),n._needNormals=a.G.PrepareDefinesForLights(r,e,n,!1,this._maxSimultaneousLights,this._disableLighting),a.G.PrepareDefinesForFrameBoundValues(r,o,n,!!i),a.G.PrepareDefinesForAttributes(e,n,!0,!0),n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var f=new p.L;n.FOG&&f.addFallback(1,"FOG"),a.G.HandleFallbacksForShadows(n,f,this.maxSimultaneousLights),n.NUM_BONE_INFLUENCERS>0&&f.addCPUSkinningFallback(0,e),n.IMAGEPROCESSINGPOSTPROCESS=r.imageProcessingConfiguration.applyByPostProcess;var _=[u.o.PositionKind];n.NORMAL&&_.push(u.o.NormalKind),n.VERTEXCOLOR&&_.push(u.o.ColorKind),a.G.PrepareAttributesForBones(_,e,n,f),a.G.PrepareAttributesForInstances(_,n);var d=n.toString(),g=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","tileSize"],m=["diffuseSamplerX","diffuseSamplerY","diffuseSamplerZ","normalSamplerX","normalSamplerY","normalSamplerZ"],v=new Array;a.G.PrepareUniformsAndSamplersList({uniformsNames:g,uniformBuffersNames:v,samplers:m,defines:n,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("triplanar",{attributes:_,uniformsNames:g,uniformBuffersNames:v,samplers:m,defines:d,fallbacks:f,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this.maxSimultaneousLights}},o),n,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n=this.getScene(),r=i._materialDefines;if(r){var o=i.effect;o&&(this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._activeEffect.setFloat("tileSize",this.tileSize),n.getCachedMaterial()!==this&&(this.diffuseTextureX&&this._activeEffect.setTexture("diffuseSamplerX",this.diffuseTextureX),this.diffuseTextureY&&this._activeEffect.setTexture("diffuseSamplerY",this.diffuseTextureY),this.diffuseTextureZ&&this._activeEffect.setTexture("diffuseSamplerZ",this.diffuseTextureZ),this.normalTextureX&&this._activeEffect.setTexture("normalSamplerX",this.normalTextureX),this.normalTextureY&&this._activeEffect.setTexture("normalSamplerY",this.normalTextureY),this.normalTextureZ&&this._activeEffect.setTexture("normalSamplerZ",this.normalTextureZ),a.G.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),n.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),n.lightsEnabled&&!this.disableLighting&&a.G.BindLights(n,t,this._activeEffect,r,this.maxSimultaneousLights),n.fogEnabled&&t.applyFog&&n.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),a.G.BindFogParameters(n,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.getAnimatables=function(){var e=[];return this.mixTexture&&this.mixTexture.animations&&this.mixTexture.animations.length>0&&e.push(this.mixTexture),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTextureX&&t.push(this._diffuseTextureX),this._diffuseTextureY&&t.push(this._diffuseTextureY),this._diffuseTextureZ&&t.push(this._diffuseTextureZ),this._normalTextureX&&t.push(this._normalTextureX),this._normalTextureY&&t.push(this._normalTextureY),this._normalTextureZ&&t.push(this._normalTextureZ),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this._diffuseTextureX===t||this._diffuseTextureY===t||this._diffuseTextureZ===t||this._normalTextureX===t||this._normalTextureY===t||this._normalTextureZ===t},t.prototype.dispose=function(t){this.mixTexture&&this.mixTexture.dispose(),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var i=this;return r.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var e=r.p4.Serialize(this);return e.customType="BABYLON.TriPlanarMaterial",e},t.prototype.getClassName=function(){return"TriPlanarMaterial"},t.Parse=function(e,i,n){return r.p4.Parse((function(){return new t(e.name,i)}),e,i,n)},(0,n.gn)([(0,r.oU)()],t.prototype,"mixTexture",void 0),(0,n.gn)([(0,r.oU)("diffuseTextureX")],t.prototype,"_diffuseTextureX",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTextureX",void 0),(0,n.gn)([(0,r.oU)("diffuseTexturY")],t.prototype,"_diffuseTextureY",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTextureY",void 0),(0,n.gn)([(0,r.oU)("diffuseTextureZ")],t.prototype,"_diffuseTextureZ",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"diffuseTextureZ",void 0),(0,n.gn)([(0,r.oU)("normalTextureX")],t.prototype,"_normalTextureX",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"normalTextureX",void 0),(0,n.gn)([(0,r.oU)("normalTextureY")],t.prototype,"_normalTextureY",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"normalTextureY",void 0),(0,n.gn)([(0,r.oU)("normalTextureZ")],t.prototype,"_normalTextureZ",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"normalTextureZ",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"tileSize",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"diffuseColor",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"specularColor",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"specularPower",void 0),(0,n.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,n.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),t}(l.a);f.Q.RegisteredTypes["BABYLON.TriPlanarMaterial"]=$;var J=i(3303),ee=i(322),te=i(8169),ie=i(5808),ne=i(8947),re=i(1308),oe=(i(722),i(1666),i(3837),i(7854),"#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nprecision highp float;\n\nuniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n\n#include<helperFunctions>\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n\n#ifdef BUMP\nvarying vec2 vNormalUV;\n#ifdef BUMPSUPERIMPOSE\nvarying vec2 vNormalUV2;\n#endif\nuniform sampler2D normalSampler;\nuniform vec2 vNormalInfos;\n#endif\nuniform sampler2D refractionSampler;\nuniform sampler2D reflectionSampler;\n\nconst float LOG2=1.442695;\nuniform vec3 cameraPosition;\nuniform vec4 waterColor;\nuniform float colorBlendFactor;\nuniform vec4 waterColor2;\nuniform float colorBlendFactor2;\nuniform float bumpHeight;\nuniform float time;\n\nvarying vec3 vRefractionMapTexCoord;\nvarying vec3 vReflectionMapTexCoord;\nvarying vec3 vPosition;\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n\n#include<fogFragmentDeclaration>\nvoid main(void) {\n\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\n\nfloat alpha=vDiffuseColor.a;\n#ifdef BUMP\n#ifdef BUMPSUPERIMPOSE\nbaseColor=0.6*texture2D(normalSampler,vNormalUV)+0.4*texture2D(normalSampler,vec2(vNormalUV2.x,vNormalUV2.y));\n#else\nbaseColor=texture2D(normalSampler,vNormalUV);\n#endif\nvec3 bumpColor=baseColor.rgb;\n#ifdef ALPHATEST\nif (baseColor.a<0.4)\ndiscard;\n#endif\nbaseColor.rgb*=vNormalInfos.y;\n#else\nvec3 bumpColor=vec3(1.0);\n#endif\n#ifdef VERTEXCOLOR\nbaseColor.rgb*=vColor.rgb;\n#endif\n\n#ifdef NORMAL\nvec2 perturbation=bumpHeight*(baseColor.rg-0.5);\n#ifdef BUMPAFFECTSREFLECTION\nvec3 normalW=normalize(vNormalW+vec3(perturbation.x*8.0,0.0,perturbation.y*8.0));\nif (normalW.y<0.0) {\nnormalW.y=-normalW.y;\n}\n#else\nvec3 normalW=normalize(vNormalW);\n#endif\n#else\nvec3 normalW=vec3(1.0,1.0,1.0);\nvec2 perturbation=bumpHeight*(vec2(1.0,1.0)-0.5);\n#endif\n#ifdef FRESNELSEPARATE\n#ifdef REFLECTION\n\nvec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation*0.5,0.0,1.0);\nvec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);\n#ifdef IS_REFRACTION_LINEAR\nrefractiveColor.rgb=toGammaSpace(refractiveColor.rgb);\n#endif\nvec2 projectedReflectionTexCoords=clamp(vec2(\nvReflectionMapTexCoord.x/vReflectionMapTexCoord.z+perturbation.x*0.3,\nvReflectionMapTexCoord.y/vReflectionMapTexCoord.z+perturbation.y\n),0.0,1.0);\nvec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);\n#ifdef IS_REFLECTION_LINEAR\nreflectiveColor.rgb=toGammaSpace(reflectiveColor.rgb);\n#endif\nvec3 upVector=vec3(0.0,1.0,0.0);\nfloat fresnelTerm=clamp(abs(pow(dot(viewDirectionW,upVector),3.0)),0.05,0.65);\nfloat IfresnelTerm=1.0-fresnelTerm;\nrefractiveColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*refractiveColor;\nreflectiveColor=IfresnelTerm*colorBlendFactor2*waterColor+(1.0-colorBlendFactor2*IfresnelTerm)*reflectiveColor;\nvec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*IfresnelTerm;\nbaseColor=combinedColor;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#else\n#ifdef REFLECTION\n\nvec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation,0.0,1.0);\nvec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);\n#ifdef IS_REFRACTION_LINEAR\nrefractiveColor.rgb=toGammaSpace(refractiveColor.rgb);\n#endif\nvec2 projectedReflectionTexCoords=clamp(vReflectionMapTexCoord.xy/vReflectionMapTexCoord.z+perturbation,0.0,1.0);\nvec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);\n#ifdef IS_REFLECTION_LINEAR\nreflectiveColor.rgb=toGammaSpace(reflectiveColor.rgb);\n#endif\nvec3 upVector=vec3(0.0,1.0,0.0);\nfloat fresnelTerm=max(dot(viewDirectionW,upVector),0.0);\nvec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*(1.0-fresnelTerm);\nbaseColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*combinedColor;\n#endif\n\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\nfloat shadow=1.;\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularBase=vec3(0.,0.,0.);\nvec3 specularColor=vSpecularColor.rgb;\n#else\nfloat glossiness=0.;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);\n#ifdef VERTEXALPHA\nalpha*=vColor.a;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#endif\n\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\n#include<logDepthFragment>\n#include<fogFragment>\n\n\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#elif defined(IMAGEPROCESSING)\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\ngl_FragColor=color;\n}\n");_.Q.ShadersStore.waterPixelShader=oe,i(8041);_.Q.ShadersStore.waterVertexShader="precision highp float;\n\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef BUMP\nvarying vec2 vNormalUV;\n#ifdef BUMPSUPERIMPOSE\nvarying vec2 vNormalUV2;\n#endif\nuniform mat4 normalMatrix;\nuniform vec2 vNormalInfos;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<logDepthDeclaration>\n\nuniform mat4 worldReflectionViewProjection;\nuniform vec2 windDirection;\nuniform float waveLength;\nuniform float time;\nuniform float windForce;\nuniform float waveHeight;\nuniform float waveSpeed;\nuniform float waveCount;\n\nvarying vec3 vPosition;\nvarying vec3 vRefractionMapTexCoord;\nvarying vec3 vReflectionMapTexCoord;\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\nvPositionW=vec3(worldPos);\n#ifdef NORMAL\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef BUMP\nif (vNormalInfos.x == 0.)\n{\nvNormalUV=vec2(normalMatrix*vec4((uv*1.0)/waveLength+time*windForce*windDirection,1.0,0.0));\n#ifdef BUMPSUPERIMPOSE\nvNormalUV2=vec2(normalMatrix*vec4((uv*0.721)/waveLength+time*1.2*windForce*windDirection,1.0,0.0));\n#endif\n}\nelse\n{\nvNormalUV=vec2(normalMatrix*vec4((uv2*1.0)/waveLength+time*windForce*windDirection ,1.0,0.0));\n#ifdef BUMPSUPERIMPOSE\nvNormalUV2=vec2(normalMatrix*vec4((uv2*0.721)/waveLength+time*1.2*windForce*windDirection ,1.0,0.0));\n#endif\n}\n#endif\n\n#include<clipPlaneVertex>\n\n#include<fogVertex>\n\n#include<shadowsVertex>[0..maxSimultaneousLights]\n\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n\n#ifdef POINTSIZE\ngl_PointSize=pointSize;\n#endif\nfloat finalWaveCount=1.0/(waveCount*0.5);\nvec3 p=position;\nfloat newY=(sin(((p.x/finalWaveCount)+time*waveSpeed))*waveHeight*windDirection.x*5.0)\n+(cos(((p.z/finalWaveCount)+time*waveSpeed))*waveHeight*windDirection.y*5.0);\np.y+=abs(newY);\ngl_Position=viewProjection*finalWorld*vec4(p,1.0);\n#ifdef REFLECTION\nworldPos=viewProjection*finalWorld*vec4(p,1.0);\n\nvPosition=position;\nvRefractionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);\nvRefractionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);\nvRefractionMapTexCoord.z=worldPos.w;\nworldPos=worldReflectionViewProjection*vec4(position,1.0);\nvReflectionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);\nvReflectionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);\nvReflectionMapTexCoord.z=worldPos.w;\n#endif\n#include<logDepthVertex>\n}\n";var se=function(e){function t(){var t=e.call(this)||this;return t.BUMP=!1,t.REFLECTION=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.POINTSIZE=!1,t.FOG=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.INSTANCES=!1,t.SPECULARTERM=!1,t.LOGARITHMICDEPTH=!1,t.USE_REVERSE_DEPTHBUFFER=!1,t.FRESNELSEPARATE=!1,t.BUMPSUPERIMPOSE=!1,t.BUMPAFFECTSREFLECTION=!1,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.rebuild(),t}return(0,n.ZT)(t,e),t}(s.H),ae=function(e){function t(t,i,n){void 0===n&&(n=new w.FM(512,512));var r=e.call(this,t,i)||this;return r.renderTargetSize=n,r.diffuseColor=new o.Wo(1,1,1),r.specularColor=new o.Wo(0,0,0),r.specularPower=64,r._disableLighting=!1,r._maxSimultaneousLights=4,r.windForce=6,r.windDirection=new w.FM(0,1),r.waveHeight=.4,r.bumpHeight=.4,r._bumpSuperimpose=!1,r._fresnelSeparate=!1,r._bumpAffectsReflection=!1,r.waterColor=new o.Wo(.1,.1,.6),r.colorBlendFactor=.2,r.waterColor2=new o.Wo(.1,.1,.6),r.colorBlendFactor2=.2,r.waveLength=.1,r.waveSpeed=1,r.waveCount=20,r.disableClipPlane=!1,r._renderTargets=new te.t(16),r._mesh=null,r._reflectionTransform=w.y3.Zero(),r._lastTime=0,r._lastDeltaTime=0,r._createRenderTargets(i,n),r.getRenderTargetTextures=function(){return r._renderTargets.reset(),r._renderTargets.push(r._reflectionRTT),r._renderTargets.push(r._refractionRTT),r._renderTargets},r._imageProcessingConfiguration=r.getScene().imageProcessingConfiguration,r._imageProcessingConfiguration&&(r._imageProcessingObserver=r._imageProcessingConfiguration.onUpdateParameters.add((function(){r._markAllSubMeshesAsImageProcessingDirty()}))),r}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"hasRenderTargetTextures",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refractionTexture",{get:function(){return this._refractionRTT},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reflectionTexture",{get:function(){return this._reflectionRTT},enumerable:!1,configurable:!0}),t.prototype.addToRenderList=function(e){this._refractionRTT&&this._refractionRTT.renderList&&this._refractionRTT.renderList.push(e),this._reflectionRTT&&this._reflectionRTT.renderList&&this._reflectionRTT.renderList.push(e)},t.prototype.enableRenderTargets=function(e){var t=e?1:0;this._refractionRTT&&(this._refractionRTT.refreshRate=t),this._reflectionRTT&&(this._reflectionRTT.refreshRate=t)},t.prototype.getRenderList=function(){return this._refractionRTT?this._refractionRTT.renderList:[]},Object.defineProperty(t.prototype,"renderTargetsEnabled",{get:function(){return!(this._refractionRTT&&0===this._refractionRTT.refreshRate)},enumerable:!1,configurable:!0}),t.prototype.needAlphaBlending=function(){return this.alpha<1},t.prototype.needAlphaTesting=function(){return!1},t.prototype.getAlphaTestTexture=function(){return null},t.prototype.isReadyForSubMesh=function(e,t,i){if(this.isFrozen&&t.effect&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t.materialDefines=new se);var n=t._materialDefines,r=this.getScene();if(this._isReadyForSubMesh(t))return!0;var o=r.getEngine();if(n._areTexturesDirty&&(n._needUVs=!1,r.texturesEnabled)){if(this.bumpTexture&&h.k.BumpTextureEnabled){if(!this.bumpTexture.isReady())return!1;n._needUVs=!0,n.BUMP=!0}h.k.ReflectionTextureEnabled&&(n.REFLECTION=!0)}if(a.G.PrepareDefinesForFrameBoundValues(r,o,n,!!i),a.G.PrepareDefinesForMisc(e,r,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e),n),n._areMiscDirty&&(this._fresnelSeparate&&(n.FRESNELSEPARATE=!0),this._bumpSuperimpose&&(n.BUMPSUPERIMPOSE=!0),this._bumpAffectsReflection&&(n.BUMPAFFECTSREFLECTION=!0)),n._needNormals=a.G.PrepareDefinesForLights(r,e,n,!0,this._maxSimultaneousLights,this._disableLighting),n._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(n),n.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,n.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(a.G.PrepareDefinesForAttributes(e,n,!0,!0),this._mesh=e,this._waitingRenderList){for(var s=0;s<this._waitingRenderList.length;s++)this.addToRenderList(r.getNodeById(this._waitingRenderList[s]));this._waitingRenderList=null}if(n.isDirty){n.markAsProcessed(),r.resetCachedMaterial();var l=new p.L;n.FOG&&l.addFallback(1,"FOG"),n.LOGARITHMICDEPTH&&l.addFallback(0,"LOGARITHMICDEPTH"),a.G.HandleFallbacksForShadows(n,l,this.maxSimultaneousLights),n.NUM_BONE_INFLUENCERS>0&&l.addCPUSkinningFallback(0,e);var c=[u.o.PositionKind];n.NORMAL&&c.push(u.o.NormalKind),n.UV1&&c.push(u.o.UVKind),n.UV2&&c.push(u.o.UV2Kind),n.VERTEXCOLOR&&c.push(u.o.ColorKind),a.G.PrepareAttributesForBones(c,e,n,l),a.G.PrepareAttributesForInstances(c,n);var f=n.toString(),_=["world","view","viewProjection","vEyePosition","vLightsType","vDiffuseColor","vSpecularColor","vFogInfos","vFogColor","pointSize","vNormalInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","normalMatrix","logarithmicDepthConstant","worldReflectionViewProjection","windDirection","waveLength","time","windForce","cameraPosition","bumpHeight","waveHeight","waterColor","waterColor2","colorBlendFactor","colorBlendFactor2","waveSpeed","waveCount"],d=["normalSampler","refractionSampler","reflectionSampler"],g=new Array;ne.$&&(ne.$.PrepareUniforms(_,n),ne.$.PrepareSamplers(d,n)),a.G.PrepareUniformsAndSamplersList({uniformsNames:_,uniformBuffersNames:g,samplers:d,defines:n,maxSimultaneousLights:this.maxSimultaneousLights}),t.setEffect(r.getEngine().createEffect("water",{attributes:c,uniformsNames:_,uniformBuffersNames:g,samplers:d,defines:f,fallbacks:l,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights}},o),n,this._materialContext)}return!(!t.effect||!t.effect.isReady()||(n._renderId=r.getRenderId(),t.effect._wasPreviouslyReady=!0,0))},t.prototype.bindForSubMesh=function(e,t,i){var n=this.getScene(),r=i._materialDefines;if(r){var o=i.effect;if(o&&this._mesh){this._activeEffect=o,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("viewProjection",n.getTransformMatrix()),a.G.BindBonesParameters(t,this._activeEffect),this._mustRebind(n,o)&&(this.bumpTexture&&h.k.BumpTextureEnabled&&(this._activeEffect.setTexture("normalSampler",this.bumpTexture),this._activeEffect.setFloat2("vNormalInfos",this.bumpTexture.coordinatesIndex,this.bumpTexture.level),this._activeEffect.setMatrix("normalMatrix",this.bumpTexture.getTextureMatrix())),a.G.BindClipPlane(this._activeEffect,n),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),n.bindEyePosition(o)),this._activeEffect.setColor4("vDiffuseColor",this.diffuseColor,this.alpha*t.visibility),r.SPECULARTERM&&this._activeEffect.setColor4("vSpecularColor",this.specularColor,this.specularPower),n.lightsEnabled&&!this.disableLighting&&a.G.BindLights(n,t,this._activeEffect,r,this.maxSimultaneousLights),n.fogEnabled&&t.applyFog&&n.fogMode!==c.x.FOGMODE_NONE&&this._activeEffect.setMatrix("view",n.getViewMatrix()),a.G.BindFogParameters(n,t,this._activeEffect),a.G.BindLogDepth(r,this._activeEffect,n),h.k.ReflectionTextureEnabled&&(this._activeEffect.setTexture("refractionSampler",this._refractionRTT),this._activeEffect.setTexture("reflectionSampler",this._reflectionRTT));var s=this._mesh.getWorldMatrix().multiply(this._reflectionTransform).multiply(n.getProjectionMatrix()),l=n.getEngine().getDeltaTime();l!==this._lastDeltaTime&&(this._lastDeltaTime=l,this._lastTime+=this._lastDeltaTime),this._activeEffect.setMatrix("worldReflectionViewProjection",s),this._activeEffect.setVector2("windDirection",this.windDirection),this._activeEffect.setFloat("waveLength",this.waveLength),this._activeEffect.setFloat("time",this._lastTime/1e5),this._activeEffect.setFloat("windForce",this.windForce),this._activeEffect.setFloat("waveHeight",this.waveHeight),this._activeEffect.setFloat("bumpHeight",this.bumpHeight),this._activeEffect.setColor4("waterColor",this.waterColor,1),this._activeEffect.setFloat("colorBlendFactor",this.colorBlendFactor),this._activeEffect.setColor4("waterColor2",this.waterColor2,1),this._activeEffect.setFloat("colorBlendFactor2",this.colorBlendFactor2),this._activeEffect.setFloat("waveSpeed",this.waveSpeed),this._activeEffect.setFloat("waveCount",this.waveCount),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect),this._afterBind(t,this._activeEffect)}}},t.prototype._createRenderTargets=function(e,t){var i,n=this;this._refractionRTT=new ie._(name+"_refraction",{width:t.x,height:t.y},e,!1,!0),this._refractionRTT.wrapU=ee.g.TEXTURE_MIRROR_ADDRESSMODE,this._refractionRTT.wrapV=ee.g.TEXTURE_MIRROR_ADDRESSMODE,this._refractionRTT.ignoreCameraViewport=!0,this._reflectionRTT=new ie._(name+"_reflection",{width:t.x,height:t.y},e,!1,!0),this._reflectionRTT.wrapU=ee.g.TEXTURE_MIRROR_ADDRESSMODE,this._reflectionRTT.wrapV=ee.g.TEXTURE_MIRROR_ADDRESSMODE,this._reflectionRTT.ignoreCameraViewport=!0;var r,o=null,s=w.y3.Zero();this._refractionRTT.onBeforeRender=function(){if(n._mesh&&(i=n._mesh.isVisible,n._mesh.isVisible=!1),!n.disableClipPlane){o=e.clipPlane;var t=n._mesh?n._mesh.position.y:0;e.clipPlane=J.J.FromPositionAndNormal(new w.P(0,t+.05,0),new w.P(0,1,0))}},this._refractionRTT.onAfterRender=function(){n._mesh&&(n._mesh.isVisible=i),n.disableClipPlane||(e.clipPlane=o)},this._reflectionRTT.onBeforeRender=function(){if(n._mesh&&(i=n._mesh.isVisible,n._mesh.isVisible=!1),!n.disableClipPlane){o=e.clipPlane;var t=n._mesh?n._mesh.position.y:0;e.clipPlane=J.J.FromPositionAndNormal(new w.P(0,t-.05,0),new w.P(0,-1,0)),w.y3.ReflectionToRef(e.clipPlane,s)}r=e.getViewMatrix(),s.multiplyToRef(r,n._reflectionTransform),e.setTransformMatrix(n._reflectionTransform,e.getProjectionMatrix()),e.getEngine().cullBackFaces=!1,e._mirroredCameraPosition=w.P.TransformCoordinates(e.activeCamera.position,s)},this._reflectionRTT.onAfterRender=function(){n._mesh&&(n._mesh.isVisible=i),e.clipPlane=o,e.setTransformMatrix(r,e.getProjectionMatrix()),e.getEngine().cullBackFaces=null,e._mirroredCameraPosition=null}},t.prototype.getAnimatables=function(){var e=[];return this.bumpTexture&&this.bumpTexture.animations&&this.bumpTexture.animations.length>0&&e.push(this.bumpTexture),this._reflectionRTT&&this._reflectionRTT.animations&&this._reflectionRTT.animations.length>0&&e.push(this._reflectionRTT),this._refractionRTT&&this._refractionRTT.animations&&this._refractionRTT.animations.length>0&&e.push(this._refractionRTT),e},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._bumpTexture&&t.push(this._bumpTexture),t},t.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||this._bumpTexture===t},t.prototype.dispose=function(t){this.bumpTexture&&this.bumpTexture.dispose();var i=this.getScene().customRenderTargets.indexOf(this._refractionRTT);-1!=i&&this.getScene().customRenderTargets.splice(i,1),i=-1,-1!=(i=this.getScene().customRenderTargets.indexOf(this._reflectionRTT))&&this.getScene().customRenderTargets.splice(i,1),this._reflectionRTT&&this._reflectionRTT.dispose(),this._refractionRTT&&this._refractionRTT.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var i=this;return r.p4.Clone((function(){return new t(e,i.getScene())}),this)},t.prototype.serialize=function(){var e=r.p4.Serialize(this);if(e.customType="BABYLON.WaterMaterial",e.renderList=[],this._refractionRTT&&this._refractionRTT.renderList)for(var t=0;t<this._refractionRTT.renderList.length;t++)e.renderList.push(this._refractionRTT.renderList[t].id);return e},t.prototype.getClassName=function(){return"WaterMaterial"},t.Parse=function(e,i,n){var o=r.p4.Parse((function(){return new t(e.name,i)}),e,i,n);return o._waitingRenderList=e.renderList,o},t.CreateDefaultMesh=function(e,t){return re.Kj.CreateGround(e,512,512,32,t,!1)},(0,n.gn)([(0,r.oU)("bumpTexture")],t.prototype,"_bumpTexture",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"bumpTexture",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"diffuseColor",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"specularColor",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"specularPower",void 0),(0,n.gn)([(0,r.qC)("disableLighting")],t.prototype,"_disableLighting",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"disableLighting",void 0),(0,n.gn)([(0,r.qC)("maxSimultaneousLights")],t.prototype,"_maxSimultaneousLights",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsLightsDirty")],t.prototype,"maxSimultaneousLights",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"windForce",void 0),(0,n.gn)([(0,r.QC)()],t.prototype,"windDirection",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"waveHeight",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"bumpHeight",void 0),(0,n.gn)([(0,r.qC)("bumpSuperimpose")],t.prototype,"_bumpSuperimpose",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsMiscDirty")],t.prototype,"bumpSuperimpose",void 0),(0,n.gn)([(0,r.qC)("fresnelSeparate")],t.prototype,"_fresnelSeparate",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsMiscDirty")],t.prototype,"fresnelSeparate",void 0),(0,n.gn)([(0,r.qC)("bumpAffectsReflection")],t.prototype,"_bumpAffectsReflection",void 0),(0,n.gn)([(0,r.wz)("_markAllSubMeshesAsMiscDirty")],t.prototype,"bumpAffectsReflection",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"waterColor",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"colorBlendFactor",void 0),(0,n.gn)([(0,r.n9)()],t.prototype,"waterColor2",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"colorBlendFactor2",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"waveLength",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"waveSpeed",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"waveCount",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"disableClipPlane",void 0),(0,n.gn)([(0,r.qC)()],t.prototype,"useLogarithmicDepth",null),t}(l.a);f.Q.RegisteredTypes["BABYLON.WaterMaterial"]=ae}}]);
//# sourceMappingURL=439.babylonBundle.js.map