(self.webpackChunkbabylonjs_typescript_webpack_simple_scene=self.webpackChunkbabylonjs_typescript_webpack_simple_scene||[]).push([[292],{4292:(e,t,o)=>{"use strict";o.r(t),o.d(t,{Buoyancy:()=>r});var s=o(6506),r=function(){function e(e,t,o){void 0===t&&(t=5),void 0===o&&(o=1),this.enabled=!0,this._size=e,this._displacementMap=null,this._lengthScale=0,this._numSteps=t,this._attenuation=o,this._meshes=[]}return e.prototype.setWaterHeightMap=function(e,t){this._displacementMap=e,this._lengthScale=t},e.prototype.addMesh=function(e,t,o,r){void 0===o&&(o=0),void 0===r&&(r=0),this._meshes.push({mesh:e,frame:t,yOffset:o,spaceCoordinates:r,initQuaternion:e.rotationQuaternion.clone(),curStep:0,curQuaternion:new s.Quaternion,stepQuaternion:new s.Quaternion})},Object.defineProperty(e.prototype,"size",{set:function(e){this._size=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attenuation",{get:function(){return this._attenuation},set:function(e){this._attenuation=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numSteps",{get:function(){return this._numSteps},set:function(e){this._numSteps=e},enumerable:!1,configurable:!0}),e.prototype.update=function(){if(this.enabled)for(var e=0;e<this._meshes.length;++e)this._updateMesh(this._meshes[e])},e.prototype.getWaterHeight=function(e){var t=s.TmpVectors.Vector3[0];return this._getWaterDisplacement(e,t),e.subtractToRef(t,t),this._getWaterDisplacement(e,t),e.subtractToRef(t,t),this._getWaterDisplacement(e,t),e.subtractToRef(t,t),this._getWaterDisplacement(e,t),t.y},e.prototype._updateMesh=function(e){var t=s.TmpVectors.Vector3[5],o=s.TmpVectors.Vector3[6],r=s.TmpVectors.Vector3[7],i=s.TmpVectors.Vector3[8],a=s.TmpVectors.Vector3[9],n=s.TmpVectors.Vector3[10],c=s.TmpVectors.Vector3[11],p=s.TmpVectors.Vector3[12],u=e.mesh,h=e.frame,l=e.yOffset,m=e.spaceCoordinates,f=e.initQuaternion,_=e.curQuaternion,T=e.stepQuaternion,y=e.curStep;s.Vector3.TransformCoordinatesToRef(h.v1,u.getWorldMatrix(),t);var d=this.getWaterHeight(t);if(u.position.y=d+l,h.v2&&h.v3){if(y<this._numSteps)return e.curStep++,_.multiplyToRef(T,_),void f.multiplyToRef(_,u.rotationQuaternion);s.Vector3.TransformCoordinatesToRef(h.v2,u.getWorldMatrix(),o),o.subtractToRef(t,c),c.normalize(),s.Vector3.TransformCoordinatesToRef(h.v3,u.getWorldMatrix(),r),r.subtractToRef(t,p),p.normalize(),t.y=d,i.copyFrom(o),i.y=this.getWaterHeight(o),i.subtractToRef(t,i),i.normalize(),a.copyFrom(r),a.y=this.getWaterHeight(r),a.subtractToRef(t,a),a.normalize(),s.Vector3.CrossToRef(a,i,n),s.Vector3.CrossToRef(i,n,a),a.normalize();var g=Math.acos(s.Scalar.Clamp(s.Vector3.Dot(c,i),0,1))*this._attenuation,V=Math.acos(s.Scalar.Clamp(s.Vector3.Dot(p,a),0,1))*this._attenuation;switch(m){case 0:i.y>c.y&&(g=-g),a.y>p.y&&(V=-V),s.Quaternion.FromEulerAnglesToRef(g/this._numSteps,V/this._numSteps,0,e.stepQuaternion);break;case 1:i.y>c.y&&(g=-g),a.y<p.y&&(V=-V),s.Quaternion.FromEulerAnglesToRef(g/this._numSteps,0,V/this._numSteps,e.stepQuaternion);break;case 2:i.y>c.y&&(g=-g),a.y>p.y&&(V=-V),s.Quaternion.FromEulerAnglesToRef(g/this._numSteps,0,V/this._numSteps,e.stepQuaternion)}e.curStep=0}},e.prototype._getWaterDisplacement=function(e,t){if(this._displacementMap){var o=this._size-1,r=e.x/this._lengthScale*this._size,i=e.z/this._lengthScale*this._size,a=s.TmpVectors.Vector3[1],n=s.TmpVectors.Vector3[2],c=s.TmpVectors.Vector3[3],p=s.TmpVectors.Vector3[4],u=Math.floor(r),h=Math.floor(i),l=r-u,m=i-h;u&=o,h&=o,this._getDisplacement(u,h,a),this._getDisplacement(u+1&o,h,n),n.subtractToRef(a,c).scaleToRef(l,c).addToRef(a,c),this._getDisplacement(u,h+1&o,a),this._getDisplacement(u+1&o,h+1&o,n),n.subtractToRef(a,p).scaleToRef(l,p).addToRef(a,p),p.subtractToRef(c,t).scaleToRef(m,t).addToRef(c,t)}else t.set(e.x,e.y,e.z)},e.prototype._getDisplacement=function(e,t,o){this._displacementMap&&(o.x=s.TextureTools.FromHalfFloat(this._displacementMap[t*this._size*4+4*e+0]),o.y=s.TextureTools.FromHalfFloat(this._displacementMap[t*this._size*4+4*e+1]),o.z=s.TextureTools.FromHalfFloat(this._displacementMap[t*this._size*4+4*e+2]))},e}()}}]);
//# sourceMappingURL=292.babylonBundle.js.map